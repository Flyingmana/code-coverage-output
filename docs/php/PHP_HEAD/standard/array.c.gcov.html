<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - tests.info - standard/array.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">standard</a> - array.c<span style="font-size: 80%;"> (source / <a href="array.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">tests.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">3047</td>
            <td class="headerCovTableEntry">3331</td>
            <td class="headerCovTableEntryHi">91.5 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2021-11-29 14:13:02</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">174</td>
            <td class="headerCovTableEntry">183</td>
            <td class="headerCovTableEntryHi">95.1 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<a name="2"><span class="lineNum">       2 </span>            :    +----------------------------------------------------------------------+</a>
<a name="3"><span class="lineNum">       3 </span>            :    | Copyright (c) The PHP Group                                          |</a>
<a name="4"><span class="lineNum">       4 </span>            :    +----------------------------------------------------------------------+</a>
<a name="5"><span class="lineNum">       5 </span>            :    | This source file is subject to version 3.01 of the PHP license,      |</a>
<a name="6"><span class="lineNum">       6 </span>            :    | that is bundled with this package in the file LICENSE, and is        |</a>
<a name="7"><span class="lineNum">       7 </span>            :    | available through the world-wide-web at the following url:           |</a>
<a name="8"><span class="lineNum">       8 </span>            :    | https://www.php.net/license/3_01.txt                                 |</a>
<a name="9"><span class="lineNum">       9 </span>            :    | If you did not receive a copy of the PHP license and are unable to   |</a>
<a name="10"><span class="lineNum">      10 </span>            :    | obtain it through the world-wide-web, please send a note to          |</a>
<a name="11"><span class="lineNum">      11 </span>            :    | license@php.net so we can mail you a copy immediately.               |</a>
<a name="12"><span class="lineNum">      12 </span>            :    +----------------------------------------------------------------------+</a>
<a name="13"><span class="lineNum">      13 </span>            :    | Authors: Andi Gutmans &lt;andi@php.net&gt;                                 |</a>
<a name="14"><span class="lineNum">      14 </span>            :    |          Zeev Suraski &lt;zeev@php.net&gt;                                 |</a>
<a name="15"><span class="lineNum">      15 </span>            :    |          Rasmus Lerdorf &lt;rasmus@php.net&gt;                             |</a>
<a name="16"><span class="lineNum">      16 </span>            :    |          Andrei Zmievski &lt;andrei@php.net&gt;                            |</a>
<a name="17"><span class="lineNum">      17 </span>            :    |          Stig Venaas &lt;venaas@php.net&gt;                                |</a>
<a name="18"><span class="lineNum">      18 </span>            :    |          Jason Greene &lt;jason@php.net&gt;                                |</a>
<a name="19"><span class="lineNum">      19 </span>            :    +----------------------------------------------------------------------+</a>
<a name="20"><span class="lineNum">      20 </span>            : */</a>
<a name="21"><span class="lineNum">      21 </span>            : </a>
<a name="22"><span class="lineNum">      22 </span>            : #include &quot;php.h&quot;</a>
<a name="23"><span class="lineNum">      23 </span>            : #include &quot;php_ini.h&quot;</a>
<a name="24"><span class="lineNum">      24 </span>            : #include &lt;stdarg.h&gt;</a>
<a name="25"><span class="lineNum">      25 </span>            : #include &lt;stdlib.h&gt;</a>
<a name="26"><span class="lineNum">      26 </span>            : #include &lt;math.h&gt;</a>
<a name="27"><span class="lineNum">      27 </span>            : #include &lt;time.h&gt;</a>
<a name="28"><span class="lineNum">      28 </span>            : #include &lt;stdio.h&gt;</a>
<a name="29"><span class="lineNum">      29 </span>            : #include &lt;string.h&gt;</a>
<a name="30"><span class="lineNum">      30 </span>            : #ifdef PHP_WIN32</a>
<a name="31"><span class="lineNum">      31 </span>            : #include &quot;win32/unistd.h&quot;</a>
<a name="32"><span class="lineNum">      32 </span>            : #endif</a>
<a name="33"><span class="lineNum">      33 </span>            : #include &quot;zend_globals.h&quot;</a>
<a name="34"><span class="lineNum">      34 </span>            : #include &quot;zend_interfaces.h&quot;</a>
<a name="35"><span class="lineNum">      35 </span>            : #include &quot;php_globals.h&quot;</a>
<a name="36"><span class="lineNum">      36 </span>            : #include &quot;php_array.h&quot;</a>
<a name="37"><span class="lineNum">      37 </span>            : #include &quot;basic_functions.h&quot;</a>
<a name="38"><span class="lineNum">      38 </span>            : #include &quot;php_string.h&quot;</a>
<a name="39"><span class="lineNum">      39 </span>            : #include &quot;php_rand.h&quot;</a>
<a name="40"><span class="lineNum">      40 </span>            : #include &quot;php_math.h&quot;</a>
<a name="41"><span class="lineNum">      41 </span>            : #include &quot;zend_smart_str.h&quot;</a>
<a name="42"><span class="lineNum">      42 </span>            : #include &quot;zend_bitset.h&quot;</a>
<a name="43"><span class="lineNum">      43 </span>            : #include &quot;zend_exceptions.h&quot;</a>
<a name="44"><span class="lineNum">      44 </span>            : #include &quot;ext/spl/spl_array.h&quot;</a>
<a name="45"><span class="lineNum">      45 </span>            : </a>
<a name="46"><span class="lineNum">      46 </span>            : /* {{{ defines */</a>
<a name="47"><span class="lineNum">      47 </span>            : #define EXTR_OVERWRITE                  0</a>
<a name="48"><span class="lineNum">      48 </span>            : #define EXTR_SKIP                               1</a>
<a name="49"><span class="lineNum">      49 </span>            : #define EXTR_PREFIX_SAME                2</a>
<a name="50"><span class="lineNum">      50 </span>            : #define EXTR_PREFIX_ALL                 3</a>
<a name="51"><span class="lineNum">      51 </span>            : #define EXTR_PREFIX_INVALID             4</a>
<a name="52"><span class="lineNum">      52 </span>            : #define EXTR_PREFIX_IF_EXISTS   5</a>
<a name="53"><span class="lineNum">      53 </span>            : #define EXTR_IF_EXISTS                  6</a>
<a name="54"><span class="lineNum">      54 </span>            : </a>
<a name="55"><span class="lineNum">      55 </span>            : #define EXTR_REFS                               0x100</a>
<a name="56"><span class="lineNum">      56 </span>            : </a>
<a name="57"><span class="lineNum">      57 </span>            : #define CASE_LOWER                              0</a>
<a name="58"><span class="lineNum">      58 </span>            : #define CASE_UPPER                              1</a>
<a name="59"><span class="lineNum">      59 </span>            : </a>
<a name="60"><span class="lineNum">      60 </span>            : #define DIFF_NORMAL                     1</a>
<a name="61"><span class="lineNum">      61 </span>            : #define DIFF_KEY                        2</a>
<a name="62"><span class="lineNum">      62 </span>            : #define DIFF_ASSOC                      6</a>
<a name="63"><span class="lineNum">      63 </span>            : #define DIFF_COMP_DATA_NONE    -1</a>
<a name="64"><span class="lineNum">      64 </span>            : #define DIFF_COMP_DATA_INTERNAL 0</a>
<a name="65"><span class="lineNum">      65 </span>            : #define DIFF_COMP_DATA_USER     1</a>
<a name="66"><span class="lineNum">      66 </span>            : #define DIFF_COMP_KEY_INTERNAL  0</a>
<a name="67"><span class="lineNum">      67 </span>            : #define DIFF_COMP_KEY_USER      1</a>
<a name="68"><span class="lineNum">      68 </span>            : </a>
<a name="69"><span class="lineNum">      69 </span>            : #define INTERSECT_NORMAL                1</a>
<a name="70"><span class="lineNum">      70 </span>            : #define INTERSECT_KEY                   2</a>
<a name="71"><span class="lineNum">      71 </span>            : #define INTERSECT_ASSOC                 6</a>
<a name="72"><span class="lineNum">      72 </span>            : #define INTERSECT_COMP_DATA_NONE    -1</a>
<a name="73"><span class="lineNum">      73 </span>            : #define INTERSECT_COMP_DATA_INTERNAL 0</a>
<a name="74"><span class="lineNum">      74 </span>            : #define INTERSECT_COMP_DATA_USER     1</a>
<a name="75"><span class="lineNum">      75 </span>            : #define INTERSECT_COMP_KEY_INTERNAL  0</a>
<a name="76"><span class="lineNum">      76 </span>            : #define INTERSECT_COMP_KEY_USER      1</a>
<a name="77"><span class="lineNum">      77 </span>            : /* }}} */</a>
<a name="78"><span class="lineNum">      78 </span>            : </a>
<a name="79"><span class="lineNum">      79 </span>            : ZEND_DECLARE_MODULE_GLOBALS(array)</a>
<a name="80"><span class="lineNum">      80 </span>            : </a>
<a name="81"><span class="lineNum">      81 </span>            : /* {{{ php_array_init_globals */</a>
<a name="82"><span class="lineNum">      82 </span><span class="lineCov">      38769 : static void php_array_init_globals(zend_array_globals *array_globals)</span></a>
<a name="83"><span class="lineNum">      83 </span>            : {</a>
<a name="84"><span class="lineNum">      84 </span><span class="lineCov">      38769 :         memset(array_globals, 0, sizeof(zend_array_globals));</span></a>
<a name="85"><span class="lineNum">      85 </span><span class="lineCov">      38769 : }</span></a>
<a name="86"><span class="lineNum">      86 </span>            : /* }}} */</a>
<a name="87"><span class="lineNum">      87 </span>            : </a>
<a name="88"><span class="lineNum">      88 </span><span class="lineCov">      38769 : PHP_MINIT_FUNCTION(array) /* {{{ */</span></a>
<a name="89"><span class="lineNum">      89 </span>            : {</a>
<a name="90"><span class="lineNum">      90 </span><span class="lineCov">      38769 :         ZEND_INIT_MODULE_GLOBALS(array, php_array_init_globals, NULL);</span></a>
<a name="91"><span class="lineNum">      91 </span>            : </a>
<a name="92"><span class="lineNum">      92 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;EXTR_OVERWRITE&quot;, EXTR_OVERWRITE, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="93"><span class="lineNum">      93 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;EXTR_SKIP&quot;, EXTR_SKIP, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="94"><span class="lineNum">      94 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;EXTR_PREFIX_SAME&quot;, EXTR_PREFIX_SAME, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="95"><span class="lineNum">      95 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;EXTR_PREFIX_ALL&quot;, EXTR_PREFIX_ALL, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="96"><span class="lineNum">      96 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;EXTR_PREFIX_INVALID&quot;, EXTR_PREFIX_INVALID, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="97"><span class="lineNum">      97 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;EXTR_PREFIX_IF_EXISTS&quot;, EXTR_PREFIX_IF_EXISTS, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="98"><span class="lineNum">      98 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;EXTR_IF_EXISTS&quot;, EXTR_IF_EXISTS, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="99"><span class="lineNum">      99 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;EXTR_REFS&quot;, EXTR_REFS, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="100"><span class="lineNum">     100 </span>            : </a>
<a name="101"><span class="lineNum">     101 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;SORT_ASC&quot;, PHP_SORT_ASC, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="102"><span class="lineNum">     102 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;SORT_DESC&quot;, PHP_SORT_DESC, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="103"><span class="lineNum">     103 </span>            : </a>
<a name="104"><span class="lineNum">     104 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;SORT_REGULAR&quot;, PHP_SORT_REGULAR, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="105"><span class="lineNum">     105 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;SORT_NUMERIC&quot;, PHP_SORT_NUMERIC, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="106"><span class="lineNum">     106 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;SORT_STRING&quot;, PHP_SORT_STRING, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="107"><span class="lineNum">     107 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;SORT_LOCALE_STRING&quot;, PHP_SORT_LOCALE_STRING, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="108"><span class="lineNum">     108 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;SORT_NATURAL&quot;, PHP_SORT_NATURAL, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="109"><span class="lineNum">     109 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;SORT_FLAG_CASE&quot;, PHP_SORT_FLAG_CASE, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="110"><span class="lineNum">     110 </span>            : </a>
<a name="111"><span class="lineNum">     111 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;CASE_LOWER&quot;, CASE_LOWER, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="112"><span class="lineNum">     112 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;CASE_UPPER&quot;, CASE_UPPER, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="113"><span class="lineNum">     113 </span>            : </a>
<a name="114"><span class="lineNum">     114 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;COUNT_NORMAL&quot;, COUNT_NORMAL, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="115"><span class="lineNum">     115 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;COUNT_RECURSIVE&quot;, COUNT_RECURSIVE, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="116"><span class="lineNum">     116 </span>            : </a>
<a name="117"><span class="lineNum">     117 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;ARRAY_FILTER_USE_BOTH&quot;, ARRAY_FILTER_USE_BOTH, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="118"><span class="lineNum">     118 </span><span class="lineCov">      38769 :         REGISTER_LONG_CONSTANT(&quot;ARRAY_FILTER_USE_KEY&quot;, ARRAY_FILTER_USE_KEY, CONST_CS | CONST_PERSISTENT);</span></a>
<a name="119"><span class="lineNum">     119 </span>            : </a>
<a name="120"><span class="lineNum">     120 </span><span class="lineCov">      38769 :         return SUCCESS;</span></a>
<a name="121"><span class="lineNum">     121 </span>            : }</a>
<a name="122"><span class="lineNum">     122 </span>            : /* }}} */</a>
<a name="123"><span class="lineNum">     123 </span>            : </a>
<a name="124"><span class="lineNum">     124 </span><span class="lineCov">      38766 : PHP_MSHUTDOWN_FUNCTION(array) /* {{{ */</span></a>
<a name="125"><span class="lineNum">     125 </span>            : {</a>
<a name="126"><span class="lineNum">     126 </span>            : #ifdef ZTS</a>
<a name="127"><span class="lineNum">     127 </span>            :         ts_free_id(array_globals_id);</a>
<a name="128"><span class="lineNum">     128 </span>            : #endif</a>
<a name="129"><span class="lineNum">     129 </span>            : </a>
<a name="130"><span class="lineNum">     130 </span><span class="lineCov">      38766 :         return SUCCESS;</span></a>
<a name="131"><span class="lineNum">     131 </span>            : }</a>
<a name="132"><span class="lineNum">     132 </span>            : /* }}} */</a>
<a name="133"><span class="lineNum">     133 </span>            : </a>
<a name="134"><span class="lineNum">     134 </span><span class="lineCov">     340125 : static zend_never_inline ZEND_COLD int stable_sort_fallback(Bucket *a, Bucket *b) {</span></a>
<a name="135"><span class="lineNum">     135 </span><span class="lineCov">     340125 :         if (Z_EXTRA(a-&gt;val) &gt; Z_EXTRA(b-&gt;val)) {</span></a>
<a name="136"><span class="lineNum">     136 </span><span class="lineCov">     302652 :                 return 1;</span></a>
<a name="137"><span class="lineNum">     137 </span><span class="lineCov">      37473 :         } else if (Z_EXTRA(a-&gt;val) &lt; Z_EXTRA(b-&gt;val)) {</span></a>
<a name="138"><span class="lineNum">     138 </span><span class="lineCov">      37473 :                 return -1;</span></a>
<a name="139"><span class="lineNum">     139 </span>            :         } else {</a>
<a name="140"><span class="lineNum">     140 </span><span class="lineNoCov">          0 :                 return 0;</span></a>
<a name="141"><span class="lineNum">     141 </span>            :         }</a>
<a name="142"><span class="lineNum">     142 </span>            : }</a>
<a name="143"><span class="lineNum">     143 </span>            : </a>
<a name="144"><span class="lineNum">     144 </span>            : #define RETURN_STABLE_SORT(a, b, result) do { \</a>
<a name="145"><span class="lineNum">     145 </span>            :         int _result = (result); \</a>
<a name="146"><span class="lineNum">     146 </span>            :         if (EXPECTED(_result)) { \</a>
<a name="147"><span class="lineNum">     147 </span>            :                 return _result; \</a>
<a name="148"><span class="lineNum">     148 </span>            :         } \</a>
<a name="149"><span class="lineNum">     149 </span>            :         return stable_sort_fallback((a), (b)); \</a>
<a name="150"><span class="lineNum">     150 </span>            : } while (0)</a>
<a name="151"><span class="lineNum">     151 </span>            : </a>
<a name="152"><span class="lineNum">     152 </span>            : /* Generate inlined unstable and stable variants, and non-inlined reversed variants. */</a>
<a name="153"><span class="lineNum">     153 </span>            : #define DEFINE_SORT_VARIANTS(name) \</a>
<a name="154"><span class="lineNum">     154 </span>            :         static zend_never_inline int php_array_##name##_unstable(Bucket *a, Bucket *b) { \</a>
<a name="155"><span class="lineNum">     155 </span>            :                 return php_array_##name##_unstable_i(a, b); \</a>
<a name="156"><span class="lineNum">     156 </span>            :         } \</a>
<a name="157"><span class="lineNum">     157 </span>            :         static zend_never_inline int php_array_##name(Bucket *a, Bucket *b) { \</a>
<a name="158"><span class="lineNum">     158 </span>            :                 RETURN_STABLE_SORT(a, b, php_array_##name##_unstable_i(a, b)); \</a>
<a name="159"><span class="lineNum">     159 </span>            :         } \</a>
<a name="160"><span class="lineNum">     160 </span>            :         static zend_never_inline int php_array_reverse_##name##_unstable(Bucket *a, Bucket *b) { \</a>
<a name="161"><span class="lineNum">     161 </span>            :                 return php_array_##name##_unstable(a, b) * -1; \</a>
<a name="162"><span class="lineNum">     162 </span>            :         } \</a>
<a name="163"><span class="lineNum">     163 </span>            :         static zend_never_inline int php_array_reverse_##name(Bucket *a, Bucket *b) { \</a>
<a name="164"><span class="lineNum">     164 </span>            :                 RETURN_STABLE_SORT(a, b, php_array_reverse_##name##_unstable(a, b)); \</a>
<a name="165"><span class="lineNum">     165 </span>            :         } \</a>
<a name="166"><span class="lineNum">     166 </span>            : </a>
<a name="167"><span class="lineNum">     167 </span>            : static zend_always_inline int php_array_key_compare_unstable_i(Bucket *f, Bucket *s) /* {{{ */</a>
<a name="168"><span class="lineNum">     168 </span>            : {</a>
<a name="169"><span class="lineNum">     169 </span>            :         zend_uchar t;</a>
<a name="170"><span class="lineNum">     170 </span>            :         zend_long l1, l2;</a>
<a name="171"><span class="lineNum">     171 </span>            :         double d;</a>
<a name="172"><span class="lineNum">     172 </span>            : </a>
<a name="173"><span class="lineNum">     173 </span><span class="lineCov">       4432 :         if (f-&gt;key == NULL) {</span></a>
<a name="174"><span class="lineNum">     174 </span><span class="lineCov">       2575 :                 if (s-&gt;key == NULL) {</span></a>
<a name="175"><span class="lineNum">     175 </span><span class="lineCov">       2443 :                         return (zend_long)f-&gt;h &gt; (zend_long)s-&gt;h ? 1 : -1;</span></a>
<a name="176"><span class="lineNum">     176 </span>            :                 } else {</a>
<a name="177"><span class="lineNum">     177 </span><span class="lineCov">        132 :                         l1 = (zend_long)f-&gt;h;</span></a>
<a name="178"><span class="lineNum">     178 </span><span class="lineCov">        132 :                         t = is_numeric_string(s-&gt;key-&gt;val, s-&gt;key-&gt;len, &amp;l2, &amp;d, 1);</span></a>
<a name="179"><span class="lineNum">     179 </span><span class="lineCov">        132 :                         if (t == IS_LONG) {</span></a>
<a name="180"><span class="lineNum">     180 </span>            :                                 /* pass */</a>
<a name="181"><span class="lineNum">     181 </span><span class="lineCov">        132 :                         } else if (t == IS_DOUBLE) {</span></a>
<a name="182"><span class="lineNum">     182 </span><span class="lineCov">         12 :                                 return ZEND_NORMALIZE_BOOL((double)l1 - d);</span></a>
<a name="183"><span class="lineNum">     183 </span>            :                         } else {</a>
<a name="184"><span class="lineNum">     184 </span><span class="lineCov">        120 :                                 l2 = 0;</span></a>
<a name="185"><span class="lineNum">     185 </span>            :                         }</a>
<a name="186"><span class="lineNum">     186 </span>            :                 }</a>
<a name="187"><span class="lineNum">     187 </span>            :         } else {</a>
<a name="188"><span class="lineNum">     188 </span><span class="lineCov">       1857 :                 if (s-&gt;key) {</span></a>
<a name="189"><span class="lineNum">     189 </span><span class="lineCov">       1734 :                         return zendi_smart_strcmp(f-&gt;key, s-&gt;key);</span></a>
<a name="190"><span class="lineNum">     190 </span>            :                 } else {</a>
<a name="191"><span class="lineNum">     191 </span><span class="lineCov">        123 :                         l2 = (zend_long)s-&gt;h;</span></a>
<a name="192"><span class="lineNum">     192 </span><span class="lineCov">        123 :                         t = is_numeric_string(f-&gt;key-&gt;val, f-&gt;key-&gt;len, &amp;l1, &amp;d, 1);</span></a>
<a name="193"><span class="lineNum">     193 </span><span class="lineCov">        123 :                         if (t == IS_LONG) {</span></a>
<a name="194"><span class="lineNum">     194 </span>            :                                 /* pass */</a>
<a name="195"><span class="lineNum">     195 </span><span class="lineCov">        123 :                         } else if (t == IS_DOUBLE) {</span></a>
<a name="196"><span class="lineNum">     196 </span><span class="lineCov">         12 :                                 return ZEND_NORMALIZE_BOOL(d - (double)l2);</span></a>
<a name="197"><span class="lineNum">     197 </span>            :                         } else {</a>
<a name="198"><span class="lineNum">     198 </span><span class="lineCov">        111 :                                 l1 = 0;</span></a>
<a name="199"><span class="lineNum">     199 </span>            :                         }</a>
<a name="200"><span class="lineNum">     200 </span>            :                 }</a>
<a name="201"><span class="lineNum">     201 </span>            :         }</a>
<a name="202"><span class="lineNum">     202 </span><span class="lineCov">        231 :         return ZEND_NORMALIZE_BOOL(l1 - l2);</span></a>
<a name="203"><span class="lineNum">     203 </span>            : }</a>
<a name="204"><span class="lineNum">     204 </span>            : /* }}} */</a>
<a name="205"><span class="lineNum">     205 </span>            : </a>
<a name="206"><span class="lineNum">     206 </span>            : static zend_always_inline int php_array_key_compare_numeric_unstable_i(Bucket *f, Bucket *s) /* {{{ */</a>
<a name="207"><span class="lineNum">     207 </span>            : {</a>
<a name="208"><span class="lineNum">     208 </span><span class="lineCov">        576 :         if (f-&gt;key == NULL &amp;&amp; s-&gt;key == NULL) {</span></a>
<a name="209"><span class="lineNum">     209 </span><span class="lineCov">        570 :                 return (zend_long)f-&gt;h &gt; (zend_long)s-&gt;h ? 1 : -1;</span></a>
<a name="210"><span class="lineNum">     210 </span>            :         } else {</a>
<a name="211"><span class="lineNum">     211 </span>            :                 double d1, d2;</a>
<a name="212"><span class="lineNum">     212 </span><span class="lineCov">         12 :                 if (f-&gt;key) {</span></a>
<a name="213"><span class="lineNum">     213 </span><span class="lineCov">          6 :                         d1 = zend_strtod(f-&gt;key-&gt;val, NULL);</span></a>
<a name="214"><span class="lineNum">     214 </span>            :                 } else {</a>
<a name="215"><span class="lineNum">     215 </span><span class="lineCov">          6 :                         d1 = (double)(zend_long)f-&gt;h;</span></a>
<a name="216"><span class="lineNum">     216 </span>            :                 }</a>
<a name="217"><span class="lineNum">     217 </span><span class="lineCov">         12 :                 if (s-&gt;key) {</span></a>
<a name="218"><span class="lineNum">     218 </span><span class="lineCov">          6 :                         d2 = zend_strtod(s-&gt;key-&gt;val, NULL);</span></a>
<a name="219"><span class="lineNum">     219 </span>            :                 } else {</a>
<a name="220"><span class="lineNum">     220 </span><span class="lineCov">          6 :                         d2 = (double)(zend_long)s-&gt;h;</span></a>
<a name="221"><span class="lineNum">     221 </span>            :                 }</a>
<a name="222"><span class="lineNum">     222 </span><span class="lineCov">         12 :                 return ZEND_NORMALIZE_BOOL(d1 - d2);</span></a>
<a name="223"><span class="lineNum">     223 </span>            :         }</a>
<a name="224"><span class="lineNum">     224 </span>            : }</a>
<a name="225"><span class="lineNum">     225 </span>            : /* }}} */</a>
<a name="226"><span class="lineNum">     226 </span>            : </a>
<a name="227"><span class="lineNum">     227 </span>            : static zend_always_inline int php_array_key_compare_string_case_unstable_i(Bucket *f, Bucket *s) /* {{{ */</a>
<a name="228"><span class="lineNum">     228 </span>            : {</a>
<a name="229"><span class="lineNum">     229 </span>            :         const char *s1, *s2;</a>
<a name="230"><span class="lineNum">     230 </span>            :         size_t l1, l2;</a>
<a name="231"><span class="lineNum">     231 </span>            :         char buf1[MAX_LENGTH_OF_LONG + 1];</a>
<a name="232"><span class="lineNum">     232 </span>            :         char buf2[MAX_LENGTH_OF_LONG + 1];</a>
<a name="233"><span class="lineNum">     233 </span>            : </a>
<a name="234"><span class="lineNum">     234 </span><span class="lineCov">         96 :         if (f-&gt;key) {</span></a>
<a name="235"><span class="lineNum">     235 </span><span class="lineCov">         96 :                 s1 = f-&gt;key-&gt;val;</span></a>
<a name="236"><span class="lineNum">     236 </span><span class="lineCov">         96 :                 l1 = f-&gt;key-&gt;len;</span></a>
<a name="237"><span class="lineNum">     237 </span>            :         } else {</a>
<a name="238"><span class="lineNum">     238 </span><span class="lineNoCov">          0 :                 s1 = zend_print_long_to_buf(buf1 + sizeof(buf1) - 1, f-&gt;h);</span></a>
<a name="239"><span class="lineNum">     239 </span><span class="lineNoCov">          0 :                 l1 = buf1 + sizeof(buf1) - 1 - s1;</span></a>
<a name="240"><span class="lineNum">     240 </span>            :         }</a>
<a name="241"><span class="lineNum">     241 </span><span class="lineCov">         96 :         if (s-&gt;key) {</span></a>
<a name="242"><span class="lineNum">     242 </span><span class="lineCov">         96 :                 s2 = s-&gt;key-&gt;val;</span></a>
<a name="243"><span class="lineNum">     243 </span><span class="lineCov">         96 :                 l2 = s-&gt;key-&gt;len;</span></a>
<a name="244"><span class="lineNum">     244 </span>            :         } else {</a>
<a name="245"><span class="lineNum">     245 </span><span class="lineNoCov">          0 :                 s2 = zend_print_long_to_buf(buf2 + sizeof(buf2) - 1, s-&gt;h);</span></a>
<a name="246"><span class="lineNum">     246 </span><span class="lineNoCov">          0 :                 l2 = buf2 + sizeof(buf2) - 1 - s1;</span></a>
<a name="247"><span class="lineNum">     247 </span>            :         }</a>
<a name="248"><span class="lineNum">     248 </span><span class="lineCov">         96 :         return zend_binary_strcasecmp_l(s1, l1, s2, l2);</span></a>
<a name="249"><span class="lineNum">     249 </span>            : }</a>
<a name="250"><span class="lineNum">     250 </span>            : /* }}} */</a>
<a name="251"><span class="lineNum">     251 </span>            : </a>
<a name="252"><span class="lineNum">     252 </span>            : static zend_always_inline int php_array_key_compare_string_unstable_i(Bucket *f, Bucket *s) /* {{{ */</a>
<a name="253"><span class="lineNum">     253 </span>            : {</a>
<a name="254"><span class="lineNum">     254 </span>            :         const char *s1, *s2;</a>
<a name="255"><span class="lineNum">     255 </span>            :         size_t l1, l2;</a>
<a name="256"><span class="lineNum">     256 </span>            :         char buf1[MAX_LENGTH_OF_LONG + 1];</a>
<a name="257"><span class="lineNum">     257 </span>            :         char buf2[MAX_LENGTH_OF_LONG + 1];</a>
<a name="258"><span class="lineNum">     258 </span>            : </a>
<a name="259"><span class="lineNum">     259 </span><span class="lineCov">        627 :         if (f-&gt;key) {</span></a>
<a name="260"><span class="lineNum">     260 </span><span class="lineCov">        537 :                 s1 = f-&gt;key-&gt;val;</span></a>
<a name="261"><span class="lineNum">     261 </span><span class="lineCov">        537 :                 l1 = f-&gt;key-&gt;len;</span></a>
<a name="262"><span class="lineNum">     262 </span>            :         } else {</a>
<a name="263"><span class="lineNum">     263 </span><span class="lineCov">         90 :                 s1 = zend_print_long_to_buf(buf1 + sizeof(buf1) - 1, f-&gt;h);</span></a>
<a name="264"><span class="lineNum">     264 </span><span class="lineCov">         90 :                 l1 = buf1 + sizeof(buf1) - 1 - s1;</span></a>
<a name="265"><span class="lineNum">     265 </span>            :         }</a>
<a name="266"><span class="lineNum">     266 </span><span class="lineCov">        627 :         if (s-&gt;key) {</span></a>
<a name="267"><span class="lineNum">     267 </span><span class="lineCov">        522 :                 s2 = s-&gt;key-&gt;val;</span></a>
<a name="268"><span class="lineNum">     268 </span><span class="lineCov">        522 :                 l2 = s-&gt;key-&gt;len;</span></a>
<a name="269"><span class="lineNum">     269 </span>            :         } else {</a>
<a name="270"><span class="lineNum">     270 </span><span class="lineCov">        105 :                 s2 = zend_print_long_to_buf(buf2 + sizeof(buf2) - 1, s-&gt;h);</span></a>
<a name="271"><span class="lineNum">     271 </span><span class="lineCov">        105 :                 l2 = buf2 + sizeof(buf2) - 1 - s2;</span></a>
<a name="272"><span class="lineNum">     272 </span>            :         }</a>
<a name="273"><span class="lineNum">     273 </span><span class="lineCov">        627 :         return zend_binary_strcmp(s1, l1, s2, l2);</span></a>
<a name="274"><span class="lineNum">     274 </span>            : }</a>
<a name="275"><span class="lineNum">     275 </span>            : /* }}} */</a>
<a name="276"><span class="lineNum">     276 </span>            : </a>
<a name="277"><span class="lineNum">     277 </span><span class="lineCov">        195 : static int php_array_key_compare_string_natural_general(Bucket *f, Bucket *s, int fold_case) /* {{{ */</span></a>
<a name="278"><span class="lineNum">     278 </span>            : {</a>
<a name="279"><span class="lineNum">     279 </span>            :         const char *s1, *s2;</a>
<a name="280"><span class="lineNum">     280 </span>            :         size_t l1, l2;</a>
<a name="281"><span class="lineNum">     281 </span>            :         char buf1[MAX_LENGTH_OF_LONG + 1];</a>
<a name="282"><span class="lineNum">     282 </span>            :         char buf2[MAX_LENGTH_OF_LONG + 1];</a>
<a name="283"><span class="lineNum">     283 </span>            : </a>
<a name="284"><span class="lineNum">     284 </span><span class="lineCov">        195 :         if (f-&gt;key) {</span></a>
<a name="285"><span class="lineNum">     285 </span><span class="lineCov">        195 :                 s1 = f-&gt;key-&gt;val;</span></a>
<a name="286"><span class="lineNum">     286 </span><span class="lineCov">        195 :                 l1 = f-&gt;key-&gt;len;</span></a>
<a name="287"><span class="lineNum">     287 </span>            :         } else {</a>
<a name="288"><span class="lineNum">     288 </span><span class="lineNoCov">          0 :                 s1 = zend_print_long_to_buf(buf1 + sizeof(buf1) - 1, f-&gt;h);</span></a>
<a name="289"><span class="lineNum">     289 </span><span class="lineNoCov">          0 :                 l1 = buf1 + sizeof(buf1) - 1 - s1;</span></a>
<a name="290"><span class="lineNum">     290 </span>            :         }</a>
<a name="291"><span class="lineNum">     291 </span><span class="lineCov">        195 :         if (s-&gt;key) {</span></a>
<a name="292"><span class="lineNum">     292 </span><span class="lineCov">        195 :                 s2 = s-&gt;key-&gt;val;</span></a>
<a name="293"><span class="lineNum">     293 </span><span class="lineCov">        195 :                 l2 = s-&gt;key-&gt;len;</span></a>
<a name="294"><span class="lineNum">     294 </span>            :         } else {</a>
<a name="295"><span class="lineNum">     295 </span><span class="lineNoCov">          0 :                 s2 = zend_print_long_to_buf(buf2 + sizeof(buf2) - 1, s-&gt;h);</span></a>
<a name="296"><span class="lineNum">     296 </span><span class="lineNoCov">          0 :                 l2 = buf2 + sizeof(buf2) - 1 - s1;</span></a>
<a name="297"><span class="lineNum">     297 </span>            :         }</a>
<a name="298"><span class="lineNum">     298 </span><span class="lineCov">        195 :         return strnatcmp_ex(s1, l1, s2, l2, fold_case);</span></a>
<a name="299"><span class="lineNum">     299 </span>            : }</a>
<a name="300"><span class="lineNum">     300 </span>            : /* }}} */</a>
<a name="301"><span class="lineNum">     301 </span>            : </a>
<a name="302"><span class="lineNum">     302 </span><span class="lineCov">         30 : static int php_array_key_compare_string_natural_case(Bucket *a, Bucket *b) /* {{{ */</span></a>
<a name="303"><span class="lineNum">     303 </span>            : {</a>
<a name="304"><span class="lineNum">     304 </span><span class="lineCov">         30 :         RETURN_STABLE_SORT(a, b, php_array_key_compare_string_natural_general(a, b, 1));</span></a>
<a name="305"><span class="lineNum">     305 </span>            : }</a>
<a name="306"><span class="lineNum">     306 </span>            : /* }}} */</a>
<a name="307"><span class="lineNum">     307 </span>            : </a>
<a name="308"><span class="lineNum">     308 </span><span class="lineCov">         60 : static int php_array_reverse_key_compare_string_natural_case(Bucket *a, Bucket *b) /* {{{ */</span></a>
<a name="309"><span class="lineNum">     309 </span>            : {</a>
<a name="310"><span class="lineNum">     310 </span><span class="lineCov">         60 :         RETURN_STABLE_SORT(a, b, php_array_key_compare_string_natural_general(b, a, 1));</span></a>
<a name="311"><span class="lineNum">     311 </span>            : }</a>
<a name="312"><span class="lineNum">     312 </span>            : /* }}} */</a>
<a name="313"><span class="lineNum">     313 </span>            : </a>
<a name="314"><span class="lineNum">     314 </span><span class="lineCov">         48 : static int php_array_key_compare_string_natural(Bucket *a, Bucket *b) /* {{{ */</span></a>
<a name="315"><span class="lineNum">     315 </span>            : {</a>
<a name="316"><span class="lineNum">     316 </span><span class="lineCov">         48 :         RETURN_STABLE_SORT(a, b, php_array_key_compare_string_natural_general(a, b, 0));</span></a>
<a name="317"><span class="lineNum">     317 </span>            : }</a>
<a name="318"><span class="lineNum">     318 </span>            : /* }}} */</a>
<a name="319"><span class="lineNum">     319 </span>            : </a>
<a name="320"><span class="lineNum">     320 </span><span class="lineCov">         57 : static int php_array_reverse_key_compare_string_natural(Bucket *a, Bucket *b) /* {{{ */</span></a>
<a name="321"><span class="lineNum">     321 </span>            : {</a>
<a name="322"><span class="lineNum">     322 </span><span class="lineCov">         57 :         RETURN_STABLE_SORT(a, b, php_array_key_compare_string_natural_general(b, a, 0));</span></a>
<a name="323"><span class="lineNum">     323 </span>            : }</a>
<a name="324"><span class="lineNum">     324 </span>            : /* }}} */</a>
<a name="325"><span class="lineNum">     325 </span>            : </a>
<a name="326"><span class="lineNum">     326 </span>            : static zend_always_inline int php_array_key_compare_string_locale_unstable_i(Bucket *f, Bucket *s) /* {{{ */</a>
<a name="327"><span class="lineNum">     327 </span>            : {</a>
<a name="328"><span class="lineNum">     328 </span>            :         const char *s1, *s2;</a>
<a name="329"><span class="lineNum">     329 </span>            :         char buf1[MAX_LENGTH_OF_LONG + 1];</a>
<a name="330"><span class="lineNum">     330 </span>            :         char buf2[MAX_LENGTH_OF_LONG + 1];</a>
<a name="331"><span class="lineNum">     331 </span>            : </a>
<a name="332"><span class="lineNum">     332 </span><span class="lineNoCov">          0 :         if (f-&gt;key) {</span></a>
<a name="333"><span class="lineNum">     333 </span><span class="lineNoCov">          0 :                 s1 = f-&gt;key-&gt;val;</span></a>
<a name="334"><span class="lineNum">     334 </span>            :         } else {</a>
<a name="335"><span class="lineNum">     335 </span><span class="lineNoCov">          0 :                 s1 = zend_print_long_to_buf(buf1 + sizeof(buf1) - 1, f-&gt;h);</span></a>
<a name="336"><span class="lineNum">     336 </span>            :         }</a>
<a name="337"><span class="lineNum">     337 </span><span class="lineNoCov">          0 :         if (s-&gt;key) {</span></a>
<a name="338"><span class="lineNum">     338 </span><span class="lineNoCov">          0 :                 s2 = s-&gt;key-&gt;val;</span></a>
<a name="339"><span class="lineNum">     339 </span>            :         } else {</a>
<a name="340"><span class="lineNum">     340 </span><span class="lineNoCov">          0 :                 s2 = zend_print_long_to_buf(buf2 + sizeof(buf2) - 1, s-&gt;h);</span></a>
<a name="341"><span class="lineNum">     341 </span>            :         }</a>
<a name="342"><span class="lineNum">     342 </span><span class="lineNoCov">          0 :         return strcoll(s1, s2);</span></a>
<a name="343"><span class="lineNum">     343 </span>            : }</a>
<a name="344"><span class="lineNum">     344 </span>            : /* }}} */</a>
<a name="345"><span class="lineNum">     345 </span>            : </a>
<a name="346"><span class="lineNum">     346 </span>            : static zend_always_inline int php_array_data_compare_unstable_i(Bucket *f, Bucket *s) /* {{{ */</a>
<a name="347"><span class="lineNum">     347 </span>            : {</a>
<a name="348"><span class="lineNum">     348 </span><span class="lineCov">     113316 :         return zend_compare(&amp;f-&gt;val, &amp;s-&gt;val);</span></a>
<a name="349"><span class="lineNum">     349 </span>            : }</a>
<a name="350"><span class="lineNum">     350 </span>            : /* }}} */</a>
<a name="351"><span class="lineNum">     351 </span>            : </a>
<a name="352"><span class="lineNum">     352 </span>            : static zend_always_inline int php_array_data_compare_numeric_unstable_i(Bucket *f, Bucket *s) /* {{{ */</a>
<a name="353"><span class="lineNum">     353 </span>            : {</a>
<a name="354"><span class="lineNum">     354 </span><span class="lineCov">       1632 :         return numeric_compare_function(&amp;f-&gt;val, &amp;s-&gt;val);</span></a>
<a name="355"><span class="lineNum">     355 </span>            : }</a>
<a name="356"><span class="lineNum">     356 </span>            : /* }}} */</a>
<a name="357"><span class="lineNum">     357 </span>            : </a>
<a name="358"><span class="lineNum">     358 </span>            : static zend_always_inline int php_array_data_compare_string_case_unstable_i(Bucket *f, Bucket *s) /* {{{ */</a>
<a name="359"><span class="lineNum">     359 </span>            : {</a>
<a name="360"><span class="lineNum">     360 </span><span class="lineCov">        222 :         return string_case_compare_function(&amp;f-&gt;val, &amp;s-&gt;val);</span></a>
<a name="361"><span class="lineNum">     361 </span>            : }</a>
<a name="362"><span class="lineNum">     362 </span>            : /* }}} */</a>
<a name="363"><span class="lineNum">     363 </span>            : </a>
<a name="364"><span class="lineNum">     364 </span>            : static zend_always_inline int php_array_data_compare_string_unstable_i(Bucket *f, Bucket *s) /* {{{ */</a>
<a name="365"><span class="lineNum">     365 </span>            : {</a>
<a name="366"><span class="lineNum">     366 </span><span class="lineCov">      33509 :         return string_compare_function(&amp;f-&gt;val, &amp;s-&gt;val);</span></a>
<a name="367"><span class="lineNum">     367 </span>            : }</a>
<a name="368"><span class="lineNum">     368 </span>            : /* }}} */</a>
<a name="369"><span class="lineNum">     369 </span>            : </a>
<a name="370"><span class="lineNum">     370 </span><span class="lineCov">       1662 : static int php_array_natural_general_compare(Bucket *f, Bucket *s, int fold_case) /* {{{ */</span></a>
<a name="371"><span class="lineNum">     371 </span>            : {</a>
<a name="372"><span class="lineNum">     372 </span>            :         zend_string *tmp_str1, *tmp_str2;</a>
<a name="373"><span class="lineNum">     373 </span><span class="lineCov">       1662 :         zend_string *str1 = zval_get_tmp_string(&amp;f-&gt;val, &amp;tmp_str1);</span></a>
<a name="374"><span class="lineNum">     374 </span><span class="lineCov">       1662 :         zend_string *str2 = zval_get_tmp_string(&amp;s-&gt;val, &amp;tmp_str2);</span></a>
<a name="375"><span class="lineNum">     375 </span>            : </a>
<a name="376"><span class="lineNum">     376 </span><span class="lineCov">       1662 :         int result = strnatcmp_ex(ZSTR_VAL(str1), ZSTR_LEN(str1), ZSTR_VAL(str2), ZSTR_LEN(str2), fold_case);</span></a>
<a name="377"><span class="lineNum">     377 </span>            : </a>
<a name="378"><span class="lineNum">     378 </span><span class="lineCov">       1662 :         zend_tmp_string_release(tmp_str1);</span></a>
<a name="379"><span class="lineNum">     379 </span><span class="lineCov">       1662 :         zend_tmp_string_release(tmp_str2);</span></a>
<a name="380"><span class="lineNum">     380 </span><span class="lineCov">       1662 :         return result;</span></a>
<a name="381"><span class="lineNum">     381 </span>            : }</a>
<a name="382"><span class="lineNum">     382 </span>            : /* }}} */</a>
<a name="383"><span class="lineNum">     383 </span>            : </a>
<a name="384"><span class="lineNum">     384 </span>            : static zend_always_inline int php_array_natural_compare_unstable_i(Bucket *a, Bucket *b) /* {{{ */</a>
<a name="385"><span class="lineNum">     385 </span>            : {</a>
<a name="386"><span class="lineNum">     386 </span><span class="lineCov">        462 :         return php_array_natural_general_compare(a, b, 0);</span></a>
<a name="387"><span class="lineNum">     387 </span>            : }</a>
<a name="388"><span class="lineNum">     388 </span>            : /* }}} */</a>
<a name="389"><span class="lineNum">     389 </span>            : </a>
<a name="390"><span class="lineNum">     390 </span>            : static zend_always_inline int php_array_natural_case_compare_unstable_i(Bucket *a, Bucket *b) /* {{{ */</a>
<a name="391"><span class="lineNum">     391 </span>            : {</a>
<a name="392"><span class="lineNum">     392 </span><span class="lineCov">       1200 :         return php_array_natural_general_compare(a, b, 1);</span></a>
<a name="393"><span class="lineNum">     393 </span>            : }</a>
<a name="394"><span class="lineNum">     394 </span>            : /* }}} */</a>
<a name="395"><span class="lineNum">     395 </span>            : </a>
<a name="396"><span class="lineNum">     396 </span><span class="lineNoCov">          0 : static int php_array_data_compare_string_locale_unstable_i(Bucket *f, Bucket *s) /* {{{ */</span></a>
<a name="397"><span class="lineNum">     397 </span>            : {</a>
<a name="398"><span class="lineNum">     398 </span><span class="lineNoCov">          0 :         return string_locale_compare_function(&amp;f-&gt;val, &amp;s-&gt;val);</span></a>
<a name="399"><span class="lineNum">     399 </span>            : }</a>
<a name="400"><span class="lineNum">     400 </span>            : /* }}} */</a>
<a name="401"><span class="lineNum">     401 </span>            : </a>
<a name="402"><span class="lineNum">     402 </span><span class="lineCov">      12488 : DEFINE_SORT_VARIANTS(key_compare);</span></a>
<a name="403"><span class="lineNum">     403 </span><span class="lineCov">       1710 : DEFINE_SORT_VARIANTS(key_compare_numeric);</span></a>
<a name="404"><span class="lineNum">     404 </span><span class="lineCov">        312 : DEFINE_SORT_VARIANTS(key_compare_string_case);</span></a>
<a name="405"><span class="lineNum">     405 </span><span class="lineCov">       1872 : DEFINE_SORT_VARIANTS(key_compare_string);</span></a>
<a name="406"><span class="lineNum">     406 </span><span class="lineNoCov">          0 : DEFINE_SORT_VARIANTS(key_compare_string_locale);</span></a>
<a name="407"><span class="lineNum">     407 </span><span class="lineCov">     233871 : DEFINE_SORT_VARIANTS(data_compare);</span></a>
<a name="408"><span class="lineNum">     408 </span><span class="lineCov">       4359 : DEFINE_SORT_VARIANTS(data_compare_numeric);</span></a>
<a name="409"><span class="lineNum">     409 </span><span class="lineCov">        684 : DEFINE_SORT_VARIANTS(data_compare_string_case);</span></a>
<a name="410"><span class="lineNum">     410 </span><span class="lineCov">      68311 : DEFINE_SORT_VARIANTS(data_compare_string);</span></a>
<a name="411"><span class="lineNum">     411 </span><span class="lineNoCov">          0 : DEFINE_SORT_VARIANTS(data_compare_string_locale);</span></a>
<a name="412"><span class="lineNum">     412 </span><span class="lineCov">       1152 : DEFINE_SORT_VARIANTS(natural_compare);</span></a>
<a name="413"><span class="lineNum">     413 </span><span class="lineCov">       2640 : DEFINE_SORT_VARIANTS(natural_case_compare);</span></a>
<a name="414"><span class="lineNum">     414 </span>            : </a>
<a name="415"><span class="lineNum">     415 </span><span class="lineCov">        564 : static bucket_compare_func_t php_get_key_compare_func(zend_long sort_type, int reverse) /* {{{ */</span></a>
<a name="416"><span class="lineNum">     416 </span>            : {</a>
<a name="417"><span class="lineNum">     417 </span><span class="lineCov">        564 :         switch (sort_type &amp; ~PHP_SORT_FLAG_CASE) {</span></a>
<a name="418"><span class="lineNum">     418 </span><span class="lineCov">         42 :                 case PHP_SORT_NUMERIC:</span></a>
<a name="419"><span class="lineNum">     419 </span><span class="lineCov">         42 :                         if (reverse) {</span></a>
<a name="420"><span class="lineNum">     420 </span><span class="lineCov">         21 :                                 return php_array_reverse_key_compare_numeric;</span></a>
<a name="421"><span class="lineNum">     421 </span>            :                         } else {</a>
<a name="422"><span class="lineNum">     422 </span><span class="lineCov">         21 :                                 return php_array_key_compare_numeric;</span></a>
<a name="423"><span class="lineNum">     423 </span>            :                         }</a>
<a name="424"><span class="lineNum">     424 </span>            :                         break;</a>
<a name="425"><span class="lineNum">     425 </span>            : </a>
<a name="426"><span class="lineNum">     426 </span><span class="lineCov">         45 :                 case PHP_SORT_STRING:</span></a>
<a name="427"><span class="lineNum">     427 </span><span class="lineCov">         45 :                         if (sort_type &amp; PHP_SORT_FLAG_CASE) {</span></a>
<a name="428"><span class="lineNum">     428 </span><span class="lineCov">          6 :                                 if (reverse) {</span></a>
<a name="429"><span class="lineNum">     429 </span><span class="lineCov">          3 :                                         return php_array_reverse_key_compare_string_case;</span></a>
<a name="430"><span class="lineNum">     430 </span>            :                                 } else {</a>
<a name="431"><span class="lineNum">     431 </span><span class="lineCov">          3 :                                         return php_array_key_compare_string_case;</span></a>
<a name="432"><span class="lineNum">     432 </span>            :                                 }</a>
<a name="433"><span class="lineNum">     433 </span>            :                         } else {</a>
<a name="434"><span class="lineNum">     434 </span><span class="lineCov">         39 :                                 if (reverse) {</span></a>
<a name="435"><span class="lineNum">     435 </span><span class="lineCov">         18 :                                         return php_array_reverse_key_compare_string;</span></a>
<a name="436"><span class="lineNum">     436 </span>            :                                 } else {</a>
<a name="437"><span class="lineNum">     437 </span><span class="lineCov">         21 :                                         return php_array_key_compare_string;</span></a>
<a name="438"><span class="lineNum">     438 </span>            :                                 }</a>
<a name="439"><span class="lineNum">     439 </span>            :                         }</a>
<a name="440"><span class="lineNum">     440 </span>            :                         break;</a>
<a name="441"><span class="lineNum">     441 </span>            : </a>
<a name="442"><span class="lineNum">     442 </span><span class="lineCov">         12 :                 case PHP_SORT_NATURAL:</span></a>
<a name="443"><span class="lineNum">     443 </span><span class="lineCov">         12 :                         if (sort_type &amp; PHP_SORT_FLAG_CASE) {</span></a>
<a name="444"><span class="lineNum">     444 </span><span class="lineCov">          6 :                                 if (reverse) {</span></a>
<a name="445"><span class="lineNum">     445 </span><span class="lineCov">          3 :                                         return php_array_reverse_key_compare_string_natural_case;</span></a>
<a name="446"><span class="lineNum">     446 </span>            :                                 } else {</a>
<a name="447"><span class="lineNum">     447 </span><span class="lineCov">          3 :                                         return php_array_key_compare_string_natural_case;</span></a>
<a name="448"><span class="lineNum">     448 </span>            :                                 }</a>
<a name="449"><span class="lineNum">     449 </span>            :                         } else {</a>
<a name="450"><span class="lineNum">     450 </span><span class="lineCov">          6 :                                 if (reverse) {</span></a>
<a name="451"><span class="lineNum">     451 </span><span class="lineCov">          3 :                                         return php_array_reverse_key_compare_string_natural;</span></a>
<a name="452"><span class="lineNum">     452 </span>            :                                 } else {</a>
<a name="453"><span class="lineNum">     453 </span><span class="lineCov">          3 :                                         return php_array_key_compare_string_natural;</span></a>
<a name="454"><span class="lineNum">     454 </span>            :                                 }</a>
<a name="455"><span class="lineNum">     455 </span>            :                         }</a>
<a name="456"><span class="lineNum">     456 </span>            :                         break;</a>
<a name="457"><span class="lineNum">     457 </span>            : </a>
<a name="458"><span class="lineNum">     458 </span><span class="lineNoCov">          0 :                 case PHP_SORT_LOCALE_STRING:</span></a>
<a name="459"><span class="lineNum">     459 </span><span class="lineNoCov">          0 :                         if (reverse) {</span></a>
<a name="460"><span class="lineNum">     460 </span><span class="lineNoCov">          0 :                                 return php_array_reverse_key_compare_string_locale;</span></a>
<a name="461"><span class="lineNum">     461 </span>            :                         } else {</a>
<a name="462"><span class="lineNum">     462 </span><span class="lineNoCov">          0 :                                 return php_array_key_compare_string_locale;</span></a>
<a name="463"><span class="lineNum">     463 </span>            :                         }</a>
<a name="464"><span class="lineNum">     464 </span>            :                         break;</a>
<a name="465"><span class="lineNum">     465 </span>            : </a>
<a name="466"><span class="lineNum">     466 </span><span class="lineCov">        465 :                 case PHP_SORT_REGULAR:</span></a>
<a name="467"><span class="lineNum">     467 </span>            :                 default:</a>
<a name="468"><span class="lineNum">     468 </span><span class="lineCov">        465 :                         if (reverse) {</span></a>
<a name="469"><span class="lineNum">     469 </span><span class="lineCov">        186 :                                 return php_array_reverse_key_compare;</span></a>
<a name="470"><span class="lineNum">     470 </span>            :                         } else {</a>
<a name="471"><span class="lineNum">     471 </span><span class="lineCov">        279 :                                 return php_array_key_compare;</span></a>
<a name="472"><span class="lineNum">     472 </span>            :                         }</a>
<a name="473"><span class="lineNum">     473 </span>            :                         break;</a>
<a name="474"><span class="lineNum">     474 </span>            :         }</a>
<a name="475"><span class="lineNum">     475 </span>            :         return NULL;</a>
<a name="476"><span class="lineNum">     476 </span>            : }</a>
<a name="477"><span class="lineNum">     477 </span>            : /* }}} */</a>
<a name="478"><span class="lineNum">     478 </span>            : </a>
<a name="479"><span class="lineNum">     479 </span><span class="lineCov">       1128 : static bucket_compare_func_t php_get_data_compare_func(zend_long sort_type, int reverse) /* {{{ */</span></a>
<a name="480"><span class="lineNum">     480 </span>            : {</a>
<a name="481"><span class="lineNum">     481 </span><span class="lineCov">       1128 :         switch (sort_type &amp; ~PHP_SORT_FLAG_CASE) {</span></a>
<a name="482"><span class="lineNum">     482 </span><span class="lineCov">        108 :                 case PHP_SORT_NUMERIC:</span></a>
<a name="483"><span class="lineNum">     483 </span><span class="lineCov">        108 :                         if (reverse) {</span></a>
<a name="484"><span class="lineNum">     484 </span><span class="lineCov">         45 :                                 return php_array_reverse_data_compare_numeric;</span></a>
<a name="485"><span class="lineNum">     485 </span>            :                         } else {</a>
<a name="486"><span class="lineNum">     486 </span><span class="lineCov">         63 :                                 return php_array_data_compare_numeric;</span></a>
<a name="487"><span class="lineNum">     487 </span>            :                         }</a>
<a name="488"><span class="lineNum">     488 </span>            :                         break;</a>
<a name="489"><span class="lineNum">     489 </span>            : </a>
<a name="490"><span class="lineNum">     490 </span><span class="lineCov">         72 :                 case PHP_SORT_STRING:</span></a>
<a name="491"><span class="lineNum">     491 </span><span class="lineCov">         72 :                         if (sort_type &amp; PHP_SORT_FLAG_CASE) {</span></a>
<a name="492"><span class="lineNum">     492 </span><span class="lineCov">         12 :                                 if (reverse) {</span></a>
<a name="493"><span class="lineNum">     493 </span><span class="lineCov">          6 :                                         return php_array_reverse_data_compare_string_case;</span></a>
<a name="494"><span class="lineNum">     494 </span>            :                                 } else {</a>
<a name="495"><span class="lineNum">     495 </span><span class="lineCov">          6 :                                         return php_array_data_compare_string_case;</span></a>
<a name="496"><span class="lineNum">     496 </span>            :                                 }</a>
<a name="497"><span class="lineNum">     497 </span>            :                         } else {</a>
<a name="498"><span class="lineNum">     498 </span><span class="lineCov">         60 :                                 if (reverse) {</span></a>
<a name="499"><span class="lineNum">     499 </span><span class="lineCov">         30 :                                         return php_array_reverse_data_compare_string;</span></a>
<a name="500"><span class="lineNum">     500 </span>            :                                 } else {</a>
<a name="501"><span class="lineNum">     501 </span><span class="lineCov">         30 :                                         return php_array_data_compare_string;</span></a>
<a name="502"><span class="lineNum">     502 </span>            :                                 }</a>
<a name="503"><span class="lineNum">     503 </span>            :                         }</a>
<a name="504"><span class="lineNum">     504 </span>            :                         break;</a>
<a name="505"><span class="lineNum">     505 </span>            : </a>
<a name="506"><span class="lineNum">     506 </span><span class="lineCov">         24 :                 case PHP_SORT_NATURAL:</span></a>
<a name="507"><span class="lineNum">     507 </span><span class="lineCov">         24 :                         if (sort_type &amp; PHP_SORT_FLAG_CASE) {</span></a>
<a name="508"><span class="lineNum">     508 </span><span class="lineCov">         12 :                                 if (reverse) {</span></a>
<a name="509"><span class="lineNum">     509 </span><span class="lineCov">          6 :                                         return php_array_reverse_natural_case_compare;</span></a>
<a name="510"><span class="lineNum">     510 </span>            :                                 } else {</a>
<a name="511"><span class="lineNum">     511 </span><span class="lineCov">          6 :                                         return php_array_natural_case_compare;</span></a>
<a name="512"><span class="lineNum">     512 </span>            :                                 }</a>
<a name="513"><span class="lineNum">     513 </span>            :                         } else {</a>
<a name="514"><span class="lineNum">     514 </span><span class="lineCov">         12 :                                 if (reverse) {</span></a>
<a name="515"><span class="lineNum">     515 </span><span class="lineCov">          6 :                                         return php_array_reverse_natural_compare;</span></a>
<a name="516"><span class="lineNum">     516 </span>            :                                 } else {</a>
<a name="517"><span class="lineNum">     517 </span><span class="lineCov">          6 :                                         return php_array_natural_compare;</span></a>
<a name="518"><span class="lineNum">     518 </span>            :                                 }</a>
<a name="519"><span class="lineNum">     519 </span>            :                         }</a>
<a name="520"><span class="lineNum">     520 </span>            :                         break;</a>
<a name="521"><span class="lineNum">     521 </span>            : </a>
<a name="522"><span class="lineNum">     522 </span><span class="lineNoCov">          0 :                 case PHP_SORT_LOCALE_STRING:</span></a>
<a name="523"><span class="lineNum">     523 </span><span class="lineNoCov">          0 :                         if (reverse) {</span></a>
<a name="524"><span class="lineNum">     524 </span><span class="lineNoCov">          0 :                                 return php_array_reverse_data_compare_string_locale;</span></a>
<a name="525"><span class="lineNum">     525 </span>            :                         } else {</a>
<a name="526"><span class="lineNum">     526 </span><span class="lineNoCov">          0 :                                 return php_array_data_compare_string_locale;</span></a>
<a name="527"><span class="lineNum">     527 </span>            :                         }</a>
<a name="528"><span class="lineNum">     528 </span>            :                         break;</a>
<a name="529"><span class="lineNum">     529 </span>            : </a>
<a name="530"><span class="lineNum">     530 </span><span class="lineCov">        924 :                 case PHP_SORT_REGULAR:</span></a>
<a name="531"><span class="lineNum">     531 </span>            :                 default:</a>
<a name="532"><span class="lineNum">     532 </span><span class="lineCov">        924 :                         if (reverse) {</span></a>
<a name="533"><span class="lineNum">     533 </span><span class="lineCov">        315 :                                 return php_array_reverse_data_compare;</span></a>
<a name="534"><span class="lineNum">     534 </span>            :                         } else {</a>
<a name="535"><span class="lineNum">     535 </span><span class="lineCov">        609 :                                 return php_array_data_compare;</span></a>
<a name="536"><span class="lineNum">     536 </span>            :                         }</a>
<a name="537"><span class="lineNum">     537 </span>            :                         break;</a>
<a name="538"><span class="lineNum">     538 </span>            :         }</a>
<a name="539"><span class="lineNum">     539 </span>            :         return NULL;</a>
<a name="540"><span class="lineNum">     540 </span>            : }</a>
<a name="541"><span class="lineNum">     541 </span>            : /* }}} */</a>
<a name="542"><span class="lineNum">     542 </span>            : </a>
<a name="543"><span class="lineNum">     543 </span><span class="lineCov">        183 : static bucket_compare_func_t php_get_data_compare_func_unstable(zend_long sort_type, int reverse) /* {{{ */</span></a>
<a name="544"><span class="lineNum">     544 </span>            : {</a>
<a name="545"><span class="lineNum">     545 </span><span class="lineCov">        183 :         switch (sort_type &amp; ~PHP_SORT_FLAG_CASE) {</span></a>
<a name="546"><span class="lineNum">     546 </span><span class="lineCov">         18 :                 case PHP_SORT_NUMERIC:</span></a>
<a name="547"><span class="lineNum">     547 </span><span class="lineCov">         18 :                         if (reverse) {</span></a>
<a name="548"><span class="lineNum">     548 </span><span class="lineCov">          6 :                                 return php_array_reverse_data_compare_numeric_unstable;</span></a>
<a name="549"><span class="lineNum">     549 </span>            :                         } else {</a>
<a name="550"><span class="lineNum">     550 </span><span class="lineCov">         12 :                                 return php_array_data_compare_numeric_unstable;</span></a>
<a name="551"><span class="lineNum">     551 </span>            :                         }</a>
<a name="552"><span class="lineNum">     552 </span>            :                         break;</a>
<a name="553"><span class="lineNum">     553 </span>            : </a>
<a name="554"><span class="lineNum">     554 </span><span class="lineCov">         18 :                 case PHP_SORT_STRING:</span></a>
<a name="555"><span class="lineNum">     555 </span><span class="lineCov">         18 :                         if (sort_type &amp; PHP_SORT_FLAG_CASE) {</span></a>
<a name="556"><span class="lineNum">     556 </span><span class="lineCov">          3 :                                 if (reverse) {</span></a>
<a name="557"><span class="lineNum">     557 </span><span class="lineNoCov">          0 :                                         return php_array_reverse_data_compare_string_case_unstable;</span></a>
<a name="558"><span class="lineNum">     558 </span>            :                                 } else {</a>
<a name="559"><span class="lineNum">     559 </span><span class="lineCov">          3 :                                         return php_array_data_compare_string_case_unstable;</span></a>
<a name="560"><span class="lineNum">     560 </span>            :                                 }</a>
<a name="561"><span class="lineNum">     561 </span>            :                         } else {</a>
<a name="562"><span class="lineNum">     562 </span><span class="lineCov">         15 :                                 if (reverse) {</span></a>
<a name="563"><span class="lineNum">     563 </span><span class="lineCov">          6 :                                         return php_array_reverse_data_compare_string_unstable;</span></a>
<a name="564"><span class="lineNum">     564 </span>            :                                 } else {</a>
<a name="565"><span class="lineNum">     565 </span><span class="lineCov">          9 :                                         return php_array_data_compare_string_unstable;</span></a>
<a name="566"><span class="lineNum">     566 </span>            :                                 }</a>
<a name="567"><span class="lineNum">     567 </span>            :                         }</a>
<a name="568"><span class="lineNum">     568 </span>            :                         break;</a>
<a name="569"><span class="lineNum">     569 </span>            : </a>
<a name="570"><span class="lineNum">     570 </span><span class="lineCov">          9 :                 case PHP_SORT_NATURAL:</span></a>
<a name="571"><span class="lineNum">     571 </span><span class="lineCov">          9 :                         if (sort_type &amp; PHP_SORT_FLAG_CASE) {</span></a>
<a name="572"><span class="lineNum">     572 </span><span class="lineCov">          3 :                                 if (reverse) {</span></a>
<a name="573"><span class="lineNum">     573 </span><span class="lineNoCov">          0 :                                         return php_array_reverse_natural_case_compare_unstable;</span></a>
<a name="574"><span class="lineNum">     574 </span>            :                                 } else {</a>
<a name="575"><span class="lineNum">     575 </span><span class="lineCov">          3 :                                         return php_array_natural_case_compare_unstable;</span></a>
<a name="576"><span class="lineNum">     576 </span>            :                                 }</a>
<a name="577"><span class="lineNum">     577 </span>            :                         } else {</a>
<a name="578"><span class="lineNum">     578 </span><span class="lineCov">          6 :                                 if (reverse) {</span></a>
<a name="579"><span class="lineNum">     579 </span><span class="lineNoCov">          0 :                                         return php_array_reverse_natural_compare_unstable;</span></a>
<a name="580"><span class="lineNum">     580 </span>            :                                 } else {</a>
<a name="581"><span class="lineNum">     581 </span><span class="lineCov">          6 :                                         return php_array_natural_compare_unstable;</span></a>
<a name="582"><span class="lineNum">     582 </span>            :                                 }</a>
<a name="583"><span class="lineNum">     583 </span>            :                         }</a>
<a name="584"><span class="lineNum">     584 </span>            :                         break;</a>
<a name="585"><span class="lineNum">     585 </span>            : </a>
<a name="586"><span class="lineNum">     586 </span><span class="lineNoCov">          0 :                 case PHP_SORT_LOCALE_STRING:</span></a>
<a name="587"><span class="lineNum">     587 </span><span class="lineNoCov">          0 :                         if (reverse) {</span></a>
<a name="588"><span class="lineNum">     588 </span><span class="lineNoCov">          0 :                                 return php_array_reverse_data_compare_string_locale_unstable;</span></a>
<a name="589"><span class="lineNum">     589 </span>            :                         } else {</a>
<a name="590"><span class="lineNum">     590 </span><span class="lineNoCov">          0 :                                 return php_array_data_compare_string_locale_unstable;</span></a>
<a name="591"><span class="lineNum">     591 </span>            :                         }</a>
<a name="592"><span class="lineNum">     592 </span>            :                         break;</a>
<a name="593"><span class="lineNum">     593 </span>            : </a>
<a name="594"><span class="lineNum">     594 </span><span class="lineCov">        138 :                 case PHP_SORT_REGULAR:</span></a>
<a name="595"><span class="lineNum">     595 </span>            :                 default:</a>
<a name="596"><span class="lineNum">     596 </span><span class="lineCov">        138 :                         if (reverse) {</span></a>
<a name="597"><span class="lineNum">     597 </span><span class="lineCov">          6 :                                 return php_array_reverse_data_compare_unstable;</span></a>
<a name="598"><span class="lineNum">     598 </span>            :                         } else {</a>
<a name="599"><span class="lineNum">     599 </span><span class="lineCov">        132 :                                 return php_array_data_compare_unstable;</span></a>
<a name="600"><span class="lineNum">     600 </span>            :                         }</a>
<a name="601"><span class="lineNum">     601 </span>            :                         break;</a>
<a name="602"><span class="lineNum">     602 </span>            :         }</a>
<a name="603"><span class="lineNum">     603 </span>            :         return NULL;</a>
<a name="604"><span class="lineNum">     604 </span>            : }</a>
<a name="605"><span class="lineNum">     605 </span>            : /* }}} */</a>
<a name="606"><span class="lineNum">     606 </span>            : </a>
<a name="607"><span class="lineNum">     607 </span>            : /* {{{ Sort an array by key value in reverse order */</a>
<a name="608"><span class="lineNum">     608 </span><span class="lineCov">        240 : PHP_FUNCTION(krsort)</span></a>
<a name="609"><span class="lineNum">     609 </span>            : {</a>
<a name="610"><span class="lineNum">     610 </span>            :         zval *array;</a>
<a name="611"><span class="lineNum">     611 </span><span class="lineCov">        240 :         zend_long sort_type = PHP_SORT_REGULAR;</span></a>
<a name="612"><span class="lineNum">     612 </span>            :         bucket_compare_func_t cmp;</a>
<a name="613"><span class="lineNum">     613 </span>            : </a>
<a name="614"><span class="lineNum">     614 </span><span class="lineCov">        240 :         ZEND_PARSE_PARAMETERS_START(1, 2)</span></a>
<a name="615"><span class="lineNum">     615 </span><span class="lineCov">       1404 :                 Z_PARAM_ARRAY_EX(array, 0, 1)</span></a>
<a name="616"><span class="lineNum">     616 </span><span class="lineCov">        234 :                 Z_PARAM_OPTIONAL</span></a>
<a name="617"><span class="lineNum">     617 </span><span class="lineCov">        357 :                 Z_PARAM_LONG(sort_type)</span></a>
<a name="618"><span class="lineNum">     618 </span><span class="lineCov">        240 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="619"><span class="lineNum">     619 </span>            : </a>
<a name="620"><span class="lineNum">     620 </span><span class="lineCov">        234 :         cmp = php_get_key_compare_func(sort_type, 1);</span></a>
<a name="621"><span class="lineNum">     621 </span>            : </a>
<a name="622"><span class="lineNum">     622 </span><span class="lineCov">        234 :         zend_hash_sort(Z_ARRVAL_P(array), cmp, 0);</span></a>
<a name="623"><span class="lineNum">     623 </span>            : </a>
<a name="624"><span class="lineNum">     624 </span><span class="lineCov">        234 :         RETURN_TRUE;</span></a>
<a name="625"><span class="lineNum">     625 </span>            : }</a>
<a name="626"><span class="lineNum">     626 </span>            : /* }}} */</a>
<a name="627"><span class="lineNum">     627 </span>            : </a>
<a name="628"><span class="lineNum">     628 </span>            : /* {{{ Sort an array by key */</a>
<a name="629"><span class="lineNum">     629 </span><span class="lineCov">        336 : PHP_FUNCTION(ksort)</span></a>
<a name="630"><span class="lineNum">     630 </span>            : {</a>
<a name="631"><span class="lineNum">     631 </span>            :         zval *array;</a>
<a name="632"><span class="lineNum">     632 </span><span class="lineCov">        336 :         zend_long sort_type = PHP_SORT_REGULAR;</span></a>
<a name="633"><span class="lineNum">     633 </span>            :         bucket_compare_func_t cmp;</a>
<a name="634"><span class="lineNum">     634 </span>            : </a>
<a name="635"><span class="lineNum">     635 </span><span class="lineCov">        336 :         ZEND_PARSE_PARAMETERS_START(1, 2)</span></a>
<a name="636"><span class="lineNum">     636 </span><span class="lineCov">       1980 :                 Z_PARAM_ARRAY_EX(array, 0, 1)</span></a>
<a name="637"><span class="lineNum">     637 </span><span class="lineCov">        330 :                 Z_PARAM_OPTIONAL</span></a>
<a name="638"><span class="lineNum">     638 </span><span class="lineCov">        492 :                 Z_PARAM_LONG(sort_type)</span></a>
<a name="639"><span class="lineNum">     639 </span><span class="lineCov">        336 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="640"><span class="lineNum">     640 </span>            : </a>
<a name="641"><span class="lineNum">     641 </span><span class="lineCov">        330 :         cmp = php_get_key_compare_func(sort_type, 0);</span></a>
<a name="642"><span class="lineNum">     642 </span>            : </a>
<a name="643"><span class="lineNum">     643 </span><span class="lineCov">        330 :         zend_hash_sort(Z_ARRVAL_P(array), cmp, 0);</span></a>
<a name="644"><span class="lineNum">     644 </span>            : </a>
<a name="645"><span class="lineNum">     645 </span><span class="lineCov">        330 :         RETURN_TRUE;</span></a>
<a name="646"><span class="lineNum">     646 </span>            : }</a>
<a name="647"><span class="lineNum">     647 </span>            : /* }}} */</a>
<a name="648"><span class="lineNum">     648 </span>            : </a>
<a name="649"><span class="lineNum">     649 </span><span class="lineCov">        231 : PHPAPI zend_long php_count_recursive(HashTable *ht) /* {{{ */</span></a>
<a name="650"><span class="lineNum">     650 </span>            : {</a>
<a name="651"><span class="lineNum">     651 </span><span class="lineCov">        231 :         zend_long cnt = 0;</span></a>
<a name="652"><span class="lineNum">     652 </span>            :         zval *element;</a>
<a name="653"><span class="lineNum">     653 </span>            : </a>
<a name="654"><span class="lineNum">     654 </span><span class="lineCov">        462 :         if (!(GC_FLAGS(ht) &amp; GC_IMMUTABLE)) {</span></a>
<a name="655"><span class="lineNum">     655 </span><span class="lineCov">        420 :                 if (GC_IS_RECURSIVE(ht)) {</span></a>
<a name="656"><span class="lineNum">     656 </span><span class="lineCov">          3 :                         php_error_docref(NULL, E_WARNING, &quot;Recursion detected&quot;);</span></a>
<a name="657"><span class="lineNum">     657 </span><span class="lineCov">          3 :                         return 0;</span></a>
<a name="658"><span class="lineNum">     658 </span>            :                 }</a>
<a name="659"><span class="lineNum">     659 </span><span class="lineCov">        207 :                 GC_PROTECT_RECURSION(ht);</span></a>
<a name="660"><span class="lineNum">     660 </span>            :         }</a>
<a name="661"><span class="lineNum">     661 </span>            : </a>
<a name="662"><span class="lineNum">     662 </span><span class="lineCov">        228 :         cnt = zend_hash_num_elements(ht);</span></a>
<a name="663"><span class="lineNum">     663 </span><span class="lineCov">       1260 :         ZEND_HASH_FOREACH_VAL(ht, element) {</span></a>
<a name="664"><span class="lineNum">     664 </span><span class="lineCov">        513 :                 ZVAL_DEREF(element);</span></a>
<a name="665"><span class="lineNum">     665 </span><span class="lineCov">        513 :                 if (Z_TYPE_P(element) == IS_ARRAY) {</span></a>
<a name="666"><span class="lineNum">     666 </span><span class="lineCov">        114 :                         cnt += php_count_recursive(Z_ARRVAL_P(element));</span></a>
<a name="667"><span class="lineNum">     667 </span>            :                 }</a>
<a name="668"><span class="lineNum">     668 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="669"><span class="lineNum">     669 </span>            : </a>
<a name="670"><span class="lineNum">     670 </span><span class="lineCov">        456 :         GC_TRY_UNPROTECT_RECURSION(ht);</span></a>
<a name="671"><span class="lineNum">     671 </span><span class="lineCov">        228 :         return cnt;</span></a>
<a name="672"><span class="lineNum">     672 </span>            : }</a>
<a name="673"><span class="lineNum">     673 </span>            : /* }}} */</a>
<a name="674"><span class="lineNum">     674 </span>            : </a>
<a name="675"><span class="lineNum">     675 </span>            : /* {{{ Count the number of elements in a variable (usually an array) */</a>
<a name="676"><span class="lineNum">     676 </span><span class="lineCov">        381 : PHP_FUNCTION(count)</span></a>
<a name="677"><span class="lineNum">     677 </span>            : {</a>
<a name="678"><span class="lineNum">     678 </span>            :         zval *array;</a>
<a name="679"><span class="lineNum">     679 </span><span class="lineCov">        381 :         zend_long mode = COUNT_NORMAL;</span></a>
<a name="680"><span class="lineNum">     680 </span>            :         zend_long cnt;</a>
<a name="681"><span class="lineNum">     681 </span>            : </a>
<a name="682"><span class="lineNum">     682 </span><span class="lineCov">        381 :         ZEND_PARSE_PARAMETERS_START(1, 2)</span></a>
<a name="683"><span class="lineNum">     683 </span><span class="lineCov">        297 :                 Z_PARAM_ZVAL(array)</span></a>
<a name="684"><span class="lineNum">     684 </span><span class="lineCov">        297 :                 Z_PARAM_OPTIONAL</span></a>
<a name="685"><span class="lineNum">     685 </span><span class="lineCov">        576 :                 Z_PARAM_LONG(mode)</span></a>
<a name="686"><span class="lineNum">     686 </span><span class="lineCov">        381 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="687"><span class="lineNum">     687 </span>            : </a>
<a name="688"><span class="lineNum">     688 </span><span class="lineCov">        291 :         if (mode != COUNT_NORMAL &amp;&amp; mode != COUNT_RECURSIVE) {</span></a>
<a name="689"><span class="lineNum">     689 </span><span class="lineCov">          6 :                 zend_argument_value_error(2, &quot;must be either COUNT_NORMAL or COUNT_RECURSIVE&quot;);</span></a>
<a name="690"><span class="lineNum">     690 </span><span class="lineCov">          6 :                 RETURN_THROWS();</span></a>
<a name="691"><span class="lineNum">     691 </span>            :         }</a>
<a name="692"><span class="lineNum">     692 </span>            : </a>
<a name="693"><span class="lineNum">     693 </span><span class="lineCov">        570 :         switch (Z_TYPE_P(array)) {</span></a>
<a name="694"><span class="lineNum">     694 </span><span class="lineCov">        231 :                 case IS_ARRAY:</span></a>
<a name="695"><span class="lineNum">     695 </span><span class="lineCov">        231 :                         if (mode != COUNT_RECURSIVE) {</span></a>
<a name="696"><span class="lineNum">     696 </span><span class="lineCov">        114 :                                 cnt = zend_hash_num_elements(Z_ARRVAL_P(array));</span></a>
<a name="697"><span class="lineNum">     697 </span>            :                         } else {</a>
<a name="698"><span class="lineNum">     698 </span><span class="lineCov">        117 :                                 cnt = php_count_recursive(Z_ARRVAL_P(array));</span></a>
<a name="699"><span class="lineNum">     699 </span>            :                         }</a>
<a name="700"><span class="lineNum">     700 </span><span class="lineCov">        231 :                         RETURN_LONG(cnt);</span></a>
<a name="701"><span class="lineNum">     701 </span>            :                         break;</a>
<a name="702"><span class="lineNum">     702 </span><span class="lineCov">         36 :                 case IS_OBJECT: {</span></a>
<a name="703"><span class="lineNum">     703 </span>            :                         zval retval;</a>
<a name="704"><span class="lineNum">     704 </span>            :                         /* first, we check if the handler is defined */</a>
<a name="705"><span class="lineNum">     705 </span><span class="lineCov">         36 :                         if (Z_OBJ_HT_P(array)-&gt;count_elements) {</span></a>
<a name="706"><span class="lineNum">     706 </span><span class="lineNoCov">          0 :                                 RETVAL_LONG(1);</span></a>
<a name="707"><span class="lineNum">     707 </span><span class="lineNoCov">          0 :                                 if (SUCCESS == Z_OBJ_HT(*array)-&gt;count_elements(Z_OBJ_P(array), &amp;Z_LVAL_P(return_value))) {</span></a>
<a name="708"><span class="lineNum">     708 </span><span class="lineCov">          6 :                                         return;</span></a>
<a name="709"><span class="lineNum">     709 </span>            :                                 }</a>
<a name="710"><span class="lineNum">     710 </span><span class="lineNoCov">          0 :                                 if (EG(exception)) {</span></a>
<a name="711"><span class="lineNum">     711 </span><span class="lineNoCov">          0 :                                         RETURN_THROWS();</span></a>
<a name="712"><span class="lineNum">     712 </span>            :                                 }</a>
<a name="713"><span class="lineNum">     713 </span>            :                         }</a>
<a name="714"><span class="lineNum">     714 </span>            :                         /* if not and the object implements Countable we call its count() method */</a>
<a name="715"><span class="lineNum">     715 </span><span class="lineCov">         72 :                         if (instanceof_function(Z_OBJCE_P(array), zend_ce_countable)) {</span></a>
<a name="716"><span class="lineNum">     716 </span><span class="lineCov">          6 :                                 zend_call_method_with_0_params(Z_OBJ_P(array), NULL, NULL, &quot;count&quot;, &amp;retval);</span></a>
<a name="717"><span class="lineNum">     717 </span><span class="lineCov">          6 :                                 if (Z_TYPE(retval) != IS_UNDEF) {</span></a>
<a name="718"><span class="lineNum">     718 </span><span class="lineCov">          6 :                                         RETVAL_LONG(zval_get_long(&amp;retval));</span></a>
<a name="719"><span class="lineNum">     719 </span><span class="lineCov">          6 :                                         zval_ptr_dtor(&amp;retval);</span></a>
<a name="720"><span class="lineNum">     720 </span>            :                                 }</a>
<a name="721"><span class="lineNum">     721 </span><span class="lineCov">          6 :                                 return;</span></a>
<a name="722"><span class="lineNum">     722 </span>            :                         }</a>
<a name="723"><span class="lineNum">     723 </span>            :                 }</a>
<a name="724"><span class="lineNum">     724 </span>            :                 ZEND_FALLTHROUGH;</a>
<a name="725"><span class="lineNum">     725 </span>            :                 default:</a>
<a name="726"><span class="lineNum">     726 </span><span class="lineCov">         48 :                         zend_argument_type_error(1, &quot;must be of type Countable|array, %s given&quot;, zend_zval_type_name(array));</span></a>
<a name="727"><span class="lineNum">     727 </span><span class="lineCov">         48 :                         RETURN_THROWS();</span></a>
<a name="728"><span class="lineNum">     728 </span>            :         }</a>
<a name="729"><span class="lineNum">     729 </span>            : }</a>
<a name="730"><span class="lineNum">     730 </span>            : /* }}} */</a>
<a name="731"><span class="lineNum">     731 </span>            : </a>
<a name="732"><span class="lineNum">     732 </span><span class="lineCov">        174 : static void php_natsort(INTERNAL_FUNCTION_PARAMETERS, int fold_case) /* {{{ */</span></a>
<a name="733"><span class="lineNum">     733 </span>            : {</a>
<a name="734"><span class="lineNum">     734 </span>            :         zval *array;</a>
<a name="735"><span class="lineNum">     735 </span>            : </a>
<a name="736"><span class="lineNum">     736 </span><span class="lineCov">        174 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="737"><span class="lineNum">     737 </span><span class="lineCov">        972 :                 Z_PARAM_ARRAY_EX(array, 0, 1)</span></a>
<a name="738"><span class="lineNum">     738 </span><span class="lineCov">        174 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="739"><span class="lineNum">     739 </span>            : </a>
<a name="740"><span class="lineNum">     740 </span><span class="lineCov">        162 :         if (fold_case) {</span></a>
<a name="741"><span class="lineNum">     741 </span><span class="lineCov">        132 :                 zend_hash_sort(Z_ARRVAL_P(array), php_array_natural_case_compare, 0);</span></a>
<a name="742"><span class="lineNum">     742 </span>            :         } else {</a>
<a name="743"><span class="lineNum">     743 </span><span class="lineCov">         30 :                 zend_hash_sort(Z_ARRVAL_P(array), php_array_natural_compare, 0);</span></a>
<a name="744"><span class="lineNum">     744 </span>            :         }</a>
<a name="745"><span class="lineNum">     745 </span>            : </a>
<a name="746"><span class="lineNum">     746 </span><span class="lineCov">        162 :         RETURN_TRUE;</span></a>
<a name="747"><span class="lineNum">     747 </span>            : }</a>
<a name="748"><span class="lineNum">     748 </span>            : /* }}} */</a>
<a name="749"><span class="lineNum">     749 </span>            : </a>
<a name="750"><span class="lineNum">     750 </span>            : /* {{{ Sort an array using natural sort */</a>
<a name="751"><span class="lineNum">     751 </span><span class="lineCov">         36 : PHP_FUNCTION(natsort)</span></a>
<a name="752"><span class="lineNum">     752 </span>            : {</a>
<a name="753"><span class="lineNum">     753 </span><span class="lineCov">         36 :         php_natsort(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);</span></a>
<a name="754"><span class="lineNum">     754 </span><span class="lineCov">         36 : }</span></a>
<a name="755"><span class="lineNum">     755 </span>            : /* }}} */</a>
<a name="756"><span class="lineNum">     756 </span>            : </a>
<a name="757"><span class="lineNum">     757 </span>            : /* {{{ Sort an array using case-insensitive natural sort */</a>
<a name="758"><span class="lineNum">     758 </span><span class="lineCov">        138 : PHP_FUNCTION(natcasesort)</span></a>
<a name="759"><span class="lineNum">     759 </span>            : {</a>
<a name="760"><span class="lineNum">     760 </span><span class="lineCov">        138 :         php_natsort(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);</span></a>
<a name="761"><span class="lineNum">     761 </span><span class="lineCov">        138 : }</span></a>
<a name="762"><span class="lineNum">     762 </span>            : /* }}} */</a>
<a name="763"><span class="lineNum">     763 </span>            : </a>
<a name="764"><span class="lineNum">     764 </span>            : /* {{{ Sort an array and maintain index association */</a>
<a name="765"><span class="lineNum">     765 </span><span class="lineCov">        384 : PHP_FUNCTION(asort)</span></a>
<a name="766"><span class="lineNum">     766 </span>            : {</a>
<a name="767"><span class="lineNum">     767 </span>            :         zval *array;</a>
<a name="768"><span class="lineNum">     768 </span><span class="lineCov">        384 :         zend_long sort_type = PHP_SORT_REGULAR;</span></a>
<a name="769"><span class="lineNum">     769 </span>            :         bucket_compare_func_t cmp;</a>
<a name="770"><span class="lineNum">     770 </span>            : </a>
<a name="771"><span class="lineNum">     771 </span><span class="lineCov">        384 :         ZEND_PARSE_PARAMETERS_START(1, 2)</span></a>
<a name="772"><span class="lineNum">     772 </span><span class="lineCov">       2268 :                 Z_PARAM_ARRAY_EX(array, 0, 1)</span></a>
<a name="773"><span class="lineNum">     773 </span><span class="lineCov">        378 :                 Z_PARAM_OPTIONAL</span></a>
<a name="774"><span class="lineNum">     774 </span><span class="lineCov">        561 :                 Z_PARAM_LONG(sort_type)</span></a>
<a name="775"><span class="lineNum">     775 </span><span class="lineCov">        384 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="776"><span class="lineNum">     776 </span>            : </a>
<a name="777"><span class="lineNum">     777 </span><span class="lineCov">        378 :         cmp = php_get_data_compare_func(sort_type, 0);</span></a>
<a name="778"><span class="lineNum">     778 </span>            : </a>
<a name="779"><span class="lineNum">     779 </span><span class="lineCov">        378 :         zend_hash_sort(Z_ARRVAL_P(array), cmp, 0);</span></a>
<a name="780"><span class="lineNum">     780 </span>            : </a>
<a name="781"><span class="lineNum">     781 </span><span class="lineCov">        378 :         RETURN_TRUE;</span></a>
<a name="782"><span class="lineNum">     782 </span>            : }</a>
<a name="783"><span class="lineNum">     783 </span>            : /* }}} */</a>
<a name="784"><span class="lineNum">     784 </span>            : </a>
<a name="785"><span class="lineNum">     785 </span>            : /* {{{ Sort an array in reverse order and maintain index association */</a>
<a name="786"><span class="lineNum">     786 </span><span class="lineCov">        234 : PHP_FUNCTION(arsort)</span></a>
<a name="787"><span class="lineNum">     787 </span>            : {</a>
<a name="788"><span class="lineNum">     788 </span>            :         zval *array;</a>
<a name="789"><span class="lineNum">     789 </span><span class="lineCov">        234 :         zend_long sort_type = PHP_SORT_REGULAR;</span></a>
<a name="790"><span class="lineNum">     790 </span>            :         bucket_compare_func_t cmp;</a>
<a name="791"><span class="lineNum">     791 </span>            : </a>
<a name="792"><span class="lineNum">     792 </span><span class="lineCov">        234 :         ZEND_PARSE_PARAMETERS_START(1, 2)</span></a>
<a name="793"><span class="lineNum">     793 </span><span class="lineCov">       1368 :                 Z_PARAM_ARRAY_EX(array, 0, 1)</span></a>
<a name="794"><span class="lineNum">     794 </span><span class="lineCov">        228 :                 Z_PARAM_OPTIONAL</span></a>
<a name="795"><span class="lineNum">     795 </span><span class="lineCov">        369 :                 Z_PARAM_LONG(sort_type)</span></a>
<a name="796"><span class="lineNum">     796 </span><span class="lineCov">        234 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="797"><span class="lineNum">     797 </span>            : </a>
<a name="798"><span class="lineNum">     798 </span><span class="lineCov">        228 :         cmp = php_get_data_compare_func(sort_type, 1);</span></a>
<a name="799"><span class="lineNum">     799 </span>            : </a>
<a name="800"><span class="lineNum">     800 </span><span class="lineCov">        228 :         zend_hash_sort(Z_ARRVAL_P(array), cmp, 0);</span></a>
<a name="801"><span class="lineNum">     801 </span>            : </a>
<a name="802"><span class="lineNum">     802 </span><span class="lineCov">        228 :         RETURN_TRUE;</span></a>
<a name="803"><span class="lineNum">     803 </span>            : }</a>
<a name="804"><span class="lineNum">     804 </span>            : /* }}} */</a>
<a name="805"><span class="lineNum">     805 </span>            : </a>
<a name="806"><span class="lineNum">     806 </span>            : /* {{{ Sort an array */</a>
<a name="807"><span class="lineNum">     807 </span><span class="lineCov">        348 : PHP_FUNCTION(sort)</span></a>
<a name="808"><span class="lineNum">     808 </span>            : {</a>
<a name="809"><span class="lineNum">     809 </span>            :         zval *array;</a>
<a name="810"><span class="lineNum">     810 </span><span class="lineCov">        348 :         zend_long sort_type = PHP_SORT_REGULAR;</span></a>
<a name="811"><span class="lineNum">     811 </span>            :         bucket_compare_func_t cmp;</a>
<a name="812"><span class="lineNum">     812 </span>            : </a>
<a name="813"><span class="lineNum">     813 </span><span class="lineCov">        348 :         ZEND_PARSE_PARAMETERS_START(1, 2)</span></a>
<a name="814"><span class="lineNum">     814 </span><span class="lineCov">       2052 :                 Z_PARAM_ARRAY_EX(array, 0, 1)</span></a>
<a name="815"><span class="lineNum">     815 </span><span class="lineCov">        342 :                 Z_PARAM_OPTIONAL</span></a>
<a name="816"><span class="lineNum">     816 </span><span class="lineCov">        477 :                 Z_PARAM_LONG(sort_type)</span></a>
<a name="817"><span class="lineNum">     817 </span><span class="lineCov">        348 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="818"><span class="lineNum">     818 </span>            : </a>
<a name="819"><span class="lineNum">     819 </span><span class="lineCov">        342 :         cmp = php_get_data_compare_func(sort_type, 0);</span></a>
<a name="820"><span class="lineNum">     820 </span>            : </a>
<a name="821"><span class="lineNum">     821 </span><span class="lineCov">        342 :         zend_hash_sort(Z_ARRVAL_P(array), cmp, 1);</span></a>
<a name="822"><span class="lineNum">     822 </span>            : </a>
<a name="823"><span class="lineNum">     823 </span><span class="lineCov">        342 :         RETURN_TRUE;</span></a>
<a name="824"><span class="lineNum">     824 </span>            : }</a>
<a name="825"><span class="lineNum">     825 </span>            : /* }}} */</a>
<a name="826"><span class="lineNum">     826 </span>            : </a>
<a name="827"><span class="lineNum">     827 </span>            : /* {{{ Sort an array in reverse order */</a>
<a name="828"><span class="lineNum">     828 </span><span class="lineCov">        186 : PHP_FUNCTION(rsort)</span></a>
<a name="829"><span class="lineNum">     829 </span>            : {</a>
<a name="830"><span class="lineNum">     830 </span>            :         zval *array;</a>
<a name="831"><span class="lineNum">     831 </span><span class="lineCov">        186 :         zend_long sort_type = PHP_SORT_REGULAR;</span></a>
<a name="832"><span class="lineNum">     832 </span>            :         bucket_compare_func_t cmp;</a>
<a name="833"><span class="lineNum">     833 </span>            : </a>
<a name="834"><span class="lineNum">     834 </span><span class="lineCov">        186 :         ZEND_PARSE_PARAMETERS_START(1, 2)</span></a>
<a name="835"><span class="lineNum">     835 </span><span class="lineCov">       1080 :                 Z_PARAM_ARRAY_EX(array, 0, 1)</span></a>
<a name="836"><span class="lineNum">     836 </span><span class="lineCov">        180 :                 Z_PARAM_OPTIONAL</span></a>
<a name="837"><span class="lineNum">     837 </span><span class="lineCov">        288 :                 Z_PARAM_LONG(sort_type)</span></a>
<a name="838"><span class="lineNum">     838 </span><span class="lineCov">        186 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="839"><span class="lineNum">     839 </span>            : </a>
<a name="840"><span class="lineNum">     840 </span><span class="lineCov">        180 :         cmp = php_get_data_compare_func(sort_type, 1);</span></a>
<a name="841"><span class="lineNum">     841 </span>            : </a>
<a name="842"><span class="lineNum">     842 </span><span class="lineCov">        180 :         zend_hash_sort(Z_ARRVAL_P(array), cmp, 1);</span></a>
<a name="843"><span class="lineNum">     843 </span>            : </a>
<a name="844"><span class="lineNum">     844 </span><span class="lineCov">        180 :         RETURN_TRUE;</span></a>
<a name="845"><span class="lineNum">     845 </span>            : }</a>
<a name="846"><span class="lineNum">     846 </span>            : /* }}} */</a>
<a name="847"><span class="lineNum">     847 </span>            : </a>
<a name="848"><span class="lineNum">     848 </span><span class="lineCov">     329668 : static inline int php_array_user_compare_unstable(Bucket *f, Bucket *s) /* {{{ */</span></a>
<a name="849"><span class="lineNum">     849 </span>            : {</a>
<a name="850"><span class="lineNum">     850 </span>            :         zval args[2];</a>
<a name="851"><span class="lineNum">     851 </span>            :         zval retval;</a>
<a name="852"><span class="lineNum">     852 </span>            :         bool call_failed;</a>
<a name="853"><span class="lineNum">     853 </span>            : </a>
<a name="854"><span class="lineNum">     854 </span><span class="lineCov">     329668 :         ZVAL_COPY(&amp;args[0], &amp;f-&gt;val);</span></a>
<a name="855"><span class="lineNum">     855 </span><span class="lineCov">     329668 :         ZVAL_COPY(&amp;args[1], &amp;s-&gt;val);</span></a>
<a name="856"><span class="lineNum">     856 </span>            : </a>
<a name="857"><span class="lineNum">     857 </span><span class="lineCov">     329668 :         BG(user_compare_fci).param_count = 2;</span></a>
<a name="858"><span class="lineNum">     858 </span><span class="lineCov">     329668 :         BG(user_compare_fci).params = args;</span></a>
<a name="859"><span class="lineNum">     859 </span><span class="lineCov">     329668 :         BG(user_compare_fci).retval = &amp;retval;</span></a>
<a name="860"><span class="lineNum">     860 </span><span class="lineCov">     659336 :         call_failed = zend_call_function(&amp;BG(user_compare_fci), &amp;BG(user_compare_fci_cache)) == FAILURE || Z_TYPE(retval) == IS_UNDEF;</span></a>
<a name="861"><span class="lineNum">     861 </span><span class="lineCov">     329668 :         zval_ptr_dtor(&amp;args[1]);</span></a>
<a name="862"><span class="lineNum">     862 </span><span class="lineCov">     329668 :         zval_ptr_dtor(&amp;args[0]);</span></a>
<a name="863"><span class="lineNum">     863 </span><span class="lineCov">     329668 :         if (UNEXPECTED(call_failed)) {</span></a>
<a name="864"><span class="lineNum">     864 </span><span class="lineCov">         15 :                 return 0;</span></a>
<a name="865"><span class="lineNum">     865 </span>            :         }</a>
<a name="866"><span class="lineNum">     866 </span>            : </a>
<a name="867"><span class="lineNum">     867 </span><span class="lineCov">     656214 :         if (UNEXPECTED(Z_TYPE(retval) == IS_FALSE || Z_TYPE(retval) == IS_TRUE)) {</span></a>
<a name="868"><span class="lineNum">     868 </span><span class="lineCov">       8587 :                 if (!ARRAYG(compare_deprecation_thrown)) {</span></a>
<a name="869"><span class="lineNum">     869 </span><span class="lineCov">         42 :                         php_error_docref(NULL, E_DEPRECATED,</span></a>
<a name="870"><span class="lineNum">     870 </span>            :                                 &quot;Returning bool from comparison function is deprecated, &quot;</a>
<a name="871"><span class="lineNum">     871 </span>            :                                 &quot;return an integer less than, equal to, or greater than zero&quot;);</a>
<a name="872"><span class="lineNum">     872 </span><span class="lineCov">         42 :                         ARRAYG(compare_deprecation_thrown) = 1;</span></a>
<a name="873"><span class="lineNum">     873 </span>            :                 }</a>
<a name="874"><span class="lineNum">     874 </span>            : </a>
<a name="875"><span class="lineNum">     875 </span><span class="lineCov">       8587 :                 if (Z_TYPE(retval) == IS_FALSE) {</span></a>
<a name="876"><span class="lineNum">     876 </span>            :                         /* Retry with swapped operands. */</a>
<a name="877"><span class="lineNum">     877 </span><span class="lineCov">       3092 :                         ZVAL_COPY(&amp;args[0], &amp;s-&gt;val);</span></a>
<a name="878"><span class="lineNum">     878 </span><span class="lineCov">       3092 :                         ZVAL_COPY(&amp;args[1], &amp;f-&gt;val);</span></a>
<a name="879"><span class="lineNum">     879 </span><span class="lineCov">       6184 :                         call_failed = zend_call_function(&amp;BG(user_compare_fci), &amp;BG(user_compare_fci_cache)) == FAILURE || Z_TYPE(retval) == IS_UNDEF;</span></a>
<a name="880"><span class="lineNum">     880 </span><span class="lineCov">       3092 :                         zval_ptr_dtor(&amp;args[1]);</span></a>
<a name="881"><span class="lineNum">     881 </span><span class="lineCov">       3092 :                         zval_ptr_dtor(&amp;args[0]);</span></a>
<a name="882"><span class="lineNum">     882 </span><span class="lineCov">       3092 :                         if (call_failed) {</span></a>
<a name="883"><span class="lineNum">     883 </span><span class="lineNoCov">          0 :                                 return 0;</span></a>
<a name="884"><span class="lineNum">     884 </span>            :                         }</a>
<a name="885"><span class="lineNum">     885 </span>            : </a>
<a name="886"><span class="lineNum">     886 </span><span class="lineCov">       3092 :                         zend_long ret = zval_get_long(&amp;retval);</span></a>
<a name="887"><span class="lineNum">     887 </span><span class="lineCov">       3092 :                         zval_ptr_dtor(&amp;retval);</span></a>
<a name="888"><span class="lineNum">     888 </span><span class="lineCov">       3092 :                         return -ZEND_NORMALIZE_BOOL(ret);</span></a>
<a name="889"><span class="lineNum">     889 </span>            :                 }</a>
<a name="890"><span class="lineNum">     890 </span>            :         }</a>
<a name="891"><span class="lineNum">     891 </span>            : </a>
<a name="892"><span class="lineNum">     892 </span><span class="lineCov">     326561 :         zend_long ret = zval_get_long(&amp;retval);</span></a>
<a name="893"><span class="lineNum">     893 </span><span class="lineCov">     326561 :         zval_ptr_dtor(&amp;retval);</span></a>
<a name="894"><span class="lineNum">     894 </span><span class="lineCov">     326561 :         return ZEND_NORMALIZE_BOOL(ret);</span></a>
<a name="895"><span class="lineNum">     895 </span>            : }</a>
<a name="896"><span class="lineNum">     896 </span>            : /* }}} */</a>
<a name="897"><span class="lineNum">     897 </span>            : </a>
<a name="898"><span class="lineNum">     898 </span><span class="lineCov">     328525 : static int php_array_user_compare(Bucket *a, Bucket *b) /* {{{ */</span></a>
<a name="899"><span class="lineNum">     899 </span>            : {</a>
<a name="900"><span class="lineNum">     900 </span><span class="lineCov">     328525 :         RETURN_STABLE_SORT(a, b, php_array_user_compare_unstable(a, b));</span></a>
<a name="901"><span class="lineNum">     901 </span>            : }</a>
<a name="902"><span class="lineNum">     902 </span>            : /* }}} */</a>
<a name="903"><span class="lineNum">     903 </span>            : </a>
<a name="904"><span class="lineNum">     904 </span>            : #define PHP_ARRAY_CMP_FUNC_VARS \</a>
<a name="905"><span class="lineNum">     905 </span>            :         zend_fcall_info old_user_compare_fci; \</a>
<a name="906"><span class="lineNum">     906 </span>            :         zend_fcall_info_cache old_user_compare_fci_cache \</a>
<a name="907"><span class="lineNum">     907 </span>            : </a>
<a name="908"><span class="lineNum">     908 </span>            : #define PHP_ARRAY_CMP_FUNC_BACKUP() \</a>
<a name="909"><span class="lineNum">     909 </span>            :         old_user_compare_fci = BG(user_compare_fci); \</a>
<a name="910"><span class="lineNum">     910 </span>            :         old_user_compare_fci_cache = BG(user_compare_fci_cache); \</a>
<a name="911"><span class="lineNum">     911 </span>            :         ARRAYG(compare_deprecation_thrown) = 0; \</a>
<a name="912"><span class="lineNum">     912 </span>            :         BG(user_compare_fci_cache) = empty_fcall_info_cache; \</a>
<a name="913"><span class="lineNum">     913 </span>            : </a>
<a name="914"><span class="lineNum">     914 </span>            : #define PHP_ARRAY_CMP_FUNC_RESTORE() \</a>
<a name="915"><span class="lineNum">     915 </span>            :         BG(user_compare_fci) = old_user_compare_fci; \</a>
<a name="916"><span class="lineNum">     916 </span>            :         BG(user_compare_fci_cache) = old_user_compare_fci_cache; \</a>
<a name="917"><span class="lineNum">     917 </span>            : </a>
<a name="918"><span class="lineNum">     918 </span><span class="lineCov">        378 : static void php_usort(INTERNAL_FUNCTION_PARAMETERS, bucket_compare_func_t compare_func, bool renumber) /* {{{ */</span></a>
<a name="919"><span class="lineNum">     919 </span>            : {</a>
<a name="920"><span class="lineNum">     920 </span>            :         zval *array;</a>
<a name="921"><span class="lineNum">     921 </span>            :         zend_array *arr;</a>
<a name="922"><span class="lineNum">     922 </span>            :         PHP_ARRAY_CMP_FUNC_VARS;</a>
<a name="923"><span class="lineNum">     923 </span>            : </a>
<a name="924"><span class="lineNum">     924 </span><span class="lineCov">        378 :         PHP_ARRAY_CMP_FUNC_BACKUP();</span></a>
<a name="925"><span class="lineNum">     925 </span>            : </a>
<a name="926"><span class="lineNum">     926 </span><span class="lineCov">        378 :         ZEND_PARSE_PARAMETERS_START(2, 2)</span></a>
<a name="927"><span class="lineNum">     927 </span><span class="lineCov">       1080 :                 Z_PARAM_ARRAY_EX2(array, 0, 1, 0)</span></a>
<a name="928"><span class="lineNum">     928 </span><span class="lineCov">        720 :                 Z_PARAM_FUNC(BG(user_compare_fci), BG(user_compare_fci_cache))</span></a>
<a name="929"><span class="lineNum">     929 </span><span class="lineCov">        378 :         ZEND_PARSE_PARAMETERS_END_EX( PHP_ARRAY_CMP_FUNC_RESTORE(); return );</span></a>
<a name="930"><span class="lineNum">     930 </span>            : </a>
<a name="931"><span class="lineNum">     931 </span><span class="lineCov">        324 :         arr = Z_ARR_P(array);</span></a>
<a name="932"><span class="lineNum">     932 </span><span class="lineCov">        324 :         if (zend_hash_num_elements(arr) == 0)  {</span></a>
<a name="933"><span class="lineNum">     933 </span><span class="lineCov">         12 :                 PHP_ARRAY_CMP_FUNC_RESTORE();</span></a>
<a name="934"><span class="lineNum">     934 </span><span class="lineCov">         12 :                 RETURN_TRUE;</span></a>
<a name="935"><span class="lineNum">     935 </span>            :         }</a>
<a name="936"><span class="lineNum">     936 </span>            : </a>
<a name="937"><span class="lineNum">     937 </span>            :         /* Copy array, so the in-place modifications will not be visible to the callback function */</a>
<a name="938"><span class="lineNum">     938 </span><span class="lineCov">        312 :         arr = zend_array_dup(arr);</span></a>
<a name="939"><span class="lineNum">     939 </span>            : </a>
<a name="940"><span class="lineNum">     940 </span><span class="lineCov">        312 :         zend_hash_sort(arr, compare_func, renumber);</span></a>
<a name="941"><span class="lineNum">     941 </span>            : </a>
<a name="942"><span class="lineNum">     942 </span>            :         zval garbage;</a>
<a name="943"><span class="lineNum">     943 </span><span class="lineCov">        312 :         ZVAL_COPY_VALUE(&amp;garbage, array);</span></a>
<a name="944"><span class="lineNum">     944 </span><span class="lineCov">        312 :         ZVAL_ARR(array, arr);</span></a>
<a name="945"><span class="lineNum">     945 </span><span class="lineCov">        312 :         zval_ptr_dtor(&amp;garbage);</span></a>
<a name="946"><span class="lineNum">     946 </span>            : </a>
<a name="947"><span class="lineNum">     947 </span><span class="lineCov">        312 :         PHP_ARRAY_CMP_FUNC_RESTORE();</span></a>
<a name="948"><span class="lineNum">     948 </span><span class="lineCov">        312 :         RETURN_TRUE;</span></a>
<a name="949"><span class="lineNum">     949 </span>            : }</a>
<a name="950"><span class="lineNum">     950 </span>            : /* }}} */</a>
<a name="951"><span class="lineNum">     951 </span>            : </a>
<a name="952"><span class="lineNum">     952 </span>            : /* {{{ Sort an array by values using a user-defined comparison function */</a>
<a name="953"><span class="lineNum">     953 </span><span class="lineCov">        132 : PHP_FUNCTION(usort)</span></a>
<a name="954"><span class="lineNum">     954 </span>            : {</a>
<a name="955"><span class="lineNum">     955 </span><span class="lineCov">        132 :         php_usort(INTERNAL_FUNCTION_PARAM_PASSTHRU, php_array_user_compare, 1);</span></a>
<a name="956"><span class="lineNum">     956 </span><span class="lineCov">        132 : }</span></a>
<a name="957"><span class="lineNum">     957 </span>            : /* }}} */</a>
<a name="958"><span class="lineNum">     958 </span>            : </a>
<a name="959"><span class="lineNum">     959 </span>            : /* {{{ Sort an array with a user-defined comparison function and maintain index association */</a>
<a name="960"><span class="lineNum">     960 </span><span class="lineCov">        171 : PHP_FUNCTION(uasort)</span></a>
<a name="961"><span class="lineNum">     961 </span>            : {</a>
<a name="962"><span class="lineNum">     962 </span><span class="lineCov">        171 :         php_usort(INTERNAL_FUNCTION_PARAM_PASSTHRU, php_array_user_compare, 0);</span></a>
<a name="963"><span class="lineNum">     963 </span><span class="lineCov">        171 : }</span></a>
<a name="964"><span class="lineNum">     964 </span>            : /* }}} */</a>
<a name="965"><span class="lineNum">     965 </span>            : </a>
<a name="966"><span class="lineNum">     966 </span><span class="lineCov">      16122 : static inline int php_array_user_key_compare_unstable(Bucket *f, Bucket *s) /* {{{ */</span></a>
<a name="967"><span class="lineNum">     967 </span>            : {</a>
<a name="968"><span class="lineNum">     968 </span>            :         zval args[2];</a>
<a name="969"><span class="lineNum">     969 </span>            :         zval retval;</a>
<a name="970"><span class="lineNum">     970 </span>            :         bool call_failed;</a>
<a name="971"><span class="lineNum">     971 </span>            : </a>
<a name="972"><span class="lineNum">     972 </span><span class="lineCov">      16122 :         if (f-&gt;key == NULL) {</span></a>
<a name="973"><span class="lineNum">     973 </span><span class="lineCov">       8940 :                 ZVAL_LONG(&amp;args[0], f-&gt;h);</span></a>
<a name="974"><span class="lineNum">     974 </span>            :         } else {</a>
<a name="975"><span class="lineNum">     975 </span><span class="lineCov">      19833 :                 ZVAL_STR_COPY(&amp;args[0], f-&gt;key);</span></a>
<a name="976"><span class="lineNum">     976 </span>            :         }</a>
<a name="977"><span class="lineNum">     977 </span><span class="lineCov">      16122 :         if (s-&gt;key == NULL) {</span></a>
<a name="978"><span class="lineNum">     978 </span><span class="lineCov">       9834 :                 ZVAL_LONG(&amp;args[1], s-&gt;h);</span></a>
<a name="979"><span class="lineNum">     979 </span>            :         } else {</a>
<a name="980"><span class="lineNum">     980 </span><span class="lineCov">      18066 :                 ZVAL_STR_COPY(&amp;args[1], s-&gt;key);</span></a>
<a name="981"><span class="lineNum">     981 </span>            :         }</a>
<a name="982"><span class="lineNum">     982 </span>            : </a>
<a name="983"><span class="lineNum">     983 </span><span class="lineCov">      16122 :         BG(user_compare_fci).param_count = 2;</span></a>
<a name="984"><span class="lineNum">     984 </span><span class="lineCov">      16122 :         BG(user_compare_fci).params = args;</span></a>
<a name="985"><span class="lineNum">     985 </span><span class="lineCov">      16122 :         BG(user_compare_fci).retval = &amp;retval;</span></a>
<a name="986"><span class="lineNum">     986 </span><span class="lineCov">      32244 :         call_failed = zend_call_function(&amp;BG(user_compare_fci), &amp;BG(user_compare_fci_cache)) == FAILURE || Z_TYPE(retval) == IS_UNDEF;</span></a>
<a name="987"><span class="lineNum">     987 </span><span class="lineCov">      16122 :         zval_ptr_dtor(&amp;args[1]);</span></a>
<a name="988"><span class="lineNum">     988 </span><span class="lineCov">      16122 :         zval_ptr_dtor(&amp;args[0]);</span></a>
<a name="989"><span class="lineNum">     989 </span><span class="lineCov">      16122 :         if (UNEXPECTED(call_failed)) {</span></a>
<a name="990"><span class="lineNum">     990 </span><span class="lineCov">          9 :                 return 0;</span></a>
<a name="991"><span class="lineNum">     991 </span>            :         }</a>
<a name="992"><span class="lineNum">     992 </span>            : </a>
<a name="993"><span class="lineNum">     993 </span><span class="lineCov">      30638 :         if (UNEXPECTED(Z_TYPE(retval) == IS_FALSE || Z_TYPE(retval) == IS_TRUE)) {</span></a>
<a name="994"><span class="lineNum">     994 </span><span class="lineCov">       4227 :                 if (!ARRAYG(compare_deprecation_thrown)) {</span></a>
<a name="995"><span class="lineNum">     995 </span><span class="lineCov">         21 :                         php_error_docref(NULL, E_DEPRECATED,</span></a>
<a name="996"><span class="lineNum">     996 </span>            :                                 &quot;Returning bool from comparison function is deprecated, &quot;</a>
<a name="997"><span class="lineNum">     997 </span>            :                                 &quot;return an integer less than, equal to, or greater than zero&quot;);</a>
<a name="998"><span class="lineNum">     998 </span><span class="lineCov">         21 :                         ARRAYG(compare_deprecation_thrown) = 1;</span></a>
<a name="999"><span class="lineNum">     999 </span>            :                 }</a>
<a name="1000"><span class="lineNum">    1000 </span>            : </a>
<a name="1001"><span class="lineNum">    1001 </span><span class="lineCov">       4227 :                 if (Z_TYPE(retval) == IS_FALSE) {</span></a>
<a name="1002"><span class="lineNum">    1002 </span>            :                         /* Retry with swapped operands. */</a>
<a name="1003"><span class="lineNum">    1003 </span><span class="lineCov">       1588 :                         if (s-&gt;key == NULL) {</span></a>
<a name="1004"><span class="lineNum">    1004 </span><span class="lineCov">       1588 :                                 ZVAL_LONG(&amp;args[0], s-&gt;h);</span></a>
<a name="1005"><span class="lineNum">    1005 </span>            :                         } else {</a>
<a name="1006"><span class="lineNum">    1006 </span><span class="lineNoCov">          0 :                                 ZVAL_STR_COPY(&amp;args[0], s-&gt;key);</span></a>
<a name="1007"><span class="lineNum">    1007 </span>            :                         }</a>
<a name="1008"><span class="lineNum">    1008 </span><span class="lineCov">       1588 :                         if (f-&gt;key == NULL) {</span></a>
<a name="1009"><span class="lineNum">    1009 </span><span class="lineCov">       1588 :                                 ZVAL_LONG(&amp;args[1], f-&gt;h);</span></a>
<a name="1010"><span class="lineNum">    1010 </span>            :                         } else {</a>
<a name="1011"><span class="lineNum">    1011 </span><span class="lineNoCov">          0 :                                 ZVAL_STR_COPY(&amp;args[1], f-&gt;key);</span></a>
<a name="1012"><span class="lineNum">    1012 </span>            :                         }</a>
<a name="1013"><span class="lineNum">    1013 </span>            : </a>
<a name="1014"><span class="lineNum">    1014 </span><span class="lineCov">       3176 :                         call_failed = zend_call_function(&amp;BG(user_compare_fci), &amp;BG(user_compare_fci_cache)) == FAILURE || Z_TYPE(retval) == IS_UNDEF;</span></a>
<a name="1015"><span class="lineNum">    1015 </span><span class="lineCov">       1588 :                         zval_ptr_dtor(&amp;args[1]);</span></a>
<a name="1016"><span class="lineNum">    1016 </span><span class="lineCov">       1588 :                         zval_ptr_dtor(&amp;args[0]);</span></a>
<a name="1017"><span class="lineNum">    1017 </span><span class="lineCov">       1588 :                         if (call_failed) {</span></a>
<a name="1018"><span class="lineNum">    1018 </span><span class="lineNoCov">          0 :                                 return 0;</span></a>
<a name="1019"><span class="lineNum">    1019 </span>            :                         }</a>
<a name="1020"><span class="lineNum">    1020 </span>            : </a>
<a name="1021"><span class="lineNum">    1021 </span><span class="lineCov">       1588 :                         zend_long ret = zval_get_long(&amp;retval);</span></a>
<a name="1022"><span class="lineNum">    1022 </span><span class="lineCov">       1588 :                         zval_ptr_dtor(&amp;retval);</span></a>
<a name="1023"><span class="lineNum">    1023 </span><span class="lineCov">       1588 :                         return -ZEND_NORMALIZE_BOOL(ret);</span></a>
<a name="1024"><span class="lineNum">    1024 </span>            :                 }</a>
<a name="1025"><span class="lineNum">    1025 </span>            :         }</a>
<a name="1026"><span class="lineNum">    1026 </span>            : </a>
<a name="1027"><span class="lineNum">    1027 </span><span class="lineCov">      14525 :         zend_long result = zval_get_long(&amp;retval);</span></a>
<a name="1028"><span class="lineNum">    1028 </span><span class="lineCov">      14525 :         zval_ptr_dtor(&amp;retval);</span></a>
<a name="1029"><span class="lineNum">    1029 </span><span class="lineCov">      14525 :         return ZEND_NORMALIZE_BOOL(result);</span></a>
<a name="1030"><span class="lineNum">    1030 </span>            : }</a>
<a name="1031"><span class="lineNum">    1031 </span>            : /* }}} */</a>
<a name="1032"><span class="lineNum">    1032 </span>            : </a>
<a name="1033"><span class="lineNum">    1033 </span><span class="lineCov">       7653 : static int php_array_user_key_compare(Bucket *a, Bucket *b) /* {{{ */</span></a>
<a name="1034"><span class="lineNum">    1034 </span>            : {</a>
<a name="1035"><span class="lineNum">    1035 </span><span class="lineCov">       7653 :         RETURN_STABLE_SORT(a, b, php_array_user_key_compare_unstable(a, b));</span></a>
<a name="1036"><span class="lineNum">    1036 </span>            : }</a>
<a name="1037"><span class="lineNum">    1037 </span>            : /* }}} */</a>
<a name="1038"><span class="lineNum">    1038 </span>            : </a>
<a name="1039"><span class="lineNum">    1039 </span>            : /* {{{ Sort an array by keys using a user-defined comparison function */</a>
<a name="1040"><span class="lineNum">    1040 </span><span class="lineCov">         75 : PHP_FUNCTION(uksort)</span></a>
<a name="1041"><span class="lineNum">    1041 </span>            : {</a>
<a name="1042"><span class="lineNum">    1042 </span><span class="lineCov">         75 :         php_usort(INTERNAL_FUNCTION_PARAM_PASSTHRU, php_array_user_key_compare, 0);</span></a>
<a name="1043"><span class="lineNum">    1043 </span><span class="lineCov">         75 : }</span></a>
<a name="1044"><span class="lineNum">    1044 </span>            : /* }}} */</a>
<a name="1045"><span class="lineNum">    1045 </span>            : </a>
<a name="1046"><span class="lineNum">    1046 </span><span class="lineCov">       2508 : static inline HashTable *get_ht_for_iap(zval *zv, bool separate) {</span></a>
<a name="1047"><span class="lineNum">    1047 </span><span class="lineCov">       2508 :         if (EXPECTED(Z_TYPE_P(zv) == IS_ARRAY)) {</span></a>
<a name="1048"><span class="lineNum">    1048 </span><span class="lineCov">       2487 :                 return Z_ARRVAL_P(zv);</span></a>
<a name="1049"><span class="lineNum">    1049 </span>            :         }</a>
<a name="1050"><span class="lineNum">    1050 </span>            : </a>
<a name="1051"><span class="lineNum">    1051 </span><span class="lineCov">         21 :         ZEND_ASSERT(Z_TYPE_P(zv) == IS_OBJECT);</span></a>
<a name="1052"><span class="lineNum">    1052 </span><span class="lineCov">         21 :         php_error_docref(NULL, E_DEPRECATED,</span></a>
<a name="1053"><span class="lineNum">    1053 </span>            :                 &quot;Calling %s() on an object is deprecated&quot;, get_active_function_name());</a>
<a name="1054"><span class="lineNum">    1054 </span>            : </a>
<a name="1055"><span class="lineNum">    1055 </span><span class="lineCov">         21 :         zend_object *zobj = Z_OBJ_P(zv);</span></a>
<a name="1056"><span class="lineNum">    1056 </span><span class="lineCov">         36 :         if (separate &amp;&amp; zobj-&gt;properties &amp;&amp; UNEXPECTED(GC_REFCOUNT(zobj-&gt;properties) &gt; 1)) {</span></a>
<a name="1057"><span class="lineNum">    1057 </span><span class="lineCov">         12 :                 if (EXPECTED(!(GC_FLAGS(zobj-&gt;properties) &amp; IS_ARRAY_IMMUTABLE))) {</span></a>
<a name="1058"><span class="lineNum">    1058 </span><span class="lineCov">          6 :                         GC_DELREF(zobj-&gt;properties);</span></a>
<a name="1059"><span class="lineNum">    1059 </span>            :                 }</a>
<a name="1060"><span class="lineNum">    1060 </span><span class="lineCov">          6 :                 zobj-&gt;properties = zend_array_dup(zobj-&gt;properties);</span></a>
<a name="1061"><span class="lineNum">    1061 </span>            :         }</a>
<a name="1062"><span class="lineNum">    1062 </span><span class="lineCov">         21 :         return zobj-&gt;handlers-&gt;get_properties(zobj);</span></a>
<a name="1063"><span class="lineNum">    1063 </span>            : }</a>
<a name="1064"><span class="lineNum">    1064 </span>            : </a>
<a name="1065"><span class="lineNum">    1065 </span>            : /* {{{ Advances array argument's internal pointer to the last element and return it */</a>
<a name="1066"><span class="lineNum">    1066 </span><span class="lineCov">        156 : PHP_FUNCTION(end)</span></a>
<a name="1067"><span class="lineNum">    1067 </span>            : {</a>
<a name="1068"><span class="lineNum">    1068 </span>            :         zval *array_zv;</a>
<a name="1069"><span class="lineNum">    1069 </span>            :         zval *entry;</a>
<a name="1070"><span class="lineNum">    1070 </span>            : </a>
<a name="1071"><span class="lineNum">    1071 </span><span class="lineCov">        156 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="1072"><span class="lineNum">    1072 </span><span class="lineCov">        897 :                 Z_PARAM_ARRAY_OR_OBJECT_EX(array_zv, 0, 1)</span></a>
<a name="1073"><span class="lineNum">    1073 </span><span class="lineCov">        270 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="1074"><span class="lineNum">    1074 </span>            : </a>
<a name="1075"><span class="lineNum">    1075 </span><span class="lineCov">        150 :         HashTable *array = get_ht_for_iap(array_zv, /* separate */ true);</span></a>
<a name="1076"><span class="lineNum">    1076 </span><span class="lineCov">        150 :         zend_hash_internal_pointer_end(array);</span></a>
<a name="1077"><span class="lineNum">    1077 </span>            : </a>
<a name="1078"><span class="lineNum">    1078 </span><span class="lineCov">        150 :         if (USED_RET()) {</span></a>
<a name="1079"><span class="lineNum">    1079 </span><span class="lineCov">        114 :                 if ((entry = zend_hash_get_current_data(array)) == NULL) {</span></a>
<a name="1080"><span class="lineNum">    1080 </span><span class="lineNoCov">          0 :                         RETURN_FALSE;</span></a>
<a name="1081"><span class="lineNum">    1081 </span>            :                 }</a>
<a name="1082"><span class="lineNum">    1082 </span>            : </a>
<a name="1083"><span class="lineNum">    1083 </span><span class="lineCov">        114 :                 if (Z_TYPE_P(entry) == IS_INDIRECT) {</span></a>
<a name="1084"><span class="lineNum">    1084 </span><span class="lineNoCov">          0 :                         entry = Z_INDIRECT_P(entry);</span></a>
<a name="1085"><span class="lineNum">    1085 </span>            :                 }</a>
<a name="1086"><span class="lineNum">    1086 </span>            : </a>
<a name="1087"><span class="lineNum">    1087 </span><span class="lineCov">        153 :                 RETURN_COPY_DEREF(entry);</span></a>
<a name="1088"><span class="lineNum">    1088 </span>            :         }</a>
<a name="1089"><span class="lineNum">    1089 </span>            : }</a>
<a name="1090"><span class="lineNum">    1090 </span>            : /* }}} */</a>
<a name="1091"><span class="lineNum">    1091 </span>            : </a>
<a name="1092"><span class="lineNum">    1092 </span>            : /* {{{ Move array argument's internal pointer to the previous element and return it */</a>
<a name="1093"><span class="lineNum">    1093 </span><span class="lineCov">         66 : PHP_FUNCTION(prev)</span></a>
<a name="1094"><span class="lineNum">    1094 </span>            : {</a>
<a name="1095"><span class="lineNum">    1095 </span>            :         zval *array_zv;</a>
<a name="1096"><span class="lineNum">    1096 </span>            :         zval *entry;</a>
<a name="1097"><span class="lineNum">    1097 </span>            : </a>
<a name="1098"><span class="lineNum">    1098 </span><span class="lineCov">         66 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="1099"><span class="lineNum">    1099 </span><span class="lineCov">        357 :                 Z_PARAM_ARRAY_OR_OBJECT_EX(array_zv, 0, 1)</span></a>
<a name="1100"><span class="lineNum">    1100 </span><span class="lineCov">        120 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="1101"><span class="lineNum">    1101 </span>            : </a>
<a name="1102"><span class="lineNum">    1102 </span><span class="lineCov">         60 :         HashTable *array = get_ht_for_iap(array_zv, /* separate */ true);</span></a>
<a name="1103"><span class="lineNum">    1103 </span><span class="lineCov">         60 :         zend_hash_move_backwards(array);</span></a>
<a name="1104"><span class="lineNum">    1104 </span>            : </a>
<a name="1105"><span class="lineNum">    1105 </span><span class="lineCov">         60 :         if (USED_RET()) {</span></a>
<a name="1106"><span class="lineNum">    1106 </span><span class="lineCov">         54 :                 if ((entry = zend_hash_get_current_data(array)) == NULL) {</span></a>
<a name="1107"><span class="lineNum">    1107 </span><span class="lineCov">         15 :                         RETURN_FALSE;</span></a>
<a name="1108"><span class="lineNum">    1108 </span>            :                 }</a>
<a name="1109"><span class="lineNum">    1109 </span>            : </a>
<a name="1110"><span class="lineNum">    1110 </span><span class="lineCov">         39 :                 if (Z_TYPE_P(entry) == IS_INDIRECT) {</span></a>
<a name="1111"><span class="lineNum">    1111 </span><span class="lineNoCov">          0 :                         entry = Z_INDIRECT_P(entry);</span></a>
<a name="1112"><span class="lineNum">    1112 </span>            :                 }</a>
<a name="1113"><span class="lineNum">    1113 </span>            : </a>
<a name="1114"><span class="lineNum">    1114 </span><span class="lineCov">         57 :                 RETURN_COPY_DEREF(entry);</span></a>
<a name="1115"><span class="lineNum">    1115 </span>            :         }</a>
<a name="1116"><span class="lineNum">    1116 </span>            : }</a>
<a name="1117"><span class="lineNum">    1117 </span>            : /* }}} */</a>
<a name="1118"><span class="lineNum">    1118 </span>            : </a>
<a name="1119"><span class="lineNum">    1119 </span>            : /* {{{ Move array argument's internal pointer to the next element and return it */</a>
<a name="1120"><span class="lineNum">    1120 </span><span class="lineCov">        495 : PHP_FUNCTION(next)</span></a>
<a name="1121"><span class="lineNum">    1121 </span>            : {</a>
<a name="1122"><span class="lineNum">    1122 </span>            :         zval *array_zv;</a>
<a name="1123"><span class="lineNum">    1123 </span>            :         zval *entry;</a>
<a name="1124"><span class="lineNum">    1124 </span>            : </a>
<a name="1125"><span class="lineNum">    1125 </span><span class="lineCov">        495 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="1126"><span class="lineNum">    1126 </span><span class="lineCov">       2928 :                 Z_PARAM_ARRAY_OR_OBJECT_EX(array_zv, 0, 1)</span></a>
<a name="1127"><span class="lineNum">    1127 </span><span class="lineCov">        774 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="1128"><span class="lineNum">    1128 </span>            : </a>
<a name="1129"><span class="lineNum">    1129 </span><span class="lineCov">        489 :         HashTable *array = get_ht_for_iap(array_zv, /* separate */ true);</span></a>
<a name="1130"><span class="lineNum">    1130 </span><span class="lineCov">        489 :         zend_hash_move_forward(array);</span></a>
<a name="1131"><span class="lineNum">    1131 </span>            : </a>
<a name="1132"><span class="lineNum">    1132 </span><span class="lineCov">        489 :         if (USED_RET()) {</span></a>
<a name="1133"><span class="lineNum">    1133 </span><span class="lineCov">        279 :                 if ((entry = zend_hash_get_current_data(array)) == NULL) {</span></a>
<a name="1134"><span class="lineNum">    1134 </span><span class="lineCov">         96 :                         RETURN_FALSE;</span></a>
<a name="1135"><span class="lineNum">    1135 </span>            :                 }</a>
<a name="1136"><span class="lineNum">    1136 </span>            : </a>
<a name="1137"><span class="lineNum">    1137 </span><span class="lineCov">        183 :                 if (Z_TYPE_P(entry) == IS_INDIRECT) {</span></a>
<a name="1138"><span class="lineNum">    1138 </span><span class="lineNoCov">          0 :                         entry = Z_INDIRECT_P(entry);</span></a>
<a name="1139"><span class="lineNum">    1139 </span>            :                 }</a>
<a name="1140"><span class="lineNum">    1140 </span>            : </a>
<a name="1141"><span class="lineNum">    1141 </span><span class="lineCov">        291 :                 RETURN_COPY_DEREF(entry);</span></a>
<a name="1142"><span class="lineNum">    1142 </span>            :         }</a>
<a name="1143"><span class="lineNum">    1143 </span>            : }</a>
<a name="1144"><span class="lineNum">    1144 </span>            : /* }}} */</a>
<a name="1145"><span class="lineNum">    1145 </span>            : </a>
<a name="1146"><span class="lineNum">    1146 </span>            : /* {{{ Set array argument's internal pointer to the first element and return it */</a>
<a name="1147"><span class="lineNum">    1147 </span><span class="lineCov">        279 : PHP_FUNCTION(reset)</span></a>
<a name="1148"><span class="lineNum">    1148 </span>            : {</a>
<a name="1149"><span class="lineNum">    1149 </span>            :         zval *array_zv;</a>
<a name="1150"><span class="lineNum">    1150 </span>            :         zval *entry;</a>
<a name="1151"><span class="lineNum">    1151 </span>            : </a>
<a name="1152"><span class="lineNum">    1152 </span><span class="lineCov">        279 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="1153"><span class="lineNum">    1153 </span><span class="lineCov">       1635 :                 Z_PARAM_ARRAY_OR_OBJECT_EX(array_zv, 0, 1)</span></a>
<a name="1154"><span class="lineNum">    1154 </span><span class="lineCov">        432 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="1155"><span class="lineNum">    1155 </span>            : </a>
<a name="1156"><span class="lineNum">    1156 </span><span class="lineCov">        273 :         HashTable *array = get_ht_for_iap(array_zv, /* separate */ true);</span></a>
<a name="1157"><span class="lineNum">    1157 </span><span class="lineCov">        273 :         zend_hash_internal_pointer_reset(array);</span></a>
<a name="1158"><span class="lineNum">    1158 </span>            : </a>
<a name="1159"><span class="lineNum">    1159 </span><span class="lineCov">        273 :         if (USED_RET()) {</span></a>
<a name="1160"><span class="lineNum">    1160 </span><span class="lineCov">        153 :                 if ((entry = zend_hash_get_current_data(array)) == NULL) {</span></a>
<a name="1161"><span class="lineNum">    1161 </span><span class="lineCov">          3 :                         RETURN_FALSE;</span></a>
<a name="1162"><span class="lineNum">    1162 </span>            :                 }</a>
<a name="1163"><span class="lineNum">    1163 </span>            : </a>
<a name="1164"><span class="lineNum">    1164 </span><span class="lineCov">        150 :                 if (Z_TYPE_P(entry) == IS_INDIRECT) {</span></a>
<a name="1165"><span class="lineNum">    1165 </span><span class="lineNoCov">          0 :                         entry = Z_INDIRECT_P(entry);</span></a>
<a name="1166"><span class="lineNum">    1166 </span>            :                 }</a>
<a name="1167"><span class="lineNum">    1167 </span>            : </a>
<a name="1168"><span class="lineNum">    1168 </span><span class="lineCov">        216 :                 RETURN_COPY_DEREF(entry);</span></a>
<a name="1169"><span class="lineNum">    1169 </span>            :         }</a>
<a name="1170"><span class="lineNum">    1170 </span>            : }</a>
<a name="1171"><span class="lineNum">    1171 </span>            : /* }}} */</a>
<a name="1172"><span class="lineNum">    1172 </span>            : </a>
<a name="1173"><span class="lineNum">    1173 </span>            : /* {{{ Return the element currently pointed to by the internal array pointer */</a>
<a name="1174"><span class="lineNum">    1174 </span><span class="lineCov">       1014 : PHP_FUNCTION(current)</span></a>
<a name="1175"><span class="lineNum">    1175 </span>            : {</a>
<a name="1176"><span class="lineNum">    1176 </span>            :         zval *array_zv;</a>
<a name="1177"><span class="lineNum">    1177 </span>            :         zval *entry;</a>
<a name="1178"><span class="lineNum">    1178 </span>            : </a>
<a name="1179"><span class="lineNum">    1179 </span><span class="lineCov">       1014 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="1180"><span class="lineNum">    1180 </span><span class="lineCov">       1836 :                 Z_PARAM_ARRAY_OR_OBJECT(array_zv)</span></a>
<a name="1181"><span class="lineNum">    1181 </span><span class="lineCov">       1014 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="1182"><span class="lineNum">    1182 </span>            : </a>
<a name="1183"><span class="lineNum">    1183 </span><span class="lineCov">        906 :         HashTable *array = get_ht_for_iap(array_zv, /* separate */ false);</span></a>
<a name="1184"><span class="lineNum">    1184 </span><span class="lineCov">        906 :         if ((entry = zend_hash_get_current_data(array)) == NULL) {</span></a>
<a name="1185"><span class="lineNum">    1185 </span><span class="lineCov">         84 :                 RETURN_FALSE;</span></a>
<a name="1186"><span class="lineNum">    1186 </span>            :         }</a>
<a name="1187"><span class="lineNum">    1187 </span>            : </a>
<a name="1188"><span class="lineNum">    1188 </span><span class="lineCov">        822 :         if (Z_TYPE_P(entry) == IS_INDIRECT) {</span></a>
<a name="1189"><span class="lineNum">    1189 </span><span class="lineNoCov">          0 :                 entry = Z_INDIRECT_P(entry);</span></a>
<a name="1190"><span class="lineNum">    1190 </span>            :         }</a>
<a name="1191"><span class="lineNum">    1191 </span>            : </a>
<a name="1192"><span class="lineNum">    1192 </span><span class="lineCov">       1344 :         RETURN_COPY_DEREF(entry);</span></a>
<a name="1193"><span class="lineNum">    1193 </span>            : }</a>
<a name="1194"><span class="lineNum">    1194 </span>            : /* }}} */</a>
<a name="1195"><span class="lineNum">    1195 </span>            : </a>
<a name="1196"><span class="lineNum">    1196 </span>            : /* {{{ Return the key of the element currently pointed to by the internal array pointer */</a>
<a name="1197"><span class="lineNum">    1197 </span><span class="lineCov">        684 : PHP_FUNCTION(key)</span></a>
<a name="1198"><span class="lineNum">    1198 </span>            : {</a>
<a name="1199"><span class="lineNum">    1199 </span>            :         zval *array_zv;</a>
<a name="1200"><span class="lineNum">    1200 </span>            : </a>
<a name="1201"><span class="lineNum">    1201 </span><span class="lineCov">        684 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="1202"><span class="lineNum">    1202 </span><span class="lineCov">       1272 :                 Z_PARAM_ARRAY_OR_OBJECT(array_zv)</span></a>
<a name="1203"><span class="lineNum">    1203 </span><span class="lineCov">        684 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="1204"><span class="lineNum">    1204 </span>            : </a>
<a name="1205"><span class="lineNum">    1205 </span><span class="lineCov">        630 :         HashTable *array = get_ht_for_iap(array_zv, /* separate */ false);</span></a>
<a name="1206"><span class="lineNum">    1206 </span><span class="lineCov">        630 :         zend_hash_get_current_key_zval(array, return_value);</span></a>
<a name="1207"><span class="lineNum">    1207 </span>            : }</a>
<a name="1208"><span class="lineNum">    1208 </span>            : /* }}} */</a>
<a name="1209"><span class="lineNum">    1209 </span>            : </a>
<a name="1210"><span class="lineNum">    1210 </span><span class="lineCov">        894 : static int php_data_compare(const void *f, const void *s) /* {{{ */</span></a>
<a name="1211"><span class="lineNum">    1211 </span>            : {</a>
<a name="1212"><span class="lineNum">    1212 </span><span class="lineCov">        894 :         return zend_compare((zval*)f, (zval*)s);</span></a>
<a name="1213"><span class="lineNum">    1213 </span>            : }</a>
<a name="1214"><span class="lineNum">    1214 </span>            : /* }}} */</a>
<a name="1215"><span class="lineNum">    1215 </span>            : </a>
<a name="1216"><span class="lineNum">    1216 </span>            : /* {{{</a>
<a name="1217"><span class="lineNum">    1217 </span>            :  * proto mixed min(array values)</a>
<a name="1218"><span class="lineNum">    1218 </span>            :  * proto mixed min(mixed arg1 [, mixed arg2 [, mixed ...]])</a>
<a name="1219"><span class="lineNum">    1219 </span>            :    Return the lowest value in an array or a series of arguments */</a>
<a name="1220"><span class="lineNum">    1220 </span><span class="lineCov">       6357 : PHP_FUNCTION(min)</span></a>
<a name="1221"><span class="lineNum">    1221 </span>            : {</a>
<a name="1222"><span class="lineNum">    1222 </span>            :         int argc;</a>
<a name="1223"><span class="lineNum">    1223 </span><span class="lineCov">       6357 :         zval *args = NULL;</span></a>
<a name="1224"><span class="lineNum">    1224 </span>            : </a>
<a name="1225"><span class="lineNum">    1225 </span><span class="lineCov">       6357 :         ZEND_PARSE_PARAMETERS_START(1, -1)</span></a>
<a name="1226"><span class="lineNum">    1226 </span><span class="lineCov">       6351 :                 Z_PARAM_VARIADIC('+', args, argc)</span></a>
<a name="1227"><span class="lineNum">    1227 </span><span class="lineCov">       6357 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="1228"><span class="lineNum">    1228 </span>            : </a>
<a name="1229"><span class="lineNum">    1229 </span>            :         /* mixed min ( array $values ) */</a>
<a name="1230"><span class="lineNum">    1230 </span><span class="lineCov">       6351 :         if (argc == 1) {</span></a>
<a name="1231"><span class="lineNum">    1231 </span><span class="lineCov">         66 :                 if (Z_TYPE(args[0]) != IS_ARRAY) {</span></a>
<a name="1232"><span class="lineNum">    1232 </span><span class="lineCov">         12 :                         zend_argument_type_error(1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;args[0]));</span></a>
<a name="1233"><span class="lineNum">    1233 </span><span class="lineCov">         12 :                         RETURN_THROWS();</span></a>
<a name="1234"><span class="lineNum">    1234 </span>            :                 } else {</a>
<a name="1235"><span class="lineNum">    1235 </span><span class="lineCov">         54 :                         zval *result = zend_hash_minmax(Z_ARRVAL(args[0]), php_data_compare, 0);</span></a>
<a name="1236"><span class="lineNum">    1236 </span><span class="lineCov">         54 :                         if (result) {</span></a>
<a name="1237"><span class="lineNum">    1237 </span><span class="lineCov">         51 :                                 RETURN_COPY_DEREF(result);</span></a>
<a name="1238"><span class="lineNum">    1238 </span>            :                         } else {</a>
<a name="1239"><span class="lineNum">    1239 </span><span class="lineCov">          3 :                                 zend_argument_value_error(1, &quot;must contain at least one element&quot;);</span></a>
<a name="1240"><span class="lineNum">    1240 </span><span class="lineCov">          3 :                                 RETURN_THROWS();</span></a>
<a name="1241"><span class="lineNum">    1241 </span>            :                         }</a>
<a name="1242"><span class="lineNum">    1242 </span>            :                 }</a>
<a name="1243"><span class="lineNum">    1243 </span>            :         } else {</a>
<a name="1244"><span class="lineNum">    1244 </span>            :                 /* mixed min ( mixed $value1 , mixed $value2 [, mixed $value3... ] ) */</a>
<a name="1245"><span class="lineNum">    1245 </span>            :                 zval *min, result;</a>
<a name="1246"><span class="lineNum">    1246 </span>            :                 int i;</a>
<a name="1247"><span class="lineNum">    1247 </span>            : </a>
<a name="1248"><span class="lineNum">    1248 </span><span class="lineCov">       6285 :                 min = &amp;args[0];</span></a>
<a name="1249"><span class="lineNum">    1249 </span>            : </a>
<a name="1250"><span class="lineNum">    1250 </span><span class="lineCov">      16449 :                 for (i = 1; i &lt; argc; i++) {</span></a>
<a name="1251"><span class="lineNum">    1251 </span><span class="lineCov">      10164 :                         is_smaller_function(&amp;result, &amp;args[i], min);</span></a>
<a name="1252"><span class="lineNum">    1252 </span><span class="lineCov">      10164 :                         if (Z_TYPE(result) == IS_TRUE) {</span></a>
<a name="1253"><span class="lineNum">    1253 </span><span class="lineCov">         42 :                                 min = &amp;args[i];</span></a>
<a name="1254"><span class="lineNum">    1254 </span>            :                         }</a>
<a name="1255"><span class="lineNum">    1255 </span>            :                 }</a>
<a name="1256"><span class="lineNum">    1256 </span>            : </a>
<a name="1257"><span class="lineNum">    1257 </span><span class="lineCov">       6285 :                 RETURN_COPY(min);</span></a>
<a name="1258"><span class="lineNum">    1258 </span>            :         }</a>
<a name="1259"><span class="lineNum">    1259 </span>            : }</a>
<a name="1260"><span class="lineNum">    1260 </span>            : /* }}} */</a>
<a name="1261"><span class="lineNum">    1261 </span>            : </a>
<a name="1262"><span class="lineNum">    1262 </span>            : /* {{{</a>
<a name="1263"><span class="lineNum">    1263 </span>            :  * proto mixed max(array values)</a>
<a name="1264"><span class="lineNum">    1264 </span>            :  * proto mixed max(mixed arg1 [, mixed arg2 [, mixed ...]])</a>
<a name="1265"><span class="lineNum">    1265 </span>            :    Return the highest value in an array or a series of arguments */</a>
<a name="1266"><span class="lineNum">    1266 </span><span class="lineCov">        324 : PHP_FUNCTION(max)</span></a>
<a name="1267"><span class="lineNum">    1267 </span>            : {</a>
<a name="1268"><span class="lineNum">    1268 </span><span class="lineCov">        324 :         zval *args = NULL;</span></a>
<a name="1269"><span class="lineNum">    1269 </span>            :         int argc;</a>
<a name="1270"><span class="lineNum">    1270 </span>            : </a>
<a name="1271"><span class="lineNum">    1271 </span><span class="lineCov">        324 :         ZEND_PARSE_PARAMETERS_START(1, -1)</span></a>
<a name="1272"><span class="lineNum">    1272 </span><span class="lineCov">        318 :                 Z_PARAM_VARIADIC('+', args, argc)</span></a>
<a name="1273"><span class="lineNum">    1273 </span><span class="lineCov">        324 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="1274"><span class="lineNum">    1274 </span>            : </a>
<a name="1275"><span class="lineNum">    1275 </span>            :         /* mixed max ( array $values ) */</a>
<a name="1276"><span class="lineNum">    1276 </span><span class="lineCov">        318 :         if (argc == 1) {</span></a>
<a name="1277"><span class="lineNum">    1277 </span><span class="lineCov">        198 :                 if (Z_TYPE(args[0]) != IS_ARRAY) {</span></a>
<a name="1278"><span class="lineNum">    1278 </span><span class="lineCov">         12 :                         zend_argument_type_error(1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;args[0]));</span></a>
<a name="1279"><span class="lineNum">    1279 </span><span class="lineCov">         12 :                         RETURN_THROWS();</span></a>
<a name="1280"><span class="lineNum">    1280 </span>            :                 } else {</a>
<a name="1281"><span class="lineNum">    1281 </span><span class="lineCov">        186 :                         zval *result = zend_hash_minmax(Z_ARRVAL(args[0]), php_data_compare, 1);</span></a>
<a name="1282"><span class="lineNum">    1282 </span><span class="lineCov">        186 :                         if (result) {</span></a>
<a name="1283"><span class="lineNum">    1283 </span><span class="lineCov">        186 :                                 RETURN_COPY_DEREF(result);</span></a>
<a name="1284"><span class="lineNum">    1284 </span>            :                         } else {</a>
<a name="1285"><span class="lineNum">    1285 </span><span class="lineCov">          3 :                                 zend_argument_value_error(1, &quot;must contain at least one element&quot;);</span></a>
<a name="1286"><span class="lineNum">    1286 </span><span class="lineCov">          3 :                                 RETURN_THROWS();</span></a>
<a name="1287"><span class="lineNum">    1287 </span>            :                         }</a>
<a name="1288"><span class="lineNum">    1288 </span>            :                 }</a>
<a name="1289"><span class="lineNum">    1289 </span>            :         } else {</a>
<a name="1290"><span class="lineNum">    1290 </span>            :                 /* mixed max ( mixed $value1 , mixed $value2 [, mixed $value3... ] ) */</a>
<a name="1291"><span class="lineNum">    1291 </span>            :                 zval *max, result;</a>
<a name="1292"><span class="lineNum">    1292 </span>            :                 int i;</a>
<a name="1293"><span class="lineNum">    1293 </span>            : </a>
<a name="1294"><span class="lineNum">    1294 </span><span class="lineCov">        120 :                 max = &amp;args[0];</span></a>
<a name="1295"><span class="lineNum">    1295 </span>            : </a>
<a name="1296"><span class="lineNum">    1296 </span><span class="lineCov">       4119 :                 for (i = 1; i &lt; argc; i++) {</span></a>
<a name="1297"><span class="lineNum">    1297 </span><span class="lineCov">       3999 :                         is_smaller_or_equal_function(&amp;result, &amp;args[i], max);</span></a>
<a name="1298"><span class="lineNum">    1298 </span><span class="lineCov">       3999 :                         if (Z_TYPE(result) == IS_FALSE) {</span></a>
<a name="1299"><span class="lineNum">    1299 </span><span class="lineCov">        126 :                                 max = &amp;args[i];</span></a>
<a name="1300"><span class="lineNum">    1300 </span>            :                         }</a>
<a name="1301"><span class="lineNum">    1301 </span>            :                 }</a>
<a name="1302"><span class="lineNum">    1302 </span>            : </a>
<a name="1303"><span class="lineNum">    1303 </span><span class="lineCov">        123 :                 RETURN_COPY(max);</span></a>
<a name="1304"><span class="lineNum">    1304 </span>            :         }</a>
<a name="1305"><span class="lineNum">    1305 </span>            : }</a>
<a name="1306"><span class="lineNum">    1306 </span>            : /* }}} */</a>
<a name="1307"><span class="lineNum">    1307 </span>            : </a>
<a name="1308"><span class="lineNum">    1308 </span>            : typedef struct {</a>
<a name="1309"><span class="lineNum">    1309 </span>            :         zend_fcall_info fci;</a>
<a name="1310"><span class="lineNum">    1310 </span>            :         zend_fcall_info_cache fci_cache;</a>
<a name="1311"><span class="lineNum">    1311 </span>            : } php_array_walk_context;</a>
<a name="1312"><span class="lineNum">    1312 </span>            : </a>
<a name="1313"><span class="lineNum">    1313 </span><span class="lineCov">        816 : static int php_array_walk(</span></a>
<a name="1314"><span class="lineNum">    1314 </span>            :         php_array_walk_context *context, zval *array, zval *userdata, int recursive)</a>
<a name="1315"><span class="lineNum">    1315 </span>            : {</a>
<a name="1316"><span class="lineNum">    1316 </span>            :         zval args[3],           /* Arguments to userland function */</a>
<a name="1317"><span class="lineNum">    1317 </span>            :                  retval,                /* Return value - unused */</a>
<a name="1318"><span class="lineNum">    1318 </span>            :                  *zv;</a>
<a name="1319"><span class="lineNum">    1319 </span><span class="lineCov">        837 :         HashTable *target_hash = HASH_OF(array);</span></a>
<a name="1320"><span class="lineNum">    1320 </span>            :         HashPosition pos;</a>
<a name="1321"><span class="lineNum">    1321 </span>            :         uint32_t ht_iter;</a>
<a name="1322"><span class="lineNum">    1322 </span><span class="lineCov">        816 :         int result = SUCCESS;</span></a>
<a name="1323"><span class="lineNum">    1323 </span>            : </a>
<a name="1324"><span class="lineNum">    1324 </span>            :         /* Create a local copy of fci, as we want to use different arguments at different</a>
<a name="1325"><span class="lineNum">    1325 </span>            :          * levels of recursion. */</a>
<a name="1326"><span class="lineNum">    1326 </span><span class="lineCov">        816 :         zend_fcall_info fci = context-&gt;fci;</span></a>
<a name="1327"><span class="lineNum">    1327 </span>            : </a>
<a name="1328"><span class="lineNum">    1328 </span>            :         /* Set up known arguments */</a>
<a name="1329"><span class="lineNum">    1329 </span><span class="lineCov">        816 :         ZVAL_UNDEF(&amp;args[1]);</span></a>
<a name="1330"><span class="lineNum">    1330 </span><span class="lineCov">        816 :         if (userdata) {</span></a>
<a name="1331"><span class="lineNum">    1331 </span><span class="lineCov">        450 :                 ZVAL_COPY(&amp;args[2], userdata);</span></a>
<a name="1332"><span class="lineNum">    1332 </span>            :         }</a>
<a name="1333"><span class="lineNum">    1333 </span>            : </a>
<a name="1334"><span class="lineNum">    1334 </span><span class="lineCov">        816 :         fci.retval = &amp;retval;</span></a>
<a name="1335"><span class="lineNum">    1335 </span><span class="lineCov">        816 :         fci.param_count = userdata ? 3 : 2;</span></a>
<a name="1336"><span class="lineNum">    1336 </span><span class="lineCov">        816 :         fci.params = args;</span></a>
<a name="1337"><span class="lineNum">    1337 </span>            : </a>
<a name="1338"><span class="lineNum">    1338 </span><span class="lineCov">        816 :         zend_hash_internal_pointer_reset_ex(target_hash, &amp;pos);</span></a>
<a name="1339"><span class="lineNum">    1339 </span><span class="lineCov">        816 :         ht_iter = zend_hash_iterator_add(target_hash, pos);</span></a>
<a name="1340"><span class="lineNum">    1340 </span>            : </a>
<a name="1341"><span class="lineNum">    1341 </span>            :         /* Iterate through hash */</a>
<a name="1342"><span class="lineNum">    1342 </span>            :         do {</a>
<a name="1343"><span class="lineNum">    1343 </span>            :                 /* Retrieve value */</a>
<a name="1344"><span class="lineNum">    1344 </span><span class="lineCov">       3789 :                 zv = zend_hash_get_current_data_ex(target_hash, &amp;pos);</span></a>
<a name="1345"><span class="lineNum">    1345 </span><span class="lineCov">       3789 :                 if (zv == NULL) {</span></a>
<a name="1346"><span class="lineNum">    1346 </span><span class="lineCov">        771 :                         break;</span></a>
<a name="1347"><span class="lineNum">    1347 </span>            :                 }</a>
<a name="1348"><span class="lineNum">    1348 </span>            : </a>
<a name="1349"><span class="lineNum">    1349 </span>            :                 /* Skip undefined indirect elements */</a>
<a name="1350"><span class="lineNum">    1350 </span><span class="lineCov">       3018 :                 if (Z_TYPE_P(zv) == IS_INDIRECT) {</span></a>
<a name="1351"><span class="lineNum">    1351 </span><span class="lineCov">         39 :                         zv = Z_INDIRECT_P(zv);</span></a>
<a name="1352"><span class="lineNum">    1352 </span><span class="lineCov">         39 :                         if (Z_TYPE_P(zv) == IS_UNDEF) {</span></a>
<a name="1353"><span class="lineNum">    1353 </span><span class="lineNoCov">          0 :                                 zend_hash_move_forward_ex(target_hash, &amp;pos);</span></a>
<a name="1354"><span class="lineNum">    1354 </span><span class="lineNoCov">          0 :                                 continue;</span></a>
<a name="1355"><span class="lineNum">    1355 </span>            :                         }</a>
<a name="1356"><span class="lineNum">    1356 </span>            : </a>
<a name="1357"><span class="lineNum">    1357 </span>            :                         /* Add type source for property references. */</a>
<a name="1358"><span class="lineNum">    1358 </span><span class="lineCov">         78 :                         if (Z_TYPE_P(zv) != IS_REFERENCE &amp;&amp; Z_TYPE_P(array) == IS_OBJECT) {</span></a>
<a name="1359"><span class="lineNum">    1359 </span>            :                                 zend_property_info *prop_info =</a>
<a name="1360"><span class="lineNum">    1360 </span><span class="lineCov">         39 :                                         zend_get_typed_property_info_for_slot(Z_OBJ_P(array), zv);</span></a>
<a name="1361"><span class="lineNum">    1361 </span><span class="lineCov">         39 :                                 if (prop_info) {</span></a>
<a name="1362"><span class="lineNum">    1362 </span><span class="lineCov">          3 :                                         ZVAL_NEW_REF(zv, zv);</span></a>
<a name="1363"><span class="lineNum">    1363 </span><span class="lineCov">          3 :                                         ZEND_REF_ADD_TYPE_SOURCE(Z_REF_P(zv), prop_info);</span></a>
<a name="1364"><span class="lineNum">    1364 </span>            :                                 }</a>
<a name="1365"><span class="lineNum">    1365 </span>            :                         }</a>
<a name="1366"><span class="lineNum">    1366 </span>            :                 }</a>
<a name="1367"><span class="lineNum">    1367 </span>            : </a>
<a name="1368"><span class="lineNum">    1368 </span>            :                 /* Ensure the value is a reference. Otherwise the location of the value may be freed. */</a>
<a name="1369"><span class="lineNum">    1369 </span><span class="lineCov">       8607 :                 ZVAL_MAKE_REF(zv);</span></a>
<a name="1370"><span class="lineNum">    1370 </span>            : </a>
<a name="1371"><span class="lineNum">    1371 </span>            :                 /* Retrieve key */</a>
<a name="1372"><span class="lineNum">    1372 </span><span class="lineCov">       3018 :                 zend_hash_get_current_key_zval_ex(target_hash, &amp;args[1], &amp;pos);</span></a>
<a name="1373"><span class="lineNum">    1373 </span>            : </a>
<a name="1374"><span class="lineNum">    1374 </span>            :                 /* Move to next element already now -- this mirrors the approach used by foreach</a>
<a name="1375"><span class="lineNum">    1375 </span>            :                  * and ensures proper behavior with regard to modifications. */</a>
<a name="1376"><span class="lineNum">    1376 </span><span class="lineCov">       3018 :                 zend_hash_move_forward_ex(target_hash, &amp;pos);</span></a>
<a name="1377"><span class="lineNum">    1377 </span>            : </a>
<a name="1378"><span class="lineNum">    1378 </span>            :                 /* Back up hash position, as it may change */</a>
<a name="1379"><span class="lineNum">    1379 </span><span class="lineCov">       3018 :                 EG(ht_iterators)[ht_iter].pos = pos;</span></a>
<a name="1380"><span class="lineNum">    1380 </span>            : </a>
<a name="1381"><span class="lineNum">    1381 </span><span class="lineCov">       4692 :                 if (recursive &amp;&amp; Z_TYPE_P(Z_REFVAL_P(zv)) == IS_ARRAY) {</span></a>
<a name="1382"><span class="lineNum">    1382 </span>            :                         HashTable *thash;</a>
<a name="1383"><span class="lineNum">    1383 </span>            :                         zval ref;</a>
<a name="1384"><span class="lineNum">    1384 </span><span class="lineCov">        339 :                         ZVAL_COPY_VALUE(&amp;ref, zv);</span></a>
<a name="1385"><span class="lineNum">    1385 </span>            : </a>
<a name="1386"><span class="lineNum">    1386 </span><span class="lineCov">        339 :                         ZVAL_DEREF(zv);</span></a>
<a name="1387"><span class="lineNum">    1387 </span><span class="lineCov">        678 :                         SEPARATE_ARRAY(zv);</span></a>
<a name="1388"><span class="lineNum">    1388 </span><span class="lineCov">        339 :                         thash = Z_ARRVAL_P(zv);</span></a>
<a name="1389"><span class="lineNum">    1389 </span><span class="lineCov">        678 :                         if (GC_IS_RECURSIVE(thash)) {</span></a>
<a name="1390"><span class="lineNum">    1390 </span><span class="lineNoCov">          0 :                                 zend_throw_error(NULL, &quot;Recursion detected&quot;);</span></a>
<a name="1391"><span class="lineNum">    1391 </span><span class="lineNoCov">          0 :                                 result = FAILURE;</span></a>
<a name="1392"><span class="lineNum">    1392 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="1393"><span class="lineNum">    1393 </span>            :                         }</a>
<a name="1394"><span class="lineNum">    1394 </span>            : </a>
<a name="1395"><span class="lineNum">    1395 </span>            :                         Z_ADDREF(ref);</a>
<a name="1396"><span class="lineNum">    1396 </span><span class="lineCov">        339 :                         GC_PROTECT_RECURSION(thash);</span></a>
<a name="1397"><span class="lineNum">    1397 </span><span class="lineCov">        339 :                         result = php_array_walk(context, zv, userdata, recursive);</span></a>
<a name="1398"><span class="lineNum">    1398 </span><span class="lineCov">        678 :                         if (Z_TYPE_P(Z_REFVAL(ref)) == IS_ARRAY &amp;&amp; thash == Z_ARRVAL_P(Z_REFVAL(ref))) {</span></a>
<a name="1399"><span class="lineNum">    1399 </span>            :                                 /* If the hashtable changed in the meantime, we'll &quot;leak&quot; this apply count</a>
<a name="1400"><span class="lineNum">    1400 </span>            :                                  * increment -- our reference to thash is no longer valid. */</a>
<a name="1401"><span class="lineNum">    1401 </span><span class="lineCov">        339 :                                 GC_UNPROTECT_RECURSION(thash);</span></a>
<a name="1402"><span class="lineNum">    1402 </span>            :                         }</a>
<a name="1403"><span class="lineNum">    1403 </span><span class="lineCov">        339 :                         zval_ptr_dtor(&amp;ref);</span></a>
<a name="1404"><span class="lineNum">    1404 </span>            :                 } else {</a>
<a name="1405"><span class="lineNum">    1405 </span><span class="lineCov">       2679 :                         ZVAL_COPY(&amp;args[0], zv);</span></a>
<a name="1406"><span class="lineNum">    1406 </span>            : </a>
<a name="1407"><span class="lineNum">    1407 </span>            :                         /* Call the userland function */</a>
<a name="1408"><span class="lineNum">    1408 </span><span class="lineCov">       2679 :                         result = zend_call_function(&amp;fci, &amp;context-&gt;fci_cache);</span></a>
<a name="1409"><span class="lineNum">    1409 </span><span class="lineCov">       2679 :                         if (result == SUCCESS) {</span></a>
<a name="1410"><span class="lineNum">    1410 </span><span class="lineCov">       2679 :                                 zval_ptr_dtor(&amp;retval);</span></a>
<a name="1411"><span class="lineNum">    1411 </span>            :                         }</a>
<a name="1412"><span class="lineNum">    1412 </span>            : </a>
<a name="1413"><span class="lineNum">    1413 </span><span class="lineCov">       2679 :                         zval_ptr_dtor(&amp;args[0]);</span></a>
<a name="1414"><span class="lineNum">    1414 </span>            :                 }</a>
<a name="1415"><span class="lineNum">    1415 </span>            : </a>
<a name="1416"><span class="lineNum">    1416 </span><span class="lineCov">       3018 :                 if (Z_TYPE(args[1]) != IS_UNDEF) {</span></a>
<a name="1417"><span class="lineNum">    1417 </span><span class="lineCov">       3018 :                         zval_ptr_dtor(&amp;args[1]);</span></a>
<a name="1418"><span class="lineNum">    1418 </span><span class="lineCov">       3018 :                         ZVAL_UNDEF(&amp;args[1]);</span></a>
<a name="1419"><span class="lineNum">    1419 </span>            :                 }</a>
<a name="1420"><span class="lineNum">    1420 </span>            : </a>
<a name="1421"><span class="lineNum">    1421 </span><span class="lineCov">       3018 :                 if (result == FAILURE) {</span></a>
<a name="1422"><span class="lineNum">    1422 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="1423"><span class="lineNum">    1423 </span>            :                 }</a>
<a name="1424"><span class="lineNum">    1424 </span>            : </a>
<a name="1425"><span class="lineNum">    1425 </span>            :                 /* Reload array and position -- both may have changed */</a>
<a name="1426"><span class="lineNum">    1426 </span><span class="lineCov">       3018 :                 if (Z_TYPE_P(array) == IS_ARRAY) {</span></a>
<a name="1427"><span class="lineNum">    1427 </span><span class="lineCov">       2964 :                         pos = zend_hash_iterator_pos_ex(ht_iter, array);</span></a>
<a name="1428"><span class="lineNum">    1428 </span><span class="lineCov">       2964 :                         target_hash = Z_ARRVAL_P(array);</span></a>
<a name="1429"><span class="lineNum">    1429 </span><span class="lineCov">         54 :                 } else if (Z_TYPE_P(array) == IS_OBJECT) {</span></a>
<a name="1430"><span class="lineNum">    1430 </span><span class="lineCov">         51 :                         target_hash = Z_OBJPROP_P(array);</span></a>
<a name="1431"><span class="lineNum">    1431 </span><span class="lineCov">         51 :                         pos = zend_hash_iterator_pos(ht_iter, target_hash);</span></a>
<a name="1432"><span class="lineNum">    1432 </span>            :                 } else {</a>
<a name="1433"><span class="lineNum">    1433 </span><span class="lineCov">          3 :                         zend_type_error(&quot;Iterated value is no longer an array or object&quot;);</span></a>
<a name="1434"><span class="lineNum">    1434 </span><span class="lineCov">          3 :                         result = FAILURE;</span></a>
<a name="1435"><span class="lineNum">    1435 </span><span class="lineCov">          3 :                         break;</span></a>
<a name="1436"><span class="lineNum">    1436 </span>            :                 }</a>
<a name="1437"><span class="lineNum">    1437 </span><span class="lineCov">       3015 :         } while (!EG(exception));</span></a>
<a name="1438"><span class="lineNum">    1438 </span>            : </a>
<a name="1439"><span class="lineNum">    1439 </span><span class="lineCov">        816 :         if (userdata) {</span></a>
<a name="1440"><span class="lineNum">    1440 </span><span class="lineCov">        450 :                 zval_ptr_dtor(&amp;args[2]);</span></a>
<a name="1441"><span class="lineNum">    1441 </span>            :         }</a>
<a name="1442"><span class="lineNum">    1442 </span><span class="lineCov">        816 :         zend_hash_iterator_del(ht_iter);</span></a>
<a name="1443"><span class="lineNum">    1443 </span><span class="lineCov">        816 :         return result;</span></a>
<a name="1444"><span class="lineNum">    1444 </span>            : }</a>
<a name="1445"><span class="lineNum">    1445 </span>            : </a>
<a name="1446"><span class="lineNum">    1446 </span>            : /* {{{ Apply a user function to every member of an array */</a>
<a name="1447"><span class="lineNum">    1447 </span><span class="lineCov">        333 : PHP_FUNCTION(array_walk)</span></a>
<a name="1448"><span class="lineNum">    1448 </span>            : {</a>
<a name="1449"><span class="lineNum">    1449 </span>            :         zval *array;</a>
<a name="1450"><span class="lineNum">    1450 </span><span class="lineCov">        333 :         zval *userdata = NULL;</span></a>
<a name="1451"><span class="lineNum">    1451 </span>            :         php_array_walk_context context;</a>
<a name="1452"><span class="lineNum">    1452 </span>            : </a>
<a name="1453"><span class="lineNum">    1453 </span><span class="lineCov">        333 :         ZEND_PARSE_PARAMETERS_START(2, 3)</span></a>
<a name="1454"><span class="lineNum">    1454 </span><span class="lineCov">       1929 :                 Z_PARAM_ARRAY_OR_OBJECT_EX(array, 0, 1)</span></a>
<a name="1455"><span class="lineNum">    1455 </span><span class="lineCov">        642 :                 Z_PARAM_FUNC(context.fci, context.fci_cache)</span></a>
<a name="1456"><span class="lineNum">    1456 </span><span class="lineCov">        315 :                 Z_PARAM_OPTIONAL</span></a>
<a name="1457"><span class="lineNum">    1457 </span><span class="lineCov">        315 :                 Z_PARAM_ZVAL(userdata)</span></a>
<a name="1458"><span class="lineNum">    1458 </span><span class="lineCov">        333 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="1459"><span class="lineNum">    1459 </span>            : </a>
<a name="1460"><span class="lineNum">    1460 </span><span class="lineCov">        315 :         php_array_walk(&amp;context, array, userdata, 0);</span></a>
<a name="1461"><span class="lineNum">    1461 </span><span class="lineCov">        315 :         RETURN_TRUE;</span></a>
<a name="1462"><span class="lineNum">    1462 </span>            : }</a>
<a name="1463"><span class="lineNum">    1463 </span>            : /* }}} */</a>
<a name="1464"><span class="lineNum">    1464 </span>            : </a>
<a name="1465"><span class="lineNum">    1465 </span>            : /* {{{ Apply a user function recursively to every member of an array */</a>
<a name="1466"><span class="lineNum">    1466 </span><span class="lineCov">        177 : PHP_FUNCTION(array_walk_recursive)</span></a>
<a name="1467"><span class="lineNum">    1467 </span>            : {</a>
<a name="1468"><span class="lineNum">    1468 </span>            :         zval *array;</a>
<a name="1469"><span class="lineNum">    1469 </span><span class="lineCov">        177 :         zval *userdata = NULL;</span></a>
<a name="1470"><span class="lineNum">    1470 </span>            :         php_array_walk_context context;</a>
<a name="1471"><span class="lineNum">    1471 </span>            : </a>
<a name="1472"><span class="lineNum">    1472 </span><span class="lineCov">        177 :         ZEND_PARSE_PARAMETERS_START(2, 3)</span></a>
<a name="1473"><span class="lineNum">    1473 </span><span class="lineCov">        996 :                 Z_PARAM_ARRAY_OR_OBJECT_EX(array, 0, 1)</span></a>
<a name="1474"><span class="lineNum">    1474 </span><span class="lineCov">        330 :                 Z_PARAM_FUNC(context.fci, context.fci_cache)</span></a>
<a name="1475"><span class="lineNum">    1475 </span><span class="lineCov">        162 :                 Z_PARAM_OPTIONAL</span></a>
<a name="1476"><span class="lineNum">    1476 </span><span class="lineCov">        162 :                 Z_PARAM_ZVAL(userdata)</span></a>
<a name="1477"><span class="lineNum">    1477 </span><span class="lineCov">        177 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="1478"><span class="lineNum">    1478 </span>            : </a>
<a name="1479"><span class="lineNum">    1479 </span><span class="lineCov">        162 :         php_array_walk(&amp;context, array, userdata, 1);</span></a>
<a name="1480"><span class="lineNum">    1480 </span><span class="lineCov">        162 :         RETURN_TRUE;</span></a>
<a name="1481"><span class="lineNum">    1481 </span>            : }</a>
<a name="1482"><span class="lineNum">    1482 </span>            : /* }}} */</a>
<a name="1483"><span class="lineNum">    1483 </span>            : </a>
<a name="1484"><span class="lineNum">    1484 </span>            : /* void php_search_array(INTERNAL_FUNCTION_PARAMETERS, int behavior)</a>
<a name="1485"><span class="lineNum">    1485 </span>            :  * 0 = return boolean</a>
<a name="1486"><span class="lineNum">    1486 </span>            :  * 1 = return key</a>
<a name="1487"><span class="lineNum">    1487 </span>            :  */</a>
<a name="1488"><span class="lineNum">    1488 </span><span class="lineCov">       9004 : static inline void php_search_array(INTERNAL_FUNCTION_PARAMETERS, int behavior) /* {{{ */</span></a>
<a name="1489"><span class="lineNum">    1489 </span>            : {</a>
<a name="1490"><span class="lineNum">    1490 </span>            :         zval *value,                            /* value to check for */</a>
<a name="1491"><span class="lineNum">    1491 </span>            :                  *array,                                /* array to check in */</a>
<a name="1492"><span class="lineNum">    1492 </span>            :                  *entry;                                /* pointer to array entry */</a>
<a name="1493"><span class="lineNum">    1493 </span>            :         zend_ulong num_idx;</a>
<a name="1494"><span class="lineNum">    1494 </span>            :         zend_string *str_idx;</a>
<a name="1495"><span class="lineNum">    1495 </span><span class="lineCov">       9004 :         bool strict = 0;                /* strict comparison or not */</span></a>
<a name="1496"><span class="lineNum">    1496 </span>            : </a>
<a name="1497"><span class="lineNum">    1497 </span><span class="lineCov">       9004 :         ZEND_PARSE_PARAMETERS_START(2, 3)</span></a>
<a name="1498"><span class="lineNum">    1498 </span><span class="lineCov">       8920 :                 Z_PARAM_ZVAL(value)</span></a>
<a name="1499"><span class="lineNum">    1499 </span><span class="lineCov">      17840 :                 Z_PARAM_ARRAY(array)</span></a>
<a name="1500"><span class="lineNum">    1500 </span><span class="lineCov">       8884 :                 Z_PARAM_OPTIONAL</span></a>
<a name="1501"><span class="lineNum">    1501 </span><span class="lineCov">      10807 :                 Z_PARAM_BOOL(strict)</span></a>
<a name="1502"><span class="lineNum">    1502 </span><span class="lineCov">       9004 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="1503"><span class="lineNum">    1503 </span>            : </a>
<a name="1504"><span class="lineNum">    1504 </span><span class="lineCov">       8884 :         if (strict) {</span></a>
<a name="1505"><span class="lineNum">    1505 </span><span class="lineCov">       1968 :                 if (Z_TYPE_P(value) == IS_LONG) {</span></a>
<a name="1506"><span class="lineNum">    1506 </span><span class="lineCov">       1533 :                         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(array), num_idx, str_idx, entry) {</span></a>
<a name="1507"><span class="lineNum">    1507 </span><span class="lineCov">        696 :                                 ZVAL_DEREF(entry);</span></a>
<a name="1508"><span class="lineNum">    1508 </span><span class="lineCov">        696 :                                 if (Z_TYPE_P(entry) == IS_LONG &amp;&amp; Z_LVAL_P(entry) == Z_LVAL_P(value)) {</span></a>
<a name="1509"><span class="lineNum">    1509 </span><span class="lineCov">         36 :                                         if (behavior == 0) {</span></a>
<a name="1510"><span class="lineNum">    1510 </span><span class="lineCov">         18 :                                                 RETURN_TRUE;</span></a>
<a name="1511"><span class="lineNum">    1511 </span>            :                                         } else {</a>
<a name="1512"><span class="lineNum">    1512 </span><span class="lineCov">         18 :                                                 if (str_idx) {</span></a>
<a name="1513"><span class="lineNum">    1513 </span><span class="lineCov">          6 :                                                         RETURN_STR_COPY(str_idx);</span></a>
<a name="1514"><span class="lineNum">    1514 </span>            :                                                 } else {</a>
<a name="1515"><span class="lineNum">    1515 </span><span class="lineCov">         15 :                                                         RETURN_LONG(num_idx);</span></a>
<a name="1516"><span class="lineNum">    1516 </span>            :                                                 }</a>
<a name="1517"><span class="lineNum">    1517 </span>            :                                         }</a>
<a name="1518"><span class="lineNum">    1518 </span>            :                                 }</a>
<a name="1519"><span class="lineNum">    1519 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="1520"><span class="lineNum">    1520 </span>            :                 } else {</a>
<a name="1521"><span class="lineNum">    1521 </span><span class="lineCov">      20250 :                         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(array), num_idx, str_idx, entry) {</span></a>
<a name="1522"><span class="lineNum">    1522 </span><span class="lineCov">       9762 :                                 ZVAL_DEREF(entry);</span></a>
<a name="1523"><span class="lineNum">    1523 </span><span class="lineCov">      19524 :                                 if (fast_is_identical_function(value, entry)) {</span></a>
<a name="1524"><span class="lineNum">    1524 </span><span class="lineCov">         81 :                                         if (behavior == 0) {</span></a>
<a name="1525"><span class="lineNum">    1525 </span><span class="lineCov">         42 :                                                 RETURN_TRUE;</span></a>
<a name="1526"><span class="lineNum">    1526 </span>            :                                         } else {</a>
<a name="1527"><span class="lineNum">    1527 </span><span class="lineCov">         39 :                                                 if (str_idx) {</span></a>
<a name="1528"><span class="lineNum">    1528 </span><span class="lineCov">         24 :                                                         RETURN_STR_COPY(str_idx);</span></a>
<a name="1529"><span class="lineNum">    1529 </span>            :                                                 } else {</a>
<a name="1530"><span class="lineNum">    1530 </span><span class="lineCov">         27 :                                                         RETURN_LONG(num_idx);</span></a>
<a name="1531"><span class="lineNum">    1531 </span>            :                                                 }</a>
<a name="1532"><span class="lineNum">    1532 </span>            :                                         }</a>
<a name="1533"><span class="lineNum">    1533 </span>            :                                 }</a>
<a name="1534"><span class="lineNum">    1534 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="1535"><span class="lineNum">    1535 </span>            :                 }</a>
<a name="1536"><span class="lineNum">    1536 </span>            :         } else {</a>
<a name="1537"><span class="lineNum">    1537 </span><span class="lineCov">      15800 :                 if (Z_TYPE_P(value) == IS_LONG) {</span></a>
<a name="1538"><span class="lineNum">    1538 </span><span class="lineCov">       2523 :                         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(array), num_idx, str_idx, entry) {</span></a>
<a name="1539"><span class="lineNum">    1539 </span><span class="lineCov">       2316 :                                 if (fast_equal_check_long(value, entry)) {</span></a>
<a name="1540"><span class="lineNum">    1540 </span><span class="lineCov">        150 :                                         if (behavior == 0) {</span></a>
<a name="1541"><span class="lineNum">    1541 </span><span class="lineCov">         72 :                                                 RETURN_TRUE;</span></a>
<a name="1542"><span class="lineNum">    1542 </span>            :                                         } else {</a>
<a name="1543"><span class="lineNum">    1543 </span><span class="lineCov">         78 :                                                 if (str_idx) {</span></a>
<a name="1544"><span class="lineNum">    1544 </span><span class="lineCov">         39 :                                                         RETURN_STR_COPY(str_idx);</span></a>
<a name="1545"><span class="lineNum">    1545 </span>            :                                                 } else {</a>
<a name="1546"><span class="lineNum">    1546 </span><span class="lineCov">         60 :                                                         RETURN_LONG(num_idx);</span></a>
<a name="1547"><span class="lineNum">    1547 </span>            :                                                 }</a>
<a name="1548"><span class="lineNum">    1548 </span>            :                                         }</a>
<a name="1549"><span class="lineNum">    1549 </span>            :                                 }</a>
<a name="1550"><span class="lineNum">    1550 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="1551"><span class="lineNum">    1551 </span><span class="lineCov">      15086 :                 } else if (Z_TYPE_P(value) == IS_STRING) {</span></a>
<a name="1552"><span class="lineNum">    1552 </span><span class="lineCov">    1655870 :                         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(array), num_idx, str_idx, entry) {</span></a>
<a name="1553"><span class="lineNum">    1553 </span><span class="lineCov">    1653150 :                                 if (fast_equal_check_string(value, entry)) {</span></a>
<a name="1554"><span class="lineNum">    1554 </span><span class="lineCov">       4027 :                                         if (behavior == 0) {</span></a>
<a name="1555"><span class="lineNum">    1555 </span><span class="lineCov">       3849 :                                                 RETURN_TRUE;</span></a>
<a name="1556"><span class="lineNum">    1556 </span>            :                                         } else {</a>
<a name="1557"><span class="lineNum">    1557 </span><span class="lineCov">        178 :                                                 if (str_idx) {</span></a>
<a name="1558"><span class="lineNum">    1558 </span><span class="lineCov">         66 :                                                         RETURN_STR_COPY(str_idx);</span></a>
<a name="1559"><span class="lineNum">    1559 </span>            :                                                 } else {</a>
<a name="1560"><span class="lineNum">    1560 </span><span class="lineCov">        151 :                                                         RETURN_LONG(num_idx);</span></a>
<a name="1561"><span class="lineNum">    1561 </span>            :                                                 }</a>
<a name="1562"><span class="lineNum">    1562 </span>            :                                         }</a>
<a name="1563"><span class="lineNum">    1563 </span>            :                                 }</a>
<a name="1564"><span class="lineNum">    1564 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="1565"><span class="lineNum">    1565 </span>            :                 } else {</a>
<a name="1566"><span class="lineNum">    1566 </span><span class="lineCov">      79702 :                         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(array), num_idx, str_idx, entry) {</span></a>
<a name="1567"><span class="lineNum">    1567 </span><span class="lineCov">      79266 :                                 if (fast_equal_check_function(value, entry)) {</span></a>
<a name="1568"><span class="lineNum">    1568 </span><span class="lineCov">        393 :                                         if (behavior == 0) {</span></a>
<a name="1569"><span class="lineNum">    1569 </span><span class="lineCov">        222 :                                                 RETURN_TRUE;</span></a>
<a name="1570"><span class="lineNum">    1570 </span>            :                                         } else {</a>
<a name="1571"><span class="lineNum">    1571 </span><span class="lineCov">        171 :                                                 if (str_idx) {</span></a>
<a name="1572"><span class="lineNum">    1572 </span><span class="lineCov">         72 :                                                         RETURN_STR_COPY(str_idx);</span></a>
<a name="1573"><span class="lineNum">    1573 </span>            :                                                 } else {</a>
<a name="1574"><span class="lineNum">    1574 </span><span class="lineCov">        135 :                                                         RETURN_LONG(num_idx);</span></a>
<a name="1575"><span class="lineNum">    1575 </span>            :                                                 }</a>
<a name="1576"><span class="lineNum">    1576 </span>            :                                         }</a>
<a name="1577"><span class="lineNum">    1577 </span>            :                                 }</a>
<a name="1578"><span class="lineNum">    1578 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="1579"><span class="lineNum">    1579 </span>            :                 }</a>
<a name="1580"><span class="lineNum">    1580 </span>            :         }</a>
<a name="1581"><span class="lineNum">    1581 </span>            : </a>
<a name="1582"><span class="lineNum">    1582 </span><span class="lineCov">       4197 :         RETURN_FALSE;</span></a>
<a name="1583"><span class="lineNum">    1583 </span>            : }</a>
<a name="1584"><span class="lineNum">    1584 </span>            : /* }}} */</a>
<a name="1585"><span class="lineNum">    1585 </span>            : </a>
<a name="1586"><span class="lineNum">    1586 </span>            : /* {{{ Checks if the given value exists in the array */</a>
<a name="1587"><span class="lineNum">    1587 </span><span class="lineCov">       7392 : PHP_FUNCTION(in_array)</span></a>
<a name="1588"><span class="lineNum">    1588 </span>            : {</a>
<a name="1589"><span class="lineNum">    1589 </span><span class="lineCov">       7392 :         php_search_array(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);</span></a>
<a name="1590"><span class="lineNum">    1590 </span><span class="lineCov">       7392 : }</span></a>
<a name="1591"><span class="lineNum">    1591 </span>            : /* }}} */</a>
<a name="1592"><span class="lineNum">    1592 </span>            : </a>
<a name="1593"><span class="lineNum">    1593 </span>            : /* {{{ Searches the array for a given value and returns the corresponding key if successful */</a>
<a name="1594"><span class="lineNum">    1594 </span><span class="lineCov">       1612 : PHP_FUNCTION(array_search)</span></a>
<a name="1595"><span class="lineNum">    1595 </span>            : {</a>
<a name="1596"><span class="lineNum">    1596 </span><span class="lineCov">       1612 :         php_search_array(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);</span></a>
<a name="1597"><span class="lineNum">    1597 </span><span class="lineCov">       1612 : }</span></a>
<a name="1598"><span class="lineNum">    1598 </span>            : /* }}} */</a>
<a name="1599"><span class="lineNum">    1599 </span>            : </a>
<a name="1600"><span class="lineNum">    1600 </span>            : static zend_always_inline int php_valid_var_name(const char *var_name, size_t var_name_len) /* {{{ */</a>
<a name="1601"><span class="lineNum">    1601 </span>            : {</a>
<a name="1602"><span class="lineNum">    1602 </span>            : #if 1</a>
<a name="1603"><span class="lineNum">    1603 </span>            :         /* first 256 bits for first character, and second 256 bits for the next */</a>
<a name="1604"><span class="lineNum">    1604 </span>            :         static const uint32_t charset[8] = {</a>
<a name="1605"><span class="lineNum">    1605 </span>            :              /*  31      0   63     32   95     64   127    96 */</a>
<a name="1606"><span class="lineNum">    1606 </span>            :                         0x00000000, 0x00000000, 0x87fffffe, 0x07fffffe,</a>
<a name="1607"><span class="lineNum">    1607 </span>            :                         0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff};</a>
<a name="1608"><span class="lineNum">    1608 </span>            :         static const uint32_t charset2[8] = {</a>
<a name="1609"><span class="lineNum">    1609 </span>            :              /*  31      0   63     32   95     64   127    96 */</a>
<a name="1610"><span class="lineNum">    1610 </span>            :                         0x00000000, 0x03ff0000, 0x87fffffe, 0x07fffffe,</a>
<a name="1611"><span class="lineNum">    1611 </span>            :                         0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff};</a>
<a name="1612"><span class="lineNum">    1612 </span>            : #endif</a>
<a name="1613"><span class="lineNum">    1613 </span>            :         size_t i;</a>
<a name="1614"><span class="lineNum">    1614 </span>            :         uint32_t ch;</a>
<a name="1615"><span class="lineNum">    1615 </span>            : </a>
<a name="1616"><span class="lineNum">    1616 </span><span class="lineCov">       1569 :         if (UNEXPECTED(!var_name_len)) {</span></a>
<a name="1617"><span class="lineNum">    1617 </span><span class="lineCov">         12 :                 return 0;</span></a>
<a name="1618"><span class="lineNum">    1618 </span>            :         }</a>
<a name="1619"><span class="lineNum">    1619 </span>            : </a>
<a name="1620"><span class="lineNum">    1620 </span>            :         /* These are allowed as first char: [a-zA-Z_\x7f-\xff] */</a>
<a name="1621"><span class="lineNum">    1621 </span><span class="lineCov">       1557 :         ch = (uint32_t)((unsigned char *)var_name)[0];</span></a>
<a name="1622"><span class="lineNum">    1622 </span>            : #if 1</a>
<a name="1623"><span class="lineNum">    1623 </span><span class="lineCov">       1557 :         if (UNEXPECTED(!ZEND_BIT_TEST(charset, ch))) {</span></a>
<a name="1624"><span class="lineNum">    1624 </span>            : #else</a>
<a name="1625"><span class="lineNum">    1625 </span>            :         if (var_name[0] != '_' &amp;&amp;</a>
<a name="1626"><span class="lineNum">    1626 </span>            :                 (ch &lt; 65  /* A    */ || /* Z    */ ch &gt; 90)  &amp;&amp;</a>
<a name="1627"><span class="lineNum">    1627 </span>            :                 (ch &lt; 97  /* a    */ || /* z    */ ch &gt; 122) &amp;&amp;</a>
<a name="1628"><span class="lineNum">    1628 </span>            :                 (ch &lt; 127 /* 0x7f */ || /* 0xff */ ch &gt; 255)</a>
<a name="1629"><span class="lineNum">    1629 </span>            :         ) {</a>
<a name="1630"><span class="lineNum">    1630 </span>            : #endif</a>
<a name="1631"><span class="lineNum">    1631 </span><span class="lineCov">         48 :                 return 0;</span></a>
<a name="1632"><span class="lineNum">    1632 </span>            :         }</a>
<a name="1633"><span class="lineNum">    1633 </span>            : </a>
<a name="1634"><span class="lineNum">    1634 </span>            :         /* And these as the rest: [a-zA-Z0-9_\x7f-\xff] */</a>
<a name="1635"><span class="lineNum">    1635 </span><span class="lineCov">       1509 :         if (var_name_len &gt; 1) {</span></a>
<a name="1636"><span class="lineNum">    1636 </span><span class="lineCov">       1305 :                 i = 1;</span></a>
<a name="1637"><span class="lineNum">    1637 </span>            :                 do {</a>
<a name="1638"><span class="lineNum">    1638 </span><span class="lineCov">       4248 :                         ch = (uint32_t)((unsigned char *)var_name)[i];</span></a>
<a name="1639"><span class="lineNum">    1639 </span>            : #if 1</a>
<a name="1640"><span class="lineNum">    1640 </span><span class="lineCov">       4248 :                         if (UNEXPECTED(!ZEND_BIT_TEST(charset2, ch))) {</span></a>
<a name="1641"><span class="lineNum">    1641 </span>            : #else</a>
<a name="1642"><span class="lineNum">    1642 </span>            :                         if (var_name[i] != '_' &amp;&amp;</a>
<a name="1643"><span class="lineNum">    1643 </span>            :                                 (ch &lt; 48  /* 0    */ || /* 9    */ ch &gt; 57)  &amp;&amp;</a>
<a name="1644"><span class="lineNum">    1644 </span>            :                                 (ch &lt; 65  /* A    */ || /* Z    */ ch &gt; 90)  &amp;&amp;</a>
<a name="1645"><span class="lineNum">    1645 </span>            :                                 (ch &lt; 97  /* a    */ || /* z    */ ch &gt; 122) &amp;&amp;</a>
<a name="1646"><span class="lineNum">    1646 </span>            :                                 (ch &lt; 127 /* 0x7f */ || /* 0xff */ ch &gt; 255)</a>
<a name="1647"><span class="lineNum">    1647 </span>            :                         ) {</a>
<a name="1648"><span class="lineNum">    1648 </span>            : #endif</a>
<a name="1649"><span class="lineNum">    1649 </span><span class="lineCov">         18 :                                 return 0;</span></a>
<a name="1650"><span class="lineNum">    1650 </span>            :                         }</a>
<a name="1651"><span class="lineNum">    1651 </span><span class="lineCov">       4230 :                 } while (++i &lt; var_name_len);</span></a>
<a name="1652"><span class="lineNum">    1652 </span>            :         }</a>
<a name="1653"><span class="lineNum">    1653 </span><span class="lineCov">       1491 :         return 1;</span></a>
<a name="1654"><span class="lineNum">    1654 </span>            : }</a>
<a name="1655"><span class="lineNum">    1655 </span>            : /* }}} */</a>
<a name="1656"><span class="lineNum">    1656 </span>            : </a>
<a name="1657"><span class="lineNum">    1657 </span><span class="lineCov">        783 : PHPAPI int php_prefix_varname(zval *result, zend_string *prefix, const char *var_name, size_t var_name_len, bool add_underscore) /* {{{ */</span></a>
<a name="1658"><span class="lineNum">    1658 </span>            : {</a>
<a name="1659"><span class="lineNum">    1659 </span><span class="lineCov">        783 :         ZVAL_NEW_STR(result, zend_string_alloc(ZSTR_LEN(prefix) + (add_underscore ? 1 : 0) + var_name_len, 0));</span></a>
<a name="1660"><span class="lineNum">    1660 </span><span class="lineCov">        783 :         memcpy(Z_STRVAL_P(result), ZSTR_VAL(prefix), ZSTR_LEN(prefix));</span></a>
<a name="1661"><span class="lineNum">    1661 </span>            : </a>
<a name="1662"><span class="lineNum">    1662 </span><span class="lineCov">        783 :         if (add_underscore) {</span></a>
<a name="1663"><span class="lineNum">    1663 </span><span class="lineCov">        783 :                 Z_STRVAL_P(result)[ZSTR_LEN(prefix)] = '_';</span></a>
<a name="1664"><span class="lineNum">    1664 </span>            :         }</a>
<a name="1665"><span class="lineNum">    1665 </span>            : </a>
<a name="1666"><span class="lineNum">    1666 </span><span class="lineCov">        783 :         memcpy(Z_STRVAL_P(result) + ZSTR_LEN(prefix) + (add_underscore ? 1 : 0), var_name, var_name_len + 1);</span></a>
<a name="1667"><span class="lineNum">    1667 </span>            : </a>
<a name="1668"><span class="lineNum">    1668 </span><span class="lineCov">        783 :         return SUCCESS;</span></a>
<a name="1669"><span class="lineNum">    1669 </span>            : }</a>
<a name="1670"><span class="lineNum">    1670 </span>            : /* }}} */</a>
<a name="1671"><span class="lineNum">    1671 </span>            : </a>
<a name="1672"><span class="lineNum">    1672 </span><span class="lineCov">          9 : static zend_long php_extract_ref_if_exists(zend_array *arr, zend_array *symbol_table) /* {{{ */</span></a>
<a name="1673"><span class="lineNum">    1673 </span>            : {</a>
<a name="1674"><span class="lineNum">    1674 </span><span class="lineCov">          9 :         zend_long count = 0;</span></a>
<a name="1675"><span class="lineNum">    1675 </span>            :         zend_string *var_name;</a>
<a name="1676"><span class="lineNum">    1676 </span>            :         zval *entry, *orig_var;</a>
<a name="1677"><span class="lineNum">    1677 </span>            : </a>
<a name="1678"><span class="lineNum">    1678 </span><span class="lineCov">          9 :         if (HT_IS_PACKED(arr)) {</span></a>
<a name="1679"><span class="lineNum">    1679 </span><span class="lineNoCov">          0 :                 return 0;</span></a>
<a name="1680"><span class="lineNum">    1680 </span>            :         }</a>
<a name="1681"><span class="lineNum">    1681 </span><span class="lineCov">         39 :         ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(arr, var_name, entry) {</span></a>
<a name="1682"><span class="lineNum">    1682 </span><span class="lineCov">         15 :                 if (!var_name) {</span></a>
<a name="1683"><span class="lineNum">    1683 </span><span class="lineNoCov">          0 :                         continue;</span></a>
<a name="1684"><span class="lineNum">    1684 </span>            :                 }</a>
<a name="1685"><span class="lineNum">    1685 </span><span class="lineCov">         15 :                 orig_var = zend_hash_find_known_hash(symbol_table, var_name);</span></a>
<a name="1686"><span class="lineNum">    1686 </span><span class="lineCov">         15 :                 if (orig_var) {</span></a>
<a name="1687"><span class="lineNum">    1687 </span><span class="lineCov">          6 :                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="1688"><span class="lineNum">    1688 </span><span class="lineCov">          6 :                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="1689"><span class="lineNum">    1689 </span><span class="lineCov">          6 :                                 if (Z_TYPE_P(orig_var) == IS_UNDEF) {</span></a>
<a name="1690"><span class="lineNum">    1690 </span><span class="lineNoCov">          0 :                                         continue;</span></a>
<a name="1691"><span class="lineNum">    1691 </span>            :                                 }</a>
<a name="1692"><span class="lineNum">    1692 </span>            :                         }</a>
<a name="1693"><span class="lineNum">    1693 </span><span class="lineCov">         12 :                         if (!php_valid_var_name(ZSTR_VAL(var_name), ZSTR_LEN(var_name))) {</span></a>
<a name="1694"><span class="lineNum">    1694 </span><span class="lineNoCov">          0 :                                 continue;</span></a>
<a name="1695"><span class="lineNum">    1695 </span>            :                         }</a>
<a name="1696"><span class="lineNum">    1696 </span><span class="lineCov">          6 :                         if (zend_string_equals_literal(var_name, &quot;GLOBALS&quot;)) {</span></a>
<a name="1697"><span class="lineNum">    1697 </span><span class="lineNoCov">          0 :                                 continue;</span></a>
<a name="1698"><span class="lineNum">    1698 </span>            :                         }</a>
<a name="1699"><span class="lineNum">    1699 </span><span class="lineCov">          6 :                         if (zend_string_equals_literal(var_name, &quot;this&quot;)) {</span></a>
<a name="1700"><span class="lineNum">    1700 </span><span class="lineNoCov">          0 :                                 zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="1701"><span class="lineNum">    1701 </span><span class="lineNoCov">          0 :                                 return -1;</span></a>
<a name="1702"><span class="lineNum">    1702 </span>            :                         }</a>
<a name="1703"><span class="lineNum">    1703 </span><span class="lineCov">          6 :                         if (Z_ISREF_P(entry)) {</span></a>
<a name="1704"><span class="lineNum">    1704 </span>            :                                 Z_ADDREF_P(entry);</a>
<a name="1705"><span class="lineNum">    1705 </span>            :                         } else {</a>
<a name="1706"><span class="lineNum">    1706 </span><span class="lineCov">         12 :                                 ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="1707"><span class="lineNum">    1707 </span>            :                         }</a>
<a name="1708"><span class="lineNum">    1708 </span><span class="lineCov">          6 :                         zval_ptr_dtor(orig_var);</span></a>
<a name="1709"><span class="lineNum">    1709 </span><span class="lineCov">          6 :                         ZVAL_REF(orig_var, Z_REF_P(entry));</span></a>
<a name="1710"><span class="lineNum">    1710 </span><span class="lineCov">          6 :                         count++;</span></a>
<a name="1711"><span class="lineNum">    1711 </span>            :                 }</a>
<a name="1712"><span class="lineNum">    1712 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="1713"><span class="lineNum">    1713 </span>            : </a>
<a name="1714"><span class="lineNum">    1714 </span><span class="lineCov">          9 :         return count;</span></a>
<a name="1715"><span class="lineNum">    1715 </span>            : }</a>
<a name="1716"><span class="lineNum">    1716 </span>            : /* }}} */</a>
<a name="1717"><span class="lineNum">    1717 </span>            : </a>
<a name="1718"><span class="lineNum">    1718 </span><span class="lineCov">         42 : static zend_long php_extract_if_exists(zend_array *arr, zend_array *symbol_table) /* {{{ */</span></a>
<a name="1719"><span class="lineNum">    1719 </span>            : {</a>
<a name="1720"><span class="lineNum">    1720 </span><span class="lineCov">         42 :         zend_long count = 0;</span></a>
<a name="1721"><span class="lineNum">    1721 </span>            :         zend_string *var_name;</a>
<a name="1722"><span class="lineNum">    1722 </span>            :         zval *entry, *orig_var;</a>
<a name="1723"><span class="lineNum">    1723 </span>            : </a>
<a name="1724"><span class="lineNum">    1724 </span><span class="lineCov">         42 :         if (HT_IS_PACKED(arr)) {</span></a>
<a name="1725"><span class="lineNum">    1725 </span><span class="lineCov">         21 :                 return 0;</span></a>
<a name="1726"><span class="lineNum">    1726 </span>            :         }</a>
<a name="1727"><span class="lineNum">    1727 </span><span class="lineCov">        213 :         ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(arr, var_name, entry) {</span></a>
<a name="1728"><span class="lineNum">    1728 </span><span class="lineCov">         96 :                 if (!var_name) {</span></a>
<a name="1729"><span class="lineNum">    1729 </span><span class="lineCov">         36 :                         continue;</span></a>
<a name="1730"><span class="lineNum">    1730 </span>            :                 }</a>
<a name="1731"><span class="lineNum">    1731 </span><span class="lineCov">         60 :                 orig_var = zend_hash_find_known_hash(symbol_table, var_name);</span></a>
<a name="1732"><span class="lineNum">    1732 </span><span class="lineCov">         60 :                 if (orig_var) {</span></a>
<a name="1733"><span class="lineNum">    1733 </span><span class="lineCov">         39 :                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="1734"><span class="lineNum">    1734 </span><span class="lineCov">          6 :                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="1735"><span class="lineNum">    1735 </span><span class="lineCov">          6 :                                 if (Z_TYPE_P(orig_var) == IS_UNDEF) {</span></a>
<a name="1736"><span class="lineNum">    1736 </span><span class="lineNoCov">          0 :                                         continue;</span></a>
<a name="1737"><span class="lineNum">    1737 </span>            :                                 }</a>
<a name="1738"><span class="lineNum">    1738 </span>            :                         }</a>
<a name="1739"><span class="lineNum">    1739 </span><span class="lineCov">         78 :                         if (!php_valid_var_name(ZSTR_VAL(var_name), ZSTR_LEN(var_name))) {</span></a>
<a name="1740"><span class="lineNum">    1740 </span><span class="lineNoCov">          0 :                                 continue;</span></a>
<a name="1741"><span class="lineNum">    1741 </span>            :                         }</a>
<a name="1742"><span class="lineNum">    1742 </span><span class="lineCov">         39 :                         if (zend_string_equals_literal(var_name, &quot;GLOBALS&quot;)) {</span></a>
<a name="1743"><span class="lineNum">    1743 </span><span class="lineNoCov">          0 :                                 continue;</span></a>
<a name="1744"><span class="lineNum">    1744 </span>            :                         }</a>
<a name="1745"><span class="lineNum">    1745 </span><span class="lineCov">         39 :                         if (zend_string_equals_literal(var_name, &quot;this&quot;)) {</span></a>
<a name="1746"><span class="lineNum">    1746 </span><span class="lineNoCov">          0 :                                 zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="1747"><span class="lineNum">    1747 </span><span class="lineNoCov">          0 :                                 return -1;</span></a>
<a name="1748"><span class="lineNum">    1748 </span>            :                         }</a>
<a name="1749"><span class="lineNum">    1749 </span><span class="lineCov">         39 :                         ZVAL_DEREF(entry);</span></a>
<a name="1750"><span class="lineNum">    1750 </span><span class="lineCov">         99 :                         ZEND_TRY_ASSIGN_COPY_EX(orig_var, entry, 0);</span></a>
<a name="1751"><span class="lineNum">    1751 </span><span class="lineCov">         39 :                         if (UNEXPECTED(EG(exception))) {</span></a>
<a name="1752"><span class="lineNum">    1752 </span><span class="lineNoCov">          0 :                                 return -1;</span></a>
<a name="1753"><span class="lineNum">    1753 </span>            :                         }</a>
<a name="1754"><span class="lineNum">    1754 </span><span class="lineCov">         39 :                         count++;</span></a>
<a name="1755"><span class="lineNum">    1755 </span>            :                 }</a>
<a name="1756"><span class="lineNum">    1756 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="1757"><span class="lineNum">    1757 </span>            : </a>
<a name="1758"><span class="lineNum">    1758 </span><span class="lineCov">         21 :         return count;</span></a>
<a name="1759"><span class="lineNum">    1759 </span>            : }</a>
<a name="1760"><span class="lineNum">    1760 </span>            : /* }}} */</a>
<a name="1761"><span class="lineNum">    1761 </span>            : </a>
<a name="1762"><span class="lineNum">    1762 </span><span class="lineCov">         57 : static zend_long php_extract_ref_overwrite(zend_array *arr, zend_array *symbol_table) /* {{{ */</span></a>
<a name="1763"><span class="lineNum">    1763 </span>            : {</a>
<a name="1764"><span class="lineNum">    1764 </span><span class="lineCov">         57 :         zend_long count = 0;</span></a>
<a name="1765"><span class="lineNum">    1765 </span>            :         zend_string *var_name;</a>
<a name="1766"><span class="lineNum">    1766 </span>            :         zval *entry, *orig_var;</a>
<a name="1767"><span class="lineNum">    1767 </span>            : </a>
<a name="1768"><span class="lineNum">    1768 </span><span class="lineCov">         57 :         if (HT_IS_PACKED(arr)) {</span></a>
<a name="1769"><span class="lineNum">    1769 </span><span class="lineNoCov">          0 :                 return 0;</span></a>
<a name="1770"><span class="lineNum">    1770 </span>            :         }</a>
<a name="1771"><span class="lineNum">    1771 </span><span class="lineCov">        396 :         ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(arr, var_name, entry) {</span></a>
<a name="1772"><span class="lineNum">    1772 </span><span class="lineCov">        171 :                 if (!var_name) {</span></a>
<a name="1773"><span class="lineNum">    1773 </span><span class="lineNoCov">          0 :                         continue;</span></a>
<a name="1774"><span class="lineNum">    1774 </span>            :                 }</a>
<a name="1775"><span class="lineNum">    1775 </span><span class="lineCov">        342 :                 if (!php_valid_var_name(ZSTR_VAL(var_name), ZSTR_LEN(var_name))) {</span></a>
<a name="1776"><span class="lineNum">    1776 </span><span class="lineNoCov">          0 :                         continue;</span></a>
<a name="1777"><span class="lineNum">    1777 </span>            :                 }</a>
<a name="1778"><span class="lineNum">    1778 </span><span class="lineCov">        171 :                 if (zend_string_equals_literal(var_name, &quot;this&quot;)) {</span></a>
<a name="1779"><span class="lineNum">    1779 </span><span class="lineCov">          3 :                         zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="1780"><span class="lineNum">    1780 </span><span class="lineCov">          3 :                         return -1;</span></a>
<a name="1781"><span class="lineNum">    1781 </span>            :                 }</a>
<a name="1782"><span class="lineNum">    1782 </span><span class="lineCov">        168 :                 orig_var = zend_hash_find_known_hash(symbol_table, var_name);</span></a>
<a name="1783"><span class="lineNum">    1783 </span><span class="lineCov">        168 :                 if (orig_var) {</span></a>
<a name="1784"><span class="lineNum">    1784 </span><span class="lineCov">        102 :                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="1785"><span class="lineNum">    1785 </span><span class="lineCov">         57 :                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="1786"><span class="lineNum">    1786 </span>            :                         }</a>
<a name="1787"><span class="lineNum">    1787 </span><span class="lineCov">        102 :                         if (zend_string_equals_literal(var_name, &quot;GLOBALS&quot;)) {</span></a>
<a name="1788"><span class="lineNum">    1788 </span><span class="lineNoCov">          0 :                                 continue;</span></a>
<a name="1789"><span class="lineNum">    1789 </span>            :                         }</a>
<a name="1790"><span class="lineNum">    1790 </span><span class="lineCov">        102 :                         if (Z_ISREF_P(entry)) {</span></a>
<a name="1791"><span class="lineNum">    1791 </span>            :                                 Z_ADDREF_P(entry);</a>
<a name="1792"><span class="lineNum">    1792 </span>            :                         } else {</a>
<a name="1793"><span class="lineNum">    1793 </span><span class="lineCov">        180 :                                 ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="1794"><span class="lineNum">    1794 </span>            :                         }</a>
<a name="1795"><span class="lineNum">    1795 </span><span class="lineCov">        102 :                         zval_ptr_dtor(orig_var);</span></a>
<a name="1796"><span class="lineNum">    1796 </span><span class="lineCov">        102 :                         ZVAL_REF(orig_var, Z_REF_P(entry));</span></a>
<a name="1797"><span class="lineNum">    1797 </span>            :                 } else {</a>
<a name="1798"><span class="lineNum">    1798 </span><span class="lineCov">         66 :                         if (Z_ISREF_P(entry)) {</span></a>
<a name="1799"><span class="lineNum">    1799 </span>            :                                 Z_ADDREF_P(entry);</a>
<a name="1800"><span class="lineNum">    1800 </span>            :                         } else {</a>
<a name="1801"><span class="lineNum">    1801 </span><span class="lineCov">        132 :                                 ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="1802"><span class="lineNum">    1802 </span>            :                         }</a>
<a name="1803"><span class="lineNum">    1803 </span><span class="lineCov">         66 :                         zend_hash_add_new(symbol_table, var_name, entry);</span></a>
<a name="1804"><span class="lineNum">    1804 </span>            :                 }</a>
<a name="1805"><span class="lineNum">    1805 </span><span class="lineCov">        168 :                 count++;</span></a>
<a name="1806"><span class="lineNum">    1806 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="1807"><span class="lineNum">    1807 </span>            : </a>
<a name="1808"><span class="lineNum">    1808 </span><span class="lineCov">         54 :         return count;</span></a>
<a name="1809"><span class="lineNum">    1809 </span>            : }</a>
<a name="1810"><span class="lineNum">    1810 </span>            : /* }}} */</a>
<a name="1811"><span class="lineNum">    1811 </span>            : </a>
<a name="1812"><span class="lineNum">    1812 </span><span class="lineCov">        111 : static zend_long php_extract_overwrite(zend_array *arr, zend_array *symbol_table) /* {{{ */</span></a>
<a name="1813"><span class="lineNum">    1813 </span>            : {</a>
<a name="1814"><span class="lineNum">    1814 </span><span class="lineCov">        111 :         zend_long count = 0;</span></a>
<a name="1815"><span class="lineNum">    1815 </span>            :         zend_string *var_name;</a>
<a name="1816"><span class="lineNum">    1816 </span>            :         zval *entry, *orig_var;</a>
<a name="1817"><span class="lineNum">    1817 </span>            : </a>
<a name="1818"><span class="lineNum">    1818 </span><span class="lineCov">        111 :         if (HT_IS_PACKED(arr)) {</span></a>
<a name="1819"><span class="lineNum">    1819 </span><span class="lineCov">         42 :                 return 0;</span></a>
<a name="1820"><span class="lineNum">    1820 </span>            :         }</a>
<a name="1821"><span class="lineNum">    1821 </span><span class="lineCov">        534 :         ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(arr, var_name, entry) {</span></a>
<a name="1822"><span class="lineNum">    1822 </span><span class="lineCov">        237 :                 if (!var_name) {</span></a>
<a name="1823"><span class="lineNum">    1823 </span><span class="lineCov">         81 :                         continue;</span></a>
<a name="1824"><span class="lineNum">    1824 </span>            :                 }</a>
<a name="1825"><span class="lineNum">    1825 </span><span class="lineCov">        312 :                 if (!php_valid_var_name(ZSTR_VAL(var_name), ZSTR_LEN(var_name))) {</span></a>
<a name="1826"><span class="lineNum">    1826 </span><span class="lineCov">         24 :                         continue;</span></a>
<a name="1827"><span class="lineNum">    1827 </span>            :                 }</a>
<a name="1828"><span class="lineNum">    1828 </span><span class="lineCov">        132 :                 if (zend_string_equals_literal(var_name, &quot;this&quot;)) {</span></a>
<a name="1829"><span class="lineNum">    1829 </span><span class="lineCov">          6 :                         zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="1830"><span class="lineNum">    1830 </span><span class="lineCov">          6 :                         return -1;</span></a>
<a name="1831"><span class="lineNum">    1831 </span>            :                 }</a>
<a name="1832"><span class="lineNum">    1832 </span><span class="lineCov">        126 :                 orig_var = zend_hash_find_known_hash(symbol_table, var_name);</span></a>
<a name="1833"><span class="lineNum">    1833 </span><span class="lineCov">        126 :                 if (orig_var) {</span></a>
<a name="1834"><span class="lineNum">    1834 </span><span class="lineCov">         72 :                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="1835"><span class="lineNum">    1835 </span><span class="lineCov">         36 :                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="1836"><span class="lineNum">    1836 </span>            :                         }</a>
<a name="1837"><span class="lineNum">    1837 </span><span class="lineCov">         72 :                         if (zend_string_equals_literal(var_name, &quot;GLOBALS&quot;)) {</span></a>
<a name="1838"><span class="lineNum">    1838 </span><span class="lineNoCov">          0 :                                 continue;</span></a>
<a name="1839"><span class="lineNum">    1839 </span>            :                         }</a>
<a name="1840"><span class="lineNum">    1840 </span><span class="lineCov">         72 :                         ZVAL_DEREF(entry);</span></a>
<a name="1841"><span class="lineNum">    1841 </span><span class="lineCov">        177 :                         ZEND_TRY_ASSIGN_COPY_EX(orig_var, entry, 0);</span></a>
<a name="1842"><span class="lineNum">    1842 </span><span class="lineCov">         72 :                         if (UNEXPECTED(EG(exception))) {</span></a>
<a name="1843"><span class="lineNum">    1843 </span><span class="lineCov">          3 :                                 return -1;</span></a>
<a name="1844"><span class="lineNum">    1844 </span>            :                         }</a>
<a name="1845"><span class="lineNum">    1845 </span>            :                 } else {</a>
<a name="1846"><span class="lineNum">    1846 </span><span class="lineCov">         54 :                         ZVAL_DEREF(entry);</span></a>
<a name="1847"><span class="lineNum">    1847 </span><span class="lineCov">         54 :                         Z_TRY_ADDREF_P(entry);</span></a>
<a name="1848"><span class="lineNum">    1848 </span><span class="lineCov">         54 :                         zend_hash_add_new(symbol_table, var_name, entry);</span></a>
<a name="1849"><span class="lineNum">    1849 </span>            :                 }</a>
<a name="1850"><span class="lineNum">    1850 </span><span class="lineCov">        123 :                 count++;</span></a>
<a name="1851"><span class="lineNum">    1851 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="1852"><span class="lineNum">    1852 </span>            : </a>
<a name="1853"><span class="lineNum">    1853 </span><span class="lineCov">         60 :         return count;</span></a>
<a name="1854"><span class="lineNum">    1854 </span>            : }</a>
<a name="1855"><span class="lineNum">    1855 </span>            : /* }}} */</a>
<a name="1856"><span class="lineNum">    1856 </span>            : </a>
<a name="1857"><span class="lineNum">    1857 </span><span class="lineCov">          9 : static zend_long php_extract_ref_prefix_if_exists(zend_array *arr, zend_array *symbol_table, zend_string *prefix) /* {{{ */</span></a>
<a name="1858"><span class="lineNum">    1858 </span>            : {</a>
<a name="1859"><span class="lineNum">    1859 </span><span class="lineCov">          9 :         zend_long count = 0;</span></a>
<a name="1860"><span class="lineNum">    1860 </span>            :         zend_string *var_name;</a>
<a name="1861"><span class="lineNum">    1861 </span>            :         zval *entry, *orig_var, final_name;</a>
<a name="1862"><span class="lineNum">    1862 </span>            : </a>
<a name="1863"><span class="lineNum">    1863 </span><span class="lineCov">          9 :         if (HT_IS_PACKED(arr)) {</span></a>
<a name="1864"><span class="lineNum">    1864 </span><span class="lineNoCov">          0 :                 return 0;</span></a>
<a name="1865"><span class="lineNum">    1865 </span>            :         }</a>
<a name="1866"><span class="lineNum">    1866 </span><span class="lineCov">         39 :         ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(arr, var_name, entry) {</span></a>
<a name="1867"><span class="lineNum">    1867 </span><span class="lineCov">         15 :                 if (!var_name) {</span></a>
<a name="1868"><span class="lineNum">    1868 </span><span class="lineNoCov">          0 :                         continue;</span></a>
<a name="1869"><span class="lineNum">    1869 </span>            :                 }</a>
<a name="1870"><span class="lineNum">    1870 </span><span class="lineCov">         15 :                 orig_var = zend_hash_find_known_hash(symbol_table, var_name);</span></a>
<a name="1871"><span class="lineNum">    1871 </span><span class="lineCov">         15 :                 if (orig_var) {</span></a>
<a name="1872"><span class="lineNum">    1872 </span><span class="lineCov">          6 :                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="1873"><span class="lineNum">    1873 </span><span class="lineCov">          6 :                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="1874"><span class="lineNum">    1874 </span><span class="lineCov">          6 :                                 if (Z_TYPE_P(orig_var) == IS_UNDEF) {</span></a>
<a name="1875"><span class="lineNum">    1875 </span><span class="lineNoCov">          0 :                                         if (Z_ISREF_P(entry)) {</span></a>
<a name="1876"><span class="lineNum">    1876 </span>            :                                                 Z_ADDREF_P(entry);</a>
<a name="1877"><span class="lineNum">    1877 </span>            :                                         } else {</a>
<a name="1878"><span class="lineNum">    1878 </span><span class="lineNoCov">          0 :                                                 ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="1879"><span class="lineNum">    1879 </span>            :                                         }</a>
<a name="1880"><span class="lineNum">    1880 </span><span class="lineNoCov">          0 :                                         ZVAL_REF(orig_var, Z_REF_P(entry));</span></a>
<a name="1881"><span class="lineNum">    1881 </span><span class="lineNoCov">          0 :                                         count++;</span></a>
<a name="1882"><span class="lineNum">    1882 </span><span class="lineNoCov">          0 :                                         continue;</span></a>
<a name="1883"><span class="lineNum">    1883 </span>            :                                 }</a>
<a name="1884"><span class="lineNum">    1884 </span>            :                         }</a>
<a name="1885"><span class="lineNum">    1885 </span><span class="lineCov">          6 :                         php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(var_name), ZSTR_LEN(var_name), 1);</span></a>
<a name="1886"><span class="lineNum">    1886 </span><span class="lineCov">         12 :                         if (php_valid_var_name(Z_STRVAL(final_name), Z_STRLEN(final_name))) {</span></a>
<a name="1887"><span class="lineNum">    1887 </span><span class="lineCov">          6 :                                 if (zend_string_equals_literal(Z_STR(final_name), &quot;this&quot;)) {</span></a>
<a name="1888"><span class="lineNum">    1888 </span><span class="lineNoCov">          0 :                                         zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="1889"><span class="lineNum">    1889 </span><span class="lineNoCov">          0 :                                         return -1;</span></a>
<a name="1890"><span class="lineNum">    1890 </span>            :                                 } else {</a>
<a name="1891"><span class="lineNum">    1891 </span><span class="lineCov">          6 :                                         if (Z_ISREF_P(entry)) {</span></a>
<a name="1892"><span class="lineNum">    1892 </span>            :                                                 Z_ADDREF_P(entry);</a>
<a name="1893"><span class="lineNum">    1893 </span>            :                                         } else {</a>
<a name="1894"><span class="lineNum">    1894 </span><span class="lineCov">         12 :                                                 ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="1895"><span class="lineNum">    1895 </span>            :                                         }</a>
<a name="1896"><span class="lineNum">    1896 </span><span class="lineCov">          6 :                                         if ((orig_var = zend_hash_find(symbol_table, Z_STR(final_name))) != NULL) {</span></a>
<a name="1897"><span class="lineNum">    1897 </span><span class="lineCov">          3 :                                                 if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="1898"><span class="lineNum">    1898 </span><span class="lineCov">          3 :                                                         orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="1899"><span class="lineNum">    1899 </span>            :                                                 }</a>
<a name="1900"><span class="lineNum">    1900 </span><span class="lineCov">          3 :                                                 zval_ptr_dtor(orig_var);</span></a>
<a name="1901"><span class="lineNum">    1901 </span><span class="lineCov">          3 :                                                 ZVAL_REF(orig_var, Z_REF_P(entry));</span></a>
<a name="1902"><span class="lineNum">    1902 </span>            :                                         } else {</a>
<a name="1903"><span class="lineNum">    1903 </span><span class="lineCov">          3 :                                                 zend_hash_add_new(symbol_table, Z_STR(final_name), entry);</span></a>
<a name="1904"><span class="lineNum">    1904 </span>            :                                         }</a>
<a name="1905"><span class="lineNum">    1905 </span><span class="lineCov">          6 :                                         count++;</span></a>
<a name="1906"><span class="lineNum">    1906 </span>            :                                 }</a>
<a name="1907"><span class="lineNum">    1907 </span>            :                         }</a>
<a name="1908"><span class="lineNum">    1908 </span>            :                         zval_ptr_dtor_str(&amp;final_name);</a>
<a name="1909"><span class="lineNum">    1909 </span>            :                 }</a>
<a name="1910"><span class="lineNum">    1910 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="1911"><span class="lineNum">    1911 </span>            : </a>
<a name="1912"><span class="lineNum">    1912 </span><span class="lineCov">          9 :         return count;</span></a>
<a name="1913"><span class="lineNum">    1913 </span>            : }</a>
<a name="1914"><span class="lineNum">    1914 </span>            : /* }}} */</a>
<a name="1915"><span class="lineNum">    1915 </span>            : </a>
<a name="1916"><span class="lineNum">    1916 </span><span class="lineCov">         42 : static zend_long php_extract_prefix_if_exists(zend_array *arr, zend_array *symbol_table, zend_string *prefix) /* {{{ */</span></a>
<a name="1917"><span class="lineNum">    1917 </span>            : {</a>
<a name="1918"><span class="lineNum">    1918 </span><span class="lineCov">         42 :         zend_long count = 0;</span></a>
<a name="1919"><span class="lineNum">    1919 </span>            :         zend_string *var_name;</a>
<a name="1920"><span class="lineNum">    1920 </span>            :         zval *entry, *orig_var, final_name;</a>
<a name="1921"><span class="lineNum">    1921 </span>            : </a>
<a name="1922"><span class="lineNum">    1922 </span><span class="lineCov">         42 :         if (HT_IS_PACKED(arr)) {</span></a>
<a name="1923"><span class="lineNum">    1923 </span><span class="lineCov">         21 :                 return 0;</span></a>
<a name="1924"><span class="lineNum">    1924 </span>            :         }</a>
<a name="1925"><span class="lineNum">    1925 </span><span class="lineCov">        213 :         ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(arr, var_name, entry) {</span></a>
<a name="1926"><span class="lineNum">    1926 </span><span class="lineCov">         96 :                 if (!var_name) {</span></a>
<a name="1927"><span class="lineNum">    1927 </span><span class="lineCov">         36 :                         continue;</span></a>
<a name="1928"><span class="lineNum">    1928 </span>            :                 }</a>
<a name="1929"><span class="lineNum">    1929 </span><span class="lineCov">         60 :                 orig_var = zend_hash_find_known_hash(symbol_table, var_name);</span></a>
<a name="1930"><span class="lineNum">    1930 </span><span class="lineCov">         60 :                 if (orig_var) {</span></a>
<a name="1931"><span class="lineNum">    1931 </span><span class="lineCov">         39 :                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="1932"><span class="lineNum">    1932 </span><span class="lineCov">          6 :                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="1933"><span class="lineNum">    1933 </span><span class="lineCov">          6 :                                 if (Z_TYPE_P(orig_var) == IS_UNDEF) {</span></a>
<a name="1934"><span class="lineNum">    1934 </span><span class="lineNoCov">          0 :                                         ZVAL_COPY_DEREF(orig_var, entry);</span></a>
<a name="1935"><span class="lineNum">    1935 </span><span class="lineNoCov">          0 :                                         count++;</span></a>
<a name="1936"><span class="lineNum">    1936 </span><span class="lineNoCov">          0 :                                         continue;</span></a>
<a name="1937"><span class="lineNum">    1937 </span>            :                                 }</a>
<a name="1938"><span class="lineNum">    1938 </span>            :                         }</a>
<a name="1939"><span class="lineNum">    1939 </span><span class="lineCov">         39 :                         php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(var_name), ZSTR_LEN(var_name), 1);</span></a>
<a name="1940"><span class="lineNum">    1940 </span><span class="lineCov">         78 :                         if (php_valid_var_name(Z_STRVAL(final_name), Z_STRLEN(final_name))) {</span></a>
<a name="1941"><span class="lineNum">    1941 </span><span class="lineCov">         39 :                                 if (zend_string_equals_literal(Z_STR(final_name), &quot;this&quot;)) {</span></a>
<a name="1942"><span class="lineNum">    1942 </span><span class="lineNoCov">          0 :                                         zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="1943"><span class="lineNum">    1943 </span><span class="lineNoCov">          0 :                                         return -1;</span></a>
<a name="1944"><span class="lineNum">    1944 </span>            :                                 } else {</a>
<a name="1945"><span class="lineNum">    1945 </span><span class="lineCov">         39 :                                         ZVAL_DEREF(entry);</span></a>
<a name="1946"><span class="lineNum">    1946 </span><span class="lineCov">         39 :                                         if ((orig_var = zend_hash_find(symbol_table, Z_STR(final_name))) != NULL) {</span></a>
<a name="1947"><span class="lineNum">    1947 </span><span class="lineCov">         36 :                                                 if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="1948"><span class="lineNum">    1948 </span><span class="lineCov">          3 :                                                         orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="1949"><span class="lineNum">    1949 </span>            :                                                 }</a>
<a name="1950"><span class="lineNum">    1950 </span><span class="lineCov">         93 :                                                 ZEND_TRY_ASSIGN_COPY_EX(orig_var, entry, 0);</span></a>
<a name="1951"><span class="lineNum">    1951 </span><span class="lineCov">         36 :                                                 if (UNEXPECTED(EG(exception))) {</span></a>
<a name="1952"><span class="lineNum">    1952 </span><span class="lineNoCov">          0 :                                                         zend_string_release_ex(Z_STR(final_name), 0);</span></a>
<a name="1953"><span class="lineNum">    1953 </span><span class="lineNoCov">          0 :                                                         return -1;</span></a>
<a name="1954"><span class="lineNum">    1954 </span>            :                                                 }</a>
<a name="1955"><span class="lineNum">    1955 </span>            :                                         } else {</a>
<a name="1956"><span class="lineNum">    1956 </span><span class="lineCov">          3 :                                                 Z_TRY_ADDREF_P(entry);</span></a>
<a name="1957"><span class="lineNum">    1957 </span><span class="lineCov">          3 :                                                 zend_hash_add_new(symbol_table, Z_STR(final_name), entry);</span></a>
<a name="1958"><span class="lineNum">    1958 </span>            :                                         }</a>
<a name="1959"><span class="lineNum">    1959 </span><span class="lineCov">         39 :                                         count++;</span></a>
<a name="1960"><span class="lineNum">    1960 </span>            :                                 }</a>
<a name="1961"><span class="lineNum">    1961 </span>            :                         }</a>
<a name="1962"><span class="lineNum">    1962 </span>            :                         zval_ptr_dtor_str(&amp;final_name);</a>
<a name="1963"><span class="lineNum">    1963 </span>            :                 }</a>
<a name="1964"><span class="lineNum">    1964 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="1965"><span class="lineNum">    1965 </span>            : </a>
<a name="1966"><span class="lineNum">    1966 </span><span class="lineCov">         21 :         return count;</span></a>
<a name="1967"><span class="lineNum">    1967 </span>            : }</a>
<a name="1968"><span class="lineNum">    1968 </span>            : /* }}} */</a>
<a name="1969"><span class="lineNum">    1969 </span>            : </a>
<a name="1970"><span class="lineNum">    1970 </span><span class="lineCov">          9 : static zend_long php_extract_ref_prefix_same(zend_array *arr, zend_array *symbol_table, zend_string *prefix) /* {{{ */</span></a>
<a name="1971"><span class="lineNum">    1971 </span>            : {</a>
<a name="1972"><span class="lineNum">    1972 </span><span class="lineCov">          9 :         zend_long count = 0;</span></a>
<a name="1973"><span class="lineNum">    1973 </span>            :         zend_string *var_name;</a>
<a name="1974"><span class="lineNum">    1974 </span>            :         zval *entry, *orig_var, final_name;</a>
<a name="1975"><span class="lineNum">    1975 </span>            : </a>
<a name="1976"><span class="lineNum">    1976 </span><span class="lineCov">          9 :         if (HT_IS_PACKED(arr)) {</span></a>
<a name="1977"><span class="lineNum">    1977 </span><span class="lineNoCov">          0 :                 return 0;</span></a>
<a name="1978"><span class="lineNum">    1978 </span>            :         }</a>
<a name="1979"><span class="lineNum">    1979 </span><span class="lineCov">         39 :         ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(arr, var_name, entry) {</span></a>
<a name="1980"><span class="lineNum">    1980 </span><span class="lineCov">         15 :                 if (!var_name) {</span></a>
<a name="1981"><span class="lineNum">    1981 </span><span class="lineNoCov">          0 :                         continue;</span></a>
<a name="1982"><span class="lineNum">    1982 </span>            :                 }</a>
<a name="1983"><span class="lineNum">    1983 </span><span class="lineCov">         15 :                 if (ZSTR_LEN(var_name) == 0) {</span></a>
<a name="1984"><span class="lineNum">    1984 </span><span class="lineNoCov">          0 :                         continue;</span></a>
<a name="1985"><span class="lineNum">    1985 </span>            :                 }</a>
<a name="1986"><span class="lineNum">    1986 </span><span class="lineCov">         15 :                 orig_var = zend_hash_find_known_hash(symbol_table, var_name);</span></a>
<a name="1987"><span class="lineNum">    1987 </span><span class="lineCov">         15 :                 if (orig_var) {</span></a>
<a name="1988"><span class="lineNum">    1988 </span><span class="lineCov">          9 :                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="1989"><span class="lineNum">    1989 </span><span class="lineCov">          6 :                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="1990"><span class="lineNum">    1990 </span><span class="lineCov">          6 :                                 if (Z_TYPE_P(orig_var) == IS_UNDEF) {</span></a>
<a name="1991"><span class="lineNum">    1991 </span><span class="lineNoCov">          0 :                                         if (Z_ISREF_P(entry)) {</span></a>
<a name="1992"><span class="lineNum">    1992 </span>            :                                                 Z_ADDREF_P(entry);</a>
<a name="1993"><span class="lineNum">    1993 </span>            :                                         } else {</a>
<a name="1994"><span class="lineNum">    1994 </span><span class="lineNoCov">          0 :                                                 ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="1995"><span class="lineNum">    1995 </span>            :                                         }</a>
<a name="1996"><span class="lineNum">    1996 </span><span class="lineNoCov">          0 :                                         ZVAL_REF(orig_var, Z_REF_P(entry));</span></a>
<a name="1997"><span class="lineNum">    1997 </span><span class="lineNoCov">          0 :                                         count++;</span></a>
<a name="1998"><span class="lineNum">    1998 </span><span class="lineNoCov">          0 :                                         continue;</span></a>
<a name="1999"><span class="lineNum">    1999 </span>            :                                 }</a>
<a name="2000"><span class="lineNum">    2000 </span>            :                         }</a>
<a name="2001"><span class="lineNum">    2001 </span><span class="lineCov">          9 : prefix:</span></a>
<a name="2002"><span class="lineNum">    2002 </span><span class="lineCov">         12 :                         php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(var_name), ZSTR_LEN(var_name), 1);</span></a>
<a name="2003"><span class="lineNum">    2003 </span><span class="lineCov">         24 :                         if (php_valid_var_name(Z_STRVAL(final_name), Z_STRLEN(final_name))) {</span></a>
<a name="2004"><span class="lineNum">    2004 </span><span class="lineCov">         12 :                                 if (zend_string_equals_literal(Z_STR(final_name), &quot;this&quot;)) {</span></a>
<a name="2005"><span class="lineNum">    2005 </span><span class="lineNoCov">          0 :                                         zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="2006"><span class="lineNum">    2006 </span><span class="lineNoCov">          0 :                                         return -1;</span></a>
<a name="2007"><span class="lineNum">    2007 </span>            :                                 } else {</a>
<a name="2008"><span class="lineNum">    2008 </span><span class="lineCov">         12 :                                         if (Z_ISREF_P(entry)) {</span></a>
<a name="2009"><span class="lineNum">    2009 </span>            :                                                 Z_ADDREF_P(entry);</a>
<a name="2010"><span class="lineNum">    2010 </span>            :                                         } else {</a>
<a name="2011"><span class="lineNum">    2011 </span><span class="lineCov">         24 :                                                 ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="2012"><span class="lineNum">    2012 </span>            :                                         }</a>
<a name="2013"><span class="lineNum">    2013 </span><span class="lineCov">         12 :                                         if ((orig_var = zend_hash_find(symbol_table, Z_STR(final_name))) != NULL) {</span></a>
<a name="2014"><span class="lineNum">    2014 </span><span class="lineCov">          6 :                                                 if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="2015"><span class="lineNum">    2015 </span><span class="lineCov">          6 :                                                         orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="2016"><span class="lineNum">    2016 </span>            :                                                 }</a>
<a name="2017"><span class="lineNum">    2017 </span><span class="lineCov">          6 :                                                 zval_ptr_dtor(orig_var);</span></a>
<a name="2018"><span class="lineNum">    2018 </span><span class="lineCov">          6 :                                                 ZVAL_REF(orig_var, Z_REF_P(entry));</span></a>
<a name="2019"><span class="lineNum">    2019 </span>            :                                         } else {</a>
<a name="2020"><span class="lineNum">    2020 </span><span class="lineCov">          6 :                                                 zend_hash_add_new(symbol_table, Z_STR(final_name), entry);</span></a>
<a name="2021"><span class="lineNum">    2021 </span>            :                                         }</a>
<a name="2022"><span class="lineNum">    2022 </span><span class="lineCov">         12 :                                         count++;</span></a>
<a name="2023"><span class="lineNum">    2023 </span>            :                                 }</a>
<a name="2024"><span class="lineNum">    2024 </span>            :                         }</a>
<a name="2025"><span class="lineNum">    2025 </span>            :                         zval_ptr_dtor_str(&amp;final_name);</a>
<a name="2026"><span class="lineNum">    2026 </span>            :                 } else {</a>
<a name="2027"><span class="lineNum">    2027 </span><span class="lineCov">         12 :                         if (!php_valid_var_name(ZSTR_VAL(var_name), ZSTR_LEN(var_name))) {</span></a>
<a name="2028"><span class="lineNum">    2028 </span><span class="lineNoCov">          0 :                                 continue;</span></a>
<a name="2029"><span class="lineNum">    2029 </span>            :                         }</a>
<a name="2030"><span class="lineNum">    2030 </span><span class="lineCov">          6 :                         if (zend_string_equals_literal(var_name, &quot;this&quot;)) {</span></a>
<a name="2031"><span class="lineNum">    2031 </span><span class="lineCov">          3 :                                 goto prefix;</span></a>
<a name="2032"><span class="lineNum">    2032 </span>            :                         }</a>
<a name="2033"><span class="lineNum">    2033 </span><span class="lineCov">          3 :                         if (Z_ISREF_P(entry)) {</span></a>
<a name="2034"><span class="lineNum">    2034 </span>            :                                 Z_ADDREF_P(entry);</a>
<a name="2035"><span class="lineNum">    2035 </span>            :                         } else {</a>
<a name="2036"><span class="lineNum">    2036 </span><span class="lineCov">          6 :                                 ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="2037"><span class="lineNum">    2037 </span>            :                         }</a>
<a name="2038"><span class="lineNum">    2038 </span><span class="lineCov">          3 :                         zend_hash_add_new(symbol_table, var_name, entry);</span></a>
<a name="2039"><span class="lineNum">    2039 </span><span class="lineCov">          3 :                         count++;</span></a>
<a name="2040"><span class="lineNum">    2040 </span>            :                 }</a>
<a name="2041"><span class="lineNum">    2041 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="2042"><span class="lineNum">    2042 </span>            : </a>
<a name="2043"><span class="lineNum">    2043 </span><span class="lineCov">          9 :         return count;</span></a>
<a name="2044"><span class="lineNum">    2044 </span>            : }</a>
<a name="2045"><span class="lineNum">    2045 </span>            : /* }}} */</a>
<a name="2046"><span class="lineNum">    2046 </span>            : </a>
<a name="2047"><span class="lineNum">    2047 </span><span class="lineCov">         48 : static zend_long php_extract_prefix_same(zend_array *arr, zend_array *symbol_table, zend_string *prefix) /* {{{ */</span></a>
<a name="2048"><span class="lineNum">    2048 </span>            : {</a>
<a name="2049"><span class="lineNum">    2049 </span><span class="lineCov">         48 :         zend_long count = 0;</span></a>
<a name="2050"><span class="lineNum">    2050 </span>            :         zend_string *var_name;</a>
<a name="2051"><span class="lineNum">    2051 </span>            :         zval *entry, *orig_var, final_name;</a>
<a name="2052"><span class="lineNum">    2052 </span>            : </a>
<a name="2053"><span class="lineNum">    2053 </span><span class="lineCov">         48 :         if (HT_IS_PACKED(arr)) {</span></a>
<a name="2054"><span class="lineNum">    2054 </span><span class="lineCov">         21 :                 return 0;</span></a>
<a name="2055"><span class="lineNum">    2055 </span>            :         }</a>
<a name="2056"><span class="lineNum">    2056 </span><span class="lineCov">        231 :         ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(arr, var_name, entry) {</span></a>
<a name="2057"><span class="lineNum">    2057 </span><span class="lineCov">        102 :                 if (!var_name) {</span></a>
<a name="2058"><span class="lineNum">    2058 </span><span class="lineCov">         36 :                         continue;</span></a>
<a name="2059"><span class="lineNum">    2059 </span>            :                 }</a>
<a name="2060"><span class="lineNum">    2060 </span><span class="lineCov">         66 :                 if (ZSTR_LEN(var_name) == 0) {</span></a>
<a name="2061"><span class="lineNum">    2061 </span><span class="lineCov">          6 :                         continue;</span></a>
<a name="2062"><span class="lineNum">    2062 </span>            :                 }</a>
<a name="2063"><span class="lineNum">    2063 </span><span class="lineCov">         60 :                 orig_var = zend_hash_find_known_hash(symbol_table, var_name);</span></a>
<a name="2064"><span class="lineNum">    2064 </span><span class="lineCov">         60 :                 if (orig_var) {</span></a>
<a name="2065"><span class="lineNum">    2065 </span><span class="lineCov">         45 :                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="2066"><span class="lineNum">    2066 </span><span class="lineCov">          9 :                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="2067"><span class="lineNum">    2067 </span><span class="lineCov">          9 :                                 if (Z_TYPE_P(orig_var) == IS_UNDEF) {</span></a>
<a name="2068"><span class="lineNum">    2068 </span><span class="lineNoCov">          0 :                                         ZVAL_COPY_DEREF(orig_var, entry);</span></a>
<a name="2069"><span class="lineNum">    2069 </span><span class="lineNoCov">          0 :                                         count++;</span></a>
<a name="2070"><span class="lineNum">    2070 </span><span class="lineNoCov">          0 :                                         continue;</span></a>
<a name="2071"><span class="lineNum">    2071 </span>            :                                 }</a>
<a name="2072"><span class="lineNum">    2072 </span>            :                         }</a>
<a name="2073"><span class="lineNum">    2073 </span><span class="lineCov">         45 : prefix:</span></a>
<a name="2074"><span class="lineNum">    2074 </span><span class="lineCov">         48 :                         php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(var_name), ZSTR_LEN(var_name), 1);</span></a>
<a name="2075"><span class="lineNum">    2075 </span><span class="lineCov">         96 :                         if (php_valid_var_name(Z_STRVAL(final_name), Z_STRLEN(final_name))) {</span></a>
<a name="2076"><span class="lineNum">    2076 </span><span class="lineCov">         48 :                                 if (zend_string_equals_literal(Z_STR(final_name), &quot;this&quot;)) {</span></a>
<a name="2077"><span class="lineNum">    2077 </span><span class="lineNoCov">          0 :                                         zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="2078"><span class="lineNum">    2078 </span><span class="lineNoCov">          0 :                                         return -1;</span></a>
<a name="2079"><span class="lineNum">    2079 </span>            :                                 } else {</a>
<a name="2080"><span class="lineNum">    2080 </span><span class="lineCov">         48 :                                         ZVAL_DEREF(entry);</span></a>
<a name="2081"><span class="lineNum">    2081 </span><span class="lineCov">         48 :                                         if ((orig_var = zend_hash_find(symbol_table, Z_STR(final_name))) != NULL) {</span></a>
<a name="2082"><span class="lineNum">    2082 </span><span class="lineCov">          6 :                                                 if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="2083"><span class="lineNum">    2083 </span><span class="lineCov">          6 :                                                         orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="2084"><span class="lineNum">    2084 </span>            :                                                 }</a>
<a name="2085"><span class="lineNum">    2085 </span><span class="lineCov">         15 :                                                 ZEND_TRY_ASSIGN_COPY_EX(orig_var, entry, 0);</span></a>
<a name="2086"><span class="lineNum">    2086 </span><span class="lineCov">          6 :                                                 if (UNEXPECTED(EG(exception))) {</span></a>
<a name="2087"><span class="lineNum">    2087 </span><span class="lineNoCov">          0 :                                                         zend_string_release_ex(Z_STR(final_name), 0);</span></a>
<a name="2088"><span class="lineNum">    2088 </span><span class="lineNoCov">          0 :                                                         return -1;</span></a>
<a name="2089"><span class="lineNum">    2089 </span>            :                                                 }</a>
<a name="2090"><span class="lineNum">    2090 </span>            :                                         } else {</a>
<a name="2091"><span class="lineNum">    2091 </span><span class="lineCov">         42 :                                                 Z_TRY_ADDREF_P(entry);</span></a>
<a name="2092"><span class="lineNum">    2092 </span><span class="lineCov">         42 :                                                 zend_hash_add_new(symbol_table, Z_STR(final_name), entry);</span></a>
<a name="2093"><span class="lineNum">    2093 </span>            :                                         }</a>
<a name="2094"><span class="lineNum">    2094 </span><span class="lineCov">         48 :                                         count++;</span></a>
<a name="2095"><span class="lineNum">    2095 </span>            :                                 }</a>
<a name="2096"><span class="lineNum">    2096 </span>            :                         }</a>
<a name="2097"><span class="lineNum">    2097 </span>            :                         zval_ptr_dtor_str(&amp;final_name);</a>
<a name="2098"><span class="lineNum">    2098 </span>            :                 } else {</a>
<a name="2099"><span class="lineNum">    2099 </span><span class="lineCov">         30 :                         if (!php_valid_var_name(ZSTR_VAL(var_name), ZSTR_LEN(var_name))) {</span></a>
<a name="2100"><span class="lineNum">    2100 </span><span class="lineCov">          9 :                                 continue;</span></a>
<a name="2101"><span class="lineNum">    2101 </span>            :                         }</a>
<a name="2102"><span class="lineNum">    2102 </span><span class="lineCov">          6 :                         if (zend_string_equals_literal(var_name, &quot;this&quot;)) {</span></a>
<a name="2103"><span class="lineNum">    2103 </span><span class="lineCov">          3 :                                 goto prefix;</span></a>
<a name="2104"><span class="lineNum">    2104 </span>            :                         }</a>
<a name="2105"><span class="lineNum">    2105 </span><span class="lineCov">          3 :                         ZVAL_DEREF(entry);</span></a>
<a name="2106"><span class="lineNum">    2106 </span><span class="lineCov">          3 :                         Z_TRY_ADDREF_P(entry);</span></a>
<a name="2107"><span class="lineNum">    2107 </span><span class="lineCov">          3 :                         zend_hash_add_new(symbol_table, var_name, entry);</span></a>
<a name="2108"><span class="lineNum">    2108 </span><span class="lineCov">          3 :                         count++;</span></a>
<a name="2109"><span class="lineNum">    2109 </span>            :                 }</a>
<a name="2110"><span class="lineNum">    2110 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="2111"><span class="lineNum">    2111 </span>            : </a>
<a name="2112"><span class="lineNum">    2112 </span><span class="lineCov">         27 :         return count;</span></a>
<a name="2113"><span class="lineNum">    2113 </span>            : }</a>
<a name="2114"><span class="lineNum">    2114 </span>            : /* }}} */</a>
<a name="2115"><span class="lineNum">    2115 </span>            : </a>
<a name="2116"><span class="lineNum">    2116 </span><span class="lineCov">          9 : static zend_long php_extract_ref_prefix_all(zend_array *arr, zend_array *symbol_table, zend_string *prefix) /* {{{ */</span></a>
<a name="2117"><span class="lineNum">    2117 </span>            : {</a>
<a name="2118"><span class="lineNum">    2118 </span><span class="lineCov">          9 :         zend_long count = 0;</span></a>
<a name="2119"><span class="lineNum">    2119 </span>            :         zend_string *var_name;</a>
<a name="2120"><span class="lineNum">    2120 </span>            :         zend_ulong num_key;</a>
<a name="2121"><span class="lineNum">    2121 </span>            :         zval *entry, *orig_var, final_name;</a>
<a name="2122"><span class="lineNum">    2122 </span>            : </a>
<a name="2123"><span class="lineNum">    2123 </span><span class="lineCov">         39 :         ZEND_HASH_FOREACH_KEY_VAL(arr, num_key, var_name, entry) {</span></a>
<a name="2124"><span class="lineNum">    2124 </span><span class="lineCov">         15 :                 if (var_name) {</span></a>
<a name="2125"><span class="lineNum">    2125 </span><span class="lineCov">         15 :                         if (ZSTR_LEN(var_name) == 0) {</span></a>
<a name="2126"><span class="lineNum">    2126 </span><span class="lineNoCov">          0 :                                 continue;</span></a>
<a name="2127"><span class="lineNum">    2127 </span>            :                         }</a>
<a name="2128"><span class="lineNum">    2128 </span><span class="lineCov">         15 :                         php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(var_name), ZSTR_LEN(var_name), 1);</span></a>
<a name="2129"><span class="lineNum">    2129 </span>            :                 } else {</a>
<a name="2130"><span class="lineNum">    2130 </span><span class="lineNoCov">          0 :                         zend_string *str = zend_long_to_str(num_key);</span></a>
<a name="2131"><span class="lineNum">    2131 </span><span class="lineNoCov">          0 :                         php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(str), ZSTR_LEN(str), 1);</span></a>
<a name="2132"><span class="lineNum">    2132 </span>            :                         zend_string_release_ex(str, 0);</a>
<a name="2133"><span class="lineNum">    2133 </span>            :                 }</a>
<a name="2134"><span class="lineNum">    2134 </span><span class="lineCov">         30 :                 if (php_valid_var_name(Z_STRVAL(final_name), Z_STRLEN(final_name))) {</span></a>
<a name="2135"><span class="lineNum">    2135 </span><span class="lineCov">         15 :                         if (zend_string_equals_literal(Z_STR(final_name), &quot;this&quot;)) {</span></a>
<a name="2136"><span class="lineNum">    2136 </span><span class="lineNoCov">          0 :                                 zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="2137"><span class="lineNum">    2137 </span><span class="lineNoCov">          0 :                                 return -1;</span></a>
<a name="2138"><span class="lineNum">    2138 </span>            :                         } else {</a>
<a name="2139"><span class="lineNum">    2139 </span><span class="lineCov">         15 :                                 if (Z_ISREF_P(entry)) {</span></a>
<a name="2140"><span class="lineNum">    2140 </span>            :                                         Z_ADDREF_P(entry);</a>
<a name="2141"><span class="lineNum">    2141 </span>            :                                 } else {</a>
<a name="2142"><span class="lineNum">    2142 </span><span class="lineCov">         30 :                                         ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="2143"><span class="lineNum">    2143 </span>            :                                 }</a>
<a name="2144"><span class="lineNum">    2144 </span><span class="lineCov">         15 :                                 if ((orig_var = zend_hash_find(symbol_table, Z_STR(final_name))) != NULL) {</span></a>
<a name="2145"><span class="lineNum">    2145 </span><span class="lineCov">          6 :                                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="2146"><span class="lineNum">    2146 </span><span class="lineCov">          6 :                                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="2147"><span class="lineNum">    2147 </span>            :                                         }</a>
<a name="2148"><span class="lineNum">    2148 </span><span class="lineCov">          6 :                                         zval_ptr_dtor(orig_var);</span></a>
<a name="2149"><span class="lineNum">    2149 </span><span class="lineCov">          6 :                                         ZVAL_REF(orig_var, Z_REF_P(entry));</span></a>
<a name="2150"><span class="lineNum">    2150 </span>            :                                 } else {</a>
<a name="2151"><span class="lineNum">    2151 </span><span class="lineCov">          9 :                                         zend_hash_add_new(symbol_table, Z_STR(final_name), entry);</span></a>
<a name="2152"><span class="lineNum">    2152 </span>            :                                 }</a>
<a name="2153"><span class="lineNum">    2153 </span><span class="lineCov">         15 :                                 count++;</span></a>
<a name="2154"><span class="lineNum">    2154 </span>            :                         }</a>
<a name="2155"><span class="lineNum">    2155 </span>            :                 }</a>
<a name="2156"><span class="lineNum">    2156 </span>            :                 zval_ptr_dtor_str(&amp;final_name);</a>
<a name="2157"><span class="lineNum">    2157 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="2158"><span class="lineNum">    2158 </span>            : </a>
<a name="2159"><span class="lineNum">    2159 </span><span class="lineCov">          9 :         return count;</span></a>
<a name="2160"><span class="lineNum">    2160 </span>            : }</a>
<a name="2161"><span class="lineNum">    2161 </span>            : /* }}} */</a>
<a name="2162"><span class="lineNum">    2162 </span>            : </a>
<a name="2163"><span class="lineNum">    2163 </span><span class="lineCov">         93 : static zend_long php_extract_prefix_all(zend_array *arr, zend_array *symbol_table, zend_string *prefix) /* {{{ */</span></a>
<a name="2164"><span class="lineNum">    2164 </span>            : {</a>
<a name="2165"><span class="lineNum">    2165 </span><span class="lineCov">         93 :         zend_long count = 0;</span></a>
<a name="2166"><span class="lineNum">    2166 </span>            :         zend_string *var_name;</a>
<a name="2167"><span class="lineNum">    2167 </span>            :         zend_ulong num_key;</a>
<a name="2168"><span class="lineNum">    2168 </span>            :         zval *entry, *orig_var, final_name;</a>
<a name="2169"><span class="lineNum">    2169 </span>            : </a>
<a name="2170"><span class="lineNum">    2170 </span><span class="lineCov">       1122 :         ZEND_HASH_FOREACH_KEY_VAL(arr, num_key, var_name, entry) {</span></a>
<a name="2171"><span class="lineNum">    2171 </span><span class="lineCov">        507 :                 if (var_name) {</span></a>
<a name="2172"><span class="lineNum">    2172 </span><span class="lineCov">        147 :                         if (ZSTR_LEN(var_name) == 0) {</span></a>
<a name="2173"><span class="lineNum">    2173 </span><span class="lineCov">         15 :                                 continue;</span></a>
<a name="2174"><span class="lineNum">    2174 </span>            :                         }</a>
<a name="2175"><span class="lineNum">    2175 </span><span class="lineCov">        132 :                         php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(var_name), ZSTR_LEN(var_name), 1);</span></a>
<a name="2176"><span class="lineNum">    2176 </span>            :                 } else {</a>
<a name="2177"><span class="lineNum">    2177 </span><span class="lineCov">        360 :                         zend_string *str = zend_long_to_str(num_key);</span></a>
<a name="2178"><span class="lineNum">    2178 </span><span class="lineCov">        360 :                         php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(str), ZSTR_LEN(str), 1);</span></a>
<a name="2179"><span class="lineNum">    2179 </span>            :                         zend_string_release_ex(str, 0);</a>
<a name="2180"><span class="lineNum">    2180 </span>            :                 }</a>
<a name="2181"><span class="lineNum">    2181 </span><span class="lineCov">        984 :                 if (php_valid_var_name(Z_STRVAL(final_name), Z_STRLEN(final_name))) {</span></a>
<a name="2182"><span class="lineNum">    2182 </span><span class="lineCov">        480 :                         if (zend_string_equals_literal(Z_STR(final_name), &quot;this&quot;)) {</span></a>
<a name="2183"><span class="lineNum">    2183 </span><span class="lineNoCov">          0 :                                 zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="2184"><span class="lineNum">    2184 </span><span class="lineNoCov">          0 :                                 return -1;</span></a>
<a name="2185"><span class="lineNum">    2185 </span>            :                         } else {</a>
<a name="2186"><span class="lineNum">    2186 </span><span class="lineCov">        480 :                                 ZVAL_DEREF(entry);</span></a>
<a name="2187"><span class="lineNum">    2187 </span><span class="lineCov">        480 :                                 if ((orig_var = zend_hash_find(symbol_table, Z_STR(final_name))) != NULL) {</span></a>
<a name="2188"><span class="lineNum">    2188 </span><span class="lineCov">        141 :                                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="2189"><span class="lineNum">    2189 </span><span class="lineCov">          6 :                                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="2190"><span class="lineNum">    2190 </span>            :                                         }</a>
<a name="2191"><span class="lineNum">    2191 </span><span class="lineCov">        390 :                                         ZEND_TRY_ASSIGN_COPY_EX(orig_var, entry, 0);</span></a>
<a name="2192"><span class="lineNum">    2192 </span><span class="lineCov">        141 :                                         if (UNEXPECTED(EG(exception))) {</span></a>
<a name="2193"><span class="lineNum">    2193 </span><span class="lineNoCov">          0 :                                                 zend_string_release_ex(Z_STR(final_name), 0);</span></a>
<a name="2194"><span class="lineNum">    2194 </span><span class="lineNoCov">          0 :                                                 return -1;</span></a>
<a name="2195"><span class="lineNum">    2195 </span>            :                                         }</a>
<a name="2196"><span class="lineNum">    2196 </span>            :                                 } else {</a>
<a name="2197"><span class="lineNum">    2197 </span><span class="lineCov">        339 :                                         Z_TRY_ADDREF_P(entry);</span></a>
<a name="2198"><span class="lineNum">    2198 </span><span class="lineCov">        339 :                                         zend_hash_add_new(symbol_table, Z_STR(final_name), entry);</span></a>
<a name="2199"><span class="lineNum">    2199 </span>            :                                 }</a>
<a name="2200"><span class="lineNum">    2200 </span><span class="lineCov">        480 :                                 count++;</span></a>
<a name="2201"><span class="lineNum">    2201 </span>            :                         }</a>
<a name="2202"><span class="lineNum">    2202 </span>            :                 }</a>
<a name="2203"><span class="lineNum">    2203 </span>            :                 zval_ptr_dtor_str(&amp;final_name);</a>
<a name="2204"><span class="lineNum">    2204 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="2205"><span class="lineNum">    2205 </span>            : </a>
<a name="2206"><span class="lineNum">    2206 </span><span class="lineCov">         93 :         return count;</span></a>
<a name="2207"><span class="lineNum">    2207 </span>            : }</a>
<a name="2208"><span class="lineNum">    2208 </span>            : /* }}} */</a>
<a name="2209"><span class="lineNum">    2209 </span>            : </a>
<a name="2210"><span class="lineNum">    2210 </span><span class="lineCov">          9 : static zend_long php_extract_ref_prefix_invalid(zend_array *arr, zend_array *symbol_table, zend_string *prefix) /* {{{ */</span></a>
<a name="2211"><span class="lineNum">    2211 </span>            : {</a>
<a name="2212"><span class="lineNum">    2212 </span><span class="lineCov">          9 :         zend_long count = 0;</span></a>
<a name="2213"><span class="lineNum">    2213 </span>            :         zend_string *var_name;</a>
<a name="2214"><span class="lineNum">    2214 </span>            :         zend_ulong num_key;</a>
<a name="2215"><span class="lineNum">    2215 </span>            :         zval *entry, *orig_var, final_name;</a>
<a name="2216"><span class="lineNum">    2216 </span>            : </a>
<a name="2217"><span class="lineNum">    2217 </span><span class="lineCov">         39 :         ZEND_HASH_FOREACH_KEY_VAL(arr, num_key, var_name, entry) {</span></a>
<a name="2218"><span class="lineNum">    2218 </span><span class="lineCov">         15 :                 if (var_name) {</span></a>
<a name="2219"><span class="lineNum">    2219 </span><span class="lineCov">         30 :                         if (!php_valid_var_name(ZSTR_VAL(var_name), ZSTR_LEN(var_name))</span></a>
<a name="2220"><span class="lineNum">    2220 </span><span class="lineCov">         15 :                          || zend_string_equals_literal(var_name, &quot;this&quot;)) {</span></a>
<a name="2221"><span class="lineNum">    2221 </span><span class="lineCov">          3 :                                 php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(var_name), ZSTR_LEN(var_name), 1);</span></a>
<a name="2222"><span class="lineNum">    2222 </span><span class="lineCov">          6 :                                 if (!php_valid_var_name(Z_STRVAL(final_name), Z_STRLEN(final_name))) {</span></a>
<a name="2223"><span class="lineNum">    2223 </span>            :                                         zval_ptr_dtor_str(&amp;final_name);</a>
<a name="2224"><span class="lineNum">    2224 </span><span class="lineNoCov">          0 :                                         continue;</span></a>
<a name="2225"><span class="lineNum">    2225 </span>            :                                 }</a>
<a name="2226"><span class="lineNum">    2226 </span>            :                         } else {</a>
<a name="2227"><span class="lineNum">    2227 </span><span class="lineCov">         24 :                                 ZVAL_STR_COPY(&amp;final_name, var_name);</span></a>
<a name="2228"><span class="lineNum">    2228 </span>            :                         }</a>
<a name="2229"><span class="lineNum">    2229 </span>            :                 } else {</a>
<a name="2230"><span class="lineNum">    2230 </span><span class="lineNoCov">          0 :                         zend_string *str = zend_long_to_str(num_key);</span></a>
<a name="2231"><span class="lineNum">    2231 </span><span class="lineNoCov">          0 :                         php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(str), ZSTR_LEN(str), 1);</span></a>
<a name="2232"><span class="lineNum">    2232 </span>            :                         zend_string_release_ex(str, 0);</a>
<a name="2233"><span class="lineNum">    2233 </span><span class="lineNoCov">          0 :                         if (!php_valid_var_name(Z_STRVAL(final_name), Z_STRLEN(final_name))) {</span></a>
<a name="2234"><span class="lineNum">    2234 </span>            :                                 zval_ptr_dtor_str(&amp;final_name);</a>
<a name="2235"><span class="lineNum">    2235 </span><span class="lineNoCov">          0 :                                 continue;</span></a>
<a name="2236"><span class="lineNum">    2236 </span>            :                         }</a>
<a name="2237"><span class="lineNum">    2237 </span>            :                 }</a>
<a name="2238"><span class="lineNum">    2238 </span><span class="lineCov">         15 :                 if (zend_string_equals_literal(Z_STR(final_name), &quot;this&quot;)) {</span></a>
<a name="2239"><span class="lineNum">    2239 </span><span class="lineNoCov">          0 :                         zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="2240"><span class="lineNum">    2240 </span><span class="lineNoCov">          0 :                         return -1;</span></a>
<a name="2241"><span class="lineNum">    2241 </span>            :                 } else {</a>
<a name="2242"><span class="lineNum">    2242 </span><span class="lineCov">         15 :                         if (Z_ISREF_P(entry)) {</span></a>
<a name="2243"><span class="lineNum">    2243 </span>            :                                 Z_ADDREF_P(entry);</a>
<a name="2244"><span class="lineNum">    2244 </span>            :                         } else {</a>
<a name="2245"><span class="lineNum">    2245 </span><span class="lineCov">         30 :                                 ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="2246"><span class="lineNum">    2246 </span>            :                         }</a>
<a name="2247"><span class="lineNum">    2247 </span><span class="lineCov">         15 :                         if ((orig_var = zend_hash_find(symbol_table, Z_STR(final_name))) != NULL) {</span></a>
<a name="2248"><span class="lineNum">    2248 </span><span class="lineCov">         12 :                                 if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="2249"><span class="lineNum">    2249 </span><span class="lineCov">          9 :                                         orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="2250"><span class="lineNum">    2250 </span>            :                                 }</a>
<a name="2251"><span class="lineNum">    2251 </span><span class="lineCov">         12 :                                 zval_ptr_dtor(orig_var);</span></a>
<a name="2252"><span class="lineNum">    2252 </span><span class="lineCov">         12 :                                 ZVAL_REF(orig_var, Z_REF_P(entry));</span></a>
<a name="2253"><span class="lineNum">    2253 </span>            :                         } else {</a>
<a name="2254"><span class="lineNum">    2254 </span><span class="lineCov">          3 :                                 zend_hash_add_new(symbol_table, Z_STR(final_name), entry);</span></a>
<a name="2255"><span class="lineNum">    2255 </span>            :                         }</a>
<a name="2256"><span class="lineNum">    2256 </span><span class="lineCov">         15 :                         count++;</span></a>
<a name="2257"><span class="lineNum">    2257 </span>            :                 }</a>
<a name="2258"><span class="lineNum">    2258 </span>            :                 zval_ptr_dtor_str(&amp;final_name);</a>
<a name="2259"><span class="lineNum">    2259 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="2260"><span class="lineNum">    2260 </span>            : </a>
<a name="2261"><span class="lineNum">    2261 </span><span class="lineCov">          9 :         return count;</span></a>
<a name="2262"><span class="lineNum">    2262 </span>            : }</a>
<a name="2263"><span class="lineNum">    2263 </span>            : /* }}} */</a>
<a name="2264"><span class="lineNum">    2264 </span>            : </a>
<a name="2265"><span class="lineNum">    2265 </span><span class="lineCov">         42 : static zend_long php_extract_prefix_invalid(zend_array *arr, zend_array *symbol_table, zend_string *prefix) /* {{{ */</span></a>
<a name="2266"><span class="lineNum">    2266 </span>            : {</a>
<a name="2267"><span class="lineNum">    2267 </span><span class="lineCov">         42 :         zend_long count = 0;</span></a>
<a name="2268"><span class="lineNum">    2268 </span>            :         zend_string *var_name;</a>
<a name="2269"><span class="lineNum">    2269 </span>            :         zend_ulong num_key;</a>
<a name="2270"><span class="lineNum">    2270 </span>            :         zval *entry, *orig_var, final_name;</a>
<a name="2271"><span class="lineNum">    2271 </span>            : </a>
<a name="2272"><span class="lineNum">    2272 </span><span class="lineCov">        474 :         ZEND_HASH_FOREACH_KEY_VAL(arr, num_key, var_name, entry) {</span></a>
<a name="2273"><span class="lineNum">    2273 </span><span class="lineCov">        213 :                 if (var_name) {</span></a>
<a name="2274"><span class="lineNum">    2274 </span><span class="lineCov">        120 :                         if (!php_valid_var_name(ZSTR_VAL(var_name), ZSTR_LEN(var_name))</span></a>
<a name="2275"><span class="lineNum">    2275 </span><span class="lineCov">         48 :                          || zend_string_equals_literal(var_name, &quot;this&quot;)) {</span></a>
<a name="2276"><span class="lineNum">    2276 </span><span class="lineCov">         15 :                                 php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(var_name), ZSTR_LEN(var_name), 1);</span></a>
<a name="2277"><span class="lineNum">    2277 </span><span class="lineCov">         30 :                                 if (!php_valid_var_name(Z_STRVAL(final_name), Z_STRLEN(final_name))) {</span></a>
<a name="2278"><span class="lineNum">    2278 </span>            :                                         zval_ptr_dtor_str(&amp;final_name);</a>
<a name="2279"><span class="lineNum">    2279 </span><span class="lineCov">          6 :                                         continue;</span></a>
<a name="2280"><span class="lineNum">    2280 </span>            :                                 }</a>
<a name="2281"><span class="lineNum">    2281 </span>            :                         } else {</a>
<a name="2282"><span class="lineNum">    2282 </span><span class="lineCov">         99 :                                 ZVAL_STR_COPY(&amp;final_name, var_name);</span></a>
<a name="2283"><span class="lineNum">    2283 </span>            :                         }</a>
<a name="2284"><span class="lineNum">    2284 </span>            :                 } else {</a>
<a name="2285"><span class="lineNum">    2285 </span><span class="lineCov">        153 :                         zend_string *str = zend_long_to_str(num_key);</span></a>
<a name="2286"><span class="lineNum">    2286 </span><span class="lineCov">        153 :                         php_prefix_varname(&amp;final_name, prefix, ZSTR_VAL(str), ZSTR_LEN(str), 1);</span></a>
<a name="2287"><span class="lineNum">    2287 </span>            :                         zend_string_release_ex(str, 0);</a>
<a name="2288"><span class="lineNum">    2288 </span><span class="lineCov">        306 :                         if (!php_valid_var_name(Z_STRVAL(final_name), Z_STRLEN(final_name))) {</span></a>
<a name="2289"><span class="lineNum">    2289 </span>            :                                 zval_ptr_dtor_str(&amp;final_name);</a>
<a name="2290"><span class="lineNum">    2290 </span><span class="lineNoCov">          0 :                                 continue;</span></a>
<a name="2291"><span class="lineNum">    2291 </span>            :                         }</a>
<a name="2292"><span class="lineNum">    2292 </span>            :                 }</a>
<a name="2293"><span class="lineNum">    2293 </span><span class="lineCov">        207 :                 if (zend_string_equals_literal(Z_STR(final_name), &quot;this&quot;)) {</span></a>
<a name="2294"><span class="lineNum">    2294 </span><span class="lineNoCov">          0 :                         zend_throw_error(NULL, &quot;Cannot re-assign $this&quot;);</span></a>
<a name="2295"><span class="lineNum">    2295 </span><span class="lineNoCov">          0 :                         return -1;</span></a>
<a name="2296"><span class="lineNum">    2296 </span>            :                 } else {</a>
<a name="2297"><span class="lineNum">    2297 </span><span class="lineCov">        207 :                         ZVAL_DEREF(entry);</span></a>
<a name="2298"><span class="lineNum">    2298 </span><span class="lineCov">        207 :                         if ((orig_var = zend_hash_find(symbol_table, Z_STR(final_name))) != NULL) {</span></a>
<a name="2299"><span class="lineNum">    2299 </span><span class="lineCov">        105 :                                 if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="2300"><span class="lineNum">    2300 </span><span class="lineCov">          9 :                                         orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="2301"><span class="lineNum">    2301 </span>            :                                 }</a>
<a name="2302"><span class="lineNum">    2302 </span><span class="lineCov">        282 :                                 ZEND_TRY_ASSIGN_COPY_EX(orig_var, entry, 0);</span></a>
<a name="2303"><span class="lineNum">    2303 </span><span class="lineCov">        105 :                                 if (UNEXPECTED(EG(exception))) {</span></a>
<a name="2304"><span class="lineNum">    2304 </span><span class="lineNoCov">          0 :                                         zend_string_release_ex(Z_STR(final_name), 0);</span></a>
<a name="2305"><span class="lineNum">    2305 </span><span class="lineNoCov">          0 :                                         return -1;</span></a>
<a name="2306"><span class="lineNum">    2306 </span>            :                                 }</a>
<a name="2307"><span class="lineNum">    2307 </span>            :                         } else {</a>
<a name="2308"><span class="lineNum">    2308 </span><span class="lineCov">        102 :                                 Z_TRY_ADDREF_P(entry);</span></a>
<a name="2309"><span class="lineNum">    2309 </span><span class="lineCov">        102 :                                 zend_hash_add_new(symbol_table, Z_STR(final_name), entry);</span></a>
<a name="2310"><span class="lineNum">    2310 </span>            :                         }</a>
<a name="2311"><span class="lineNum">    2311 </span><span class="lineCov">        207 :                         count++;</span></a>
<a name="2312"><span class="lineNum">    2312 </span>            :                 }</a>
<a name="2313"><span class="lineNum">    2313 </span>            :                 zval_ptr_dtor_str(&amp;final_name);</a>
<a name="2314"><span class="lineNum">    2314 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="2315"><span class="lineNum">    2315 </span>            : </a>
<a name="2316"><span class="lineNum">    2316 </span><span class="lineCov">         42 :         return count;</span></a>
<a name="2317"><span class="lineNum">    2317 </span>            : }</a>
<a name="2318"><span class="lineNum">    2318 </span>            : /* }}} */</a>
<a name="2319"><span class="lineNum">    2319 </span>            : </a>
<a name="2320"><span class="lineNum">    2320 </span><span class="lineCov">          9 : static zend_long php_extract_ref_skip(zend_array *arr, zend_array *symbol_table) /* {{{ */</span></a>
<a name="2321"><span class="lineNum">    2321 </span>            : {</a>
<a name="2322"><span class="lineNum">    2322 </span><span class="lineCov">          9 :         zend_long count = 0;</span></a>
<a name="2323"><span class="lineNum">    2323 </span>            :         zend_string *var_name;</a>
<a name="2324"><span class="lineNum">    2324 </span>            :         zval *entry, *orig_var;</a>
<a name="2325"><span class="lineNum">    2325 </span>            : </a>
<a name="2326"><span class="lineNum">    2326 </span><span class="lineCov">          9 :         if (HT_IS_PACKED(arr)) {</span></a>
<a name="2327"><span class="lineNum">    2327 </span><span class="lineNoCov">          0 :                 return 0;</span></a>
<a name="2328"><span class="lineNum">    2328 </span>            :         }</a>
<a name="2329"><span class="lineNum">    2329 </span><span class="lineCov">         39 :         ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(arr, var_name, entry) {</span></a>
<a name="2330"><span class="lineNum">    2330 </span><span class="lineCov">         15 :                 if (!var_name) {</span></a>
<a name="2331"><span class="lineNum">    2331 </span><span class="lineNoCov">          0 :                         continue;</span></a>
<a name="2332"><span class="lineNum">    2332 </span>            :                 }</a>
<a name="2333"><span class="lineNum">    2333 </span><span class="lineCov">         30 :                 if (!php_valid_var_name(ZSTR_VAL(var_name), ZSTR_LEN(var_name))) {</span></a>
<a name="2334"><span class="lineNum">    2334 </span><span class="lineNoCov">          0 :                         continue;</span></a>
<a name="2335"><span class="lineNum">    2335 </span>            :                 }</a>
<a name="2336"><span class="lineNum">    2336 </span><span class="lineCov">         15 :                 if (zend_string_equals_literal(var_name, &quot;this&quot;)) {</span></a>
<a name="2337"><span class="lineNum">    2337 </span><span class="lineCov">          3 :                         continue;</span></a>
<a name="2338"><span class="lineNum">    2338 </span>            :                 }</a>
<a name="2339"><span class="lineNum">    2339 </span><span class="lineCov">         12 :                 orig_var = zend_hash_find_known_hash(symbol_table, var_name);</span></a>
<a name="2340"><span class="lineNum">    2340 </span><span class="lineCov">         12 :                 if (orig_var) {</span></a>
<a name="2341"><span class="lineNum">    2341 </span><span class="lineCov">          9 :                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="2342"><span class="lineNum">    2342 </span><span class="lineCov">          6 :                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="2343"><span class="lineNum">    2343 </span><span class="lineCov">          6 :                                 if (Z_TYPE_P(orig_var) == IS_UNDEF) {</span></a>
<a name="2344"><span class="lineNum">    2344 </span><span class="lineNoCov">          0 :                                         if (Z_ISREF_P(entry)) {</span></a>
<a name="2345"><span class="lineNum">    2345 </span>            :                                                 Z_ADDREF_P(entry);</a>
<a name="2346"><span class="lineNum">    2346 </span>            :                                         } else {</a>
<a name="2347"><span class="lineNum">    2347 </span><span class="lineNoCov">          0 :                                                 ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="2348"><span class="lineNum">    2348 </span>            :                                         }</a>
<a name="2349"><span class="lineNum">    2349 </span><span class="lineNoCov">          0 :                                         ZVAL_REF(orig_var, Z_REF_P(entry));</span></a>
<a name="2350"><span class="lineNum">    2350 </span><span class="lineNoCov">          0 :                                         count++;</span></a>
<a name="2351"><span class="lineNum">    2351 </span>            :                                 }</a>
<a name="2352"><span class="lineNum">    2352 </span>            :                         }</a>
<a name="2353"><span class="lineNum">    2353 </span>            :                 } else {</a>
<a name="2354"><span class="lineNum">    2354 </span><span class="lineCov">          3 :                         if (Z_ISREF_P(entry)) {</span></a>
<a name="2355"><span class="lineNum">    2355 </span>            :                                 Z_ADDREF_P(entry);</a>
<a name="2356"><span class="lineNum">    2356 </span>            :                         } else {</a>
<a name="2357"><span class="lineNum">    2357 </span><span class="lineCov">          6 :                                 ZVAL_MAKE_REF_EX(entry, 2);</span></a>
<a name="2358"><span class="lineNum">    2358 </span>            :                         }</a>
<a name="2359"><span class="lineNum">    2359 </span><span class="lineCov">          3 :                         zend_hash_add_new(symbol_table, var_name, entry);</span></a>
<a name="2360"><span class="lineNum">    2360 </span><span class="lineCov">          3 :                         count++;</span></a>
<a name="2361"><span class="lineNum">    2361 </span>            :                 }</a>
<a name="2362"><span class="lineNum">    2362 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="2363"><span class="lineNum">    2363 </span>            : </a>
<a name="2364"><span class="lineNum">    2364 </span><span class="lineCov">          9 :         return count;</span></a>
<a name="2365"><span class="lineNum">    2365 </span>            : }</a>
<a name="2366"><span class="lineNum">    2366 </span>            : /* }}} */</a>
<a name="2367"><span class="lineNum">    2367 </span>            : </a>
<a name="2368"><span class="lineNum">    2368 </span><span class="lineCov">         42 : static zend_long php_extract_skip(zend_array *arr, zend_array *symbol_table) /* {{{ */</span></a>
<a name="2369"><span class="lineNum">    2369 </span>            : {</a>
<a name="2370"><span class="lineNum">    2370 </span><span class="lineCov">         42 :         zend_long count = 0;</span></a>
<a name="2371"><span class="lineNum">    2371 </span>            :         zend_string *var_name;</a>
<a name="2372"><span class="lineNum">    2372 </span>            :         zval *entry, *orig_var;</a>
<a name="2373"><span class="lineNum">    2373 </span>            : </a>
<a name="2374"><span class="lineNum">    2374 </span><span class="lineCov">         42 :         if (HT_IS_PACKED(arr)) {</span></a>
<a name="2375"><span class="lineNum">    2375 </span><span class="lineCov">         21 :                 return 0;</span></a>
<a name="2376"><span class="lineNum">    2376 </span>            :         }</a>
<a name="2377"><span class="lineNum">    2377 </span><span class="lineCov">        213 :         ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(arr, var_name, entry) {</span></a>
<a name="2378"><span class="lineNum">    2378 </span><span class="lineCov">         96 :                 if (!var_name) {</span></a>
<a name="2379"><span class="lineNum">    2379 </span><span class="lineCov">         36 :                         continue;</span></a>
<a name="2380"><span class="lineNum">    2380 </span>            :                 }</a>
<a name="2381"><span class="lineNum">    2381 </span><span class="lineCov">        120 :                 if (!php_valid_var_name(ZSTR_VAL(var_name), ZSTR_LEN(var_name))) {</span></a>
<a name="2382"><span class="lineNum">    2382 </span><span class="lineCov">         12 :                         continue;</span></a>
<a name="2383"><span class="lineNum">    2383 </span>            :                 }</a>
<a name="2384"><span class="lineNum">    2384 </span><span class="lineCov">         48 :                 if (zend_string_equals_literal(var_name, &quot;this&quot;)) {</span></a>
<a name="2385"><span class="lineNum">    2385 </span><span class="lineCov">          3 :                         continue;</span></a>
<a name="2386"><span class="lineNum">    2386 </span>            :                 }</a>
<a name="2387"><span class="lineNum">    2387 </span><span class="lineCov">         45 :                 orig_var = zend_hash_find_known_hash(symbol_table, var_name);</span></a>
<a name="2388"><span class="lineNum">    2388 </span><span class="lineCov">         45 :                 if (orig_var) {</span></a>
<a name="2389"><span class="lineNum">    2389 </span><span class="lineCov">         42 :                         if (Z_TYPE_P(orig_var) == IS_INDIRECT) {</span></a>
<a name="2390"><span class="lineNum">    2390 </span><span class="lineCov">          6 :                                 orig_var = Z_INDIRECT_P(orig_var);</span></a>
<a name="2391"><span class="lineNum">    2391 </span><span class="lineCov">          6 :                                 if (Z_TYPE_P(orig_var) == IS_UNDEF) {</span></a>
<a name="2392"><span class="lineNum">    2392 </span><span class="lineNoCov">          0 :                                         ZVAL_COPY_DEREF(orig_var, entry);</span></a>
<a name="2393"><span class="lineNum">    2393 </span><span class="lineNoCov">          0 :                                         count++;</span></a>
<a name="2394"><span class="lineNum">    2394 </span>            :                                 }</a>
<a name="2395"><span class="lineNum">    2395 </span>            :                         }</a>
<a name="2396"><span class="lineNum">    2396 </span>            :                 } else {</a>
<a name="2397"><span class="lineNum">    2397 </span><span class="lineCov">          3 :                         ZVAL_DEREF(entry);</span></a>
<a name="2398"><span class="lineNum">    2398 </span><span class="lineCov">          3 :                         Z_TRY_ADDREF_P(entry);</span></a>
<a name="2399"><span class="lineNum">    2399 </span><span class="lineCov">          3 :                         zend_hash_add_new(symbol_table, var_name, entry);</span></a>
<a name="2400"><span class="lineNum">    2400 </span><span class="lineCov">          3 :                         count++;</span></a>
<a name="2401"><span class="lineNum">    2401 </span>            :                 }</a>
<a name="2402"><span class="lineNum">    2402 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="2403"><span class="lineNum">    2403 </span>            : </a>
<a name="2404"><span class="lineNum">    2404 </span><span class="lineCov">         21 :         return count;</span></a>
<a name="2405"><span class="lineNum">    2405 </span>            : }</a>
<a name="2406"><span class="lineNum">    2406 </span>            : /* }}} */</a>
<a name="2407"><span class="lineNum">    2407 </span>            : </a>
<a name="2408"><span class="lineNum">    2408 </span>            : /* {{{ Imports variables into symbol table from an array */</a>
<a name="2409"><span class="lineNum">    2409 </span><span class="lineCov">        615 : PHP_FUNCTION(extract)</span></a>
<a name="2410"><span class="lineNum">    2410 </span>            : {</a>
<a name="2411"><span class="lineNum">    2411 </span>            :         zval *var_array_param;</a>
<a name="2412"><span class="lineNum">    2412 </span>            :         zend_long extract_refs;</a>
<a name="2413"><span class="lineNum">    2413 </span><span class="lineCov">        615 :         zend_long extract_type = EXTR_OVERWRITE;</span></a>
<a name="2414"><span class="lineNum">    2414 </span><span class="lineCov">        615 :         zend_string *prefix = NULL;</span></a>
<a name="2415"><span class="lineNum">    2415 </span>            :         zend_long count;</a>
<a name="2416"><span class="lineNum">    2416 </span>            :         zend_array *symbol_table;</a>
<a name="2417"><span class="lineNum">    2417 </span>            : </a>
<a name="2418"><span class="lineNum">    2418 </span><span class="lineCov">        615 :         ZEND_PARSE_PARAMETERS_START(1, 3)</span></a>
<a name="2419"><span class="lineNum">    2419 </span><span class="lineCov">       1737 :                 Z_PARAM_ARRAY_EX2(var_array_param, 0, 1, 0)</span></a>
<a name="2420"><span class="lineNum">    2420 </span><span class="lineCov">        561 :                 Z_PARAM_OPTIONAL</span></a>
<a name="2421"><span class="lineNum">    2421 </span><span class="lineCov">       1035 :                 Z_PARAM_LONG(extract_type)</span></a>
<a name="2422"><span class="lineNum">    2422 </span><span class="lineCov">        795 :                 Z_PARAM_STR(prefix)</span></a>
<a name="2423"><span class="lineNum">    2423 </span><span class="lineCov">        615 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="2424"><span class="lineNum">    2424 </span>            : </a>
<a name="2425"><span class="lineNum">    2425 </span><span class="lineCov">        561 :         extract_refs = (extract_type &amp; EXTR_REFS);</span></a>
<a name="2426"><span class="lineNum">    2426 </span><span class="lineCov">        561 :         if (extract_refs) {</span></a>
<a name="2427"><span class="lineNum">    2427 </span><span class="lineCov">        228 :                 SEPARATE_ARRAY(var_array_param);</span></a>
<a name="2428"><span class="lineNum">    2428 </span>            :         }</a>
<a name="2429"><span class="lineNum">    2429 </span><span class="lineCov">        561 :         extract_type &amp;= 0xff;</span></a>
<a name="2430"><span class="lineNum">    2430 </span>            : </a>
<a name="2431"><span class="lineNum">    2431 </span><span class="lineCov">        561 :         if (extract_type &lt; EXTR_OVERWRITE || extract_type &gt; EXTR_IF_EXISTS) {</span></a>
<a name="2432"><span class="lineNum">    2432 </span><span class="lineCov">          6 :                 zend_argument_value_error(2, &quot;must be a valid extract type&quot;);</span></a>
<a name="2433"><span class="lineNum">    2433 </span><span class="lineCov">          6 :                 RETURN_THROWS();</span></a>
<a name="2434"><span class="lineNum">    2434 </span>            :         }</a>
<a name="2435"><span class="lineNum">    2435 </span>            : </a>
<a name="2436"><span class="lineNum">    2436 </span><span class="lineCov">        555 :         if (extract_type &gt; EXTR_SKIP &amp;&amp; extract_type &lt;= EXTR_PREFIX_IF_EXISTS &amp;&amp; ZEND_NUM_ARGS() &lt; 3) {</span></a>
<a name="2437"><span class="lineNum">    2437 </span><span class="lineCov">          3 :                 zend_argument_value_error(3, &quot;is required when using this extract type&quot;);</span></a>
<a name="2438"><span class="lineNum">    2438 </span><span class="lineCov">          3 :                 RETURN_THROWS();</span></a>
<a name="2439"><span class="lineNum">    2439 </span>            :         }</a>
<a name="2440"><span class="lineNum">    2440 </span>            : </a>
<a name="2441"><span class="lineNum">    2441 </span><span class="lineCov">        552 :         if (prefix) {</span></a>
<a name="2442"><span class="lineNum">    2442 </span><span class="lineCov">        561 :                 if (ZSTR_LEN(prefix) &amp;&amp; !php_valid_var_name(ZSTR_VAL(prefix), ZSTR_LEN(prefix))) {</span></a>
<a name="2443"><span class="lineNum">    2443 </span><span class="lineCov">          3 :                         zend_argument_value_error(3, &quot;must be a valid identifier&quot;);</span></a>
<a name="2444"><span class="lineNum">    2444 </span><span class="lineCov">          3 :                         RETURN_THROWS();</span></a>
<a name="2445"><span class="lineNum">    2445 </span>            :                 }</a>
<a name="2446"><span class="lineNum">    2446 </span>            :         }</a>
<a name="2447"><span class="lineNum">    2447 </span>            : </a>
<a name="2448"><span class="lineNum">    2448 </span><span class="lineCov">        549 :         if (zend_forbid_dynamic_call() == FAILURE) {</span></a>
<a name="2449"><span class="lineNum">    2449 </span><span class="lineCov">         18 :                 return;</span></a>
<a name="2450"><span class="lineNum">    2450 </span>            :         }</a>
<a name="2451"><span class="lineNum">    2451 </span>            : </a>
<a name="2452"><span class="lineNum">    2452 </span><span class="lineCov">        531 :         symbol_table = zend_rebuild_symbol_table();</span></a>
<a name="2453"><span class="lineNum">    2453 </span><span class="lineCov">        531 :         ZEND_ASSERT(symbol_table &amp;&amp; &quot;A symbol table should always be available here&quot;);</span></a>
<a name="2454"><span class="lineNum">    2454 </span>            : </a>
<a name="2455"><span class="lineNum">    2455 </span><span class="lineCov">        531 :         if (extract_refs) {</span></a>
<a name="2456"><span class="lineNum">    2456 </span><span class="lineCov">        111 :                 switch (extract_type) {</span></a>
<a name="2457"><span class="lineNum">    2457 </span><span class="lineCov">          9 :                         case EXTR_IF_EXISTS:</span></a>
<a name="2458"><span class="lineNum">    2458 </span><span class="lineCov">          9 :                                 count = php_extract_ref_if_exists(Z_ARRVAL_P(var_array_param), symbol_table);</span></a>
<a name="2459"><span class="lineNum">    2459 </span><span class="lineCov">          9 :                                 break;</span></a>
<a name="2460"><span class="lineNum">    2460 </span><span class="lineCov">         57 :                         case EXTR_OVERWRITE:</span></a>
<a name="2461"><span class="lineNum">    2461 </span><span class="lineCov">         57 :                                 count = php_extract_ref_overwrite(Z_ARRVAL_P(var_array_param), symbol_table);</span></a>
<a name="2462"><span class="lineNum">    2462 </span><span class="lineCov">         57 :                                 break;</span></a>
<a name="2463"><span class="lineNum">    2463 </span><span class="lineCov">          9 :                         case EXTR_PREFIX_IF_EXISTS:</span></a>
<a name="2464"><span class="lineNum">    2464 </span><span class="lineCov">          9 :                                 count = php_extract_ref_prefix_if_exists(Z_ARRVAL_P(var_array_param), symbol_table, prefix);</span></a>
<a name="2465"><span class="lineNum">    2465 </span><span class="lineCov">          9 :                                 break;</span></a>
<a name="2466"><span class="lineNum">    2466 </span><span class="lineCov">          9 :                         case EXTR_PREFIX_SAME:</span></a>
<a name="2467"><span class="lineNum">    2467 </span><span class="lineCov">          9 :                                 count = php_extract_ref_prefix_same(Z_ARRVAL_P(var_array_param), symbol_table, prefix);</span></a>
<a name="2468"><span class="lineNum">    2468 </span><span class="lineCov">          9 :                                 break;</span></a>
<a name="2469"><span class="lineNum">    2469 </span><span class="lineCov">          9 :                         case EXTR_PREFIX_ALL:</span></a>
<a name="2470"><span class="lineNum">    2470 </span><span class="lineCov">          9 :                                 count = php_extract_ref_prefix_all(Z_ARRVAL_P(var_array_param), symbol_table, prefix);</span></a>
<a name="2471"><span class="lineNum">    2471 </span><span class="lineCov">          9 :                                 break;</span></a>
<a name="2472"><span class="lineNum">    2472 </span><span class="lineCov">          9 :                         case EXTR_PREFIX_INVALID:</span></a>
<a name="2473"><span class="lineNum">    2473 </span><span class="lineCov">          9 :                                 count = php_extract_ref_prefix_invalid(Z_ARRVAL_P(var_array_param), symbol_table, prefix);</span></a>
<a name="2474"><span class="lineNum">    2474 </span><span class="lineCov">          9 :                                 break;</span></a>
<a name="2475"><span class="lineNum">    2475 </span><span class="lineCov">          9 :                         default:</span></a>
<a name="2476"><span class="lineNum">    2476 </span><span class="lineCov">          9 :                                 count = php_extract_ref_skip(Z_ARRVAL_P(var_array_param), symbol_table);</span></a>
<a name="2477"><span class="lineNum">    2477 </span><span class="lineCov">          9 :                                 break;</span></a>
<a name="2478"><span class="lineNum">    2478 </span>            :                 }</a>
<a name="2479"><span class="lineNum">    2479 </span>            :         } else {</a>
<a name="2480"><span class="lineNum">    2480 </span>            :                 /* The array might be stored in a local variable that will be overwritten */</a>
<a name="2481"><span class="lineNum">    2481 </span>            :                 zval array_copy;</a>
<a name="2482"><span class="lineNum">    2482 </span><span class="lineCov">        420 :                 ZVAL_COPY(&amp;array_copy, var_array_param);</span></a>
<a name="2483"><span class="lineNum">    2483 </span><span class="lineCov">        420 :                 switch (extract_type) {</span></a>
<a name="2484"><span class="lineNum">    2484 </span><span class="lineCov">         42 :                         case EXTR_IF_EXISTS:</span></a>
<a name="2485"><span class="lineNum">    2485 </span><span class="lineCov">         42 :                                 count = php_extract_if_exists(Z_ARRVAL(array_copy), symbol_table);</span></a>
<a name="2486"><span class="lineNum">    2486 </span><span class="lineCov">         42 :                                 break;</span></a>
<a name="2487"><span class="lineNum">    2487 </span><span class="lineCov">        111 :                         case EXTR_OVERWRITE:</span></a>
<a name="2488"><span class="lineNum">    2488 </span><span class="lineCov">        111 :                                 count = php_extract_overwrite(Z_ARRVAL(array_copy), symbol_table);</span></a>
<a name="2489"><span class="lineNum">    2489 </span><span class="lineCov">        111 :                                 break;</span></a>
<a name="2490"><span class="lineNum">    2490 </span><span class="lineCov">         42 :                         case EXTR_PREFIX_IF_EXISTS:</span></a>
<a name="2491"><span class="lineNum">    2491 </span><span class="lineCov">         42 :                                 count = php_extract_prefix_if_exists(Z_ARRVAL(array_copy), symbol_table, prefix);</span></a>
<a name="2492"><span class="lineNum">    2492 </span><span class="lineCov">         42 :                                 break;</span></a>
<a name="2493"><span class="lineNum">    2493 </span><span class="lineCov">         48 :                         case EXTR_PREFIX_SAME:</span></a>
<a name="2494"><span class="lineNum">    2494 </span><span class="lineCov">         48 :                                 count = php_extract_prefix_same(Z_ARRVAL(array_copy), symbol_table, prefix);</span></a>
<a name="2495"><span class="lineNum">    2495 </span><span class="lineCov">         48 :                                 break;</span></a>
<a name="2496"><span class="lineNum">    2496 </span><span class="lineCov">         93 :                         case EXTR_PREFIX_ALL:</span></a>
<a name="2497"><span class="lineNum">    2497 </span><span class="lineCov">         93 :                                 count = php_extract_prefix_all(Z_ARRVAL(array_copy), symbol_table, prefix);</span></a>
<a name="2498"><span class="lineNum">    2498 </span><span class="lineCov">         93 :                                 break;</span></a>
<a name="2499"><span class="lineNum">    2499 </span><span class="lineCov">         42 :                         case EXTR_PREFIX_INVALID:</span></a>
<a name="2500"><span class="lineNum">    2500 </span><span class="lineCov">         42 :                                 count = php_extract_prefix_invalid(Z_ARRVAL(array_copy), symbol_table, prefix);</span></a>
<a name="2501"><span class="lineNum">    2501 </span><span class="lineCov">         42 :                                 break;</span></a>
<a name="2502"><span class="lineNum">    2502 </span><span class="lineCov">         42 :                         default:</span></a>
<a name="2503"><span class="lineNum">    2503 </span><span class="lineCov">         42 :                                 count = php_extract_skip(Z_ARRVAL(array_copy), symbol_table);</span></a>
<a name="2504"><span class="lineNum">    2504 </span><span class="lineCov">         42 :                                 break;</span></a>
<a name="2505"><span class="lineNum">    2505 </span>            :                 }</a>
<a name="2506"><span class="lineNum">    2506 </span><span class="lineCov">        420 :                 zval_ptr_dtor(&amp;array_copy);</span></a>
<a name="2507"><span class="lineNum">    2507 </span>            :         }</a>
<a name="2508"><span class="lineNum">    2508 </span>            : </a>
<a name="2509"><span class="lineNum">    2509 </span><span class="lineCov">        531 :         RETURN_LONG(count);</span></a>
<a name="2510"><span class="lineNum">    2510 </span>            : }</a>
<a name="2511"><span class="lineNum">    2511 </span>            : /* }}} */</a>
<a name="2512"><span class="lineNum">    2512 </span>            : </a>
<a name="2513"><span class="lineNum">    2513 </span><span class="lineCov">        180 : static void php_compact_var(HashTable *eg_active_symbol_table, zval *return_value, zval *entry, uint32_t pos) /* {{{ */</span></a>
<a name="2514"><span class="lineNum">    2514 </span>            : {</a>
<a name="2515"><span class="lineNum">    2515 </span>            :         zval *value_ptr, data;</a>
<a name="2516"><span class="lineNum">    2516 </span>            : </a>
<a name="2517"><span class="lineNum">    2517 </span><span class="lineCov">        180 :         ZVAL_DEREF(entry);</span></a>
<a name="2518"><span class="lineNum">    2518 </span><span class="lineCov">        180 :         if (Z_TYPE_P(entry) == IS_STRING) {</span></a>
<a name="2519"><span class="lineNum">    2519 </span><span class="lineCov">        246 :                 if ((value_ptr = zend_hash_find_ind(eg_active_symbol_table, Z_STR_P(entry))) != NULL) {</span></a>
<a name="2520"><span class="lineNum">    2520 </span><span class="lineCov">         90 :                         ZVAL_DEREF(value_ptr);</span></a>
<a name="2521"><span class="lineNum">    2521 </span><span class="lineCov">         90 :                         Z_TRY_ADDREF_P(value_ptr);</span></a>
<a name="2522"><span class="lineNum">    2522 </span><span class="lineCov">         90 :                         zend_hash_update(Z_ARRVAL_P(return_value), Z_STR_P(entry), value_ptr);</span></a>
<a name="2523"><span class="lineNum">    2523 </span><span class="lineCov">         51 :                 } else if (zend_string_equals_literal(Z_STR_P(entry), &quot;this&quot;)) {</span></a>
<a name="2524"><span class="lineNum">    2524 </span><span class="lineCov">         18 :                         zend_object *object = zend_get_this_object(EG(current_execute_data));</span></a>
<a name="2525"><span class="lineNum">    2525 </span><span class="lineCov">         18 :                         if (object) {</span></a>
<a name="2526"><span class="lineNum">    2526 </span><span class="lineCov">          9 :                                 ZVAL_OBJ_COPY(&amp;data, object);</span></a>
<a name="2527"><span class="lineNum">    2527 </span><span class="lineCov">          9 :                                 zend_hash_update(Z_ARRVAL_P(return_value), Z_STR_P(entry), &amp;data);</span></a>
<a name="2528"><span class="lineNum">    2528 </span>            :                         }</a>
<a name="2529"><span class="lineNum">    2529 </span>            :                 } else {</a>
<a name="2530"><span class="lineNum">    2530 </span><span class="lineCov">         15 :                         php_error_docref(NULL, E_WARNING, &quot;Undefined variable $%s&quot;, ZSTR_VAL(Z_STR_P(entry)));</span></a>
<a name="2531"><span class="lineNum">    2531 </span>            :                 }</a>
<a name="2532"><span class="lineNum">    2532 </span><span class="lineCov">         57 :         } else if (Z_TYPE_P(entry) == IS_ARRAY) {</span></a>
<a name="2533"><span class="lineNum">    2533 </span><span class="lineCov">         51 :             if (Z_REFCOUNTED_P(entry)) {</span></a>
<a name="2534"><span class="lineNum">    2534 </span><span class="lineCov">        102 :                         if (Z_IS_RECURSIVE_P(entry)) {</span></a>
<a name="2535"><span class="lineNum">    2535 </span><span class="lineCov">          9 :                                 zend_throw_error(NULL, &quot;Recursion detected&quot;);</span></a>
<a name="2536"><span class="lineNum">    2536 </span><span class="lineCov">         15 :                                 return;</span></a>
<a name="2537"><span class="lineNum">    2537 </span>            :                         }</a>
<a name="2538"><span class="lineNum">    2538 </span><span class="lineCov">         42 :                         Z_PROTECT_RECURSION_P(entry);</span></a>
<a name="2539"><span class="lineNum">    2539 </span>            :                 }</a>
<a name="2540"><span class="lineNum">    2540 </span><span class="lineCov">        204 :                 ZEND_HASH_FOREACH_VAL(Z_ARRVAL_P(entry), value_ptr) {</span></a>
<a name="2541"><span class="lineNum">    2541 </span><span class="lineCov">         81 :                         php_compact_var(eg_active_symbol_table, return_value, value_ptr, pos);</span></a>
<a name="2542"><span class="lineNum">    2542 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="2543"><span class="lineNum">    2543 </span><span class="lineCov">         42 :             if (Z_REFCOUNTED_P(entry)) {</span></a>
<a name="2544"><span class="lineNum">    2544 </span><span class="lineCov">         42 :                         Z_UNPROTECT_RECURSION_P(entry);</span></a>
<a name="2545"><span class="lineNum">    2545 </span>            :                 }</a>
<a name="2546"><span class="lineNum">    2546 </span>            :         } else {</a>
<a name="2547"><span class="lineNum">    2547 </span><span class="lineCov">          6 :                 php_error_docref(NULL, E_WARNING, &quot;Argument #%d must be string or array of strings, %s given&quot;, pos, zend_zval_type_name(entry));</span></a>
<a name="2548"><span class="lineNum">    2548 </span><span class="lineCov">          6 :                 return;</span></a>
<a name="2549"><span class="lineNum">    2549 </span>            :         }</a>
<a name="2550"><span class="lineNum">    2550 </span>            : }</a>
<a name="2551"><span class="lineNum">    2551 </span>            : /* }}} */</a>
<a name="2552"><span class="lineNum">    2552 </span>            : </a>
<a name="2553"><span class="lineNum">    2553 </span>            : /* {{{ Creates a hash containing variables and their values */</a>
<a name="2554"><span class="lineNum">    2554 </span><span class="lineCov">        126 : PHP_FUNCTION(compact)</span></a>
<a name="2555"><span class="lineNum">    2555 </span>            : {</a>
<a name="2556"><span class="lineNum">    2556 </span><span class="lineCov">        126 :         zval *args = NULL;      /* function arguments array */</span></a>
<a name="2557"><span class="lineNum">    2557 </span>            :         uint32_t num_args, i;</a>
<a name="2558"><span class="lineNum">    2558 </span>            :         zend_array *symbol_table;</a>
<a name="2559"><span class="lineNum">    2559 </span>            : </a>
<a name="2560"><span class="lineNum">    2560 </span><span class="lineCov">        126 :         ZEND_PARSE_PARAMETERS_START(1, -1)</span></a>
<a name="2561"><span class="lineNum">    2561 </span><span class="lineCov">        120 :                 Z_PARAM_VARIADIC('+', args, num_args)</span></a>
<a name="2562"><span class="lineNum">    2562 </span><span class="lineCov">        126 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="2563"><span class="lineNum">    2563 </span>            : </a>
<a name="2564"><span class="lineNum">    2564 </span><span class="lineCov">        120 :         if (zend_forbid_dynamic_call() == FAILURE) {</span></a>
<a name="2565"><span class="lineNum">    2565 </span><span class="lineCov">         54 :                 return;</span></a>
<a name="2566"><span class="lineNum">    2566 </span>            :         }</a>
<a name="2567"><span class="lineNum">    2567 </span>            : </a>
<a name="2568"><span class="lineNum">    2568 </span><span class="lineCov">         66 :         symbol_table = zend_rebuild_symbol_table();</span></a>
<a name="2569"><span class="lineNum">    2569 </span><span class="lineCov">         66 :         ZEND_ASSERT(symbol_table &amp;&amp; &quot;A symbol table should always be available here&quot;);</span></a>
<a name="2570"><span class="lineNum">    2570 </span>            : </a>
<a name="2571"><span class="lineNum">    2571 </span>            :         /* compact() is probably most used with a single array of var_names</a>
<a name="2572"><span class="lineNum">    2572 </span>            :            or multiple string names, rather than a combination of both.</a>
<a name="2573"><span class="lineNum">    2573 </span>            :            So quickly guess a minimum result size based on that */</a>
<a name="2574"><span class="lineNum">    2574 </span><span class="lineCov">        132 :         if (num_args &amp;&amp; Z_TYPE(args[0]) == IS_ARRAY) {</span></a>
<a name="2575"><span class="lineNum">    2575 </span><span class="lineCov">         24 :                 array_init_size(return_value, zend_hash_num_elements(Z_ARRVAL(args[0])));</span></a>
<a name="2576"><span class="lineNum">    2576 </span>            :         } else {</a>
<a name="2577"><span class="lineNum">    2577 </span><span class="lineCov">         42 :                 array_init_size(return_value, num_args);</span></a>
<a name="2578"><span class="lineNum">    2578 </span>            :         }</a>
<a name="2579"><span class="lineNum">    2579 </span>            : </a>
<a name="2580"><span class="lineNum">    2580 </span><span class="lineCov">        165 :         for (i = 0; i &lt; num_args; i++) {</span></a>
<a name="2581"><span class="lineNum">    2581 </span><span class="lineCov">         99 :                 php_compact_var(symbol_table, return_value, &amp;args[i], i + 1);</span></a>
<a name="2582"><span class="lineNum">    2582 </span>            :         }</a>
<a name="2583"><span class="lineNum">    2583 </span>            : }</a>
<a name="2584"><span class="lineNum">    2584 </span>            : /* }}} */</a>
<a name="2585"><span class="lineNum">    2585 </span>            : </a>
<a name="2586"><span class="lineNum">    2586 </span>            : /* {{{ Create an array containing num elements starting with index start_key each initialized to val */</a>
<a name="2587"><span class="lineNum">    2587 </span><span class="lineCov">        426 : PHP_FUNCTION(array_fill)</span></a>
<a name="2588"><span class="lineNum">    2588 </span>            : {</a>
<a name="2589"><span class="lineNum">    2589 </span>            :         zval *val;</a>
<a name="2590"><span class="lineNum">    2590 </span>            :         zend_long start_key, num;</a>
<a name="2591"><span class="lineNum">    2591 </span>            : </a>
<a name="2592"><span class="lineNum">    2592 </span><span class="lineCov">        426 :         ZEND_PARSE_PARAMETERS_START(3, 3)</span></a>
<a name="2593"><span class="lineNum">    2593 </span><span class="lineCov">        756 :                 Z_PARAM_LONG(start_key)</span></a>
<a name="2594"><span class="lineNum">    2594 </span><span class="lineCov">        750 :                 Z_PARAM_LONG(num)</span></a>
<a name="2595"><span class="lineNum">    2595 </span><span class="lineCov">        375 :                 Z_PARAM_ZVAL(val)</span></a>
<a name="2596"><span class="lineNum">    2596 </span><span class="lineCov">        426 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="2597"><span class="lineNum">    2597 </span>            : </a>
<a name="2598"><span class="lineNum">    2598 </span><span class="lineCov">        375 :         if (EXPECTED(num &gt; 0)) {</span></a>
<a name="2599"><span class="lineNum">    2599 </span><span class="lineCov">        315 :                 if (sizeof(num) &gt; 4 &amp;&amp; UNEXPECTED(EXPECTED(num &gt; 0x7fffffff))) {</span></a>
<a name="2600"><span class="lineNum">    2600 </span><span class="lineNoCov">          0 :                         zend_argument_value_error(2, &quot;is too large&quot;);</span></a>
<a name="2601"><span class="lineNum">    2601 </span><span class="lineNoCov">          0 :                         RETURN_THROWS();</span></a>
<a name="2602"><span class="lineNum">    2602 </span><span class="lineCov">        315 :                 } else if (UNEXPECTED(start_key &gt; ZEND_LONG_MAX - num + 1)) {</span></a>
<a name="2603"><span class="lineNum">    2603 </span><span class="lineCov">          3 :                         zend_throw_error(NULL, &quot;Cannot add element to the array as the next element is already occupied&quot;);</span></a>
<a name="2604"><span class="lineNum">    2604 </span><span class="lineCov">          3 :                         RETURN_THROWS();</span></a>
<a name="2605"><span class="lineNum">    2605 </span><span class="lineCov">        567 :                 } else if (EXPECTED(start_key &gt;= 0) &amp;&amp; EXPECTED(start_key &lt; num)) {</span></a>
<a name="2606"><span class="lineNum">    2606 </span>            :                         /* create packed array */</a>
<a name="2607"><span class="lineNum">    2607 </span>            :                         zval *zv;</a>
<a name="2608"><span class="lineNum">    2608 </span>            : </a>
<a name="2609"><span class="lineNum">    2609 </span><span class="lineCov">        255 :                         array_init_size(return_value, (uint32_t)(start_key + num));</span></a>
<a name="2610"><span class="lineNum">    2610 </span><span class="lineCov">        255 :                         zend_hash_real_init_packed(Z_ARRVAL_P(return_value));</span></a>
<a name="2611"><span class="lineNum">    2611 </span><span class="lineCov">        255 :                         Z_ARRVAL_P(return_value)-&gt;nNumUsed = (uint32_t)(start_key + num);</span></a>
<a name="2612"><span class="lineNum">    2612 </span><span class="lineCov">        255 :                         Z_ARRVAL_P(return_value)-&gt;nNumOfElements = (uint32_t)num;</span></a>
<a name="2613"><span class="lineNum">    2613 </span><span class="lineCov">        255 :                         Z_ARRVAL_P(return_value)-&gt;nNextFreeElement = (zend_long)(start_key + num);</span></a>
<a name="2614"><span class="lineNum">    2614 </span>            : </a>
<a name="2615"><span class="lineNum">    2615 </span><span class="lineCov">        255 :                         if (Z_REFCOUNTED_P(val)) {</span></a>
<a name="2616"><span class="lineNum">    2616 </span><span class="lineCov">         99 :                                 GC_ADDREF_EX(Z_COUNTED_P(val), (uint32_t)num);</span></a>
<a name="2617"><span class="lineNum">    2617 </span>            :                         }</a>
<a name="2618"><span class="lineNum">    2618 </span>            : </a>
<a name="2619"><span class="lineNum">    2619 </span><span class="lineCov">        255 :                         zv = Z_ARRVAL_P(return_value)-&gt;arPacked;</span></a>
<a name="2620"><span class="lineNum">    2620 </span>            : </a>
<a name="2621"><span class="lineNum">    2621 </span><span class="lineCov">        273 :                         while (start_key--) {</span></a>
<a name="2622"><span class="lineNum">    2622 </span><span class="lineCov">         18 :                                 ZVAL_UNDEF(zv);</span></a>
<a name="2623"><span class="lineNum">    2623 </span><span class="lineCov">         18 :                                 zv++;</span></a>
<a name="2624"><span class="lineNum">    2624 </span>            :                         }</a>
<a name="2625"><span class="lineNum">    2625 </span><span class="lineCov">    1356940 :                         while (num--) {</span></a>
<a name="2626"><span class="lineNum">    2626 </span><span class="lineCov">    1356690 :                                 ZVAL_COPY_VALUE(zv, val);</span></a>
<a name="2627"><span class="lineNum">    2627 </span><span class="lineCov">    1356690 :                                 zv++;</span></a>
<a name="2628"><span class="lineNum">    2628 </span>            :                         }</a>
<a name="2629"><span class="lineNum">    2629 </span>            :                 } else {</a>
<a name="2630"><span class="lineNum">    2630 </span>            :                         /* create hash */</a>
<a name="2631"><span class="lineNum">    2631 </span><span class="lineCov">         57 :                         array_init_size(return_value, (uint32_t)num);</span></a>
<a name="2632"><span class="lineNum">    2632 </span><span class="lineCov">         57 :                         zend_hash_real_init_mixed(Z_ARRVAL_P(return_value));</span></a>
<a name="2633"><span class="lineNum">    2633 </span><span class="lineCov">         57 :                         if (Z_REFCOUNTED_P(val)) {</span></a>
<a name="2634"><span class="lineNum">    2634 </span><span class="lineNoCov">          0 :                                 GC_ADDREF_EX(Z_COUNTED_P(val), (uint32_t)num);</span></a>
<a name="2635"><span class="lineNum">    2635 </span>            :                         }</a>
<a name="2636"><span class="lineNum">    2636 </span><span class="lineCov">         57 :                         zend_hash_index_add_new(Z_ARRVAL_P(return_value), start_key, val);</span></a>
<a name="2637"><span class="lineNum">    2637 </span><span class="lineCov">         81 :                         while (--num) {</span></a>
<a name="2638"><span class="lineNum">    2638 </span><span class="lineCov">         24 :                                 zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), val);</span></a>
<a name="2639"><span class="lineNum">    2639 </span><span class="lineCov">         24 :                                 start_key++;</span></a>
<a name="2640"><span class="lineNum">    2640 </span>            :                         }</a>
<a name="2641"><span class="lineNum">    2641 </span>            :                 }</a>
<a name="2642"><span class="lineNum">    2642 </span><span class="lineCov">         60 :         } else if (EXPECTED(num == 0)) {</span></a>
<a name="2643"><span class="lineNum">    2643 </span><span class="lineCov">         57 :                 RETURN_EMPTY_ARRAY();</span></a>
<a name="2644"><span class="lineNum">    2644 </span>            :         } else {</a>
<a name="2645"><span class="lineNum">    2645 </span><span class="lineCov">          3 :                 zend_argument_value_error(2, &quot;must be greater than or equal to 0&quot;);</span></a>
<a name="2646"><span class="lineNum">    2646 </span><span class="lineCov">          3 :                 RETURN_THROWS();</span></a>
<a name="2647"><span class="lineNum">    2647 </span>            :         }</a>
<a name="2648"><span class="lineNum">    2648 </span>            : }</a>
<a name="2649"><span class="lineNum">    2649 </span>            : /* }}} */</a>
<a name="2650"><span class="lineNum">    2650 </span>            : </a>
<a name="2651"><span class="lineNum">    2651 </span>            : /* {{{ Create an array using the elements of the first parameter as keys each initialized to val */</a>
<a name="2652"><span class="lineNum">    2652 </span><span class="lineCov">        108 : PHP_FUNCTION(array_fill_keys)</span></a>
<a name="2653"><span class="lineNum">    2653 </span>            : {</a>
<a name="2654"><span class="lineNum">    2654 </span>            :         zval *keys, *val, *entry;</a>
<a name="2655"><span class="lineNum">    2655 </span>            : </a>
<a name="2656"><span class="lineNum">    2656 </span><span class="lineCov">        108 :         ZEND_PARSE_PARAMETERS_START(2, 2)</span></a>
<a name="2657"><span class="lineNum">    2657 </span><span class="lineCov">        120 :                 Z_PARAM_ARRAY(keys)</span></a>
<a name="2658"><span class="lineNum">    2658 </span><span class="lineCov">         54 :                 Z_PARAM_ZVAL(val)</span></a>
<a name="2659"><span class="lineNum">    2659 </span><span class="lineCov">        108 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="2660"><span class="lineNum">    2660 </span>            : </a>
<a name="2661"><span class="lineNum">    2661 </span>            :         /* Initialize return array */</a>
<a name="2662"><span class="lineNum">    2662 </span><span class="lineCov">         54 :         array_init_size(return_value, zend_hash_num_elements(Z_ARRVAL_P(keys)));</span></a>
<a name="2663"><span class="lineNum">    2663 </span>            : </a>
<a name="2664"><span class="lineNum">    2664 </span><span class="lineCov">        294 :         ZEND_HASH_FOREACH_VAL(Z_ARRVAL_P(keys), entry) {</span></a>
<a name="2665"><span class="lineNum">    2665 </span><span class="lineCov">        120 :                 ZVAL_DEREF(entry);</span></a>
<a name="2666"><span class="lineNum">    2666 </span><span class="lineCov">        120 :                 Z_TRY_ADDREF_P(val);</span></a>
<a name="2667"><span class="lineNum">    2667 </span><span class="lineCov">        120 :                 if (Z_TYPE_P(entry) == IS_LONG) {</span></a>
<a name="2668"><span class="lineNum">    2668 </span><span class="lineCov">         24 :                         zend_hash_index_update(Z_ARRVAL_P(return_value), Z_LVAL_P(entry), val);</span></a>
<a name="2669"><span class="lineNum">    2669 </span>            :                 } else {</a>
<a name="2670"><span class="lineNum">    2670 </span>            :                         zend_string *tmp_key;</a>
<a name="2671"><span class="lineNum">    2671 </span><span class="lineCov">         96 :                         zend_string *key = zval_get_tmp_string(entry, &amp;tmp_key);</span></a>
<a name="2672"><span class="lineNum">    2672 </span><span class="lineCov">         96 :                         zend_symtable_update(Z_ARRVAL_P(return_value), key, val);</span></a>
<a name="2673"><span class="lineNum">    2673 </span><span class="lineCov">         96 :                         zend_tmp_string_release(tmp_key);</span></a>
<a name="2674"><span class="lineNum">    2674 </span>            :                 }</a>
<a name="2675"><span class="lineNum">    2675 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="2676"><span class="lineNum">    2676 </span>            : }</a>
<a name="2677"><span class="lineNum">    2677 </span>            : /* }}} */</a>
<a name="2678"><span class="lineNum">    2678 </span>            : </a>
<a name="2679"><span class="lineNum">    2679 </span>            : #define RANGE_CHECK_DOUBLE_INIT_ARRAY(start, end) do { \</a>
<a name="2680"><span class="lineNum">    2680 </span>            :                 double __calc_size = ((start - end) / step) + 1; \</a>
<a name="2681"><span class="lineNum">    2681 </span>            :                 if (__calc_size &gt;= (double)HT_MAX_SIZE) { \</a>
<a name="2682"><span class="lineNum">    2682 </span>            :                         zend_value_error(\</a>
<a name="2683"><span class="lineNum">    2683 </span>            :                                         &quot;The supplied range exceeds the maximum array size: start=%0.0f end=%0.0f&quot;, end, start); \</a>
<a name="2684"><span class="lineNum">    2684 </span>            :                         RETURN_THROWS(); \</a>
<a name="2685"><span class="lineNum">    2685 </span>            :                 } \</a>
<a name="2686"><span class="lineNum">    2686 </span>            :                 size = (uint32_t)_php_math_round(__calc_size, 0, PHP_ROUND_HALF_UP); \</a>
<a name="2687"><span class="lineNum">    2687 </span>            :                 array_init_size(return_value, size); \</a>
<a name="2688"><span class="lineNum">    2688 </span>            :                 zend_hash_real_init_packed(Z_ARRVAL_P(return_value)); \</a>
<a name="2689"><span class="lineNum">    2689 </span>            :         } while (0)</a>
<a name="2690"><span class="lineNum">    2690 </span>            : </a>
<a name="2691"><span class="lineNum">    2691 </span>            : #define RANGE_CHECK_LONG_INIT_ARRAY(start, end) do { \</a>
<a name="2692"><span class="lineNum">    2692 </span>            :                 zend_ulong __calc_size = ((zend_ulong) start - end) / lstep; \</a>
<a name="2693"><span class="lineNum">    2693 </span>            :                 if (__calc_size &gt;= HT_MAX_SIZE - 1) { \</a>
<a name="2694"><span class="lineNum">    2694 </span>            :                         zend_value_error(\</a>
<a name="2695"><span class="lineNum">    2695 </span>            :                                         &quot;The supplied range exceeds the maximum array size: start=&quot; ZEND_LONG_FMT &quot; end=&quot; ZEND_LONG_FMT, end, start); \</a>
<a name="2696"><span class="lineNum">    2696 </span>            :                         RETURN_THROWS(); \</a>
<a name="2697"><span class="lineNum">    2697 </span>            :                 } \</a>
<a name="2698"><span class="lineNum">    2698 </span>            :                 size = (uint32_t)(__calc_size + 1); \</a>
<a name="2699"><span class="lineNum">    2699 </span>            :                 array_init_size(return_value, size); \</a>
<a name="2700"><span class="lineNum">    2700 </span>            :                 zend_hash_real_init_packed(Z_ARRVAL_P(return_value)); \</a>
<a name="2701"><span class="lineNum">    2701 </span>            :         } while (0)</a>
<a name="2702"><span class="lineNum">    2702 </span>            : </a>
<a name="2703"><span class="lineNum">    2703 </span>            : /* {{{ Create an array containing the range of integers or characters from low to high (inclusive) */</a>
<a name="2704"><span class="lineNum">    2704 </span><span class="lineCov">     300855 : PHP_FUNCTION(range)</span></a>
<a name="2705"><span class="lineNum">    2705 </span>            : {</a>
<a name="2706"><span class="lineNum">    2706 </span><span class="lineCov">     300855 :         zval *zlow, *zhigh, *zstep = NULL, tmp;</span></a>
<a name="2707"><span class="lineNum">    2707 </span><span class="lineCov">     300855 :         int err = 0, is_step_double = 0;</span></a>
<a name="2708"><span class="lineNum">    2708 </span><span class="lineCov">     300855 :         double step = 1.0;</span></a>
<a name="2709"><span class="lineNum">    2709 </span>            : </a>
<a name="2710"><span class="lineNum">    2710 </span><span class="lineCov">     300855 :         ZEND_PARSE_PARAMETERS_START(2, 3)</span></a>
<a name="2711"><span class="lineNum">    2711 </span><span class="lineCov">     300813 :                 Z_PARAM_ZVAL(zlow)</span></a>
<a name="2712"><span class="lineNum">    2712 </span><span class="lineCov">     300813 :                 Z_PARAM_ZVAL(zhigh)</span></a>
<a name="2713"><span class="lineNum">    2713 </span><span class="lineCov">     300813 :                 Z_PARAM_OPTIONAL</span></a>
<a name="2714"><span class="lineNum">    2714 </span><span class="lineCov">     300912 :                 Z_PARAM_NUMBER(zstep)</span></a>
<a name="2715"><span class="lineNum">    2715 </span><span class="lineCov">     300906 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="2716"><span class="lineNum">    2716 </span>            : </a>
<a name="2717"><span class="lineNum">    2717 </span><span class="lineCov">     300795 :         if (zstep) {</span></a>
<a name="2718"><span class="lineNum">    2718 </span><span class="lineCov">         81 :                 is_step_double = Z_TYPE_P(zstep) == IS_DOUBLE;</span></a>
<a name="2719"><span class="lineNum">    2719 </span><span class="lineCov">         81 :                 step = zval_get_double(zstep);</span></a>
<a name="2720"><span class="lineNum">    2720 </span>            : </a>
<a name="2721"><span class="lineNum">    2721 </span>            :                 /* We only want positive step values. */</a>
<a name="2722"><span class="lineNum">    2722 </span><span class="lineCov">         81 :                 if (step &lt; 0.0) {</span></a>
<a name="2723"><span class="lineNum">    2723 </span><span class="lineNoCov">          0 :                         step *= -1;</span></a>
<a name="2724"><span class="lineNum">    2724 </span>            :                 }</a>
<a name="2725"><span class="lineNum">    2725 </span>            :         }</a>
<a name="2726"><span class="lineNum">    2726 </span>            : </a>
<a name="2727"><span class="lineNum">    2727 </span>            :         /* If the range is given as strings, generate an array of characters. */</a>
<a name="2728"><span class="lineNum">    2728 </span><span class="lineCov">     601725 :         if (Z_TYPE_P(zlow) == IS_STRING &amp;&amp; Z_TYPE_P(zhigh) == IS_STRING &amp;&amp; Z_STRLEN_P(zlow) &gt;= 1 &amp;&amp; Z_STRLEN_P(zhigh) &gt;= 1) {</span></a>
<a name="2729"><span class="lineNum">    2729 </span>            :                 int type1, type2;</a>
<a name="2730"><span class="lineNum">    2730 </span>            :                 unsigned char low, high;</a>
<a name="2731"><span class="lineNum">    2731 </span><span class="lineCov">         66 :                 zend_long lstep = (zend_long) step;</span></a>
<a name="2732"><span class="lineNum">    2732 </span>            : </a>
<a name="2733"><span class="lineNum">    2733 </span><span class="lineCov">         66 :                 type1 = is_numeric_string(Z_STRVAL_P(zlow), Z_STRLEN_P(zlow), NULL, NULL, 0);</span></a>
<a name="2734"><span class="lineNum">    2734 </span><span class="lineCov">         66 :                 type2 = is_numeric_string(Z_STRVAL_P(zhigh), Z_STRLEN_P(zhigh), NULL, NULL, 0);</span></a>
<a name="2735"><span class="lineNum">    2735 </span>            : </a>
<a name="2736"><span class="lineNum">    2736 </span><span class="lineCov">         66 :                 if (type1 == IS_DOUBLE || type2 == IS_DOUBLE || is_step_double) {</span></a>
<a name="2737"><span class="lineNum">    2737 </span><span class="lineCov">         12 :                         goto double_str;</span></a>
<a name="2738"><span class="lineNum">    2738 </span><span class="lineCov">         54 :                 } else if (type1 == IS_LONG || type2 == IS_LONG) {</span></a>
<a name="2739"><span class="lineNum">    2739 </span><span class="lineCov">         15 :                         goto long_str;</span></a>
<a name="2740"><span class="lineNum">    2740 </span>            :                 }</a>
<a name="2741"><span class="lineNum">    2741 </span>            : </a>
<a name="2742"><span class="lineNum">    2742 </span><span class="lineCov">         39 :                 low = (unsigned char)Z_STRVAL_P(zlow)[0];</span></a>
<a name="2743"><span class="lineNum">    2743 </span><span class="lineCov">         39 :                 high = (unsigned char)Z_STRVAL_P(zhigh)[0];</span></a>
<a name="2744"><span class="lineNum">    2744 </span>            : </a>
<a name="2745"><span class="lineNum">    2745 </span><span class="lineCov">         39 :                 if (low &gt; high) {            /* Negative Steps */</span></a>
<a name="2746"><span class="lineNum">    2746 </span><span class="lineCov">          9 :                         if (low - high &lt; lstep || lstep &lt;= 0) {</span></a>
<a name="2747"><span class="lineNum">    2747 </span><span class="lineCov">          6 :                                 err = 1;</span></a>
<a name="2748"><span class="lineNum">    2748 </span><span class="lineCov">          6 :                                 goto err;</span></a>
<a name="2749"><span class="lineNum">    2749 </span>            :                         }</a>
<a name="2750"><span class="lineNum">    2750 </span>            :                         /* Initialize the return_value as an array. */</a>
<a name="2751"><span class="lineNum">    2751 </span><span class="lineCov">          3 :                         array_init_size(return_value, (uint32_t)(((low - high) / lstep) + 1));</span></a>
<a name="2752"><span class="lineNum">    2752 </span><span class="lineCov">          3 :                         zend_hash_real_init_packed(Z_ARRVAL_P(return_value));</span></a>
<a name="2753"><span class="lineNum">    2753 </span><span class="lineCov">          3 :                         ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="2754"><span class="lineNum">    2754 </span><span class="lineCov">         81 :                                 for (; low &gt;= high; low -= (unsigned int)lstep) {</span></a>
<a name="2755"><span class="lineNum">    2755 </span><span class="lineCov">         78 :                                         ZEND_HASH_FILL_SET_INTERNED_STR(ZSTR_CHAR(low));</span></a>
<a name="2756"><span class="lineNum">    2756 </span><span class="lineCov">         78 :                                         ZEND_HASH_FILL_NEXT();</span></a>
<a name="2757"><span class="lineNum">    2757 </span><span class="lineCov">         78 :                                         if (((signed int)low - lstep) &lt; 0) {</span></a>
<a name="2758"><span class="lineNum">    2758 </span><span class="lineNoCov">          0 :                                                 break;</span></a>
<a name="2759"><span class="lineNum">    2759 </span>            :                                         }</a>
<a name="2760"><span class="lineNum">    2760 </span>            :                                 }</a>
<a name="2761"><span class="lineNum">    2761 </span><span class="lineCov">          3 :                         } ZEND_HASH_FILL_END();</span></a>
<a name="2762"><span class="lineNum">    2762 </span><span class="lineCov">         30 :                 } else if (high &gt; low) {     /* Positive Steps */</span></a>
<a name="2763"><span class="lineNum">    2763 </span><span class="lineCov">         24 :                         if (high - low &lt; lstep || lstep &lt;= 0) {</span></a>
<a name="2764"><span class="lineNum">    2764 </span><span class="lineCov">          6 :                                 err = 1;</span></a>
<a name="2765"><span class="lineNum">    2765 </span><span class="lineCov">          6 :                                 goto err;</span></a>
<a name="2766"><span class="lineNum">    2766 </span>            :                         }</a>
<a name="2767"><span class="lineNum">    2767 </span><span class="lineCov">         18 :                         array_init_size(return_value, (uint32_t)(((high - low) / lstep) + 1));</span></a>
<a name="2768"><span class="lineNum">    2768 </span><span class="lineCov">         18 :                         zend_hash_real_init_packed(Z_ARRVAL_P(return_value));</span></a>
<a name="2769"><span class="lineNum">    2769 </span><span class="lineCov">         18 :                         ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="2770"><span class="lineNum">    2770 </span><span class="lineCov">        390 :                                 for (; low &lt;= high; low += (unsigned int)lstep) {</span></a>
<a name="2771"><span class="lineNum">    2771 </span><span class="lineCov">        372 :                                         ZEND_HASH_FILL_SET_INTERNED_STR(ZSTR_CHAR(low));</span></a>
<a name="2772"><span class="lineNum">    2772 </span><span class="lineCov">        372 :                                         ZEND_HASH_FILL_NEXT();</span></a>
<a name="2773"><span class="lineNum">    2773 </span><span class="lineCov">        372 :                                         if (((signed int)low + lstep) &gt; 255) {</span></a>
<a name="2774"><span class="lineNum">    2774 </span><span class="lineNoCov">          0 :                                                 break;</span></a>
<a name="2775"><span class="lineNum">    2775 </span>            :                                         }</a>
<a name="2776"><span class="lineNum">    2776 </span>            :                                 }</a>
<a name="2777"><span class="lineNum">    2777 </span><span class="lineCov">         18 :                         } ZEND_HASH_FILL_END();</span></a>
<a name="2778"><span class="lineNum">    2778 </span>            :                 } else {</a>
<a name="2779"><span class="lineNum">    2779 </span><span class="lineCov">          6 :                         array_init(return_value);</span></a>
<a name="2780"><span class="lineNum">    2780 </span><span class="lineCov">          6 :                         ZVAL_CHAR(&amp;tmp, low);</span></a>
<a name="2781"><span class="lineNum">    2781 </span><span class="lineCov">          6 :                         zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), &amp;tmp);</span></a>
<a name="2782"><span class="lineNum">    2782 </span>            :                 }</a>
<a name="2783"><span class="lineNum">    2783 </span><span class="lineCov">     902226 :         } else if (Z_TYPE_P(zlow) == IS_DOUBLE || Z_TYPE_P(zhigh) == IS_DOUBLE || is_step_double) {</span></a>
<a name="2784"><span class="lineNum">    2784 </span>            :                 double low, high, element;</a>
<a name="2785"><span class="lineNum">    2785 </span>            :                 uint32_t i, size;</a>
<a name="2786"><span class="lineNum">    2786 </span><span class="lineCov">         81 : double_str:</span></a>
<a name="2787"><span class="lineNum">    2787 </span><span class="lineCov">         93 :                 low = zval_get_double(zlow);</span></a>
<a name="2788"><span class="lineNum">    2788 </span><span class="lineCov">         93 :                 high = zval_get_double(zhigh);</span></a>
<a name="2789"><span class="lineNum">    2789 </span>            : </a>
<a name="2790"><span class="lineNum">    2790 </span><span class="lineCov">         93 :                 if (zend_isinf(high) || zend_isinf(low)) {</span></a>
<a name="2791"><span class="lineNum">    2791 </span><span class="lineCov">          6 :                         zend_value_error(&quot;Invalid range supplied: start=%0.0f end=%0.0f&quot;, low, high);</span></a>
<a name="2792"><span class="lineNum">    2792 </span><span class="lineCov">          6 :                         RETURN_THROWS();</span></a>
<a name="2793"><span class="lineNum">    2793 </span>            :                 }</a>
<a name="2794"><span class="lineNum">    2794 </span>            : </a>
<a name="2795"><span class="lineNum">    2795 </span><span class="lineCov">         87 :                 if (low &gt; high) {            /* Negative steps */</span></a>
<a name="2796"><span class="lineNum">    2796 </span><span class="lineCov">         36 :                         if (low - high &lt; step || step &lt;= 0) {</span></a>
<a name="2797"><span class="lineNum">    2797 </span><span class="lineCov">          3 :                                 err = 1;</span></a>
<a name="2798"><span class="lineNum">    2798 </span><span class="lineCov">          3 :                                 goto err;</span></a>
<a name="2799"><span class="lineNum">    2799 </span>            :                         }</a>
<a name="2800"><span class="lineNum">    2800 </span>            : </a>
<a name="2801"><span class="lineNum">    2801 </span><span class="lineCov">         33 :                         RANGE_CHECK_DOUBLE_INIT_ARRAY(low, high);</span></a>
<a name="2802"><span class="lineNum">    2802 </span>            : </a>
<a name="2803"><span class="lineNum">    2803 </span><span class="lineCov">         33 :                         ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="2804"><span class="lineNum">    2804 </span><span class="lineCov">     307521 :                                 for (i = 0, element = low; i &lt; size &amp;&amp; element &gt;= high; ++i, element = low - (i * step)) {</span></a>
<a name="2805"><span class="lineNum">    2805 </span><span class="lineCov">     307488 :                                         ZEND_HASH_FILL_SET_DOUBLE(element);</span></a>
<a name="2806"><span class="lineNum">    2806 </span><span class="lineCov">     307488 :                                         ZEND_HASH_FILL_NEXT();</span></a>
<a name="2807"><span class="lineNum">    2807 </span>            :                                 }</a>
<a name="2808"><span class="lineNum">    2808 </span><span class="lineCov">         33 :                         } ZEND_HASH_FILL_END();</span></a>
<a name="2809"><span class="lineNum">    2809 </span><span class="lineCov">         51 :                 } else if (high &gt; low) {     /* Positive steps */</span></a>
<a name="2810"><span class="lineNum">    2810 </span><span class="lineCov">         48 :                         if (high - low &lt; step || step &lt;= 0) {</span></a>
<a name="2811"><span class="lineNum">    2811 </span><span class="lineCov">          6 :                                 err = 1;</span></a>
<a name="2812"><span class="lineNum">    2812 </span><span class="lineCov">          6 :                                 goto err;</span></a>
<a name="2813"><span class="lineNum">    2813 </span>            :                         }</a>
<a name="2814"><span class="lineNum">    2814 </span>            : </a>
<a name="2815"><span class="lineNum">    2815 </span><span class="lineCov">         42 :                         RANGE_CHECK_DOUBLE_INIT_ARRAY(high, low);</span></a>
<a name="2816"><span class="lineNum">    2816 </span>            : </a>
<a name="2817"><span class="lineNum">    2817 </span><span class="lineCov">         42 :                         ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="2818"><span class="lineNum">    2818 </span><span class="lineCov">     308190 :                                 for (i = 0, element = low; i &lt; size &amp;&amp; element &lt;= high; ++i, element = low + (i * step)) {</span></a>
<a name="2819"><span class="lineNum">    2819 </span><span class="lineCov">     308148 :                                         ZEND_HASH_FILL_SET_DOUBLE(element);</span></a>
<a name="2820"><span class="lineNum">    2820 </span><span class="lineCov">     308148 :                                         ZEND_HASH_FILL_NEXT();</span></a>
<a name="2821"><span class="lineNum">    2821 </span>            :                                 }</a>
<a name="2822"><span class="lineNum">    2822 </span><span class="lineCov">         42 :                         } ZEND_HASH_FILL_END();</span></a>
<a name="2823"><span class="lineNum">    2823 </span>            :                 } else {</a>
<a name="2824"><span class="lineNum">    2824 </span><span class="lineCov">          3 :                         array_init(return_value);</span></a>
<a name="2825"><span class="lineNum">    2825 </span><span class="lineCov">          3 :                         ZVAL_DOUBLE(&amp;tmp, low);</span></a>
<a name="2826"><span class="lineNum">    2826 </span><span class="lineCov">          3 :                         zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), &amp;tmp);</span></a>
<a name="2827"><span class="lineNum">    2827 </span>            :                 }</a>
<a name="2828"><span class="lineNum">    2828 </span>            :         } else {</a>
<a name="2829"><span class="lineNum">    2829 </span>            :                 zend_long low, high;</a>
<a name="2830"><span class="lineNum">    2830 </span>            :                 /* lstep is a zend_ulong so that comparisons to it don't overflow, i.e. low - high &lt; lstep */</a>
<a name="2831"><span class="lineNum">    2831 </span>            :                 zend_ulong lstep;</a>
<a name="2832"><span class="lineNum">    2832 </span>            :                 uint32_t i, size;</a>
<a name="2833"><span class="lineNum">    2833 </span><span class="lineCov">     300648 : long_str:</span></a>
<a name="2834"><span class="lineNum">    2834 </span><span class="lineCov">     300663 :                 low = zval_get_long(zlow);</span></a>
<a name="2835"><span class="lineNum">    2835 </span><span class="lineCov">     300663 :                 high = zval_get_long(zhigh);</span></a>
<a name="2836"><span class="lineNum">    2836 </span>            : </a>
<a name="2837"><span class="lineNum">    2837 </span><span class="lineCov">     300663 :                 if (step &lt;= 0) {</span></a>
<a name="2838"><span class="lineNum">    2838 </span><span class="lineCov">         15 :                         err = 1;</span></a>
<a name="2839"><span class="lineNum">    2839 </span><span class="lineCov">         15 :                         goto err;</span></a>
<a name="2840"><span class="lineNum">    2840 </span>            :                 }</a>
<a name="2841"><span class="lineNum">    2841 </span>            : </a>
<a name="2842"><span class="lineNum">    2842 </span><span class="lineCov">     300648 :                 lstep = (zend_ulong)step;</span></a>
<a name="2843"><span class="lineNum">    2843 </span><span class="lineCov">     300648 :                 if (step &lt;= 0) {</span></a>
<a name="2844"><span class="lineNum">    2844 </span><span class="lineNoCov">          0 :                         err = 1;</span></a>
<a name="2845"><span class="lineNum">    2845 </span><span class="lineNoCov">          0 :                         goto err;</span></a>
<a name="2846"><span class="lineNum">    2846 </span>            :                 }</a>
<a name="2847"><span class="lineNum">    2847 </span>            : </a>
<a name="2848"><span class="lineNum">    2848 </span><span class="lineCov">     300648 :                 if (low &gt; high) {            /* Negative steps */</span></a>
<a name="2849"><span class="lineNum">    2849 </span><span class="lineCov">         45 :                         if ((zend_ulong)low - high &lt; lstep) {</span></a>
<a name="2850"><span class="lineNum">    2850 </span><span class="lineCov">          3 :                                 err = 1;</span></a>
<a name="2851"><span class="lineNum">    2851 </span><span class="lineCov">          3 :                                 goto err;</span></a>
<a name="2852"><span class="lineNum">    2852 </span>            :                         }</a>
<a name="2853"><span class="lineNum">    2853 </span>            : </a>
<a name="2854"><span class="lineNum">    2854 </span><span class="lineCov">         42 :                         RANGE_CHECK_LONG_INIT_ARRAY(low, high);</span></a>
<a name="2855"><span class="lineNum">    2855 </span>            : </a>
<a name="2856"><span class="lineNum">    2856 </span><span class="lineCov">         42 :                         ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="2857"><span class="lineNum">    2857 </span><span class="lineCov">       1782 :                                 for (i = 0; i &lt; size; ++i) {</span></a>
<a name="2858"><span class="lineNum">    2858 </span><span class="lineCov">       1740 :                                         ZEND_HASH_FILL_SET_LONG(low - (i * lstep));</span></a>
<a name="2859"><span class="lineNum">    2859 </span><span class="lineCov">       1740 :                                         ZEND_HASH_FILL_NEXT();</span></a>
<a name="2860"><span class="lineNum">    2860 </span>            :                                 }</a>
<a name="2861"><span class="lineNum">    2861 </span><span class="lineCov">         42 :                         } ZEND_HASH_FILL_END();</span></a>
<a name="2862"><span class="lineNum">    2862 </span><span class="lineCov">     300603 :                 } else if (high &gt; low) {     /* Positive steps */</span></a>
<a name="2863"><span class="lineNum">    2863 </span><span class="lineCov">     300534 :                         if ((zend_ulong)high - low &lt; lstep) {</span></a>
<a name="2864"><span class="lineNum">    2864 </span><span class="lineNoCov">          0 :                                 err = 1;</span></a>
<a name="2865"><span class="lineNum">    2865 </span><span class="lineNoCov">          0 :                                 goto err;</span></a>
<a name="2866"><span class="lineNum">    2866 </span>            :                         }</a>
<a name="2867"><span class="lineNum">    2867 </span>            : </a>
<a name="2868"><span class="lineNum">    2868 </span><span class="lineCov">     300534 :                         RANGE_CHECK_LONG_INIT_ARRAY(high, low);</span></a>
<a name="2869"><span class="lineNum">    2869 </span>            : </a>
<a name="2870"><span class="lineNum">    2870 </span><span class="lineCov">     300528 :                         ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="2871"><span class="lineNum">    2871 </span><span class="lineCov">    4859310 :                                 for (i = 0; i &lt; size; ++i) {</span></a>
<a name="2872"><span class="lineNum">    2872 </span><span class="lineCov">    4558780 :                                         ZEND_HASH_FILL_SET_LONG(low + (i * lstep));</span></a>
<a name="2873"><span class="lineNum">    2873 </span><span class="lineCov">    4558780 :                                         ZEND_HASH_FILL_NEXT();</span></a>
<a name="2874"><span class="lineNum">    2874 </span>            :                                 }</a>
<a name="2875"><span class="lineNum">    2875 </span><span class="lineCov">     300528 :                         } ZEND_HASH_FILL_END();</span></a>
<a name="2876"><span class="lineNum">    2876 </span>            :                 } else {</a>
<a name="2877"><span class="lineNum">    2877 </span><span class="lineCov">         69 :                         array_init(return_value);</span></a>
<a name="2878"><span class="lineNum">    2878 </span><span class="lineCov">         69 :                         ZVAL_LONG(&amp;tmp, low);</span></a>
<a name="2879"><span class="lineNum">    2879 </span><span class="lineCov">         69 :                         zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), &amp;tmp);</span></a>
<a name="2880"><span class="lineNum">    2880 </span>            :                 }</a>
<a name="2881"><span class="lineNum">    2881 </span>            :         }</a>
<a name="2882"><span class="lineNum">    2882 </span><span class="lineCov">     300783 : err:</span></a>
<a name="2883"><span class="lineNum">    2883 </span><span class="lineCov">     300783 :         if (err) {</span></a>
<a name="2884"><span class="lineNum">    2884 </span><span class="lineCov">         39 :                 zend_argument_value_error(3, &quot;must not exceed the specified range&quot;);</span></a>
<a name="2885"><span class="lineNum">    2885 </span><span class="lineCov">         39 :                 RETURN_THROWS();</span></a>
<a name="2886"><span class="lineNum">    2886 </span>            :         }</a>
<a name="2887"><span class="lineNum">    2887 </span>            : }</a>
<a name="2888"><span class="lineNum">    2888 </span>            : /* }}} */</a>
<a name="2889"><span class="lineNum">    2889 </span>            : </a>
<a name="2890"><span class="lineNum">    2890 </span>            : #undef RANGE_CHECK_DOUBLE_INIT_ARRAY</a>
<a name="2891"><span class="lineNum">    2891 </span>            : #undef RANGE_CHECK_LONG_INIT_ARRAY</a>
<a name="2892"><span class="lineNum">    2892 </span>            : </a>
<a name="2893"><span class="lineNum">    2893 </span><span class="lineCov">     270204 : static void php_array_data_shuffle(zval *array) /* {{{ */</span></a>
<a name="2894"><span class="lineNum">    2894 </span>            : {</a>
<a name="2895"><span class="lineNum">    2895 </span>            :         uint32_t idx, j, n_elems;</a>
<a name="2896"><span class="lineNum">    2896 </span>            :         zval *zv, temp;</a>
<a name="2897"><span class="lineNum">    2897 </span>            :         HashTable *hash;</a>
<a name="2898"><span class="lineNum">    2898 </span>            :         zend_long rnd_idx;</a>
<a name="2899"><span class="lineNum">    2899 </span>            :         uint32_t n_left;</a>
<a name="2900"><span class="lineNum">    2900 </span>            : </a>
<a name="2901"><span class="lineNum">    2901 </span><span class="lineCov">     270204 :         n_elems = zend_hash_num_elements(Z_ARRVAL_P(array));</span></a>
<a name="2902"><span class="lineNum">    2902 </span>            : </a>
<a name="2903"><span class="lineNum">    2903 </span><span class="lineCov">     270204 :         if (n_elems &lt; 1) {</span></a>
<a name="2904"><span class="lineNum">    2904 </span><span class="lineCov">          3 :                 return;</span></a>
<a name="2905"><span class="lineNum">    2905 </span>            :         }</a>
<a name="2906"><span class="lineNum">    2906 </span>            : </a>
<a name="2907"><span class="lineNum">    2907 </span><span class="lineCov">     270201 :         hash = Z_ARRVAL_P(array);</span></a>
<a name="2908"><span class="lineNum">    2908 </span><span class="lineCov">     270201 :         n_left = n_elems;</span></a>
<a name="2909"><span class="lineNum">    2909 </span>            : </a>
<a name="2910"><span class="lineNum">    2910 </span><span class="lineCov">     270201 :         if (!HT_IS_PACKED(hash)) {</span></a>
<a name="2911"><span class="lineNum">    2911 </span><span class="lineCov">         45 :                 if (!HT_HAS_STATIC_KEYS_ONLY(hash)) {</span></a>
<a name="2912"><span class="lineNum">    2912 </span><span class="lineCov">         30 :                         Bucket *p = hash-&gt;arData;</span></a>
<a name="2913"><span class="lineNum">    2913 </span><span class="lineCov">         30 :                         uint32_t i = hash-&gt;nNumUsed;</span></a>
<a name="2914"><span class="lineNum">    2914 </span>            : </a>
<a name="2915"><span class="lineNum">    2915 </span><span class="lineCov">        159 :                         for (; i &gt; 0; p++, i--) {</span></a>
<a name="2916"><span class="lineNum">    2916 </span><span class="lineCov">        258 :                                 if (Z_ISUNDEF(p-&gt;val)) continue;</span></a>
<a name="2917"><span class="lineNum">    2917 </span><span class="lineCov">        129 :                                 if (p-&gt;key) {</span></a>
<a name="2918"><span class="lineNum">    2918 </span><span class="lineCov">        102 :                                         zend_string_release(p-&gt;key);</span></a>
<a name="2919"><span class="lineNum">    2919 </span><span class="lineCov">        102 :                                         p-&gt;key = NULL;</span></a>
<a name="2920"><span class="lineNum">    2920 </span>            :                                 }</a>
<a name="2921"><span class="lineNum">    2921 </span>            :                         }</a>
<a name="2922"><span class="lineNum">    2922 </span>            :                 }</a>
<a name="2923"><span class="lineNum">    2923 </span><span class="lineCov">         45 :                 zend_hash_to_packed(hash);</span></a>
<a name="2924"><span class="lineNum">    2924 </span>            :         }</a>
<a name="2925"><span class="lineNum">    2925 </span>            : </a>
<a name="2926"><span class="lineNum">    2926 </span><span class="lineCov">     270201 :         if (EXPECTED(!HT_HAS_ITERATORS(hash))) {</span></a>
<a name="2927"><span class="lineNum">    2927 </span><span class="lineCov">     270201 :                 if (hash-&gt;nNumUsed != hash-&gt;nNumOfElements) {</span></a>
<a name="2928"><span class="lineNum">    2928 </span><span class="lineCov">         21 :                         for (j = 0, idx = 0; idx &lt; hash-&gt;nNumUsed; idx++) {</span></a>
<a name="2929"><span class="lineNum">    2929 </span><span class="lineCov">         15 :                                 zv = hash-&gt;arPacked + idx;</span></a>
<a name="2930"><span class="lineNum">    2930 </span><span class="lineCov">         15 :                                 if (Z_TYPE_P(zv) == IS_UNDEF) continue;</span></a>
<a name="2931"><span class="lineNum">    2931 </span><span class="lineCov">          6 :                                 if (j != idx) {</span></a>
<a name="2932"><span class="lineNum">    2932 </span><span class="lineCov">          6 :                                         ZVAL_COPY_VALUE(&amp;hash-&gt;arPacked[j], zv);</span></a>
<a name="2933"><span class="lineNum">    2933 </span>            :                                 }</a>
<a name="2934"><span class="lineNum">    2934 </span><span class="lineCov">          6 :                                 j++;</span></a>
<a name="2935"><span class="lineNum">    2935 </span>            :                         }</a>
<a name="2936"><span class="lineNum">    2936 </span>            :                 }</a>
<a name="2937"><span class="lineNum">    2937 </span><span class="lineCov">    1085890 :                 while (--n_left) {</span></a>
<a name="2938"><span class="lineNum">    2938 </span><span class="lineCov">     815685 :                         rnd_idx = php_mt_rand_range(0, n_left);</span></a>
<a name="2939"><span class="lineNum">    2939 </span><span class="lineCov">     815685 :                         if (rnd_idx != n_left) {</span></a>
<a name="2940"><span class="lineNum">    2940 </span><span class="lineCov">     523198 :                                 ZVAL_COPY_VALUE(&amp;temp, &amp;hash-&gt;arPacked[n_left]);</span></a>
<a name="2941"><span class="lineNum">    2941 </span><span class="lineCov">     523198 :                                 ZVAL_COPY_VALUE(&amp;hash-&gt;arPacked[n_left], &amp;hash-&gt;arPacked[rnd_idx]);</span></a>
<a name="2942"><span class="lineNum">    2942 </span><span class="lineCov">     523198 :                                 ZVAL_COPY_VALUE(&amp;hash-&gt;arPacked[rnd_idx], &amp;temp);</span></a>
<a name="2943"><span class="lineNum">    2943 </span>            :                         }</a>
<a name="2944"><span class="lineNum">    2944 </span>            :                 }</a>
<a name="2945"><span class="lineNum">    2945 </span>            :         } else {</a>
<a name="2946"><span class="lineNum">    2946 </span><span class="lineNoCov">          0 :                 uint32_t iter_pos = zend_hash_iterators_lower_pos(hash, 0);</span></a>
<a name="2947"><span class="lineNum">    2947 </span>            : </a>
<a name="2948"><span class="lineNum">    2948 </span><span class="lineNoCov">          0 :                 if (hash-&gt;nNumUsed != hash-&gt;nNumOfElements) {</span></a>
<a name="2949"><span class="lineNum">    2949 </span><span class="lineNoCov">          0 :                         for (j = 0, idx = 0; idx &lt; hash-&gt;nNumUsed; idx++) {</span></a>
<a name="2950"><span class="lineNum">    2950 </span><span class="lineNoCov">          0 :                                 zv = hash-&gt;arPacked + idx;</span></a>
<a name="2951"><span class="lineNum">    2951 </span><span class="lineNoCov">          0 :                                 if (Z_TYPE_P(zv) == IS_UNDEF) continue;</span></a>
<a name="2952"><span class="lineNum">    2952 </span><span class="lineNoCov">          0 :                                 if (j != idx) {</span></a>
<a name="2953"><span class="lineNum">    2953 </span><span class="lineNoCov">          0 :                                         ZVAL_COPY_VALUE(&amp;hash-&gt;arPacked[j], zv);</span></a>
<a name="2954"><span class="lineNum">    2954 </span><span class="lineNoCov">          0 :                                         if (idx == iter_pos) {</span></a>
<a name="2955"><span class="lineNum">    2955 </span>            :                                                 zend_hash_iterators_update(hash, idx, j);</a>
<a name="2956"><span class="lineNum">    2956 </span><span class="lineNoCov">          0 :                                                 iter_pos = zend_hash_iterators_lower_pos(hash, iter_pos + 1);</span></a>
<a name="2957"><span class="lineNum">    2957 </span>            :                                         }</a>
<a name="2958"><span class="lineNum">    2958 </span>            :                                 }</a>
<a name="2959"><span class="lineNum">    2959 </span><span class="lineNoCov">          0 :                                 j++;</span></a>
<a name="2960"><span class="lineNum">    2960 </span>            :                         }</a>
<a name="2961"><span class="lineNum">    2961 </span>            :                 }</a>
<a name="2962"><span class="lineNum">    2962 </span><span class="lineNoCov">          0 :                 while (--n_left) {</span></a>
<a name="2963"><span class="lineNum">    2963 </span><span class="lineNoCov">          0 :                         rnd_idx = php_mt_rand_range(0, n_left);</span></a>
<a name="2964"><span class="lineNum">    2964 </span><span class="lineNoCov">          0 :                         if (rnd_idx != n_left) {</span></a>
<a name="2965"><span class="lineNum">    2965 </span><span class="lineNoCov">          0 :                                 ZVAL_COPY_VALUE(&amp;temp, &amp;hash-&gt;arPacked[n_left]);</span></a>
<a name="2966"><span class="lineNum">    2966 </span><span class="lineNoCov">          0 :                                 ZVAL_COPY_VALUE(&amp;hash-&gt;arPacked[n_left], &amp;hash-&gt;arPacked[rnd_idx]);</span></a>
<a name="2967"><span class="lineNum">    2967 </span><span class="lineNoCov">          0 :                                 ZVAL_COPY_VALUE(&amp;hash-&gt;arPacked[rnd_idx], &amp;temp);</span></a>
<a name="2968"><span class="lineNum">    2968 </span><span class="lineNoCov">          0 :                                 zend_hash_iterators_update(hash, (uint32_t)rnd_idx, n_left);</span></a>
<a name="2969"><span class="lineNum">    2969 </span>            :                         }</a>
<a name="2970"><span class="lineNum">    2970 </span>            :                 }</a>
<a name="2971"><span class="lineNum">    2971 </span>            :         }</a>
<a name="2972"><span class="lineNum">    2972 </span><span class="lineCov">     270201 :         hash-&gt;nNumUsed = n_elems;</span></a>
<a name="2973"><span class="lineNum">    2973 </span><span class="lineCov">     270201 :         hash-&gt;nInternalPointer = 0;</span></a>
<a name="2974"><span class="lineNum">    2974 </span><span class="lineCov">     270201 :         hash-&gt;nNextFreeElement = n_elems;</span></a>
<a name="2975"><span class="lineNum">    2975 </span>            : }</a>
<a name="2976"><span class="lineNum">    2976 </span>            : /* }}} */</a>
<a name="2977"><span class="lineNum">    2977 </span>            : </a>
<a name="2978"><span class="lineNum">    2978 </span>            : /* {{{ Randomly shuffle the contents of an array */</a>
<a name="2979"><span class="lineNum">    2979 </span><span class="lineCov">     270210 : PHP_FUNCTION(shuffle)</span></a>
<a name="2980"><span class="lineNum">    2980 </span>            : {</a>
<a name="2981"><span class="lineNum">    2981 </span>            :         zval *array;</a>
<a name="2982"><span class="lineNum">    2982 </span>            : </a>
<a name="2983"><span class="lineNum">    2983 </span><span class="lineCov">     270210 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="2984"><span class="lineNum">    2984 </span><span class="lineCov">    1621220 :                 Z_PARAM_ARRAY_EX(array, 0, 1)</span></a>
<a name="2985"><span class="lineNum">    2985 </span><span class="lineCov">     270210 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="2986"><span class="lineNum">    2986 </span>            : </a>
<a name="2987"><span class="lineNum">    2987 </span><span class="lineCov">     270204 :         php_array_data_shuffle(array);</span></a>
<a name="2988"><span class="lineNum">    2988 </span>            : </a>
<a name="2989"><span class="lineNum">    2989 </span><span class="lineCov">     270204 :         RETURN_TRUE;</span></a>
<a name="2990"><span class="lineNum">    2990 </span>            : }</a>
<a name="2991"><span class="lineNum">    2991 </span>            : /* }}} */</a>
<a name="2992"><span class="lineNum">    2992 </span>            : </a>
<a name="2993"><span class="lineNum">    2993 </span><span class="lineCov">        198 : static void php_splice(HashTable *in_hash, zend_long offset, zend_long length, HashTable *replace, HashTable *removed) /* {{{ */</span></a>
<a name="2994"><span class="lineNum">    2994 </span>            : {</a>
<a name="2995"><span class="lineNum">    2995 </span>            :         HashTable        out_hash;                      /* Output hashtable */</a>
<a name="2996"><span class="lineNum">    2996 </span>            :         zend_long        num_in;                        /* Number of entries in the input hashtable */</a>
<a name="2997"><span class="lineNum">    2997 </span>            :         zend_long        pos;                           /* Current position in the hashtable */</a>
<a name="2998"><span class="lineNum">    2998 </span>            :         uint32_t     idx;</a>
<a name="2999"><span class="lineNum">    2999 </span>            :         zval            *entry;                         /* Hash entry */</a>
<a name="3000"><span class="lineNum">    3000 </span><span class="lineCov">        198 :         uint32_t    iter_pos = zend_hash_iterators_lower_pos(in_hash, 0);</span></a>
<a name="3001"><span class="lineNum">    3001 </span>            : </a>
<a name="3002"><span class="lineNum">    3002 </span>            :         /* Get number of entries in the input hash */</a>
<a name="3003"><span class="lineNum">    3003 </span><span class="lineCov">        198 :         num_in = zend_hash_num_elements(in_hash);</span></a>
<a name="3004"><span class="lineNum">    3004 </span>            : </a>
<a name="3005"><span class="lineNum">    3005 </span>            :         /* Clamp the offset.. */</a>
<a name="3006"><span class="lineNum">    3006 </span><span class="lineCov">        198 :         if (offset &gt; num_in) {</span></a>
<a name="3007"><span class="lineNum">    3007 </span><span class="lineNoCov">          0 :                 offset = num_in;</span></a>
<a name="3008"><span class="lineNum">    3008 </span><span class="lineCov">        198 :         } else if (offset &lt; 0 &amp;&amp; (offset = (num_in + offset)) &lt; 0) {</span></a>
<a name="3009"><span class="lineNum">    3009 </span><span class="lineNoCov">          0 :                 offset = 0;</span></a>
<a name="3010"><span class="lineNum">    3010 </span>            :         }</a>
<a name="3011"><span class="lineNum">    3011 </span>            : </a>
<a name="3012"><span class="lineNum">    3012 </span>            :         /* ..and the length */</a>
<a name="3013"><span class="lineNum">    3013 </span><span class="lineCov">        198 :         if (length &lt; 0) {</span></a>
<a name="3014"><span class="lineNum">    3014 </span><span class="lineCov">         45 :                 length = num_in - offset + length;</span></a>
<a name="3015"><span class="lineNum">    3015 </span><span class="lineCov">        153 :         } else if (((unsigned)offset + (unsigned)length) &gt; (unsigned)num_in) {</span></a>
<a name="3016"><span class="lineNum">    3016 </span><span class="lineCov">         33 :                 length = num_in - offset;</span></a>
<a name="3017"><span class="lineNum">    3017 </span>            :         }</a>
<a name="3018"><span class="lineNum">    3018 </span>            : </a>
<a name="3019"><span class="lineNum">    3019 </span>            :         /* Create and initialize output hash */</a>
<a name="3020"><span class="lineNum">    3020 </span><span class="lineCov">        198 :         zend_hash_init(&amp;out_hash, (length &gt; 0 ? num_in - length : 0) + (replace ? zend_hash_num_elements(replace) : 0), NULL, ZVAL_PTR_DTOR, 0);</span></a>
<a name="3021"><span class="lineNum">    3021 </span>            : </a>
<a name="3022"><span class="lineNum">    3022 </span><span class="lineCov">        198 :         if (HT_IS_PACKED(in_hash)) {</span></a>
<a name="3023"><span class="lineNum">    3023 </span>            :                 /* Start at the beginning of the input hash and copy entries to output hash until offset is reached */</a>
<a name="3024"><span class="lineNum">    3024 </span><span class="lineCov">        195 :                 entry = in_hash-&gt;arPacked;</span></a>
<a name="3025"><span class="lineNum">    3025 </span><span class="lineCov">        498 :                 for (pos = 0, idx = 0; pos &lt; offset &amp;&amp; idx &lt; in_hash-&gt;nNumUsed; idx++, entry++) {</span></a>
<a name="3026"><span class="lineNum">    3026 </span><span class="lineCov">        303 :                         if (Z_TYPE_P(entry) == IS_UNDEF) continue;</span></a>
<a name="3027"><span class="lineNum">    3027 </span>            : </a>
<a name="3028"><span class="lineNum">    3028 </span><span class="lineCov">        303 :                         zend_hash_next_index_insert_new(&amp;out_hash, entry);</span></a>
<a name="3029"><span class="lineNum">    3029 </span><span class="lineCov">        303 :                         if (idx == iter_pos) {</span></a>
<a name="3030"><span class="lineNum">    3030 </span><span class="lineCov">          6 :                                 if ((zend_long)idx != pos) {</span></a>
<a name="3031"><span class="lineNum">    3031 </span><span class="lineNoCov">          0 :                                         zend_hash_iterators_update(in_hash, idx, pos);</span></a>
<a name="3032"><span class="lineNum">    3032 </span>            :                                 }</a>
<a name="3033"><span class="lineNum">    3033 </span><span class="lineCov">          6 :                                 iter_pos = zend_hash_iterators_lower_pos(in_hash, iter_pos + 1);</span></a>
<a name="3034"><span class="lineNum">    3034 </span>            :                         }</a>
<a name="3035"><span class="lineNum">    3035 </span><span class="lineCov">        303 :                         pos++;</span></a>
<a name="3036"><span class="lineNum">    3036 </span>            :                 }</a>
<a name="3037"><span class="lineNum">    3037 </span>            : </a>
<a name="3038"><span class="lineNum">    3038 </span>            :                 /* If hash for removed entries exists, go until offset+length and copy the entries to it */</a>
<a name="3039"><span class="lineNum">    3039 </span><span class="lineCov">        195 :                 if (removed != NULL) {</span></a>
<a name="3040"><span class="lineNum">    3040 </span><span class="lineCov">        444 :                         for ( ; pos &lt; offset + length &amp;&amp; idx &lt; in_hash-&gt;nNumUsed; idx++, entry++) {</span></a>
<a name="3041"><span class="lineNum">    3041 </span><span class="lineCov">        282 :                                 if (Z_TYPE_P(entry) == IS_UNDEF) continue;</span></a>
<a name="3042"><span class="lineNum">    3042 </span><span class="lineCov">        282 :                                 pos++;</span></a>
<a name="3043"><span class="lineNum">    3043 </span><span class="lineCov">        282 :                                 Z_TRY_ADDREF_P(entry);</span></a>
<a name="3044"><span class="lineNum">    3044 </span><span class="lineCov">        282 :                                 zend_hash_next_index_insert_new(removed, entry);</span></a>
<a name="3045"><span class="lineNum">    3045 </span><span class="lineCov">        282 :                                 zend_hash_packed_del_val(in_hash, entry);</span></a>
<a name="3046"><span class="lineNum">    3046 </span>            :                         }</a>
<a name="3047"><span class="lineNum">    3047 </span>            :                 } else { /* otherwise just skip those entries */</a>
<a name="3048"><span class="lineNum">    3048 </span><span class="lineCov">         33 :                         int pos2 = pos;</span></a>
<a name="3049"><span class="lineNum">    3049 </span>            : </a>
<a name="3050"><span class="lineNum">    3050 </span><span class="lineCov">        102 :                         for ( ; pos2 &lt; offset + length &amp;&amp; idx &lt; in_hash-&gt;nNumUsed; idx++, entry++) {</span></a>
<a name="3051"><span class="lineNum">    3051 </span><span class="lineCov">         69 :                                 if (Z_TYPE_P(entry) == IS_UNDEF) continue;</span></a>
<a name="3052"><span class="lineNum">    3052 </span><span class="lineCov">         69 :                                 pos2++;</span></a>
<a name="3053"><span class="lineNum">    3053 </span><span class="lineCov">         69 :                                 zend_hash_packed_del_val(in_hash, entry);</span></a>
<a name="3054"><span class="lineNum">    3054 </span>            :                         }</a>
<a name="3055"><span class="lineNum">    3055 </span>            :                 }</a>
<a name="3056"><span class="lineNum">    3056 </span><span class="lineCov">        195 :                 iter_pos = zend_hash_iterators_lower_pos(in_hash, iter_pos);</span></a>
<a name="3057"><span class="lineNum">    3057 </span>            : </a>
<a name="3058"><span class="lineNum">    3058 </span>            :                 /* If there are entries to insert.. */</a>
<a name="3059"><span class="lineNum">    3059 </span><span class="lineCov">        195 :                 if (replace) {</span></a>
<a name="3060"><span class="lineNum">    3060 </span><span class="lineCov">        564 :                         ZEND_HASH_FOREACH_VAL(replace, entry) {</span></a>
<a name="3061"><span class="lineNum">    3061 </span><span class="lineCov">        234 :                                 Z_TRY_ADDREF_P(entry);</span></a>
<a name="3062"><span class="lineNum">    3062 </span><span class="lineCov">        234 :                                 zend_hash_next_index_insert_new(&amp;out_hash, entry);</span></a>
<a name="3063"><span class="lineNum">    3063 </span><span class="lineCov">        234 :                                 pos++;</span></a>
<a name="3064"><span class="lineNum">    3064 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="3065"><span class="lineNum">    3065 </span>            :                 }</a>
<a name="3066"><span class="lineNum">    3066 </span>            : </a>
<a name="3067"><span class="lineNum">    3067 </span>            :                 /* Copy the remaining input hash entries to the output hash */</a>
<a name="3068"><span class="lineNum">    3068 </span><span class="lineCov">        195 :                 entry = in_hash-&gt;arPacked + idx;</span></a>
<a name="3069"><span class="lineNum">    3069 </span><span class="lineCov">        522 :                 for ( ; idx &lt; in_hash-&gt;nNumUsed ; idx++, entry++) {</span></a>
<a name="3070"><span class="lineNum">    3070 </span><span class="lineCov">        327 :                         if (Z_TYPE_P(entry) == IS_UNDEF) continue;</span></a>
<a name="3071"><span class="lineNum">    3071 </span><span class="lineCov">        327 :                         zend_hash_next_index_insert_new(&amp;out_hash, entry);</span></a>
<a name="3072"><span class="lineNum">    3072 </span><span class="lineCov">        327 :                         if (idx == iter_pos) {</span></a>
<a name="3073"><span class="lineNum">    3073 </span><span class="lineCov">         12 :                                 if ((zend_long)idx != pos) {</span></a>
<a name="3074"><span class="lineNum">    3074 </span><span class="lineCov">          9 :                                         zend_hash_iterators_update(in_hash, idx, pos);</span></a>
<a name="3075"><span class="lineNum">    3075 </span>            :                                 }</a>
<a name="3076"><span class="lineNum">    3076 </span><span class="lineCov">         12 :                                 iter_pos = zend_hash_iterators_lower_pos(in_hash, iter_pos + 1);</span></a>
<a name="3077"><span class="lineNum">    3077 </span>            :                         }</a>
<a name="3078"><span class="lineNum">    3078 </span><span class="lineCov">        327 :                         pos++;</span></a>
<a name="3079"><span class="lineNum">    3079 </span>            :                 }</a>
<a name="3080"><span class="lineNum">    3080 </span>            :         } else {</a>
<a name="3081"><span class="lineNum">    3081 </span><span class="lineCov">          3 :                 Bucket *p = in_hash-&gt;arData;</span></a>
<a name="3082"><span class="lineNum">    3082 </span>            : </a>
<a name="3083"><span class="lineNum">    3083 </span>            :                 /* Start at the beginning of the input hash and copy entries to output hash until offset is reached */</a>
<a name="3084"><span class="lineNum">    3084 </span><span class="lineCov">         15 :                 for (pos = 0, idx = 0; pos &lt; offset &amp;&amp; idx &lt; in_hash-&gt;nNumUsed; idx++, p++) {</span></a>
<a name="3085"><span class="lineNum">    3085 </span><span class="lineCov">         24 :                         if (Z_TYPE(p-&gt;val) == IS_UNDEF) continue;</span></a>
<a name="3086"><span class="lineNum">    3086 </span><span class="lineCov">         12 :                         entry = &amp;p-&gt;val;</span></a>
<a name="3087"><span class="lineNum">    3087 </span>            : </a>
<a name="3088"><span class="lineNum">    3088 </span>            :                         /* Update output hash depending on key type */</a>
<a name="3089"><span class="lineNum">    3089 </span><span class="lineCov">         12 :                         if (p-&gt;key == NULL) {</span></a>
<a name="3090"><span class="lineNum">    3090 </span><span class="lineCov">          9 :                                 zend_hash_next_index_insert_new(&amp;out_hash, entry);</span></a>
<a name="3091"><span class="lineNum">    3091 </span>            :                         } else {</a>
<a name="3092"><span class="lineNum">    3092 </span><span class="lineCov">          3 :                                 zend_hash_add_new(&amp;out_hash, p-&gt;key, entry);</span></a>
<a name="3093"><span class="lineNum">    3093 </span>            :                         }</a>
<a name="3094"><span class="lineNum">    3094 </span><span class="lineCov">         12 :                         if (idx == iter_pos) {</span></a>
<a name="3095"><span class="lineNum">    3095 </span><span class="lineNoCov">          0 :                                 if ((zend_long)idx != pos) {</span></a>
<a name="3096"><span class="lineNum">    3096 </span><span class="lineNoCov">          0 :                                         zend_hash_iterators_update(in_hash, idx, pos);</span></a>
<a name="3097"><span class="lineNum">    3097 </span>            :                                 }</a>
<a name="3098"><span class="lineNum">    3098 </span><span class="lineNoCov">          0 :                                 iter_pos = zend_hash_iterators_lower_pos(in_hash, iter_pos + 1);</span></a>
<a name="3099"><span class="lineNum">    3099 </span>            :                         }</a>
<a name="3100"><span class="lineNum">    3100 </span><span class="lineCov">         12 :                         pos++;</span></a>
<a name="3101"><span class="lineNum">    3101 </span>            :                 }</a>
<a name="3102"><span class="lineNum">    3102 </span>            : </a>
<a name="3103"><span class="lineNum">    3103 </span>            :                 /* If hash for removed entries exists, go until offset+length and copy the entries to it */</a>
<a name="3104"><span class="lineNum">    3104 </span><span class="lineCov">          3 :                 if (removed != NULL) {</span></a>
<a name="3105"><span class="lineNum">    3105 </span><span class="lineCov">         12 :                         for ( ; pos &lt; offset + length &amp;&amp; idx &lt; in_hash-&gt;nNumUsed; idx++, p++) {</span></a>
<a name="3106"><span class="lineNum">    3106 </span><span class="lineCov">         18 :                                 if (Z_TYPE(p-&gt;val) == IS_UNDEF) continue;</span></a>
<a name="3107"><span class="lineNum">    3107 </span><span class="lineCov">          9 :                                 pos++;</span></a>
<a name="3108"><span class="lineNum">    3108 </span><span class="lineCov">          9 :                                 entry = &amp;p-&gt;val;</span></a>
<a name="3109"><span class="lineNum">    3109 </span><span class="lineCov">          9 :                                 Z_TRY_ADDREF_P(entry);</span></a>
<a name="3110"><span class="lineNum">    3110 </span><span class="lineCov">          9 :                                 if (p-&gt;key == NULL) {</span></a>
<a name="3111"><span class="lineNum">    3111 </span><span class="lineCov">          6 :                                         zend_hash_next_index_insert_new(removed, entry);</span></a>
<a name="3112"><span class="lineNum">    3112 </span>            :                                 } else {</a>
<a name="3113"><span class="lineNum">    3113 </span><span class="lineCov">          3 :                                         zend_hash_add_new(removed, p-&gt;key, entry);</span></a>
<a name="3114"><span class="lineNum">    3114 </span>            :                                 }</a>
<a name="3115"><span class="lineNum">    3115 </span><span class="lineCov">          9 :                                 zend_hash_del_bucket(in_hash, p);</span></a>
<a name="3116"><span class="lineNum">    3116 </span>            :                         }</a>
<a name="3117"><span class="lineNum">    3117 </span>            :                 } else { /* otherwise just skip those entries */</a>
<a name="3118"><span class="lineNum">    3118 </span><span class="lineNoCov">          0 :                         int pos2 = pos;</span></a>
<a name="3119"><span class="lineNum">    3119 </span>            : </a>
<a name="3120"><span class="lineNum">    3120 </span><span class="lineNoCov">          0 :                         for ( ; pos2 &lt; offset + length &amp;&amp; idx &lt; in_hash-&gt;nNumUsed; idx++, p++) {</span></a>
<a name="3121"><span class="lineNum">    3121 </span><span class="lineNoCov">          0 :                                 if (Z_TYPE(p-&gt;val) == IS_UNDEF) continue;</span></a>
<a name="3122"><span class="lineNum">    3122 </span><span class="lineNoCov">          0 :                                 pos2++;</span></a>
<a name="3123"><span class="lineNum">    3123 </span><span class="lineNoCov">          0 :                                 zend_hash_del_bucket(in_hash, p);</span></a>
<a name="3124"><span class="lineNum">    3124 </span>            :                         }</a>
<a name="3125"><span class="lineNum">    3125 </span>            :                 }</a>
<a name="3126"><span class="lineNum">    3126 </span><span class="lineCov">          3 :                 iter_pos = zend_hash_iterators_lower_pos(in_hash, iter_pos);</span></a>
<a name="3127"><span class="lineNum">    3127 </span>            : </a>
<a name="3128"><span class="lineNum">    3128 </span>            :                 /* If there are entries to insert.. */</a>
<a name="3129"><span class="lineNum">    3129 </span><span class="lineCov">          3 :                 if (replace) {</span></a>
<a name="3130"><span class="lineNum">    3130 </span><span class="lineNoCov">          0 :                         ZEND_HASH_FOREACH_VAL(replace, entry) {</span></a>
<a name="3131"><span class="lineNum">    3131 </span><span class="lineNoCov">          0 :                                 Z_TRY_ADDREF_P(entry);</span></a>
<a name="3132"><span class="lineNum">    3132 </span><span class="lineNoCov">          0 :                                 zend_hash_next_index_insert_new(&amp;out_hash, entry);</span></a>
<a name="3133"><span class="lineNum">    3133 </span><span class="lineNoCov">          0 :                                 pos++;</span></a>
<a name="3134"><span class="lineNum">    3134 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="3135"><span class="lineNum">    3135 </span>            :                 }</a>
<a name="3136"><span class="lineNum">    3136 </span>            : </a>
<a name="3137"><span class="lineNum">    3137 </span>            :                 /* Copy the remaining input hash entries to the output hash */</a>
<a name="3138"><span class="lineNum">    3138 </span><span class="lineCov">         12 :                 for ( ; idx &lt; in_hash-&gt;nNumUsed ; idx++, p++) {</span></a>
<a name="3139"><span class="lineNum">    3139 </span><span class="lineCov">         18 :                         if (Z_TYPE(p-&gt;val) == IS_UNDEF) continue;</span></a>
<a name="3140"><span class="lineNum">    3140 </span><span class="lineCov">          9 :                         entry = &amp;p-&gt;val;</span></a>
<a name="3141"><span class="lineNum">    3141 </span><span class="lineCov">          9 :                         if (p-&gt;key == NULL) {</span></a>
<a name="3142"><span class="lineNum">    3142 </span><span class="lineCov">          6 :                                 zend_hash_next_index_insert_new(&amp;out_hash, entry);</span></a>
<a name="3143"><span class="lineNum">    3143 </span>            :                         } else {</a>
<a name="3144"><span class="lineNum">    3144 </span><span class="lineCov">          3 :                                 zend_hash_add_new(&amp;out_hash, p-&gt;key, entry);</span></a>
<a name="3145"><span class="lineNum">    3145 </span>            :                         }</a>
<a name="3146"><span class="lineNum">    3146 </span><span class="lineCov">          9 :                         if (idx == iter_pos) {</span></a>
<a name="3147"><span class="lineNum">    3147 </span><span class="lineNoCov">          0 :                                 if ((zend_long)idx != pos) {</span></a>
<a name="3148"><span class="lineNum">    3148 </span><span class="lineNoCov">          0 :                                         zend_hash_iterators_update(in_hash, idx, pos);</span></a>
<a name="3149"><span class="lineNum">    3149 </span>            :                                 }</a>
<a name="3150"><span class="lineNum">    3150 </span><span class="lineNoCov">          0 :                                 iter_pos = zend_hash_iterators_lower_pos(in_hash, iter_pos + 1);</span></a>
<a name="3151"><span class="lineNum">    3151 </span>            :                         }</a>
<a name="3152"><span class="lineNum">    3152 </span><span class="lineCov">          9 :                         pos++;</span></a>
<a name="3153"><span class="lineNum">    3153 </span>            :                 }</a>
<a name="3154"><span class="lineNum">    3154 </span>            :         }</a>
<a name="3155"><span class="lineNum">    3155 </span>            : </a>
<a name="3156"><span class="lineNum">    3156 </span>            :         /* replace HashTable data */</a>
<a name="3157"><span class="lineNum">    3157 </span><span class="lineCov">        198 :         HT_SET_ITERATORS_COUNT(&amp;out_hash, HT_ITERATORS_COUNT(in_hash));</span></a>
<a name="3158"><span class="lineNum">    3158 </span><span class="lineCov">        198 :         HT_SET_ITERATORS_COUNT(in_hash, 0);</span></a>
<a name="3159"><span class="lineNum">    3159 </span><span class="lineCov">        198 :         in_hash-&gt;pDestructor = NULL;</span></a>
<a name="3160"><span class="lineNum">    3160 </span><span class="lineCov">        198 :         zend_hash_destroy(in_hash);</span></a>
<a name="3161"><span class="lineNum">    3161 </span>            : </a>
<a name="3162"><span class="lineNum">    3162 </span><span class="lineCov">        198 :         HT_FLAGS(in_hash)          = HT_FLAGS(&amp;out_hash);</span></a>
<a name="3163"><span class="lineNum">    3163 </span><span class="lineCov">        198 :         in_hash-&gt;nTableSize        = out_hash.nTableSize;</span></a>
<a name="3164"><span class="lineNum">    3164 </span><span class="lineCov">        198 :         in_hash-&gt;nTableMask        = out_hash.nTableMask;</span></a>
<a name="3165"><span class="lineNum">    3165 </span><span class="lineCov">        198 :         in_hash-&gt;nNumUsed          = out_hash.nNumUsed;</span></a>
<a name="3166"><span class="lineNum">    3166 </span><span class="lineCov">        198 :         in_hash-&gt;nNumOfElements    = out_hash.nNumOfElements;</span></a>
<a name="3167"><span class="lineNum">    3167 </span><span class="lineCov">        198 :         in_hash-&gt;nNextFreeElement  = out_hash.nNextFreeElement;</span></a>
<a name="3168"><span class="lineNum">    3168 </span><span class="lineCov">        198 :         in_hash-&gt;arData            = out_hash.arData;</span></a>
<a name="3169"><span class="lineNum">    3169 </span><span class="lineCov">        198 :         in_hash-&gt;pDestructor       = out_hash.pDestructor;</span></a>
<a name="3170"><span class="lineNum">    3170 </span>            : </a>
<a name="3171"><span class="lineNum">    3171 </span><span class="lineCov">        198 :         zend_hash_internal_pointer_reset(in_hash);</span></a>
<a name="3172"><span class="lineNum">    3172 </span><span class="lineCov">        198 : }</span></a>
<a name="3173"><span class="lineNum">    3173 </span>            : /* }}} */</a>
<a name="3174"><span class="lineNum">    3174 </span>            : </a>
<a name="3175"><span class="lineNum">    3175 </span>            : /* {{{ Pushes elements onto the end of the array */</a>
<a name="3176"><span class="lineNum">    3176 </span><span class="lineCov">       2157 : PHP_FUNCTION(array_push)</span></a>
<a name="3177"><span class="lineNum">    3177 </span>            : {</a>
<a name="3178"><span class="lineNum">    3178 </span>            :         zval   *args,           /* Function arguments array */</a>
<a name="3179"><span class="lineNum">    3179 </span>            :                    *stack,              /* Input array */</a>
<a name="3180"><span class="lineNum">    3180 </span>            :                     new_var;    /* Variable to be pushed */</a>
<a name="3181"><span class="lineNum">    3181 </span>            :         int i,                          /* Loop counter */</a>
<a name="3182"><span class="lineNum">    3182 </span>            :                 argc;                   /* Number of function arguments */</a>
<a name="3183"><span class="lineNum">    3183 </span>            : </a>
<a name="3184"><span class="lineNum">    3184 </span>            : </a>
<a name="3185"><span class="lineNum">    3185 </span><span class="lineCov">       2157 :         ZEND_PARSE_PARAMETERS_START(1, -1)</span></a>
<a name="3186"><span class="lineNum">    3186 </span><span class="lineCov">      12906 :                 Z_PARAM_ARRAY_EX(stack, 0, 1)</span></a>
<a name="3187"><span class="lineNum">    3187 </span><span class="lineCov">       2151 :                 Z_PARAM_VARIADIC('+', args, argc)</span></a>
<a name="3188"><span class="lineNum">    3188 </span><span class="lineCov">       2160 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="3189"><span class="lineNum">    3189 </span>            : </a>
<a name="3190"><span class="lineNum">    3190 </span>            :         /* For each subsequent argument, make it a reference, increase refcount, and add it to the end of the array */</a>
<a name="3191"><span class="lineNum">    3191 </span><span class="lineCov">       4341 :         for (i = 0; i &lt; argc; i++) {</span></a>
<a name="3192"><span class="lineNum">    3192 </span><span class="lineCov">       2193 :                 ZVAL_COPY(&amp;new_var, &amp;args[i]);</span></a>
<a name="3193"><span class="lineNum">    3193 </span>            : </a>
<a name="3194"><span class="lineNum">    3194 </span><span class="lineCov">       2193 :                 if (zend_hash_next_index_insert(Z_ARRVAL_P(stack), &amp;new_var) == NULL) {</span></a>
<a name="3195"><span class="lineNum">    3195 </span><span class="lineCov">          3 :                         Z_TRY_DELREF(new_var);</span></a>
<a name="3196"><span class="lineNum">    3196 </span><span class="lineCov">          3 :                         zend_throw_error(NULL, &quot;Cannot add element to the array as the next element is already occupied&quot;);</span></a>
<a name="3197"><span class="lineNum">    3197 </span><span class="lineCov">          3 :                         RETURN_THROWS();</span></a>
<a name="3198"><span class="lineNum">    3198 </span>            :                 }</a>
<a name="3199"><span class="lineNum">    3199 </span>            :         }</a>
<a name="3200"><span class="lineNum">    3200 </span>            : </a>
<a name="3201"><span class="lineNum">    3201 </span>            :         /* Clean up and return the number of values in the stack */</a>
<a name="3202"><span class="lineNum">    3202 </span><span class="lineCov">       2148 :         RETVAL_LONG(zend_hash_num_elements(Z_ARRVAL_P(stack)));</span></a>
<a name="3203"><span class="lineNum">    3203 </span>            : }</a>
<a name="3204"><span class="lineNum">    3204 </span>            : /* }}} */</a>
<a name="3205"><span class="lineNum">    3205 </span>            : </a>
<a name="3206"><span class="lineNum">    3206 </span>            : /* {{{ Pops an element off the end of the array */</a>
<a name="3207"><span class="lineNum">    3207 </span><span class="lineCov">        219 : PHP_FUNCTION(array_pop)</span></a>
<a name="3208"><span class="lineNum">    3208 </span>            : {</a>
<a name="3209"><span class="lineNum">    3209 </span>            :         zval *stack,    /* Input stack */</a>
<a name="3210"><span class="lineNum">    3210 </span>            :                  *val;          /* Value to be popped */</a>
<a name="3211"><span class="lineNum">    3211 </span>            :         uint32_t idx;</a>
<a name="3212"><span class="lineNum">    3212 </span>            : </a>
<a name="3213"><span class="lineNum">    3213 </span><span class="lineCov">        219 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="3214"><span class="lineNum">    3214 </span><span class="lineCov">       1278 :                 Z_PARAM_ARRAY_EX(stack, 0, 1)</span></a>
<a name="3215"><span class="lineNum">    3215 </span><span class="lineCov">        222 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="3216"><span class="lineNum">    3216 </span>            : </a>
<a name="3217"><span class="lineNum">    3217 </span><span class="lineCov">        213 :         if (zend_hash_num_elements(Z_ARRVAL_P(stack)) == 0) {</span></a>
<a name="3218"><span class="lineNum">    3218 </span><span class="lineCov">          3 :                 return;</span></a>
<a name="3219"><span class="lineNum">    3219 </span>            :         }</a>
<a name="3220"><span class="lineNum">    3220 </span>            : </a>
<a name="3221"><span class="lineNum">    3221 </span><span class="lineCov">        210 :         if (HT_IS_PACKED(Z_ARRVAL_P(stack))) {</span></a>
<a name="3222"><span class="lineNum">    3222 </span>            :                 /* Get the last value and copy it into the return value */</a>
<a name="3223"><span class="lineNum">    3223 </span><span class="lineCov">        180 :                 idx = Z_ARRVAL_P(stack)-&gt;nNumUsed;</span></a>
<a name="3224"><span class="lineNum">    3224 </span>            :                 while (1) {</a>
<a name="3225"><span class="lineNum">    3225 </span><span class="lineCov">        180 :                         if (idx == 0) {</span></a>
<a name="3226"><span class="lineNum">    3226 </span><span class="lineNoCov">          0 :                                 return;</span></a>
<a name="3227"><span class="lineNum">    3227 </span>            :                         }</a>
<a name="3228"><span class="lineNum">    3228 </span><span class="lineCov">        180 :                         idx--;</span></a>
<a name="3229"><span class="lineNum">    3229 </span><span class="lineCov">        180 :                         val = Z_ARRVAL_P(stack)-&gt;arPacked + idx;</span></a>
<a name="3230"><span class="lineNum">    3230 </span><span class="lineCov">        180 :                         if (Z_TYPE_P(val) != IS_UNDEF) {</span></a>
<a name="3231"><span class="lineNum">    3231 </span><span class="lineCov">        180 :                                 break;</span></a>
<a name="3232"><span class="lineNum">    3232 </span>            :                         }</a>
<a name="3233"><span class="lineNum">    3233 </span>            :                 }</a>
<a name="3234"><span class="lineNum">    3234 </span><span class="lineCov">        180 :                 RETVAL_COPY_DEREF(val);</span></a>
<a name="3235"><span class="lineNum">    3235 </span>            : </a>
<a name="3236"><span class="lineNum">    3236 </span><span class="lineCov">        180 :                 if (idx == (Z_ARRVAL_P(stack)-&gt;nNextFreeElement - 1)) {</span></a>
<a name="3237"><span class="lineNum">    3237 </span><span class="lineCov">        180 :                         Z_ARRVAL_P(stack)-&gt;nNextFreeElement = Z_ARRVAL_P(stack)-&gt;nNextFreeElement - 1;</span></a>
<a name="3238"><span class="lineNum">    3238 </span>            :                 }</a>
<a name="3239"><span class="lineNum">    3239 </span>            : </a>
<a name="3240"><span class="lineNum">    3240 </span>            :                 /* Delete the last value */</a>
<a name="3241"><span class="lineNum">    3241 </span><span class="lineCov">        180 :                 zend_hash_packed_del_val(Z_ARRVAL_P(stack), val);</span></a>
<a name="3242"><span class="lineNum">    3242 </span>            :         } else {</a>
<a name="3243"><span class="lineNum">    3243 </span>            :                 Bucket *p;</a>
<a name="3244"><span class="lineNum">    3244 </span>            : </a>
<a name="3245"><span class="lineNum">    3245 </span>            :                 /* Get the last value and copy it into the return value */</a>
<a name="3246"><span class="lineNum">    3246 </span><span class="lineCov">         30 :                 idx = Z_ARRVAL_P(stack)-&gt;nNumUsed;</span></a>
<a name="3247"><span class="lineNum">    3247 </span>            :                 while (1) {</a>
<a name="3248"><span class="lineNum">    3248 </span><span class="lineCov">         30 :                         if (idx == 0) {</span></a>
<a name="3249"><span class="lineNum">    3249 </span><span class="lineNoCov">          0 :                                 return;</span></a>
<a name="3250"><span class="lineNum">    3250 </span>            :                         }</a>
<a name="3251"><span class="lineNum">    3251 </span><span class="lineCov">         30 :                         idx--;</span></a>
<a name="3252"><span class="lineNum">    3252 </span><span class="lineCov">         30 :                         p = Z_ARRVAL_P(stack)-&gt;arData + idx;</span></a>
<a name="3253"><span class="lineNum">    3253 </span><span class="lineCov">         30 :                         val = &amp;p-&gt;val;</span></a>
<a name="3254"><span class="lineNum">    3254 </span><span class="lineCov">         30 :                         if (Z_TYPE_P(val) != IS_UNDEF) {</span></a>
<a name="3255"><span class="lineNum">    3255 </span><span class="lineCov">         30 :                                 break;</span></a>
<a name="3256"><span class="lineNum">    3256 </span>            :                         }</a>
<a name="3257"><span class="lineNum">    3257 </span>            :                 }</a>
<a name="3258"><span class="lineNum">    3258 </span><span class="lineCov">         30 :                 RETVAL_COPY_DEREF(val);</span></a>
<a name="3259"><span class="lineNum">    3259 </span>            : </a>
<a name="3260"><span class="lineNum">    3260 </span><span class="lineCov">         30 :                 if (!p-&gt;key &amp;&amp; (zend_long)p-&gt;h == (Z_ARRVAL_P(stack)-&gt;nNextFreeElement - 1)) {</span></a>
<a name="3261"><span class="lineNum">    3261 </span><span class="lineCov">         15 :                         Z_ARRVAL_P(stack)-&gt;nNextFreeElement = Z_ARRVAL_P(stack)-&gt;nNextFreeElement - 1;</span></a>
<a name="3262"><span class="lineNum">    3262 </span>            :                 }</a>
<a name="3263"><span class="lineNum">    3263 </span>            : </a>
<a name="3264"><span class="lineNum">    3264 </span>            :                 /* Delete the last value */</a>
<a name="3265"><span class="lineNum">    3265 </span><span class="lineCov">         30 :                 zend_hash_del_bucket(Z_ARRVAL_P(stack), p);</span></a>
<a name="3266"><span class="lineNum">    3266 </span>            :         }</a>
<a name="3267"><span class="lineNum">    3267 </span><span class="lineCov">        210 :         zend_hash_internal_pointer_reset(Z_ARRVAL_P(stack));</span></a>
<a name="3268"><span class="lineNum">    3268 </span>            : }</a>
<a name="3269"><span class="lineNum">    3269 </span>            : /* }}} */</a>
<a name="3270"><span class="lineNum">    3270 </span>            : </a>
<a name="3271"><span class="lineNum">    3271 </span>            : /* {{{ Pops an element off the beginning of the array */</a>
<a name="3272"><span class="lineNum">    3272 </span><span class="lineCov">      20116 : PHP_FUNCTION(array_shift)</span></a>
<a name="3273"><span class="lineNum">    3273 </span>            : {</a>
<a name="3274"><span class="lineNum">    3274 </span>            :         zval *stack,    /* Input stack */</a>
<a name="3275"><span class="lineNum">    3275 </span>            :                  *val;          /* Value to be popped */</a>
<a name="3276"><span class="lineNum">    3276 </span>            :         uint32_t idx;</a>
<a name="3277"><span class="lineNum">    3277 </span>            : </a>
<a name="3278"><span class="lineNum">    3278 </span><span class="lineCov">      20116 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="3279"><span class="lineNum">    3279 </span><span class="lineCov">     120660 :                 Z_PARAM_ARRAY_EX(stack, 0, 1)</span></a>
<a name="3280"><span class="lineNum">    3280 </span><span class="lineCov">      20128 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="3281"><span class="lineNum">    3281 </span>            : </a>
<a name="3282"><span class="lineNum">    3282 </span><span class="lineCov">      20110 :         if (zend_hash_num_elements(Z_ARRVAL_P(stack)) == 0) {</span></a>
<a name="3283"><span class="lineNum">    3283 </span><span class="lineCov">         12 :                 return;</span></a>
<a name="3284"><span class="lineNum">    3284 </span>            :         }</a>
<a name="3285"><span class="lineNum">    3285 </span>            : </a>
<a name="3286"><span class="lineNum">    3286 </span>            :         /* re-index like it did before */</a>
<a name="3287"><span class="lineNum">    3287 </span><span class="lineCov">      20098 :         if (HT_IS_PACKED(Z_ARRVAL_P(stack))) {</span></a>
<a name="3288"><span class="lineNum">    3288 </span><span class="lineCov">      20050 :                 uint32_t k = 0;</span></a>
<a name="3289"><span class="lineNum">    3289 </span>            : </a>
<a name="3290"><span class="lineNum">    3290 </span>            :                 /* Get the first value and copy it into the return value */</a>
<a name="3291"><span class="lineNum">    3291 </span><span class="lineCov">      20050 :                 idx = 0;</span></a>
<a name="3292"><span class="lineNum">    3292 </span>            :                 while (1) {</a>
<a name="3293"><span class="lineNum">    3293 </span><span class="lineCov">      20056 :                         if (idx == Z_ARRVAL_P(stack)-&gt;nNumUsed) {</span></a>
<a name="3294"><span class="lineNum">    3294 </span><span class="lineNoCov">          0 :                                 return;</span></a>
<a name="3295"><span class="lineNum">    3295 </span>            :                         }</a>
<a name="3296"><span class="lineNum">    3296 </span><span class="lineCov">      20056 :                         val = Z_ARRVAL_P(stack)-&gt;arPacked + idx;</span></a>
<a name="3297"><span class="lineNum">    3297 </span><span class="lineCov">      20056 :                         if (Z_TYPE_P(val) != IS_UNDEF) {</span></a>
<a name="3298"><span class="lineNum">    3298 </span><span class="lineCov">      20050 :                                 break;</span></a>
<a name="3299"><span class="lineNum">    3299 </span>            :                         }</a>
<a name="3300"><span class="lineNum">    3300 </span><span class="lineCov">          6 :                         idx++;</span></a>
<a name="3301"><span class="lineNum">    3301 </span>            :                 }</a>
<a name="3302"><span class="lineNum">    3302 </span><span class="lineCov">      20050 :                 RETVAL_COPY_DEREF(val);</span></a>
<a name="3303"><span class="lineNum">    3303 </span>            : </a>
<a name="3304"><span class="lineNum">    3304 </span>            :                 /* Delete the first value */</a>
<a name="3305"><span class="lineNum">    3305 </span><span class="lineCov">      20050 :                 zend_hash_packed_del_val(Z_ARRVAL_P(stack), val);</span></a>
<a name="3306"><span class="lineNum">    3306 </span>            : </a>
<a name="3307"><span class="lineNum">    3307 </span><span class="lineCov">      20050 :                 if (EXPECTED(!HT_HAS_ITERATORS(Z_ARRVAL_P(stack)))) {</span></a>
<a name="3308"><span class="lineNum">    3308 </span><span class="lineCov">   13139300 :                         for (idx = 0; idx &lt; Z_ARRVAL_P(stack)-&gt;nNumUsed; idx++) {</span></a>
<a name="3309"><span class="lineNum">    3309 </span><span class="lineCov">   13119300 :                                 val = Z_ARRVAL_P(stack)-&gt;arPacked + idx;</span></a>
<a name="3310"><span class="lineNum">    3310 </span><span class="lineCov">   13119300 :                                 if (Z_TYPE_P(val) == IS_UNDEF) continue;</span></a>
<a name="3311"><span class="lineNum">    3311 </span><span class="lineCov">   13099500 :                                 if (idx != k) {</span></a>
<a name="3312"><span class="lineNum">    3312 </span><span class="lineCov">   13099500 :                                         zval *q = Z_ARRVAL_P(stack)-&gt;arPacked + k;</span></a>
<a name="3313"><span class="lineNum">    3313 </span><span class="lineCov">   13099500 :                                         ZVAL_COPY_VALUE(q, val);</span></a>
<a name="3314"><span class="lineNum">    3314 </span><span class="lineCov">   13099500 :                                         ZVAL_UNDEF(val);</span></a>
<a name="3315"><span class="lineNum">    3315 </span>            :                                 }</a>
<a name="3316"><span class="lineNum">    3316 </span><span class="lineCov">   13099500 :                                 k++;</span></a>
<a name="3317"><span class="lineNum">    3317 </span>            :                         }</a>
<a name="3318"><span class="lineNum">    3318 </span>            :                 } else {</a>
<a name="3319"><span class="lineNum">    3319 </span><span class="lineCov">         72 :                         uint32_t iter_pos = zend_hash_iterators_lower_pos(Z_ARRVAL_P(stack), 0);</span></a>
<a name="3320"><span class="lineNum">    3320 </span>            : </a>
<a name="3321"><span class="lineNum">    3321 </span><span class="lineCov">        195 :                         for (idx = 0; idx &lt; Z_ARRVAL_P(stack)-&gt;nNumUsed; idx++) {</span></a>
<a name="3322"><span class="lineNum">    3322 </span><span class="lineCov">        123 :                                 val = Z_ARRVAL_P(stack)-&gt;arPacked + idx;</span></a>
<a name="3323"><span class="lineNum">    3323 </span><span class="lineCov">        123 :                                 if (Z_TYPE_P(val) == IS_UNDEF) continue;</span></a>
<a name="3324"><span class="lineNum">    3324 </span><span class="lineCov">         78 :                                 if (idx != k) {</span></a>
<a name="3325"><span class="lineNum">    3325 </span><span class="lineCov">         78 :                                         zval *q = Z_ARRVAL_P(stack)-&gt;arPacked + k;</span></a>
<a name="3326"><span class="lineNum">    3326 </span><span class="lineCov">         78 :                                         ZVAL_COPY_VALUE(q, val);</span></a>
<a name="3327"><span class="lineNum">    3327 </span><span class="lineCov">         78 :                                         ZVAL_UNDEF(val);</span></a>
<a name="3328"><span class="lineNum">    3328 </span><span class="lineCov">         78 :                                         if (idx == iter_pos) {</span></a>
<a name="3329"><span class="lineNum">    3329 </span><span class="lineCov">         45 :                                                 zend_hash_iterators_update(Z_ARRVAL_P(stack), idx, k);</span></a>
<a name="3330"><span class="lineNum">    3330 </span><span class="lineCov">         45 :                                                 iter_pos = zend_hash_iterators_lower_pos(Z_ARRVAL_P(stack), iter_pos + 1);</span></a>
<a name="3331"><span class="lineNum">    3331 </span>            :                                         }</a>
<a name="3332"><span class="lineNum">    3332 </span>            :                                 }</a>
<a name="3333"><span class="lineNum">    3333 </span><span class="lineCov">         78 :                                 k++;</span></a>
<a name="3334"><span class="lineNum">    3334 </span>            :                         }</a>
<a name="3335"><span class="lineNum">    3335 </span>            :                 }</a>
<a name="3336"><span class="lineNum">    3336 </span><span class="lineCov">      20050 :                 Z_ARRVAL_P(stack)-&gt;nNumUsed = k;</span></a>
<a name="3337"><span class="lineNum">    3337 </span><span class="lineCov">      20050 :                 Z_ARRVAL_P(stack)-&gt;nNextFreeElement = k;</span></a>
<a name="3338"><span class="lineNum">    3338 </span>            :         } else {</a>
<a name="3339"><span class="lineNum">    3339 </span><span class="lineCov">         48 :                 uint32_t k = 0;</span></a>
<a name="3340"><span class="lineNum">    3340 </span><span class="lineCov">         48 :                 int should_rehash = 0;</span></a>
<a name="3341"><span class="lineNum">    3341 </span>            :                 Bucket *p;</a>
<a name="3342"><span class="lineNum">    3342 </span>            : </a>
<a name="3343"><span class="lineNum">    3343 </span>            :                 /* Get the first value and copy it into the return value */</a>
<a name="3344"><span class="lineNum">    3344 </span><span class="lineCov">         48 :                 idx = 0;</span></a>
<a name="3345"><span class="lineNum">    3345 </span>            :                 while (1) {</a>
<a name="3346"><span class="lineNum">    3346 </span><span class="lineCov">         48 :                         if (idx == Z_ARRVAL_P(stack)-&gt;nNumUsed) {</span></a>
<a name="3347"><span class="lineNum">    3347 </span><span class="lineNoCov">          0 :                                 return;</span></a>
<a name="3348"><span class="lineNum">    3348 </span>            :                         }</a>
<a name="3349"><span class="lineNum">    3349 </span><span class="lineCov">         48 :                         p = Z_ARRVAL_P(stack)-&gt;arData + idx;</span></a>
<a name="3350"><span class="lineNum">    3350 </span><span class="lineCov">         48 :                         val = &amp;p-&gt;val;</span></a>
<a name="3351"><span class="lineNum">    3351 </span><span class="lineCov">         48 :                         if (Z_TYPE_P(val) != IS_UNDEF) {</span></a>
<a name="3352"><span class="lineNum">    3352 </span><span class="lineCov">         48 :                                 break;</span></a>
<a name="3353"><span class="lineNum">    3353 </span>            :                         }</a>
<a name="3354"><span class="lineNum">    3354 </span><span class="lineNoCov">          0 :                         idx++;</span></a>
<a name="3355"><span class="lineNum">    3355 </span>            :                 }</a>
<a name="3356"><span class="lineNum">    3356 </span><span class="lineCov">         48 :                 RETVAL_COPY_DEREF(val);</span></a>
<a name="3357"><span class="lineNum">    3357 </span>            : </a>
<a name="3358"><span class="lineNum">    3358 </span>            :                 /* Delete the first value */</a>
<a name="3359"><span class="lineNum">    3359 </span><span class="lineCov">         48 :                 zend_hash_del_bucket(Z_ARRVAL_P(stack), p);</span></a>
<a name="3360"><span class="lineNum">    3360 </span>            : </a>
<a name="3361"><span class="lineNum">    3361 </span><span class="lineCov">        189 :                 for (idx = 0; idx &lt; Z_ARRVAL_P(stack)-&gt;nNumUsed; idx++) {</span></a>
<a name="3362"><span class="lineNum">    3362 </span><span class="lineCov">        141 :                         p = Z_ARRVAL_P(stack)-&gt;arData + idx;</span></a>
<a name="3363"><span class="lineNum">    3363 </span><span class="lineCov">        282 :                         if (Z_TYPE(p-&gt;val) == IS_UNDEF) continue;</span></a>
<a name="3364"><span class="lineNum">    3364 </span><span class="lineCov">        111 :                         if (p-&gt;key == NULL) {</span></a>
<a name="3365"><span class="lineNum">    3365 </span><span class="lineCov">         57 :                                 if (p-&gt;h != k) {</span></a>
<a name="3366"><span class="lineNum">    3366 </span><span class="lineCov">         39 :                                         p-&gt;h = k++;</span></a>
<a name="3367"><span class="lineNum">    3367 </span><span class="lineCov">         39 :                                         should_rehash = 1;</span></a>
<a name="3368"><span class="lineNum">    3368 </span>            :                                 } else {</a>
<a name="3369"><span class="lineNum">    3369 </span><span class="lineCov">         18 :                                         k++;</span></a>
<a name="3370"><span class="lineNum">    3370 </span>            :                                 }</a>
<a name="3371"><span class="lineNum">    3371 </span>            :                         }</a>
<a name="3372"><span class="lineNum">    3372 </span>            :                 }</a>
<a name="3373"><span class="lineNum">    3373 </span><span class="lineCov">         48 :                 Z_ARRVAL_P(stack)-&gt;nNextFreeElement = k;</span></a>
<a name="3374"><span class="lineNum">    3374 </span><span class="lineCov">         48 :                 if (should_rehash) {</span></a>
<a name="3375"><span class="lineNum">    3375 </span><span class="lineCov">         12 :                         zend_hash_rehash(Z_ARRVAL_P(stack));</span></a>
<a name="3376"><span class="lineNum">    3376 </span>            :                 }</a>
<a name="3377"><span class="lineNum">    3377 </span>            :         }</a>
<a name="3378"><span class="lineNum">    3378 </span>            : </a>
<a name="3379"><span class="lineNum">    3379 </span><span class="lineCov">      20098 :         zend_hash_internal_pointer_reset(Z_ARRVAL_P(stack));</span></a>
<a name="3380"><span class="lineNum">    3380 </span>            : }</a>
<a name="3381"><span class="lineNum">    3381 </span>            : /* }}} */</a>
<a name="3382"><span class="lineNum">    3382 </span>            : </a>
<a name="3383"><span class="lineNum">    3383 </span>            : /* {{{ Pushes elements onto the beginning of the array */</a>
<a name="3384"><span class="lineNum">    3384 </span><span class="lineCov">        696 : PHP_FUNCTION(array_unshift)</span></a>
<a name="3385"><span class="lineNum">    3385 </span>            : {</a>
<a name="3386"><span class="lineNum">    3386 </span>            :         zval   *args,                   /* Function arguments array */</a>
<a name="3387"><span class="lineNum">    3387 </span>            :                    *stack;                      /* Input stack */</a>
<a name="3388"><span class="lineNum">    3388 </span>            :         HashTable new_hash;             /* New hashtable for the stack */</a>
<a name="3389"><span class="lineNum">    3389 </span>            :         int argc;                               /* Number of function arguments */</a>
<a name="3390"><span class="lineNum">    3390 </span>            :         int i;</a>
<a name="3391"><span class="lineNum">    3391 </span>            :         zend_string *key;</a>
<a name="3392"><span class="lineNum">    3392 </span>            :         zval *value;</a>
<a name="3393"><span class="lineNum">    3393 </span>            : </a>
<a name="3394"><span class="lineNum">    3394 </span><span class="lineCov">        696 :         ZEND_PARSE_PARAMETERS_START(1, -1)</span></a>
<a name="3395"><span class="lineNum">    3395 </span><span class="lineCov">       4140 :                 Z_PARAM_ARRAY_EX(stack, 0, 1)</span></a>
<a name="3396"><span class="lineNum">    3396 </span><span class="lineCov">        690 :                 Z_PARAM_VARIADIC('+', args, argc)</span></a>
<a name="3397"><span class="lineNum">    3397 </span><span class="lineCov">        696 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="3398"><span class="lineNum">    3398 </span>            : </a>
<a name="3399"><span class="lineNum">    3399 </span><span class="lineCov">        690 :         zend_hash_init(&amp;new_hash, zend_hash_num_elements(Z_ARRVAL_P(stack)) + argc, NULL, ZVAL_PTR_DTOR, 0);</span></a>
<a name="3400"><span class="lineNum">    3400 </span><span class="lineCov">       1947 :         for (i = 0; i &lt; argc; i++) {</span></a>
<a name="3401"><span class="lineNum">    3401 </span><span class="lineCov">       1257 :                 Z_TRY_ADDREF(args[i]);</span></a>
<a name="3402"><span class="lineNum">    3402 </span><span class="lineCov">       1257 :                 zend_hash_next_index_insert_new(&amp;new_hash, &amp;args[i]);</span></a>
<a name="3403"><span class="lineNum">    3403 </span>            :         }</a>
<a name="3404"><span class="lineNum">    3404 </span>            : </a>
<a name="3405"><span class="lineNum">    3405 </span><span class="lineCov">       5592 :         ZEND_HASH_FOREACH_STR_KEY_VAL(Z_ARRVAL_P(stack), key, value) {</span></a>
<a name="3406"><span class="lineNum">    3406 </span><span class="lineCov">       2436 :                 if (key) {</span></a>
<a name="3407"><span class="lineNum">    3407 </span><span class="lineCov">        930 :                         zend_hash_add_new(&amp;new_hash, key, value);</span></a>
<a name="3408"><span class="lineNum">    3408 </span>            :                 } else {</a>
<a name="3409"><span class="lineNum">    3409 </span><span class="lineCov">       1506 :                         zend_hash_next_index_insert_new(&amp;new_hash, value);</span></a>
<a name="3410"><span class="lineNum">    3410 </span>            :                 }</a>
<a name="3411"><span class="lineNum">    3411 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="3412"><span class="lineNum">    3412 </span>            : </a>
<a name="3413"><span class="lineNum">    3413 </span><span class="lineCov">        690 :         if (UNEXPECTED(HT_HAS_ITERATORS(Z_ARRVAL_P(stack)))) {</span></a>
<a name="3414"><span class="lineNum">    3414 </span><span class="lineCov">         63 :                 zend_hash_iterators_advance(Z_ARRVAL_P(stack), argc);</span></a>
<a name="3415"><span class="lineNum">    3415 </span><span class="lineCov">         63 :                 HT_SET_ITERATORS_COUNT(&amp;new_hash, HT_ITERATORS_COUNT(Z_ARRVAL_P(stack)));</span></a>
<a name="3416"><span class="lineNum">    3416 </span><span class="lineCov">         63 :                 HT_SET_ITERATORS_COUNT(Z_ARRVAL_P(stack), 0);</span></a>
<a name="3417"><span class="lineNum">    3417 </span>            :         }</a>
<a name="3418"><span class="lineNum">    3418 </span>            : </a>
<a name="3419"><span class="lineNum">    3419 </span>            :         /* replace HashTable data */</a>
<a name="3420"><span class="lineNum">    3420 </span><span class="lineCov">        690 :         Z_ARRVAL_P(stack)-&gt;pDestructor = NULL;</span></a>
<a name="3421"><span class="lineNum">    3421 </span><span class="lineCov">        690 :         zend_hash_destroy(Z_ARRVAL_P(stack));</span></a>
<a name="3422"><span class="lineNum">    3422 </span>            : </a>
<a name="3423"><span class="lineNum">    3423 </span><span class="lineCov">        690 :         HT_FLAGS(Z_ARRVAL_P(stack))          = HT_FLAGS(&amp;new_hash);</span></a>
<a name="3424"><span class="lineNum">    3424 </span><span class="lineCov">        690 :         Z_ARRVAL_P(stack)-&gt;nTableSize        = new_hash.nTableSize;</span></a>
<a name="3425"><span class="lineNum">    3425 </span><span class="lineCov">        690 :         Z_ARRVAL_P(stack)-&gt;nTableMask        = new_hash.nTableMask;</span></a>
<a name="3426"><span class="lineNum">    3426 </span><span class="lineCov">        690 :         Z_ARRVAL_P(stack)-&gt;nNumUsed          = new_hash.nNumUsed;</span></a>
<a name="3427"><span class="lineNum">    3427 </span><span class="lineCov">        690 :         Z_ARRVAL_P(stack)-&gt;nNumOfElements    = new_hash.nNumOfElements;</span></a>
<a name="3428"><span class="lineNum">    3428 </span><span class="lineCov">        690 :         Z_ARRVAL_P(stack)-&gt;nNextFreeElement  = new_hash.nNextFreeElement;</span></a>
<a name="3429"><span class="lineNum">    3429 </span><span class="lineCov">        690 :         Z_ARRVAL_P(stack)-&gt;arData            = new_hash.arData;</span></a>
<a name="3430"><span class="lineNum">    3430 </span><span class="lineCov">        690 :         Z_ARRVAL_P(stack)-&gt;pDestructor       = new_hash.pDestructor;</span></a>
<a name="3431"><span class="lineNum">    3431 </span>            : </a>
<a name="3432"><span class="lineNum">    3432 </span><span class="lineCov">        690 :         zend_hash_internal_pointer_reset(Z_ARRVAL_P(stack));</span></a>
<a name="3433"><span class="lineNum">    3433 </span>            : </a>
<a name="3434"><span class="lineNum">    3434 </span>            :         /* Clean up and return the number of elements in the stack */</a>
<a name="3435"><span class="lineNum">    3435 </span><span class="lineCov">        690 :         RETVAL_LONG(zend_hash_num_elements(Z_ARRVAL_P(stack)));</span></a>
<a name="3436"><span class="lineNum">    3436 </span>            : }</a>
<a name="3437"><span class="lineNum">    3437 </span>            : /* }}} */</a>
<a name="3438"><span class="lineNum">    3438 </span>            : </a>
<a name="3439"><span class="lineNum">    3439 </span>            : /* {{{ Removes the elements designated by offset and length and replace them with supplied array */</a>
<a name="3440"><span class="lineNum">    3440 </span><span class="lineCov">        204 : PHP_FUNCTION(array_splice)</span></a>
<a name="3441"><span class="lineNum">    3441 </span>            : {</a>
<a name="3442"><span class="lineNum">    3442 </span>            :         zval *array,                            /* Input array */</a>
<a name="3443"><span class="lineNum">    3443 </span><span class="lineCov">        204 :                  *repl_array = NULL;    /* Replacement array */</span></a>
<a name="3444"><span class="lineNum">    3444 </span><span class="lineCov">        204 :         HashTable  *rem_hash = NULL;</span></a>
<a name="3445"><span class="lineNum">    3445 </span>            :         zend_long offset,</a>
<a name="3446"><span class="lineNum">    3446 </span><span class="lineCov">        204 :                         length = 0;</span></a>
<a name="3447"><span class="lineNum">    3447 </span><span class="lineCov">        204 :         bool length_is_null = 1;</span></a>
<a name="3448"><span class="lineNum">    3448 </span>            :         int             num_in;                         /* Number of elements in the input array */</a>
<a name="3449"><span class="lineNum">    3449 </span>            : </a>
<a name="3450"><span class="lineNum">    3450 </span><span class="lineCov">        204 :         ZEND_PARSE_PARAMETERS_START(2, 4)</span></a>
<a name="3451"><span class="lineNum">    3451 </span><span class="lineCov">       1188 :                 Z_PARAM_ARRAY_EX(array, 0, 1)</span></a>
<a name="3452"><span class="lineNum">    3452 </span><span class="lineCov">        396 :                 Z_PARAM_LONG(offset)</span></a>
<a name="3453"><span class="lineNum">    3453 </span><span class="lineCov">        198 :                 Z_PARAM_OPTIONAL</span></a>
<a name="3454"><span class="lineNum">    3454 </span><span class="lineCov">        387 :                 Z_PARAM_LONG_OR_NULL(length, length_is_null)</span></a>
<a name="3455"><span class="lineNum">    3455 </span><span class="lineCov">        189 :                 Z_PARAM_ZVAL(repl_array)</span></a>
<a name="3456"><span class="lineNum">    3456 </span><span class="lineCov">        204 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="3457"><span class="lineNum">    3457 </span>            : </a>
<a name="3458"><span class="lineNum">    3458 </span><span class="lineCov">        198 :         num_in = zend_hash_num_elements(Z_ARRVAL_P(array));</span></a>
<a name="3459"><span class="lineNum">    3459 </span>            : </a>
<a name="3460"><span class="lineNum">    3460 </span><span class="lineCov">        198 :         if (length_is_null) {</span></a>
<a name="3461"><span class="lineNum">    3461 </span><span class="lineCov">         12 :                 length = num_in;</span></a>
<a name="3462"><span class="lineNum">    3462 </span>            :         }</a>
<a name="3463"><span class="lineNum">    3463 </span>            : </a>
<a name="3464"><span class="lineNum">    3464 </span><span class="lineCov">        198 :         if (ZEND_NUM_ARGS() == 4) {</span></a>
<a name="3465"><span class="lineNum">    3465 </span>            :                 /* Make sure the last argument, if passed, is an array */</a>
<a name="3466"><span class="lineNum">    3466 </span><span class="lineCov">         96 :                 convert_to_array(repl_array);</span></a>
<a name="3467"><span class="lineNum">    3467 </span>            :         }</a>
<a name="3468"><span class="lineNum">    3468 </span>            : </a>
<a name="3469"><span class="lineNum">    3469 </span>            :         /* Don't create the array of removed elements if it's not going</a>
<a name="3470"><span class="lineNum">    3470 </span>            :          * to be used; e.g. only removing and/or replacing elements */</a>
<a name="3471"><span class="lineNum">    3471 </span><span class="lineCov">        198 :         if (USED_RET()) {</span></a>
<a name="3472"><span class="lineNum">    3472 </span><span class="lineCov">        165 :                 zend_long size = length;</span></a>
<a name="3473"><span class="lineNum">    3473 </span>            : </a>
<a name="3474"><span class="lineNum">    3474 </span>            :                 /* Clamp the offset.. */</a>
<a name="3475"><span class="lineNum">    3475 </span><span class="lineCov">        165 :                 if (offset &gt; num_in) {</span></a>
<a name="3476"><span class="lineNum">    3476 </span><span class="lineNoCov">          0 :                         offset = num_in;</span></a>
<a name="3477"><span class="lineNum">    3477 </span><span class="lineCov">        165 :                 } else if (offset &lt; 0 &amp;&amp; (offset = (num_in + offset)) &lt; 0) {</span></a>
<a name="3478"><span class="lineNum">    3478 </span><span class="lineNoCov">          0 :                         offset = 0;</span></a>
<a name="3479"><span class="lineNum">    3479 </span>            :                 }</a>
<a name="3480"><span class="lineNum">    3480 </span>            : </a>
<a name="3481"><span class="lineNum">    3481 </span>            :                 /* ..and the length */</a>
<a name="3482"><span class="lineNum">    3482 </span><span class="lineCov">        165 :                 if (length &lt; 0) {</span></a>
<a name="3483"><span class="lineNum">    3483 </span><span class="lineCov">         45 :                         size = num_in - offset + length;</span></a>
<a name="3484"><span class="lineNum">    3484 </span><span class="lineCov">        120 :                 } else if (((zend_ulong) offset + (zend_ulong) length) &gt; (uint32_t) num_in) {</span></a>
<a name="3485"><span class="lineNum">    3485 </span><span class="lineCov">         33 :                         size = num_in - offset;</span></a>
<a name="3486"><span class="lineNum">    3486 </span>            :                 }</a>
<a name="3487"><span class="lineNum">    3487 </span>            : </a>
<a name="3488"><span class="lineNum">    3488 </span>            :                 /* Initialize return value */</a>
<a name="3489"><span class="lineNum">    3489 </span><span class="lineCov">        165 :                 array_init_size(return_value, size &gt; 0 ? (uint32_t)size : 0);</span></a>
<a name="3490"><span class="lineNum">    3490 </span><span class="lineCov">        165 :                 rem_hash = Z_ARRVAL_P(return_value);</span></a>
<a name="3491"><span class="lineNum">    3491 </span>            :         } else {</a>
<a name="3492"><span class="lineNum">    3492 </span>            :                 /* The return value will not be used, but make sure it still has the correct type. */</a>
<a name="3493"><span class="lineNum">    3493 </span><span class="lineCov">         33 :                 RETVAL_EMPTY_ARRAY();</span></a>
<a name="3494"><span class="lineNum">    3494 </span>            :         }</a>
<a name="3495"><span class="lineNum">    3495 </span>            : </a>
<a name="3496"><span class="lineNum">    3496 </span>            :         /* Perform splice */</a>
<a name="3497"><span class="lineNum">    3497 </span><span class="lineCov">        198 :         php_splice(Z_ARRVAL_P(array), offset, length, repl_array ? Z_ARRVAL_P(repl_array) : NULL, rem_hash);</span></a>
<a name="3498"><span class="lineNum">    3498 </span>            : }</a>
<a name="3499"><span class="lineNum">    3499 </span>            : /* }}} */</a>
<a name="3500"><span class="lineNum">    3500 </span>            : </a>
<a name="3501"><span class="lineNum">    3501 </span>            : /* {{{ find_bucket_at_offset(HashTable* ht, zend_long offset)</a>
<a name="3502"><span class="lineNum">    3502 </span>            :    Finds the bucket at the given valid offset */</a>
<a name="3503"><span class="lineNum">    3503 </span><span class="lineCov">        255 : static inline Bucket* find_bucket_at_offset(HashTable* ht, zend_long offset)</span></a>
<a name="3504"><span class="lineNum">    3504 </span>            : {</a>
<a name="3505"><span class="lineNum">    3505 </span>            :         zend_long pos;</a>
<a name="3506"><span class="lineNum">    3506 </span>            :         Bucket *bucket;</a>
<a name="3507"><span class="lineNum">    3507 </span><span class="lineCov">        255 :         ZEND_ASSERT(offset &gt;= 0 &amp;&amp; offset &lt;= ht-&gt;nNumOfElements);</span></a>
<a name="3508"><span class="lineNum">    3508 </span><span class="lineCov">        255 :         if (HT_IS_WITHOUT_HOLES(ht)) {</span></a>
<a name="3509"><span class="lineNum">    3509 </span>            :                 /* There's no need to iterate over the array to filter out holes if there are no holes */</a>
<a name="3510"><span class="lineNum">    3510 </span>            :                 /* This properly handles both packed and unpacked arrays. */</a>
<a name="3511"><span class="lineNum">    3511 </span><span class="lineCov">        243 :                 return ht-&gt;arData + offset;</span></a>
<a name="3512"><span class="lineNum">    3512 </span>            :         }</a>
<a name="3513"><span class="lineNum">    3513 </span>            :         /* Otherwise, this code has to iterate over the HashTable and skip holes in the array. */</a>
<a name="3514"><span class="lineNum">    3514 </span><span class="lineCov">         12 :         pos = 0;</span></a>
<a name="3515"><span class="lineNum">    3515 </span><span class="lineCov">         30 :         ZEND_HASH_MAP_FOREACH_BUCKET(ht, bucket) {</span></a>
<a name="3516"><span class="lineNum">    3516 </span><span class="lineCov">         15 :                 if (pos &gt;= offset) {</span></a>
<a name="3517"><span class="lineNum">    3517 </span>            :                         /* This is the bucket of the array element at the requested offset */</a>
<a name="3518"><span class="lineNum">    3518 </span><span class="lineCov">         12 :                         return bucket;</span></a>
<a name="3519"><span class="lineNum">    3519 </span>            :                 }</a>
<a name="3520"><span class="lineNum">    3520 </span><span class="lineCov">          3 :                 ++pos;</span></a>
<a name="3521"><span class="lineNum">    3521 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="3522"><span class="lineNum">    3522 </span>            : </a>
<a name="3523"><span class="lineNum">    3523 </span>            :         /* Return a pointer to the end of the bucket array. */</a>
<a name="3524"><span class="lineNum">    3524 </span><span class="lineNoCov">          0 :         return ht-&gt;arData + ht-&gt;nNumUsed;</span></a>
<a name="3525"><span class="lineNum">    3525 </span>            : }</a>
<a name="3526"><span class="lineNum">    3526 </span>            : /* }}} */</a>
<a name="3527"><span class="lineNum">    3527 </span>            : </a>
<a name="3528"><span class="lineNum">    3528 </span>            : /* {{{ find_bucket_at_offset(HashTable* ht, zend_long offset)</a>
<a name="3529"><span class="lineNum">    3529 </span>            :    Finds the bucket at the given valid offset */</a>
<a name="3530"><span class="lineNum">    3530 </span><span class="lineCov">        348 : static inline zval* find_packed_val_at_offset(HashTable* ht, zend_long offset)</span></a>
<a name="3531"><span class="lineNum">    3531 </span>            : {</a>
<a name="3532"><span class="lineNum">    3532 </span>            :         zend_long pos;</a>
<a name="3533"><span class="lineNum">    3533 </span>            :         zval *zv;</a>
<a name="3534"><span class="lineNum">    3534 </span><span class="lineCov">        348 :         ZEND_ASSERT(offset &gt;= 0 &amp;&amp; offset &lt;= ht-&gt;nNumOfElements);</span></a>
<a name="3535"><span class="lineNum">    3535 </span><span class="lineCov">        348 :         if (HT_IS_WITHOUT_HOLES(ht)) {</span></a>
<a name="3536"><span class="lineNum">    3536 </span>            :                 /* There's no need to iterate over the array to filter out holes if there are no holes */</a>
<a name="3537"><span class="lineNum">    3537 </span>            :                 /* This properly handles both packed and unpacked arrays. */</a>
<a name="3538"><span class="lineNum">    3538 </span><span class="lineCov">        252 :                 return ht-&gt;arPacked + offset;</span></a>
<a name="3539"><span class="lineNum">    3539 </span>            :         }</a>
<a name="3540"><span class="lineNum">    3540 </span>            :         /* Otherwise, this code has to iterate over the HashTable and skip holes in the array. */</a>
<a name="3541"><span class="lineNum">    3541 </span><span class="lineCov">         96 :         pos = 0;</span></a>
<a name="3542"><span class="lineNum">    3542 </span><span class="lineCov">        456 :         ZEND_HASH_PACKED_FOREACH_VAL(ht, zv) {</span></a>
<a name="3543"><span class="lineNum">    3543 </span><span class="lineCov">        186 :                 if (pos &gt;= offset) {</span></a>
<a name="3544"><span class="lineNum">    3544 </span>            :                         /* This is the bucket of the array element at the requested offset */</a>
<a name="3545"><span class="lineNum">    3545 </span><span class="lineCov">         96 :                         return zv;</span></a>
<a name="3546"><span class="lineNum">    3546 </span>            :                 }</a>
<a name="3547"><span class="lineNum">    3547 </span><span class="lineCov">         90 :                 ++pos;</span></a>
<a name="3548"><span class="lineNum">    3548 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="3549"><span class="lineNum">    3549 </span>            : </a>
<a name="3550"><span class="lineNum">    3550 </span>            :         /* Return a pointer to the end of the bucket array. */</a>
<a name="3551"><span class="lineNum">    3551 </span><span class="lineNoCov">          0 :         return ht-&gt;arPacked + ht-&gt;nNumUsed;</span></a>
<a name="3552"><span class="lineNum">    3552 </span>            : }</a>
<a name="3553"><span class="lineNum">    3553 </span>            : /* }}} */</a>
<a name="3554"><span class="lineNum">    3554 </span>            : </a>
<a name="3555"><span class="lineNum">    3555 </span>            : /* {{{ Returns elements specified by offset and length */</a>
<a name="3556"><span class="lineNum">    3556 </span><span class="lineCov">       1002 : PHP_FUNCTION(array_slice)</span></a>
<a name="3557"><span class="lineNum">    3557 </span>            : {</a>
<a name="3558"><span class="lineNum">    3558 </span>            :         zval *input;                  /* Input array */</a>
<a name="3559"><span class="lineNum">    3559 </span>            :         zval *entry;                  /* An array entry */</a>
<a name="3560"><span class="lineNum">    3560 </span>            :         zend_long offset;             /* Offset to get elements from */</a>
<a name="3561"><span class="lineNum">    3561 </span><span class="lineCov">       1002 :         zend_long length = 0;         /* How many elements to get */</span></a>
<a name="3562"><span class="lineNum">    3562 </span><span class="lineCov">       1002 :         bool length_is_null = 1; /* Whether an explicit length has been omitted */</span></a>
<a name="3563"><span class="lineNum">    3563 </span><span class="lineCov">       1002 :         bool preserve_keys = 0;  /* Whether to preserve keys while copying to the new array */</span></a>
<a name="3564"><span class="lineNum">    3564 </span>            :         uint32_t num_in;              /* Number of elements in the input array */</a>
<a name="3565"><span class="lineNum">    3565 </span>            :         zend_string *string_key;</a>
<a name="3566"><span class="lineNum">    3566 </span>            :         zend_ulong num_key;</a>
<a name="3567"><span class="lineNum">    3567 </span>            : </a>
<a name="3568"><span class="lineNum">    3568 </span><span class="lineCov">       1002 :         ZEND_PARSE_PARAMETERS_START(2, 4)</span></a>
<a name="3569"><span class="lineNum">    3569 </span><span class="lineCov">       1932 :                 Z_PARAM_ARRAY(input)</span></a>
<a name="3570"><span class="lineNum">    3570 </span><span class="lineCov">       1890 :                 Z_PARAM_LONG(offset)</span></a>
<a name="3571"><span class="lineNum">    3571 </span><span class="lineCov">        945 :                 Z_PARAM_OPTIONAL</span></a>
<a name="3572"><span class="lineNum">    3572 </span><span class="lineCov">       1731 :                 Z_PARAM_LONG_OR_NULL(length, length_is_null)</span></a>
<a name="3573"><span class="lineNum">    3573 </span><span class="lineCov">       1161 :                 Z_PARAM_BOOL(preserve_keys)</span></a>
<a name="3574"><span class="lineNum">    3574 </span><span class="lineCov">       1002 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="3575"><span class="lineNum">    3575 </span>            : </a>
<a name="3576"><span class="lineNum">    3576 </span>            :         /* Get number of entries in the input hash */</a>
<a name="3577"><span class="lineNum">    3577 </span><span class="lineCov">        939 :         num_in = zend_hash_num_elements(Z_ARRVAL_P(input));</span></a>
<a name="3578"><span class="lineNum">    3578 </span>            : </a>
<a name="3579"><span class="lineNum">    3579 </span>            :         /* We want all entries from offset to the end if length is not passed or is null */</a>
<a name="3580"><span class="lineNum">    3580 </span><span class="lineCov">        939 :         if (length_is_null) {</span></a>
<a name="3581"><span class="lineNum">    3581 </span><span class="lineCov">        189 :                 length = num_in;</span></a>
<a name="3582"><span class="lineNum">    3582 </span>            :         }</a>
<a name="3583"><span class="lineNum">    3583 </span>            : </a>
<a name="3584"><span class="lineNum">    3584 </span>            :         /* Clamp the offset.. */</a>
<a name="3585"><span class="lineNum">    3585 </span><span class="lineCov">        939 :         if (offset &gt; (zend_long) num_in) {</span></a>
<a name="3586"><span class="lineNum">    3586 </span><span class="lineCov">         30 :                 RETURN_EMPTY_ARRAY();</span></a>
<a name="3587"><span class="lineNum">    3587 </span><span class="lineCov">        909 :         } else if (offset &lt; 0 &amp;&amp; (offset = (num_in + offset)) &lt; 0) {</span></a>
<a name="3588"><span class="lineNum">    3588 </span><span class="lineCov">         30 :                 offset = 0;</span></a>
<a name="3589"><span class="lineNum">    3589 </span>            :         }</a>
<a name="3590"><span class="lineNum">    3590 </span>            : </a>
<a name="3591"><span class="lineNum">    3591 </span>            :         /* ..and the length */</a>
<a name="3592"><span class="lineNum">    3592 </span><span class="lineCov">        909 :         if (length &lt; 0) {</span></a>
<a name="3593"><span class="lineNum">    3593 </span><span class="lineCov">        207 :                 length = num_in - offset + length;</span></a>
<a name="3594"><span class="lineNum">    3594 </span><span class="lineCov">        702 :         } else if (((zend_ulong) offset + (zend_ulong) length) &gt; (unsigned) num_in) {</span></a>
<a name="3595"><span class="lineNum">    3595 </span><span class="lineCov">        264 :                 length = num_in - offset;</span></a>
<a name="3596"><span class="lineNum">    3596 </span>            :         }</a>
<a name="3597"><span class="lineNum">    3597 </span>            : </a>
<a name="3598"><span class="lineNum">    3598 </span><span class="lineCov">        909 :         if (length &lt;= 0) {</span></a>
<a name="3599"><span class="lineNum">    3599 </span><span class="lineCov">        306 :                 RETURN_EMPTY_ARRAY();</span></a>
<a name="3600"><span class="lineNum">    3600 </span>            :         }</a>
<a name="3601"><span class="lineNum">    3601 </span>            : </a>
<a name="3602"><span class="lineNum">    3602 </span>            :         /* Initialize returned array */</a>
<a name="3603"><span class="lineNum">    3603 </span><span class="lineCov">        603 :         array_init_size(return_value, (uint32_t)length);</span></a>
<a name="3604"><span class="lineNum">    3604 </span>            : </a>
<a name="3605"><span class="lineNum">    3605 </span>            :         // Contains modified variants of ZEND_HASH_FOREACH_VAL</a>
<a name="3606"><span class="lineNum">    3606 </span>            :         {</a>
<a name="3607"><span class="lineNum">    3607 </span><span class="lineCov">        603 :                 HashTable *ht = Z_ARRVAL_P(input);</span></a>
<a name="3608"><span class="lineNum">    3608 </span>            : </a>
<a name="3609"><span class="lineNum">    3609 </span>            :                 /* Start at the beginning and go until we hit offset */</a>
<a name="3610"><span class="lineNum">    3610 </span><span class="lineCov">        603 :                 if (HT_IS_PACKED(ht)) {</span></a>
<a name="3611"><span class="lineNum">    3611 </span><span class="lineCov">        348 :                         zval *zv = find_packed_val_at_offset(ht, offset);</span></a>
<a name="3612"><span class="lineNum">    3612 </span><span class="lineCov">        348 :                         zval *end = ht-&gt;arPacked + ht-&gt;nNumUsed;</span></a>
<a name="3613"><span class="lineNum">    3613 </span>            : </a>
<a name="3614"><span class="lineNum">    3614 </span><span class="lineCov">        348 :                         if (!preserve_keys</span></a>
<a name="3615"><span class="lineNum">    3615 </span><span class="lineCov">        114 :                          || (offset == 0 &amp;&amp; HT_IS_WITHOUT_HOLES(ht))) {</span></a>
<a name="3616"><span class="lineNum">    3616 </span><span class="lineCov">        264 :                                 zend_hash_real_init_packed(Z_ARRVAL_P(return_value));</span></a>
<a name="3617"><span class="lineNum">    3617 </span><span class="lineCov">        264 :                                 ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="3618"><span class="lineNum">    3618 </span><span class="lineCov">       1032 :                                         for (; zv != end; zv++) {</span></a>
<a name="3619"><span class="lineNum">    3619 </span><span class="lineCov">        882 :                                                 if (__fill_idx &gt;= length) {</span></a>
<a name="3620"><span class="lineNum">    3620 </span><span class="lineCov">        114 :                                                         break;</span></a>
<a name="3621"><span class="lineNum">    3621 </span>            :                                                 }</a>
<a name="3622"><span class="lineNum">    3622 </span><span class="lineCov">        768 :                                                 if (UNEXPECTED(Z_TYPE_P(zv) == IS_UNDEF)) {</span></a>
<a name="3623"><span class="lineNum">    3623 </span><span class="lineCov">          9 :                                                         continue;</span></a>
<a name="3624"><span class="lineNum">    3624 </span>            :                                                 }</a>
<a name="3625"><span class="lineNum">    3625 </span><span class="lineCov">        759 :                                                 entry = zv;</span></a>
<a name="3626"><span class="lineNum">    3626 </span><span class="lineCov">        759 :                                                 if (UNEXPECTED(Z_ISREF_P(entry)) &amp;&amp;</span></a>
<a name="3627"><span class="lineNum">    3627 </span><span class="lineCov">         12 :                                                         UNEXPECTED(Z_REFCOUNT_P(entry) == 1)) {</span></a>
<a name="3628"><span class="lineNum">    3628 </span><span class="lineCov">         12 :                                                         entry = Z_REFVAL_P(entry);</span></a>
<a name="3629"><span class="lineNum">    3629 </span>            :                                                 }</a>
<a name="3630"><span class="lineNum">    3630 </span><span class="lineCov">        759 :                                                 Z_TRY_ADDREF_P(entry);</span></a>
<a name="3631"><span class="lineNum">    3631 </span><span class="lineCov">        759 :                                                 ZEND_HASH_FILL_ADD(entry);</span></a>
<a name="3632"><span class="lineNum">    3632 </span>            :                                         }</a>
<a name="3633"><span class="lineNum">    3633 </span><span class="lineCov">        264 :                                 } ZEND_HASH_FILL_END();</span></a>
<a name="3634"><span class="lineNum">    3634 </span>            :                         } else {</a>
<a name="3635"><span class="lineNum">    3635 </span><span class="lineCov">         84 :                                 zend_long n = 0;  /* Current number of elements */</span></a>
<a name="3636"><span class="lineNum">    3636 </span><span class="lineCov">         84 :                                 zend_long idx = zv - ht-&gt;arPacked;</span></a>
<a name="3637"><span class="lineNum">    3637 </span>            : </a>
<a name="3638"><span class="lineNum">    3638 </span><span class="lineCov">        273 :                                 for (; zv != end; zv++, idx++) {</span></a>
<a name="3639"><span class="lineNum">    3639 </span><span class="lineCov">        237 :                                         if (UNEXPECTED(Z_TYPE_P(zv) == IS_UNDEF)) {</span></a>
<a name="3640"><span class="lineNum">    3640 </span><span class="lineNoCov">          0 :                                                 continue;</span></a>
<a name="3641"><span class="lineNum">    3641 </span>            :                                         }</a>
<a name="3642"><span class="lineNum">    3642 </span><span class="lineCov">        237 :                                         if (n &gt;= length) {</span></a>
<a name="3643"><span class="lineNum">    3643 </span><span class="lineCov">         48 :                                                 break;</span></a>
<a name="3644"><span class="lineNum">    3644 </span>            :                                         }</a>
<a name="3645"><span class="lineNum">    3645 </span><span class="lineCov">        189 :                                         n++;</span></a>
<a name="3646"><span class="lineNum">    3646 </span><span class="lineCov">        189 :                                         if (preserve_keys) {</span></a>
<a name="3647"><span class="lineNum">    3647 </span><span class="lineCov">        189 :                                                 entry = zend_hash_index_add_new(Z_ARRVAL_P(return_value), idx, zv);</span></a>
<a name="3648"><span class="lineNum">    3648 </span>            :                                         } else {</a>
<a name="3649"><span class="lineNum">    3649 </span><span class="lineNoCov">          0 :                                                 entry = zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), zv);</span></a>
<a name="3650"><span class="lineNum">    3650 </span>            :                                         }</a>
<a name="3651"><span class="lineNum">    3651 </span><span class="lineCov">        189 :                                         zval_add_ref(entry);</span></a>
<a name="3652"><span class="lineNum">    3652 </span>            :                                 }</a>
<a name="3653"><span class="lineNum">    3653 </span>            :                         }</a>
<a name="3654"><span class="lineNum">    3654 </span>            :                 } else {</a>
<a name="3655"><span class="lineNum">    3655 </span><span class="lineCov">        255 :                         zend_long n = 0;  /* Current number of elements */</span></a>
<a name="3656"><span class="lineNum">    3656 </span><span class="lineCov">        255 :                         Bucket *p = find_bucket_at_offset(ht, offset);</span></a>
<a name="3657"><span class="lineNum">    3657 </span><span class="lineCov">        255 :                         Bucket *end = ht-&gt;arData + ht-&gt;nNumUsed;</span></a>
<a name="3658"><span class="lineNum">    3658 </span>            : </a>
<a name="3659"><span class="lineNum">    3659 </span><span class="lineCov">        969 :                         for (; p != end; p++) {</span></a>
<a name="3660"><span class="lineNum">    3660 </span><span class="lineCov">        786 :                                 entry = &amp;p-&gt;val;</span></a>
<a name="3661"><span class="lineNum">    3661 </span><span class="lineCov">        786 :                                 if (UNEXPECTED(Z_TYPE_P(entry) == IS_UNDEF)) {</span></a>
<a name="3662"><span class="lineNum">    3662 </span><span class="lineCov">         12 :                                         continue;</span></a>
<a name="3663"><span class="lineNum">    3663 </span>            :                                 }</a>
<a name="3664"><span class="lineNum">    3664 </span><span class="lineCov">        774 :                                 if (n &gt;= length) {</span></a>
<a name="3665"><span class="lineNum">    3665 </span><span class="lineCov">         72 :                                         break;</span></a>
<a name="3666"><span class="lineNum">    3666 </span>            :                                 }</a>
<a name="3667"><span class="lineNum">    3667 </span><span class="lineCov">        702 :                                 n++;</span></a>
<a name="3668"><span class="lineNum">    3668 </span><span class="lineCov">        702 :                                 num_key = p-&gt;h;</span></a>
<a name="3669"><span class="lineNum">    3669 </span><span class="lineCov">        702 :                                 string_key = p-&gt;key;</span></a>
<a name="3670"><span class="lineNum">    3670 </span>            : </a>
<a name="3671"><span class="lineNum">    3671 </span><span class="lineCov">        702 :                                 if (string_key) {</span></a>
<a name="3672"><span class="lineNum">    3672 </span><span class="lineCov">        333 :                                         entry = zend_hash_add_new(Z_ARRVAL_P(return_value), string_key, entry);</span></a>
<a name="3673"><span class="lineNum">    3673 </span>            :                                 } else {</a>
<a name="3674"><span class="lineNum">    3674 </span><span class="lineCov">        369 :                                         if (preserve_keys) {</span></a>
<a name="3675"><span class="lineNum">    3675 </span><span class="lineCov">         75 :                                                 entry = zend_hash_index_add_new(Z_ARRVAL_P(return_value), num_key, entry);</span></a>
<a name="3676"><span class="lineNum">    3676 </span>            :                                         } else {</a>
<a name="3677"><span class="lineNum">    3677 </span><span class="lineCov">        294 :                                                 entry = zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), entry);</span></a>
<a name="3678"><span class="lineNum">    3678 </span>            :                                         }</a>
<a name="3679"><span class="lineNum">    3679 </span>            :                                 }</a>
<a name="3680"><span class="lineNum">    3680 </span><span class="lineCov">        702 :                                 zval_add_ref(entry);</span></a>
<a name="3681"><span class="lineNum">    3681 </span>            :                         }</a>
<a name="3682"><span class="lineNum">    3682 </span>            :                 }</a>
<a name="3683"><span class="lineNum">    3683 </span>            :         }</a>
<a name="3684"><span class="lineNum">    3684 </span>            : }</a>
<a name="3685"><span class="lineNum">    3685 </span>            : /* }}} */</a>
<a name="3686"><span class="lineNum">    3686 </span>            : </a>
<a name="3687"><span class="lineNum">    3687 </span><span class="lineCov">        264 : PHPAPI int php_array_merge_recursive(HashTable *dest, HashTable *src) /* {{{ */</span></a>
<a name="3688"><span class="lineNum">    3688 </span>            : {</a>
<a name="3689"><span class="lineNum">    3689 </span>            :         zval *src_entry, *dest_entry;</a>
<a name="3690"><span class="lineNum">    3690 </span>            :         zend_string *string_key;</a>
<a name="3691"><span class="lineNum">    3691 </span>            : </a>
<a name="3692"><span class="lineNum">    3692 </span><span class="lineCov">       1914 :         ZEND_HASH_FOREACH_STR_KEY_VAL(src, string_key, src_entry) {</span></a>
<a name="3693"><span class="lineNum">    3693 </span><span class="lineCov">        834 :                 if (string_key) {</span></a>
<a name="3694"><span class="lineNum">    3694 </span><span class="lineCov">        486 :                         if ((dest_entry = zend_hash_find_known_hash(dest, string_key)) != NULL) {</span></a>
<a name="3695"><span class="lineNum">    3695 </span><span class="lineCov">        276 :                                 zval *src_zval = src_entry;</span></a>
<a name="3696"><span class="lineNum">    3696 </span><span class="lineCov">        276 :                                 zval *dest_zval = dest_entry;</span></a>
<a name="3697"><span class="lineNum">    3697 </span>            :                                 HashTable *thash;</a>
<a name="3698"><span class="lineNum">    3698 </span>            :                                 zval tmp;</a>
<a name="3699"><span class="lineNum">    3699 </span>            :                                 int ret;</a>
<a name="3700"><span class="lineNum">    3700 </span>            : </a>
<a name="3701"><span class="lineNum">    3701 </span><span class="lineCov">        276 :                                 ZVAL_DEREF(src_zval);</span></a>
<a name="3702"><span class="lineNum">    3702 </span><span class="lineCov">        276 :                                 ZVAL_DEREF(dest_zval);</span></a>
<a name="3703"><span class="lineNum">    3703 </span><span class="lineCov">        276 :                                 thash = Z_TYPE_P(dest_zval) == IS_ARRAY ? Z_ARRVAL_P(dest_zval) : NULL;</span></a>
<a name="3704"><span class="lineNum">    3704 </span><span class="lineCov">        348 :                                 if ((thash &amp;&amp; GC_IS_RECURSIVE(thash)) || (src_entry == dest_entry &amp;&amp; Z_ISREF_P(dest_entry) &amp;&amp; (Z_REFCOUNT_P(dest_entry) % 2))) {</span></a>
<a name="3705"><span class="lineNum">    3705 </span><span class="lineCov">          6 :                                         zend_throw_error(NULL, &quot;Recursion detected&quot;);</span></a>
<a name="3706"><span class="lineNum">    3706 </span><span class="lineCov">         18 :                                         return 0;</span></a>
<a name="3707"><span class="lineNum">    3707 </span>            :                                 }</a>
<a name="3708"><span class="lineNum">    3708 </span>            : </a>
<a name="3709"><span class="lineNum">    3709 </span><span class="lineCov">        282 :                                 ZEND_ASSERT(!Z_ISREF_P(dest_entry) || Z_REFCOUNT_P(dest_entry) &gt; 1);</span></a>
<a name="3710"><span class="lineNum">    3710 </span><span class="lineCov">        870 :                                 SEPARATE_ZVAL(dest_entry);</span></a>
<a name="3711"><span class="lineNum">    3711 </span><span class="lineCov">        270 :                                 dest_zval = dest_entry;</span></a>
<a name="3712"><span class="lineNum">    3712 </span>            : </a>
<a name="3713"><span class="lineNum">    3713 </span><span class="lineCov">        270 :                                 if (Z_TYPE_P(dest_zval) == IS_NULL) {</span></a>
<a name="3714"><span class="lineNum">    3714 </span><span class="lineCov">          6 :                                         convert_to_array(dest_zval);</span></a>
<a name="3715"><span class="lineNum">    3715 </span><span class="lineCov">          6 :                                         add_next_index_null(dest_zval);</span></a>
<a name="3716"><span class="lineNum">    3716 </span>            :                                 } else {</a>
<a name="3717"><span class="lineNum">    3717 </span><span class="lineCov">        264 :                                         convert_to_array(dest_zval);</span></a>
<a name="3718"><span class="lineNum">    3718 </span>            :                                 }</a>
<a name="3719"><span class="lineNum">    3719 </span><span class="lineCov">        270 :                                 ZVAL_UNDEF(&amp;tmp);</span></a>
<a name="3720"><span class="lineNum">    3720 </span><span class="lineCov">        270 :                                 if (Z_TYPE_P(src_zval) == IS_OBJECT) {</span></a>
<a name="3721"><span class="lineNum">    3721 </span><span class="lineNoCov">          0 :                                         ZVAL_COPY(&amp;tmp, src_zval);</span></a>
<a name="3722"><span class="lineNum">    3722 </span><span class="lineNoCov">          0 :                                         convert_to_array(&amp;tmp);</span></a>
<a name="3723"><span class="lineNum">    3723 </span><span class="lineNoCov">          0 :                                         src_zval = &amp;tmp;</span></a>
<a name="3724"><span class="lineNum">    3724 </span>            :                                 }</a>
<a name="3725"><span class="lineNum">    3725 </span><span class="lineCov">        270 :                                 if (Z_TYPE_P(src_zval) == IS_ARRAY) {</span></a>
<a name="3726"><span class="lineNum">    3726 </span><span class="lineCov">         72 :                                         if (thash) {</span></a>
<a name="3727"><span class="lineNum">    3727 </span><span class="lineCov">        132 :                                                 GC_TRY_PROTECT_RECURSION(thash);</span></a>
<a name="3728"><span class="lineNum">    3728 </span>            :                                         }</a>
<a name="3729"><span class="lineNum">    3729 </span><span class="lineCov">         72 :                                         ret = php_array_merge_recursive(Z_ARRVAL_P(dest_zval), Z_ARRVAL_P(src_zval));</span></a>
<a name="3730"><span class="lineNum">    3730 </span><span class="lineCov">         72 :                                         if (thash) {</span></a>
<a name="3731"><span class="lineNum">    3731 </span><span class="lineCov">        132 :                                                 GC_TRY_UNPROTECT_RECURSION(thash);</span></a>
<a name="3732"><span class="lineNum">    3732 </span>            :                                         }</a>
<a name="3733"><span class="lineNum">    3733 </span><span class="lineCov">         72 :                                         if (!ret) {</span></a>
<a name="3734"><span class="lineNum">    3734 </span><span class="lineCov">         12 :                                                 return 0;</span></a>
<a name="3735"><span class="lineNum">    3735 </span>            :                                         }</a>
<a name="3736"><span class="lineNum">    3736 </span>            :                                 } else {</a>
<a name="3737"><span class="lineNum">    3737 </span><span class="lineCov">        198 :                                         Z_TRY_ADDREF_P(src_zval);</span></a>
<a name="3738"><span class="lineNum">    3738 </span><span class="lineCov">        198 :                                         zend_hash_next_index_insert(Z_ARRVAL_P(dest_zval), src_zval);</span></a>
<a name="3739"><span class="lineNum">    3739 </span>            :                                 }</a>
<a name="3740"><span class="lineNum">    3740 </span><span class="lineCov">        258 :                                 zval_ptr_dtor(&amp;tmp);</span></a>
<a name="3741"><span class="lineNum">    3741 </span>            :                         } else {</a>
<a name="3742"><span class="lineNum">    3742 </span><span class="lineCov">        210 :                                 zval *zv = zend_hash_add_new(dest, string_key, src_entry);</span></a>
<a name="3743"><span class="lineNum">    3743 </span><span class="lineCov">        210 :                                 zval_add_ref(zv);</span></a>
<a name="3744"><span class="lineNum">    3744 </span>            :                         }</a>
<a name="3745"><span class="lineNum">    3745 </span>            :                 } else {</a>
<a name="3746"><span class="lineNum">    3746 </span><span class="lineCov">        348 :                         zval *zv = zend_hash_next_index_insert(dest, src_entry);</span></a>
<a name="3747"><span class="lineNum">    3747 </span><span class="lineCov">        348 :                         zval_add_ref(zv);</span></a>
<a name="3748"><span class="lineNum">    3748 </span>            :                 }</a>
<a name="3749"><span class="lineNum">    3749 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="3750"><span class="lineNum">    3750 </span><span class="lineCov">        246 :         return 1;</span></a>
<a name="3751"><span class="lineNum">    3751 </span>            : }</a>
<a name="3752"><span class="lineNum">    3752 </span>            : /* }}} */</a>
<a name="3753"><span class="lineNum">    3753 </span>            : </a>
<a name="3754"><span class="lineNum">    3754 </span><span class="lineCov">        618 : PHPAPI int php_array_merge(HashTable *dest, HashTable *src) /* {{{ */</span></a>
<a name="3755"><span class="lineNum">    3755 </span>            : {</a>
<a name="3756"><span class="lineNum">    3756 </span>            :         zval *src_entry;</a>
<a name="3757"><span class="lineNum">    3757 </span>            :         zend_string *string_key;</a>
<a name="3758"><span class="lineNum">    3758 </span>            : </a>
<a name="3759"><span class="lineNum">    3759 </span><span class="lineCov">        618 :         if (HT_IS_PACKED(dest) &amp;&amp; HT_IS_PACKED(src)) {</span></a>
<a name="3760"><span class="lineNum">    3760 </span><span class="lineCov">        360 :                 zend_hash_extend(dest, zend_hash_num_elements(dest) + zend_hash_num_elements(src), 1);</span></a>
<a name="3761"><span class="lineNum">    3761 </span><span class="lineCov">        360 :                 ZEND_HASH_FILL_PACKED(dest) {</span></a>
<a name="3762"><span class="lineNum">    3762 </span><span class="lineCov">      72279 :                         ZEND_HASH_PACKED_FOREACH_VAL(src, src_entry) {</span></a>
<a name="3763"><span class="lineNum">    3763 </span><span class="lineCov">      35952 :                                 if (UNEXPECTED(Z_ISREF_P(src_entry)) &amp;&amp;</span></a>
<a name="3764"><span class="lineNum">    3764 </span><span class="lineNoCov">          0 :                                         UNEXPECTED(Z_REFCOUNT_P(src_entry) == 1)) {</span></a>
<a name="3765"><span class="lineNum">    3765 </span><span class="lineNoCov">          0 :                                         src_entry = Z_REFVAL_P(src_entry);</span></a>
<a name="3766"><span class="lineNum">    3766 </span>            :                                 }</a>
<a name="3767"><span class="lineNum">    3767 </span><span class="lineCov">      35952 :                                 Z_TRY_ADDREF_P(src_entry);</span></a>
<a name="3768"><span class="lineNum">    3768 </span><span class="lineCov">      35952 :                                 ZEND_HASH_FILL_ADD(src_entry);</span></a>
<a name="3769"><span class="lineNum">    3769 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="3770"><span class="lineNum">    3770 </span><span class="lineCov">        360 :                 } ZEND_HASH_FILL_END();</span></a>
<a name="3771"><span class="lineNum">    3771 </span>            :         } else {</a>
<a name="3772"><span class="lineNum">    3772 </span><span class="lineCov">       1476 :                 ZEND_HASH_FOREACH_STR_KEY_VAL(src, string_key, src_entry) {</span></a>
<a name="3773"><span class="lineNum">    3773 </span><span class="lineCov">        621 :                         if (UNEXPECTED(Z_ISREF_P(src_entry) &amp;&amp;</span></a>
<a name="3774"><span class="lineNum">    3774 </span>            :                                 Z_REFCOUNT_P(src_entry) == 1)) {</a>
<a name="3775"><span class="lineNum">    3775 </span><span class="lineCov">          3 :                                 src_entry = Z_REFVAL_P(src_entry);</span></a>
<a name="3776"><span class="lineNum">    3776 </span>            :                         }</a>
<a name="3777"><span class="lineNum">    3777 </span><span class="lineCov">        600 :                         Z_TRY_ADDREF_P(src_entry);</span></a>
<a name="3778"><span class="lineNum">    3778 </span><span class="lineCov">        600 :                         if (string_key) {</span></a>
<a name="3779"><span class="lineNum">    3779 </span><span class="lineCov">        270 :                                 zend_hash_update(dest, string_key, src_entry);</span></a>
<a name="3780"><span class="lineNum">    3780 </span>            :                         } else {</a>
<a name="3781"><span class="lineNum">    3781 </span><span class="lineCov">        330 :                                 zend_hash_next_index_insert_new(dest, src_entry);</span></a>
<a name="3782"><span class="lineNum">    3782 </span>            :                         }</a>
<a name="3783"><span class="lineNum">    3783 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="3784"><span class="lineNum">    3784 </span>            :         }</a>
<a name="3785"><span class="lineNum">    3785 </span><span class="lineCov">        618 :         return 1;</span></a>
<a name="3786"><span class="lineNum">    3786 </span>            : }</a>
<a name="3787"><span class="lineNum">    3787 </span>            : /* }}} */</a>
<a name="3788"><span class="lineNum">    3788 </span>            : </a>
<a name="3789"><span class="lineNum">    3789 </span><span class="lineCov">         27 : PHPAPI int php_array_replace_recursive(HashTable *dest, HashTable *src) /* {{{ */</span></a>
<a name="3790"><span class="lineNum">    3790 </span>            : {</a>
<a name="3791"><span class="lineNum">    3791 </span>            :         zval *src_entry, *dest_entry, *src_zval, *dest_zval;</a>
<a name="3792"><span class="lineNum">    3792 </span>            :         zend_string *string_key;</a>
<a name="3793"><span class="lineNum">    3793 </span>            :         zend_ulong num_key;</a>
<a name="3794"><span class="lineNum">    3794 </span>            :         int ret;</a>
<a name="3795"><span class="lineNum">    3795 </span>            : </a>
<a name="3796"><span class="lineNum">    3796 </span><span class="lineCov">         87 :         ZEND_HASH_FOREACH_KEY_VAL(src, num_key, string_key, src_entry) {</span></a>
<a name="3797"><span class="lineNum">    3797 </span><span class="lineCov">         33 :                 src_zval = src_entry;</span></a>
<a name="3798"><span class="lineNum">    3798 </span><span class="lineCov">         33 :                 ZVAL_DEREF(src_zval);</span></a>
<a name="3799"><span class="lineNum">    3799 </span><span class="lineCov">         33 :                 if (string_key) {</span></a>
<a name="3800"><span class="lineNum">    3800 </span><span class="lineCov">         24 :                         if (Z_TYPE_P(src_zval) != IS_ARRAY ||</span></a>
<a name="3801"><span class="lineNum">    3801 </span><span class="lineCov">          9 :                                 (dest_entry = zend_hash_find_known_hash(dest, string_key)) == NULL ||</span></a>
<a name="3802"><span class="lineNum">    3802 </span><span class="lineCov">          6 :                                 (Z_TYPE_P(dest_entry) != IS_ARRAY &amp;&amp;</span></a>
<a name="3803"><span class="lineNum">    3803 </span><span class="lineCov">          6 :                                  (!Z_ISREF_P(dest_entry) || Z_TYPE_P(Z_REFVAL_P(dest_entry)) != IS_ARRAY))) {</span></a>
<a name="3804"><span class="lineNum">    3804 </span>            : </a>
<a name="3805"><span class="lineNum">    3805 </span><span class="lineCov">          9 :                                 zval *zv = zend_hash_update(dest, string_key, src_entry);</span></a>
<a name="3806"><span class="lineNum">    3806 </span><span class="lineCov">          9 :                                 zval_add_ref(zv);</span></a>
<a name="3807"><span class="lineNum">    3807 </span><span class="lineCov">          9 :                                 continue;</span></a>
<a name="3808"><span class="lineNum">    3808 </span>            :                         }</a>
<a name="3809"><span class="lineNum">    3809 </span>            :                 } else {</a>
<a name="3810"><span class="lineNum">    3810 </span><span class="lineCov">         27 :                         if (Z_TYPE_P(src_zval) != IS_ARRAY ||</span></a>
<a name="3811"><span class="lineNum">    3811 </span><span class="lineCov">          9 :                                 (dest_entry = zend_hash_index_find(dest, num_key)) == NULL ||</span></a>
<a name="3812"><span class="lineNum">    3812 </span><span class="lineCov">          9 :                                 (Z_TYPE_P(dest_entry) != IS_ARRAY &amp;&amp;</span></a>
<a name="3813"><span class="lineNum">    3813 </span><span class="lineNoCov">          0 :                                  (!Z_ISREF_P(dest_entry) || Z_TYPE_P(Z_REFVAL_P(dest_entry)) != IS_ARRAY))) {</span></a>
<a name="3814"><span class="lineNum">    3814 </span>            : </a>
<a name="3815"><span class="lineNum">    3815 </span><span class="lineCov">          9 :                                 zval *zv = zend_hash_index_update(dest, num_key, src_entry);</span></a>
<a name="3816"><span class="lineNum">    3816 </span><span class="lineCov">          9 :                                 zval_add_ref(zv);</span></a>
<a name="3817"><span class="lineNum">    3817 </span><span class="lineCov">          9 :                                 continue;</span></a>
<a name="3818"><span class="lineNum">    3818 </span>            :                         }</a>
<a name="3819"><span class="lineNum">    3819 </span>            :                 }</a>
<a name="3820"><span class="lineNum">    3820 </span>            : </a>
<a name="3821"><span class="lineNum">    3821 </span><span class="lineCov">         15 :                 dest_zval = dest_entry;</span></a>
<a name="3822"><span class="lineNum">    3822 </span><span class="lineCov">         15 :                 ZVAL_DEREF(dest_zval);</span></a>
<a name="3823"><span class="lineNum">    3823 </span><span class="lineCov">         30 :                 if (Z_IS_RECURSIVE_P(dest_zval) ||</span></a>
<a name="3824"><span class="lineNum">    3824 </span><span class="lineCov">         30 :                     Z_IS_RECURSIVE_P(src_zval) ||</span></a>
<a name="3825"><span class="lineNum">    3825 </span><span class="lineCov">         18 :                     (Z_ISREF_P(src_entry) &amp;&amp; Z_ISREF_P(dest_entry) &amp;&amp; Z_REF_P(src_entry) == Z_REF_P(dest_entry) &amp;&amp; (Z_REFCOUNT_P(dest_entry) % 2))) {</span></a>
<a name="3826"><span class="lineNum">    3826 </span><span class="lineCov">          3 :                         zend_throw_error(NULL, &quot;Recursion detected&quot;);</span></a>
<a name="3827"><span class="lineNum">    3827 </span><span class="lineCov">          3 :                         return 0;</span></a>
<a name="3828"><span class="lineNum">    3828 </span>            :                 }</a>
<a name="3829"><span class="lineNum">    3829 </span>            : </a>
<a name="3830"><span class="lineNum">    3830 </span><span class="lineCov">         15 :                 ZEND_ASSERT(!Z_ISREF_P(dest_entry) || Z_REFCOUNT_P(dest_entry) &gt; 1);</span></a>
<a name="3831"><span class="lineNum">    3831 </span><span class="lineCov">         45 :                 SEPARATE_ZVAL(dest_entry);</span></a>
<a name="3832"><span class="lineNum">    3832 </span><span class="lineCov">         12 :                 dest_zval = dest_entry;</span></a>
<a name="3833"><span class="lineNum">    3833 </span>            : </a>
<a name="3834"><span class="lineNum">    3834 </span><span class="lineCov">         12 :                 if (Z_REFCOUNTED_P(dest_zval)) {</span></a>
<a name="3835"><span class="lineNum">    3835 </span><span class="lineCov">         12 :                         Z_PROTECT_RECURSION_P(dest_zval);</span></a>
<a name="3836"><span class="lineNum">    3836 </span>            :                 }</a>
<a name="3837"><span class="lineNum">    3837 </span><span class="lineCov">         12 :                 if (Z_REFCOUNTED_P(src_zval)) {</span></a>
<a name="3838"><span class="lineNum">    3838 </span><span class="lineCov">         12 :                         Z_PROTECT_RECURSION_P(src_zval);</span></a>
<a name="3839"><span class="lineNum">    3839 </span>            :                 }</a>
<a name="3840"><span class="lineNum">    3840 </span>            : </a>
<a name="3841"><span class="lineNum">    3841 </span><span class="lineCov">         12 :                 ret = php_array_replace_recursive(Z_ARRVAL_P(dest_zval), Z_ARRVAL_P(src_zval));</span></a>
<a name="3842"><span class="lineNum">    3842 </span>            : </a>
<a name="3843"><span class="lineNum">    3843 </span><span class="lineCov">         12 :                 if (Z_REFCOUNTED_P(dest_zval)) {</span></a>
<a name="3844"><span class="lineNum">    3844 </span><span class="lineCov">         12 :                         Z_UNPROTECT_RECURSION_P(dest_zval);</span></a>
<a name="3845"><span class="lineNum">    3845 </span>            :                 }</a>
<a name="3846"><span class="lineNum">    3846 </span><span class="lineCov">         12 :                 if (Z_REFCOUNTED_P(src_zval)) {</span></a>
<a name="3847"><span class="lineNum">    3847 </span><span class="lineCov">         12 :                         Z_UNPROTECT_RECURSION_P(src_zval);</span></a>
<a name="3848"><span class="lineNum">    3848 </span>            :                 }</a>
<a name="3849"><span class="lineNum">    3849 </span>            : </a>
<a name="3850"><span class="lineNum">    3850 </span><span class="lineCov">         12 :                 if (!ret) {</span></a>
<a name="3851"><span class="lineNum">    3851 </span><span class="lineCov">          3 :                         return 0;</span></a>
<a name="3852"><span class="lineNum">    3852 </span>            :                 }</a>
<a name="3853"><span class="lineNum">    3853 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="3854"><span class="lineNum">    3854 </span>            : </a>
<a name="3855"><span class="lineNum">    3855 </span><span class="lineCov">         21 :         return 1;</span></a>
<a name="3856"><span class="lineNum">    3856 </span>            : }</a>
<a name="3857"><span class="lineNum">    3857 </span>            : /* }}} */</a>
<a name="3858"><span class="lineNum">    3858 </span>            : </a>
<a name="3859"><span class="lineNum">    3859 </span>            : static zend_always_inline void php_array_replace_wrapper(INTERNAL_FUNCTION_PARAMETERS, int recursive) /* {{{ */</a>
<a name="3860"><span class="lineNum">    3860 </span>            : {</a>
<a name="3861"><span class="lineNum">    3861 </span><span class="lineCov">        126 :         zval *args = NULL;</span></a>
<a name="3862"><span class="lineNum">    3862 </span>            :         zval *arg;</a>
<a name="3863"><span class="lineNum">    3863 </span>            :         int argc, i;</a>
<a name="3864"><span class="lineNum">    3864 </span>            :         HashTable *dest;</a>
<a name="3865"><span class="lineNum">    3865 </span>            : </a>
<a name="3866"><span class="lineNum">    3866 </span><span class="lineCov">        126 :         ZEND_PARSE_PARAMETERS_START(1, -1)</span></a>
<a name="3867"><span class="lineNum">    3867 </span><span class="lineCov">        114 :                 Z_PARAM_VARIADIC('+', args, argc)</span></a>
<a name="3868"><span class="lineNum">    3868 </span><span class="lineCov">        126 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="3869"><span class="lineNum">    3869 </span>            : </a>
<a name="3870"><span class="lineNum">    3870 </span>            : </a>
<a name="3871"><span class="lineNum">    3871 </span><span class="lineCov">        150 :         for (i = 0; i &lt; argc; i++) {</span></a>
<a name="3872"><span class="lineNum">    3872 </span><span class="lineCov">        132 :                 zval *arg = args + i;</span></a>
<a name="3873"><span class="lineNum">    3873 </span>            : </a>
<a name="3874"><span class="lineNum">    3874 </span><span class="lineCov">        132 :                 if (Z_TYPE_P(arg) != IS_ARRAY) {</span></a>
<a name="3875"><span class="lineNum">    3875 </span><span class="lineCov">         96 :                         zend_argument_type_error(i + 1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(arg));</span></a>
<a name="3876"><span class="lineNum">    3876 </span><span class="lineCov">         96 :                         RETURN_THROWS();</span></a>
<a name="3877"><span class="lineNum">    3877 </span>            :                 }</a>
<a name="3878"><span class="lineNum">    3878 </span>            :         }</a>
<a name="3879"><span class="lineNum">    3879 </span>            : </a>
<a name="3880"><span class="lineNum">    3880 </span>            :         /* copy first array */</a>
<a name="3881"><span class="lineNum">    3881 </span><span class="lineCov">         18 :         arg = args;</span></a>
<a name="3882"><span class="lineNum">    3882 </span><span class="lineCov">         18 :         dest = zend_array_dup(Z_ARRVAL_P(arg));</span></a>
<a name="3883"><span class="lineNum">    3883 </span><span class="lineCov">         18 :         ZVAL_ARR(return_value, dest);</span></a>
<a name="3884"><span class="lineNum">    3884 </span><span class="lineCov">         18 :         if (recursive) {</span></a>
<a name="3885"><span class="lineNum">    3885 </span><span class="lineCov">         30 :                 for (i = 1; i &lt; argc; i++) {</span></a>
<a name="3886"><span class="lineNum">    3886 </span><span class="lineCov">         15 :                         arg = args + i;</span></a>
<a name="3887"><span class="lineNum">    3887 </span><span class="lineCov">         15 :                         php_array_replace_recursive(dest, Z_ARRVAL_P(arg));</span></a>
<a name="3888"><span class="lineNum">    3888 </span>            :                 }</a>
<a name="3889"><span class="lineNum">    3889 </span>            :         } else {</a>
<a name="3890"><span class="lineNum">    3890 </span><span class="lineCov">          6 :                 for (i = 1; i &lt; argc; i++) {</span></a>
<a name="3891"><span class="lineNum">    3891 </span><span class="lineCov">          3 :                         arg = args + i;</span></a>
<a name="3892"><span class="lineNum">    3892 </span><span class="lineCov">          3 :                         zend_hash_merge(dest, Z_ARRVAL_P(arg), zval_add_ref, 1);</span></a>
<a name="3893"><span class="lineNum">    3893 </span>            :                 }</a>
<a name="3894"><span class="lineNum">    3894 </span>            :         }</a>
<a name="3895"><span class="lineNum">    3895 </span>            : }</a>
<a name="3896"><span class="lineNum">    3896 </span>            : /* }}} */</a>
<a name="3897"><span class="lineNum">    3897 </span>            : </a>
<a name="3898"><span class="lineNum">    3898 </span>            : static zend_always_inline void php_array_merge_wrapper(INTERNAL_FUNCTION_PARAMETERS, int recursive) /* {{{ */</a>
<a name="3899"><span class="lineNum">    3899 </span>            : {</a>
<a name="3900"><span class="lineNum">    3900 </span><span class="lineCov">       1230 :         zval *args = NULL;</span></a>
<a name="3901"><span class="lineNum">    3901 </span>            :         zval *arg;</a>
<a name="3902"><span class="lineNum">    3902 </span>            :         int argc, i;</a>
<a name="3903"><span class="lineNum">    3903 </span>            :         zval *src_entry;</a>
<a name="3904"><span class="lineNum">    3904 </span>            :         HashTable *src, *dest;</a>
<a name="3905"><span class="lineNum">    3905 </span><span class="lineCov">       1230 :         uint32_t count = 0;</span></a>
<a name="3906"><span class="lineNum">    3906 </span>            : </a>
<a name="3907"><span class="lineNum">    3907 </span><span class="lineCov">       1230 :         ZEND_PARSE_PARAMETERS_START(0, -1)</span></a>
<a name="3908"><span class="lineNum">    3908 </span><span class="lineCov">       1230 :                 Z_PARAM_VARIADIC('+', args, argc)</span></a>
<a name="3909"><span class="lineNum">    3909 </span><span class="lineCov">       1230 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="3910"><span class="lineNum">    3910 </span>            : </a>
<a name="3911"><span class="lineNum">    3911 </span><span class="lineCov">       1227 :         if (argc == 0) {</span></a>
<a name="3912"><span class="lineNum">    3912 </span><span class="lineCov">         18 :                 RETURN_EMPTY_ARRAY();</span></a>
<a name="3913"><span class="lineNum">    3913 </span>            :         }</a>
<a name="3914"><span class="lineNum">    3914 </span>            : </a>
<a name="3915"><span class="lineNum">    3915 </span><span class="lineCov">       3024 :         for (i = 0; i &lt; argc; i++) {</span></a>
<a name="3916"><span class="lineNum">    3916 </span><span class="lineCov">       2202 :                 zval *arg = args + i;</span></a>
<a name="3917"><span class="lineNum">    3917 </span>            : </a>
<a name="3918"><span class="lineNum">    3918 </span><span class="lineCov">       2202 :                 if (Z_TYPE_P(arg) != IS_ARRAY) {</span></a>
<a name="3919"><span class="lineNum">    3919 </span><span class="lineCov">        387 :                         zend_argument_type_error(i + 1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(arg));</span></a>
<a name="3920"><span class="lineNum">    3920 </span><span class="lineCov">        387 :                         RETURN_THROWS();</span></a>
<a name="3921"><span class="lineNum">    3921 </span>            :                 }</a>
<a name="3922"><span class="lineNum">    3922 </span><span class="lineCov">       1815 :                 count += zend_hash_num_elements(Z_ARRVAL_P(arg));</span></a>
<a name="3923"><span class="lineNum">    3923 </span>            :         }</a>
<a name="3924"><span class="lineNum">    3924 </span>            : </a>
<a name="3925"><span class="lineNum">    3925 </span><span class="lineCov">        822 :         if (argc == 2) {</span></a>
<a name="3926"><span class="lineNum">    3926 </span><span class="lineCov">        657 :                 zval *ret = NULL;</span></a>
<a name="3927"><span class="lineNum">    3927 </span>            : </a>
<a name="3928"><span class="lineNum">    3928 </span><span class="lineCov">        657 :                 if (zend_hash_num_elements(Z_ARRVAL(args[0])) == 0) {</span></a>
<a name="3929"><span class="lineNum">    3929 </span><span class="lineCov">         33 :                         ret = &amp;args[1];</span></a>
<a name="3930"><span class="lineNum">    3930 </span><span class="lineCov">        624 :                 } else if (zend_hash_num_elements(Z_ARRVAL(args[1])) == 0) {</span></a>
<a name="3931"><span class="lineNum">    3931 </span><span class="lineCov">         33 :                         ret = &amp;args[0];</span></a>
<a name="3932"><span class="lineNum">    3932 </span>            :                 }</a>
<a name="3933"><span class="lineNum">    3933 </span><span class="lineCov">        657 :                 if (ret) {</span></a>
<a name="3934"><span class="lineNum">    3934 </span><span class="lineCov">         66 :                         if (HT_IS_PACKED(Z_ARRVAL_P(ret))) {</span></a>
<a name="3935"><span class="lineNum">    3935 </span><span class="lineCov">         18 :                                 if (HT_IS_WITHOUT_HOLES(Z_ARRVAL_P(ret))) {</span></a>
<a name="3936"><span class="lineNum">    3936 </span><span class="lineCov">         12 :                                         ZVAL_COPY(return_value, ret);</span></a>
<a name="3937"><span class="lineNum">    3937 </span><span class="lineCov">         12 :                                         return;</span></a>
<a name="3938"><span class="lineNum">    3938 </span>            :                                 }</a>
<a name="3939"><span class="lineNum">    3939 </span>            :                         } else {</a>
<a name="3940"><span class="lineNum">    3940 </span><span class="lineCov">         48 :                                 bool copy = 1;</span></a>
<a name="3941"><span class="lineNum">    3941 </span>            :                                 zend_string *string_key;</a>
<a name="3942"><span class="lineNum">    3942 </span>            : </a>
<a name="3943"><span class="lineNum">    3943 </span><span class="lineCov">        171 :                                 ZEND_HASH_FOREACH_STR_KEY(Z_ARRVAL_P(ret), string_key) {</span></a>
<a name="3944"><span class="lineNum">    3944 </span><span class="lineCov">         72 :                                         if (!string_key) {</span></a>
<a name="3945"><span class="lineNum">    3945 </span><span class="lineCov">         21 :                                                 copy = 0;</span></a>
<a name="3946"><span class="lineNum">    3946 </span><span class="lineCov">         21 :                                                 break;</span></a>
<a name="3947"><span class="lineNum">    3947 </span>            :                                         }</a>
<a name="3948"><span class="lineNum">    3948 </span>            :                                 } ZEND_HASH_FOREACH_END();</a>
<a name="3949"><span class="lineNum">    3949 </span><span class="lineCov">         48 :                                 if (copy) {</span></a>
<a name="3950"><span class="lineNum">    3950 </span><span class="lineCov">         27 :                                         ZVAL_COPY(return_value, ret);</span></a>
<a name="3951"><span class="lineNum">    3951 </span><span class="lineCov">         27 :                                         return;</span></a>
<a name="3952"><span class="lineNum">    3952 </span>            :                                 }</a>
<a name="3953"><span class="lineNum">    3953 </span>            :                         }</a>
<a name="3954"><span class="lineNum">    3954 </span>            :                 }</a>
<a name="3955"><span class="lineNum">    3955 </span>            :         }</a>
<a name="3956"><span class="lineNum">    3956 </span>            : </a>
<a name="3957"><span class="lineNum">    3957 </span><span class="lineCov">        783 :         arg = args;</span></a>
<a name="3958"><span class="lineNum">    3958 </span><span class="lineCov">        783 :         src  = Z_ARRVAL_P(arg);</span></a>
<a name="3959"><span class="lineNum">    3959 </span>            :         /* copy first array */</a>
<a name="3960"><span class="lineNum">    3960 </span><span class="lineCov">        783 :         array_init_size(return_value, count);</span></a>
<a name="3961"><span class="lineNum">    3961 </span><span class="lineCov">        783 :         dest = Z_ARRVAL_P(return_value);</span></a>
<a name="3962"><span class="lineNum">    3962 </span><span class="lineCov">        783 :         if (HT_IS_PACKED(src)) {</span></a>
<a name="3963"><span class="lineNum">    3963 </span><span class="lineCov">        348 :                 zend_hash_real_init_packed(dest);</span></a>
<a name="3964"><span class="lineNum">    3964 </span><span class="lineCov">        348 :                 ZEND_HASH_FILL_PACKED(dest) {</span></a>
<a name="3965"><span class="lineNum">    3965 </span><span class="lineCov">      31770 :                         ZEND_HASH_PACKED_FOREACH_VAL(src, src_entry) {</span></a>
<a name="3966"><span class="lineNum">    3966 </span><span class="lineCov">      15696 :                                 if (UNEXPECTED(Z_ISREF_P(src_entry) &amp;&amp;</span></a>
<a name="3967"><span class="lineNum">    3967 </span>            :                                         Z_REFCOUNT_P(src_entry) == 1)) {</a>
<a name="3968"><span class="lineNum">    3968 </span><span class="lineNoCov">          0 :                                         src_entry = Z_REFVAL_P(src_entry);</span></a>
<a name="3969"><span class="lineNum">    3969 </span>            :                                 }</a>
<a name="3970"><span class="lineNum">    3970 </span><span class="lineCov">      15678 :                                 Z_TRY_ADDREF_P(src_entry);</span></a>
<a name="3971"><span class="lineNum">    3971 </span><span class="lineCov">      15678 :                                 ZEND_HASH_FILL_ADD(src_entry);</span></a>
<a name="3972"><span class="lineNum">    3972 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="3973"><span class="lineNum">    3973 </span><span class="lineCov">        348 :                 } ZEND_HASH_FILL_END();</span></a>
<a name="3974"><span class="lineNum">    3974 </span>            :         } else {</a>
<a name="3975"><span class="lineNum">    3975 </span>            :                 zend_string *string_key;</a>
<a name="3976"><span class="lineNum">    3976 </span><span class="lineCov">        435 :                 zend_hash_real_init_mixed(dest);</span></a>
<a name="3977"><span class="lineNum">    3977 </span><span class="lineCov">       2829 :                 ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(src, string_key, src_entry) {</span></a>
<a name="3978"><span class="lineNum">    3978 </span><span class="lineCov">       1227 :                         if (UNEXPECTED(Z_ISREF_P(src_entry) &amp;&amp;</span></a>
<a name="3979"><span class="lineNum">    3979 </span>            :                                 Z_REFCOUNT_P(src_entry) == 1)) {</a>
<a name="3980"><span class="lineNum">    3980 </span><span class="lineNoCov">          0 :                                 src_entry = Z_REFVAL_P(src_entry);</span></a>
<a name="3981"><span class="lineNum">    3981 </span>            :                         }</a>
<a name="3982"><span class="lineNum">    3982 </span><span class="lineCov">       1197 :                         Z_TRY_ADDREF_P(src_entry);</span></a>
<a name="3983"><span class="lineNum">    3983 </span><span class="lineCov">       1197 :                         if (EXPECTED(string_key)) {</span></a>
<a name="3984"><span class="lineNum">    3984 </span>            :                                 _zend_hash_append(dest, string_key, src_entry);</a>
<a name="3985"><span class="lineNum">    3985 </span>            :                         } else {</a>
<a name="3986"><span class="lineNum">    3986 </span><span class="lineCov">        513 :                                 zend_hash_next_index_insert_new(dest, src_entry);</span></a>
<a name="3987"><span class="lineNum">    3987 </span>            :                         }</a>
<a name="3988"><span class="lineNum">    3988 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="3989"><span class="lineNum">    3989 </span>            :         }</a>
<a name="3990"><span class="lineNum">    3990 </span><span class="lineCov">        783 :         if (recursive) {</span></a>
<a name="3991"><span class="lineNum">    3991 </span><span class="lineCov">        501 :                 for (i = 1; i &lt; argc; i++) {</span></a>
<a name="3992"><span class="lineNum">    3992 </span><span class="lineCov">        192 :                         arg = args + i;</span></a>
<a name="3993"><span class="lineNum">    3993 </span><span class="lineCov">        192 :                         php_array_merge_recursive(dest, Z_ARRVAL_P(arg));</span></a>
<a name="3994"><span class="lineNum">    3994 </span>            :                 }</a>
<a name="3995"><span class="lineNum">    3995 </span>            :         } else {</a>
<a name="3996"><span class="lineNum">    3996 </span><span class="lineCov">       1092 :                 for (i = 1; i &lt; argc; i++) {</span></a>
<a name="3997"><span class="lineNum">    3997 </span><span class="lineCov">        618 :                         arg = args + i;</span></a>
<a name="3998"><span class="lineNum">    3998 </span><span class="lineCov">        618 :                         php_array_merge(dest, Z_ARRVAL_P(arg));</span></a>
<a name="3999"><span class="lineNum">    3999 </span>            :                 }</a>
<a name="4000"><span class="lineNum">    4000 </span>            :         }</a>
<a name="4001"><span class="lineNum">    4001 </span>            : }</a>
<a name="4002"><span class="lineNum">    4002 </span>            : /* }}} */</a>
<a name="4003"><span class="lineNum">    4003 </span>            : </a>
<a name="4004"><span class="lineNum">    4004 </span>            : /* {{{ Merges elements from passed arrays into one array */</a>
<a name="4005"><span class="lineNum">    4005 </span><span class="lineCov">        636 : PHP_FUNCTION(array_merge)</span></a>
<a name="4006"><span class="lineNum">    4006 </span>            : {</a>
<a name="4007"><span class="lineNum">    4007 </span>            :         php_array_merge_wrapper(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);</a>
<a name="4008"><span class="lineNum">    4008 </span><span class="lineCov">        636 : }</span></a>
<a name="4009"><span class="lineNum">    4009 </span>            : /* }}} */</a>
<a name="4010"><span class="lineNum">    4010 </span>            : </a>
<a name="4011"><span class="lineNum">    4011 </span>            : /* {{{ Recursively merges elements from passed arrays into one array */</a>
<a name="4012"><span class="lineNum">    4012 </span><span class="lineCov">        594 : PHP_FUNCTION(array_merge_recursive)</span></a>
<a name="4013"><span class="lineNum">    4013 </span>            : {</a>
<a name="4014"><span class="lineNum">    4014 </span>            :         php_array_merge_wrapper(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);</a>
<a name="4015"><span class="lineNum">    4015 </span><span class="lineCov">        594 : }</span></a>
<a name="4016"><span class="lineNum">    4016 </span>            : /* }}} */</a>
<a name="4017"><span class="lineNum">    4017 </span>            : </a>
<a name="4018"><span class="lineNum">    4018 </span>            : /* {{{ Replaces elements from passed arrays into one array */</a>
<a name="4019"><span class="lineNum">    4019 </span><span class="lineCov">         57 : PHP_FUNCTION(array_replace)</span></a>
<a name="4020"><span class="lineNum">    4020 </span>            : {</a>
<a name="4021"><span class="lineNum">    4021 </span>            :         php_array_replace_wrapper(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);</a>
<a name="4022"><span class="lineNum">    4022 </span><span class="lineCov">         57 : }</span></a>
<a name="4023"><span class="lineNum">    4023 </span>            : /* }}} */</a>
<a name="4024"><span class="lineNum">    4024 </span>            : </a>
<a name="4025"><span class="lineNum">    4025 </span>            : /* {{{ Recursively replaces elements from passed arrays into one array */</a>
<a name="4026"><span class="lineNum">    4026 </span><span class="lineCov">         69 : PHP_FUNCTION(array_replace_recursive)</span></a>
<a name="4027"><span class="lineNum">    4027 </span>            : {</a>
<a name="4028"><span class="lineNum">    4028 </span>            :         php_array_replace_wrapper(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);</a>
<a name="4029"><span class="lineNum">    4029 </span><span class="lineCov">         69 : }</span></a>
<a name="4030"><span class="lineNum">    4030 </span>            : /* }}} */</a>
<a name="4031"><span class="lineNum">    4031 </span>            : </a>
<a name="4032"><span class="lineNum">    4032 </span>            : /* {{{ Return just the keys from the input array, optionally only for the specified search_value */</a>
<a name="4033"><span class="lineNum">    4033 </span><span class="lineCov">        921 : PHP_FUNCTION(array_keys)</span></a>
<a name="4034"><span class="lineNum">    4034 </span>            : {</a>
<a name="4035"><span class="lineNum">    4035 </span>            :         zval *input,                            /* Input array */</a>
<a name="4036"><span class="lineNum">    4036 </span><span class="lineCov">        921 :              *search_value = NULL,      /* Value to search for */</span></a>
<a name="4037"><span class="lineNum">    4037 </span>            :              *entry,                            /* An entry in the input array */</a>
<a name="4038"><span class="lineNum">    4038 </span>            :                new_val;                         /* New value */</a>
<a name="4039"><span class="lineNum">    4039 </span><span class="lineCov">        921 :         bool strict = 0;                /* do strict comparison */</span></a>
<a name="4040"><span class="lineNum">    4040 </span>            :         zend_ulong num_idx;</a>
<a name="4041"><span class="lineNum">    4041 </span>            :         zend_string *str_idx;</a>
<a name="4042"><span class="lineNum">    4042 </span>            :         zend_array *arrval;</a>
<a name="4043"><span class="lineNum">    4043 </span>            :         zend_ulong elem_count;</a>
<a name="4044"><span class="lineNum">    4044 </span>            : </a>
<a name="4045"><span class="lineNum">    4045 </span><span class="lineCov">        921 :         ZEND_PARSE_PARAMETERS_START(1, 3)</span></a>
<a name="4046"><span class="lineNum">    4046 </span><span class="lineCov">       1770 :                 Z_PARAM_ARRAY(input)</span></a>
<a name="4047"><span class="lineNum">    4047 </span><span class="lineCov">        867 :                 Z_PARAM_OPTIONAL</span></a>
<a name="4048"><span class="lineNum">    4048 </span><span class="lineCov">        867 :                 Z_PARAM_ZVAL(search_value)</span></a>
<a name="4049"><span class="lineNum">    4049 </span><span class="lineCov">        180 :                 Z_PARAM_BOOL(strict)</span></a>
<a name="4050"><span class="lineNum">    4050 </span><span class="lineCov">        921 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="4051"><span class="lineNum">    4051 </span><span class="lineCov">        867 :         arrval = Z_ARRVAL_P(input);</span></a>
<a name="4052"><span class="lineNum">    4052 </span><span class="lineCov">        867 :         elem_count = zend_hash_num_elements(arrval);</span></a>
<a name="4053"><span class="lineNum">    4053 </span>            : </a>
<a name="4054"><span class="lineNum">    4054 </span>            :         /* Base case: empty input */</a>
<a name="4055"><span class="lineNum">    4055 </span><span class="lineCov">        867 :         if (!elem_count) {</span></a>
<a name="4056"><span class="lineNum">    4056 </span><span class="lineCov">         18 :                 RETURN_COPY(input);</span></a>
<a name="4057"><span class="lineNum">    4057 </span>            :         }</a>
<a name="4058"><span class="lineNum">    4058 </span>            : </a>
<a name="4059"><span class="lineNum">    4059 </span>            :         /* Initialize return array */</a>
<a name="4060"><span class="lineNum">    4060 </span><span class="lineCov">        852 :         if (search_value != NULL) {</span></a>
<a name="4061"><span class="lineNum">    4061 </span><span class="lineCov">        111 :                 array_init(return_value);</span></a>
<a name="4062"><span class="lineNum">    4062 </span>            : </a>
<a name="4063"><span class="lineNum">    4063 </span><span class="lineCov">        111 :                 if (strict) {</span></a>
<a name="4064"><span class="lineNum">    4064 </span><span class="lineCov">        993 :                         ZEND_HASH_FOREACH_KEY_VAL(arrval, num_idx, str_idx, entry) {</span></a>
<a name="4065"><span class="lineNum">    4065 </span><span class="lineCov">        462 :                                 ZVAL_DEREF(entry);</span></a>
<a name="4066"><span class="lineNum">    4066 </span><span class="lineCov">        924 :                                 if (fast_is_identical_function(search_value, entry)) {</span></a>
<a name="4067"><span class="lineNum">    4067 </span><span class="lineCov">         54 :                                         if (str_idx) {</span></a>
<a name="4068"><span class="lineNum">    4068 </span><span class="lineCov">         15 :                                                 ZVAL_STR_COPY(&amp;new_val, str_idx);</span></a>
<a name="4069"><span class="lineNum">    4069 </span>            :                                         } else {</a>
<a name="4070"><span class="lineNum">    4070 </span><span class="lineCov">         48 :                                                 ZVAL_LONG(&amp;new_val, num_idx);</span></a>
<a name="4071"><span class="lineNum">    4071 </span>            :                                         }</a>
<a name="4072"><span class="lineNum">    4072 </span><span class="lineCov">         54 :                                         zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), &amp;new_val);</span></a>
<a name="4073"><span class="lineNum">    4073 </span>            :                                 }</a>
<a name="4074"><span class="lineNum">    4074 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="4075"><span class="lineNum">    4075 </span>            :                 } else {</a>
<a name="4076"><span class="lineNum">    4076 </span><span class="lineCov">        570 :                         ZEND_HASH_FOREACH_KEY_VAL(arrval, num_idx, str_idx, entry) {</span></a>
<a name="4077"><span class="lineNum">    4077 </span><span class="lineCov">        528 :                                 if (fast_equal_check_function(search_value, entry)) {</span></a>
<a name="4078"><span class="lineNum">    4078 </span><span class="lineCov">         72 :                                         if (str_idx) {</span></a>
<a name="4079"><span class="lineNum">    4079 </span><span class="lineCov">         36 :                                                 ZVAL_STR_COPY(&amp;new_val, str_idx);</span></a>
<a name="4080"><span class="lineNum">    4080 </span>            :                                         } else {</a>
<a name="4081"><span class="lineNum">    4081 </span><span class="lineCov">         57 :                                                 ZVAL_LONG(&amp;new_val, num_idx);</span></a>
<a name="4082"><span class="lineNum">    4082 </span>            :                                         }</a>
<a name="4083"><span class="lineNum">    4083 </span><span class="lineCov">         72 :                                         zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), &amp;new_val);</span></a>
<a name="4084"><span class="lineNum">    4084 </span>            :                                 }</a>
<a name="4085"><span class="lineNum">    4085 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="4086"><span class="lineNum">    4086 </span>            :                 }</a>
<a name="4087"><span class="lineNum">    4087 </span>            :         } else {</a>
<a name="4088"><span class="lineNum">    4088 </span><span class="lineCov">        741 :                 array_init_size(return_value, elem_count);</span></a>
<a name="4089"><span class="lineNum">    4089 </span><span class="lineCov">        741 :                 zend_hash_real_init_packed(Z_ARRVAL_P(return_value));</span></a>
<a name="4090"><span class="lineNum">    4090 </span><span class="lineCov">        741 :                 ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="4091"><span class="lineNum">    4091 </span><span class="lineCov">       1350 :                         if (HT_IS_PACKED(arrval) &amp;&amp; HT_IS_WITHOUT_HOLES(arrval)) {</span></a>
<a name="4092"><span class="lineNum">    4092 </span>            :                                 /* Optimistic case: range(0..n-1) for vector-like packed array */</a>
<a name="4093"><span class="lineNum">    4093 </span><span class="lineCov">        609 :                                 zend_ulong lval = 0;</span></a>
<a name="4094"><span class="lineNum">    4094 </span>            : </a>
<a name="4095"><span class="lineNum">    4095 </span><span class="lineCov">       5186 :                                 for (; lval &lt; elem_count; ++lval) {</span></a>
<a name="4096"><span class="lineNum">    4096 </span><span class="lineCov">       4577 :                                         ZEND_HASH_FILL_SET_LONG(lval);</span></a>
<a name="4097"><span class="lineNum">    4097 </span><span class="lineCov">       4577 :                                         ZEND_HASH_FILL_NEXT();</span></a>
<a name="4098"><span class="lineNum">    4098 </span>            :                                 }</a>
<a name="4099"><span class="lineNum">    4099 </span>            :                         } else {</a>
<a name="4100"><span class="lineNum">    4100 </span>            :                                 /* Go through input array and add keys to the return array */</a>
<a name="4101"><span class="lineNum">    4101 </span><span class="lineCov">      13247 :                                 ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(input), num_idx, str_idx, entry) {</span></a>
<a name="4102"><span class="lineNum">    4102 </span><span class="lineCov">       6547 :                                         if (str_idx) {</span></a>
<a name="4103"><span class="lineNum">    4103 </span><span class="lineCov">      14553 :                                                 ZEND_HASH_FILL_SET_STR_COPY(str_idx);</span></a>
<a name="4104"><span class="lineNum">    4104 </span>            :                                         } else {</a>
<a name="4105"><span class="lineNum">    4105 </span><span class="lineCov">       1666 :                                                 ZEND_HASH_FILL_SET_LONG(num_idx);</span></a>
<a name="4106"><span class="lineNum">    4106 </span>            :                                         }</a>
<a name="4107"><span class="lineNum">    4107 </span><span class="lineCov">       6547 :                                         ZEND_HASH_FILL_NEXT();</span></a>
<a name="4108"><span class="lineNum">    4108 </span>            :                                 } ZEND_HASH_FOREACH_END();</a>
<a name="4109"><span class="lineNum">    4109 </span>            :                         }</a>
<a name="4110"><span class="lineNum">    4110 </span><span class="lineCov">        741 :                 } ZEND_HASH_FILL_END();</span></a>
<a name="4111"><span class="lineNum">    4111 </span>            :         }</a>
<a name="4112"><span class="lineNum">    4112 </span>            : }</a>
<a name="4113"><span class="lineNum">    4113 </span>            : /* }}} */</a>
<a name="4114"><span class="lineNum">    4114 </span>            : </a>
<a name="4115"><span class="lineNum">    4115 </span>            : /* {{{ Get the key of the first element of the array */</a>
<a name="4116"><span class="lineNum">    4116 </span><span class="lineCov">        111 : PHP_FUNCTION(array_key_first)</span></a>
<a name="4117"><span class="lineNum">    4117 </span>            : {</a>
<a name="4118"><span class="lineNum">    4118 </span>            :         zval *stack;    /* Input stack */</a>
<a name="4119"><span class="lineNum">    4119 </span>            : </a>
<a name="4120"><span class="lineNum">    4120 </span><span class="lineCov">        111 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="4121"><span class="lineNum">    4121 </span><span class="lineCov">        126 :                 Z_PARAM_ARRAY(stack)</span></a>
<a name="4122"><span class="lineNum">    4122 </span><span class="lineCov">        111 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="4123"><span class="lineNum">    4123 </span>            : </a>
<a name="4124"><span class="lineNum">    4124 </span><span class="lineCov">         57 :         HashTable *target_hash = Z_ARRVAL_P (stack);</span></a>
<a name="4125"><span class="lineNum">    4125 </span><span class="lineCov">         57 :         HashPosition pos = 0;</span></a>
<a name="4126"><span class="lineNum">    4126 </span><span class="lineCov">         57 :         zend_hash_get_current_key_zval_ex(target_hash, return_value, &amp;pos);</span></a>
<a name="4127"><span class="lineNum">    4127 </span>            : }</a>
<a name="4128"><span class="lineNum">    4128 </span>            : /* }}} */</a>
<a name="4129"><span class="lineNum">    4129 </span>            : </a>
<a name="4130"><span class="lineNum">    4130 </span>            : /* {{{ Get the key of the last element of the array */</a>
<a name="4131"><span class="lineNum">    4131 </span><span class="lineCov">         99 : PHP_FUNCTION(array_key_last)</span></a>
<a name="4132"><span class="lineNum">    4132 </span>            : {</a>
<a name="4133"><span class="lineNum">    4133 </span>            :         zval *stack;    /* Input stack */</a>
<a name="4134"><span class="lineNum">    4134 </span>            :         HashPosition pos;</a>
<a name="4135"><span class="lineNum">    4135 </span>            : </a>
<a name="4136"><span class="lineNum">    4136 </span><span class="lineCov">         99 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="4137"><span class="lineNum">    4137 </span><span class="lineCov">        102 :                 Z_PARAM_ARRAY(stack)</span></a>
<a name="4138"><span class="lineNum">    4138 </span><span class="lineCov">         99 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="4139"><span class="lineNum">    4139 </span>            : </a>
<a name="4140"><span class="lineNum">    4140 </span><span class="lineCov">         45 :         HashTable *target_hash = Z_ARRVAL_P (stack);</span></a>
<a name="4141"><span class="lineNum">    4141 </span><span class="lineCov">         45 :         zend_hash_internal_pointer_end_ex(target_hash, &amp;pos);</span></a>
<a name="4142"><span class="lineNum">    4142 </span><span class="lineCov">         45 :         zend_hash_get_current_key_zval_ex(target_hash, return_value, &amp;pos);</span></a>
<a name="4143"><span class="lineNum">    4143 </span>            : }</a>
<a name="4144"><span class="lineNum">    4144 </span>            : /* }}} */</a>
<a name="4145"><span class="lineNum">    4145 </span>            : </a>
<a name="4146"><span class="lineNum">    4146 </span>            : /* {{{ Return just the values from the input array */</a>
<a name="4147"><span class="lineNum">    4147 </span><span class="lineCov">        246 : PHP_FUNCTION(array_values)</span></a>
<a name="4148"><span class="lineNum">    4148 </span>            : {</a>
<a name="4149"><span class="lineNum">    4149 </span>            :         zval     *input,                /* Input array */</a>
<a name="4150"><span class="lineNum">    4150 </span>            :                          *entry;                /* An entry in the input array */</a>
<a name="4151"><span class="lineNum">    4151 </span>            :         zend_array *arrval;</a>
<a name="4152"><span class="lineNum">    4152 </span>            :         zend_long arrlen;</a>
<a name="4153"><span class="lineNum">    4153 </span>            : </a>
<a name="4154"><span class="lineNum">    4154 </span><span class="lineCov">        246 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="4155"><span class="lineNum">    4155 </span><span class="lineCov">        396 :                 Z_PARAM_ARRAY(input)</span></a>
<a name="4156"><span class="lineNum">    4156 </span><span class="lineCov">        354 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="4157"><span class="lineNum">    4157 </span>            : </a>
<a name="4158"><span class="lineNum">    4158 </span><span class="lineCov">        192 :         arrval = Z_ARRVAL_P(input);</span></a>
<a name="4159"><span class="lineNum">    4159 </span>            : </a>
<a name="4160"><span class="lineNum">    4160 </span>            :         /* Return empty input as is */</a>
<a name="4161"><span class="lineNum">    4161 </span><span class="lineCov">        192 :         arrlen = zend_hash_num_elements(arrval);</span></a>
<a name="4162"><span class="lineNum">    4162 </span><span class="lineCov">        192 :         if (!arrlen) {</span></a>
<a name="4163"><span class="lineNum">    4163 </span><span class="lineCov">         15 :                 RETURN_EMPTY_ARRAY();</span></a>
<a name="4164"><span class="lineNum">    4164 </span>            :         }</a>
<a name="4165"><span class="lineNum">    4165 </span>            : </a>
<a name="4166"><span class="lineNum">    4166 </span>            :         /* Return vector-like packed arrays as-is */</a>
<a name="4167"><span class="lineNum">    4167 </span><span class="lineCov">        177 :         if (HT_IS_PACKED(arrval) &amp;&amp; HT_IS_WITHOUT_HOLES(arrval) &amp;&amp;</span></a>
<a name="4168"><span class="lineNum">    4168 </span><span class="lineCov">         96 :                 arrval-&gt;nNextFreeElement == arrlen) {</span></a>
<a name="4169"><span class="lineNum">    4169 </span><span class="lineCov">        186 :                 RETURN_COPY(input);</span></a>
<a name="4170"><span class="lineNum">    4170 </span>            :         }</a>
<a name="4171"><span class="lineNum">    4171 </span>            : </a>
<a name="4172"><span class="lineNum">    4172 </span>            :         /* Initialize return array */</a>
<a name="4173"><span class="lineNum">    4173 </span><span class="lineCov">         84 :         array_init_size(return_value, arrlen);</span></a>
<a name="4174"><span class="lineNum">    4174 </span><span class="lineCov">         84 :         zend_hash_real_init_packed(Z_ARRVAL_P(return_value));</span></a>
<a name="4175"><span class="lineNum">    4175 </span>            : </a>
<a name="4176"><span class="lineNum">    4176 </span>            :         /* Go through input array and add values to the return array */</a>
<a name="4177"><span class="lineNum">    4177 </span><span class="lineCov">         84 :         ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="4178"><span class="lineNum">    4178 </span><span class="lineCov">        597 :                 ZEND_HASH_FOREACH_VAL(arrval, entry) {</span></a>
<a name="4179"><span class="lineNum">    4179 </span><span class="lineCov">        255 :                         if (UNEXPECTED(Z_ISREF_P(entry) &amp;&amp; Z_REFCOUNT_P(entry) == 1)) {</span></a>
<a name="4180"><span class="lineNum">    4180 </span><span class="lineNoCov">          0 :                                 entry = Z_REFVAL_P(entry);</span></a>
<a name="4181"><span class="lineNum">    4181 </span>            :                         }</a>
<a name="4182"><span class="lineNum">    4182 </span><span class="lineCov">        252 :                         Z_TRY_ADDREF_P(entry);</span></a>
<a name="4183"><span class="lineNum">    4183 </span><span class="lineCov">        252 :                         ZEND_HASH_FILL_ADD(entry);</span></a>
<a name="4184"><span class="lineNum">    4184 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="4185"><span class="lineNum">    4185 </span><span class="lineCov">         84 :         } ZEND_HASH_FILL_END();</span></a>
<a name="4186"><span class="lineNum">    4186 </span>            : }</a>
<a name="4187"><span class="lineNum">    4187 </span>            : /* }}} */</a>
<a name="4188"><span class="lineNum">    4188 </span>            : </a>
<a name="4189"><span class="lineNum">    4189 </span>            : /* {{{ Return the value as key and the frequency of that value in input as value */</a>
<a name="4190"><span class="lineNum">    4190 </span><span class="lineCov">        105 : PHP_FUNCTION(array_count_values)</span></a>
<a name="4191"><span class="lineNum">    4191 </span>            : {</a>
<a name="4192"><span class="lineNum">    4192 </span>            :         zval    *input,         /* Input array */</a>
<a name="4193"><span class="lineNum">    4193 </span>            :                         *entry,         /* An entry in the input array */</a>
<a name="4194"><span class="lineNum">    4194 </span>            :                         *tmp;</a>
<a name="4195"><span class="lineNum">    4195 </span>            :         HashTable *myht;</a>
<a name="4196"><span class="lineNum">    4196 </span>            : </a>
<a name="4197"><span class="lineNum">    4197 </span><span class="lineCov">        105 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="4198"><span class="lineNum">    4198 </span><span class="lineCov">        114 :                 Z_PARAM_ARRAY(input)</span></a>
<a name="4199"><span class="lineNum">    4199 </span><span class="lineCov">        105 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="4200"><span class="lineNum">    4200 </span>            : </a>
<a name="4201"><span class="lineNum">    4201 </span>            :         /* Initialize return array */</a>
<a name="4202"><span class="lineNum">    4202 </span><span class="lineCov">         51 :         array_init(return_value);</span></a>
<a name="4203"><span class="lineNum">    4203 </span>            : </a>
<a name="4204"><span class="lineNum">    4204 </span>            :         /* Go through input array and add values to the return array */</a>
<a name="4205"><span class="lineNum">    4205 </span><span class="lineCov">         51 :         myht = Z_ARRVAL_P(input);</span></a>
<a name="4206"><span class="lineNum">    4206 </span><span class="lineCov">        405 :         ZEND_HASH_FOREACH_VAL(myht, entry) {</span></a>
<a name="4207"><span class="lineNum">    4207 </span><span class="lineCov">        177 :                 ZVAL_DEREF(entry);</span></a>
<a name="4208"><span class="lineNum">    4208 </span><span class="lineCov">        177 :                 if (Z_TYPE_P(entry) == IS_LONG) {</span></a>
<a name="4209"><span class="lineNum">    4209 </span><span class="lineCov">         51 :                         if ((tmp = zend_hash_index_find(Z_ARRVAL_P(return_value), Z_LVAL_P(entry))) == NULL) {</span></a>
<a name="4210"><span class="lineNum">    4210 </span>            :                                 zval data;</a>
<a name="4211"><span class="lineNum">    4211 </span><span class="lineCov">         39 :                                 ZVAL_LONG(&amp;data, 1);</span></a>
<a name="4212"><span class="lineNum">    4212 </span><span class="lineCov">         39 :                                 zend_hash_index_update(Z_ARRVAL_P(return_value), Z_LVAL_P(entry), &amp;data);</span></a>
<a name="4213"><span class="lineNum">    4213 </span>            :                         } else {</a>
<a name="4214"><span class="lineNum">    4214 </span><span class="lineCov">         12 :                                 Z_LVAL_P(tmp)++;</span></a>
<a name="4215"><span class="lineNum">    4215 </span>            :                         }</a>
<a name="4216"><span class="lineNum">    4216 </span><span class="lineCov">        126 :                 } else if (Z_TYPE_P(entry) == IS_STRING) {</span></a>
<a name="4217"><span class="lineNum">    4217 </span><span class="lineCov">        198 :                         if ((tmp = zend_symtable_find(Z_ARRVAL_P(return_value), Z_STR_P(entry))) == NULL) {</span></a>
<a name="4218"><span class="lineNum">    4218 </span>            :                                 zval data;</a>
<a name="4219"><span class="lineNum">    4219 </span><span class="lineCov">         72 :                                 ZVAL_LONG(&amp;data, 1);</span></a>
<a name="4220"><span class="lineNum">    4220 </span><span class="lineCov">         72 :                                 zend_symtable_update(Z_ARRVAL_P(return_value), Z_STR_P(entry), &amp;data);</span></a>
<a name="4221"><span class="lineNum">    4221 </span>            :                         } else {</a>
<a name="4222"><span class="lineNum">    4222 </span><span class="lineCov">         27 :                                 Z_LVAL_P(tmp)++;</span></a>
<a name="4223"><span class="lineNum">    4223 </span>            :                         }</a>
<a name="4224"><span class="lineNum">    4224 </span>            :                 } else {</a>
<a name="4225"><span class="lineNum">    4225 </span><span class="lineCov">         27 :                         php_error_docref(NULL, E_WARNING, &quot;Can only count string and integer values, entry skipped&quot;);</span></a>
<a name="4226"><span class="lineNum">    4226 </span>            :                 }</a>
<a name="4227"><span class="lineNum">    4227 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="4228"><span class="lineNum">    4228 </span>            : }</a>
<a name="4229"><span class="lineNum">    4229 </span>            : /* }}} */</a>
<a name="4230"><span class="lineNum">    4230 </span>            : </a>
<a name="4231"><span class="lineNum">    4231 </span><span class="lineCov">        732 : static inline zval *array_column_fetch_prop(zval *data, zend_string *name_str, zend_long name_long, void **cache_slot, zval *rv) /* {{{ */</span></a>
<a name="4232"><span class="lineNum">    4232 </span>            : {</a>
<a name="4233"><span class="lineNum">    4233 </span><span class="lineCov">        732 :         zval *prop = NULL;</span></a>
<a name="4234"><span class="lineNum">    4234 </span>            : </a>
<a name="4235"><span class="lineNum">    4235 </span><span class="lineCov">        732 :         if (Z_TYPE_P(data) == IS_OBJECT) {</span></a>
<a name="4236"><span class="lineNum">    4236 </span>            :                 zend_string *tmp_str;</a>
<a name="4237"><span class="lineNum">    4237 </span>            :                 /* If name is an integer convert integer to string */</a>
<a name="4238"><span class="lineNum">    4238 </span><span class="lineCov">        252 :                 if (name_str == NULL) {</span></a>
<a name="4239"><span class="lineNum">    4239 </span><span class="lineCov">        102 :                         tmp_str = zend_long_to_str(name_long);</span></a>
<a name="4240"><span class="lineNum">    4240 </span>            :                 } else {</a>
<a name="4241"><span class="lineNum">    4241 </span><span class="lineCov">        150 :                         tmp_str = zend_string_copy(name_str);</span></a>
<a name="4242"><span class="lineNum">    4242 </span>            :                 }</a>
<a name="4243"><span class="lineNum">    4243 </span>            :                 /* The has_property check is first performed in &quot;exists&quot; mode (which returns true for</a>
<a name="4244"><span class="lineNum">    4244 </span>            :                  * properties that are null but exist) and then in &quot;has&quot; mode to handle objects that</a>
<a name="4245"><span class="lineNum">    4245 </span>            :                  * implement __isset (which is not called in &quot;exists&quot; mode). */</a>
<a name="4246"><span class="lineNum">    4246 </span><span class="lineCov">        252 :                 if (Z_OBJ_HANDLER_P(data, has_property)(Z_OBJ_P(data), tmp_str, ZEND_PROPERTY_EXISTS, cache_slot)</span></a>
<a name="4247"><span class="lineNum">    4247 </span><span class="lineCov">        108 :                                 || Z_OBJ_HANDLER_P(data, has_property)(Z_OBJ_P(data), tmp_str, ZEND_PROPERTY_ISSET, cache_slot)) {</span></a>
<a name="4248"><span class="lineNum">    4248 </span><span class="lineCov">        150 :                         prop = Z_OBJ_HANDLER_P(data, read_property)(Z_OBJ_P(data), tmp_str, BP_VAR_R, cache_slot, rv);</span></a>
<a name="4249"><span class="lineNum">    4249 </span><span class="lineCov">        150 :                         if (prop) {</span></a>
<a name="4250"><span class="lineNum">    4250 </span><span class="lineCov">        150 :                                 ZVAL_DEREF(prop);</span></a>
<a name="4251"><span class="lineNum">    4251 </span><span class="lineCov">        150 :                                 if (prop != rv) {</span></a>
<a name="4252"><span class="lineNum">    4252 </span><span class="lineCov">        144 :                                         Z_TRY_ADDREF_P(prop);</span></a>
<a name="4253"><span class="lineNum">    4253 </span>            :                                 }</a>
<a name="4254"><span class="lineNum">    4254 </span>            :                         }</a>
<a name="4255"><span class="lineNum">    4255 </span>            :                 }</a>
<a name="4256"><span class="lineNum">    4256 </span>            :                 zend_string_release(tmp_str);</a>
<a name="4257"><span class="lineNum">    4257 </span><span class="lineCov">        480 :         } else if (Z_TYPE_P(data) == IS_ARRAY) {</span></a>
<a name="4258"><span class="lineNum">    4258 </span>            :                 /* Name is a string */</a>
<a name="4259"><span class="lineNum">    4259 </span><span class="lineCov">        471 :                 if (name_str != NULL) {</span></a>
<a name="4260"><span class="lineNum">    4260 </span><span class="lineCov">        702 :                         prop = zend_symtable_find(Z_ARRVAL_P(data), name_str);</span></a>
<a name="4261"><span class="lineNum">    4261 </span>            :                 } else {</a>
<a name="4262"><span class="lineNum">    4262 </span><span class="lineCov">        120 :                         prop = zend_hash_index_find(Z_ARRVAL_P(data), name_long);</span></a>
<a name="4263"><span class="lineNum">    4263 </span>            :                 }</a>
<a name="4264"><span class="lineNum">    4264 </span><span class="lineCov">        471 :                 if (prop) {</span></a>
<a name="4265"><span class="lineNum">    4265 </span><span class="lineCov">        384 :                         ZVAL_DEREF(prop);</span></a>
<a name="4266"><span class="lineNum">    4266 </span><span class="lineCov">        384 :                         Z_TRY_ADDREF_P(prop);</span></a>
<a name="4267"><span class="lineNum">    4267 </span>            :                 }</a>
<a name="4268"><span class="lineNum">    4268 </span>            :         }</a>
<a name="4269"><span class="lineNum">    4269 </span>            : </a>
<a name="4270"><span class="lineNum">    4270 </span><span class="lineCov">        732 :         return prop;</span></a>
<a name="4271"><span class="lineNum">    4271 </span>            : }</a>
<a name="4272"><span class="lineNum">    4272 </span>            : /* }}} */</a>
<a name="4273"><span class="lineNum">    4273 </span>            : </a>
<a name="4274"><span class="lineNum">    4274 </span>            : /* {{{ Return the values from a single column in the input array, identified by the</a>
<a name="4275"><span class="lineNum">    4275 </span>            :    value_key and optionally indexed by the index_key */</a>
<a name="4276"><span class="lineNum">    4276 </span><span class="lineCov">        246 : PHP_FUNCTION(array_column)</span></a>
<a name="4277"><span class="lineNum">    4277 </span>            : {</a>
<a name="4278"><span class="lineNum">    4278 </span>            :         HashTable *input;</a>
<a name="4279"><span class="lineNum">    4279 </span>            :         zval *colval, *data, rv;</a>
<a name="4280"><span class="lineNum">    4280 </span><span class="lineCov">        246 :         zend_string *column_str = NULL;</span></a>
<a name="4281"><span class="lineNum">    4281 </span>            :         zend_long column_long;</a>
<a name="4282"><span class="lineNum">    4282 </span><span class="lineCov">        246 :         bool column_is_null = 0;</span></a>
<a name="4283"><span class="lineNum">    4283 </span><span class="lineCov">        246 :         zend_string *index_str = NULL;</span></a>
<a name="4284"><span class="lineNum">    4284 </span>            :         zend_long index_long;</a>
<a name="4285"><span class="lineNum">    4285 </span><span class="lineCov">        246 :         bool index_is_null = 1;</span></a>
<a name="4286"><span class="lineNum">    4286 </span>            : </a>
<a name="4287"><span class="lineNum">    4287 </span><span class="lineCov">        246 :         ZEND_PARSE_PARAMETERS_START(2, 3)</span></a>
<a name="4288"><span class="lineNum">    4288 </span><span class="lineCov">        408 :                 Z_PARAM_ARRAY_HT(input)</span></a>
<a name="4289"><span class="lineNum">    4289 </span><span class="lineCov">        384 :                 Z_PARAM_STR_OR_LONG_OR_NULL(column_str, column_long, column_is_null)</span></a>
<a name="4290"><span class="lineNum">    4290 </span><span class="lineCov">        180 :                 Z_PARAM_OPTIONAL</span></a>
<a name="4291"><span class="lineNum">    4291 </span><span class="lineCov">        267 :                 Z_PARAM_STR_OR_LONG_OR_NULL(index_str, index_long, index_is_null)</span></a>
<a name="4292"><span class="lineNum">    4292 </span><span class="lineCov">        246 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="4293"><span class="lineNum">    4293 </span>            : </a>
<a name="4294"><span class="lineNum">    4294 </span><span class="lineCov">        168 :         void* cache_slot_column[3] = { NULL, NULL, NULL };</span></a>
<a name="4295"><span class="lineNum">    4295 </span><span class="lineCov">        168 :         void* cache_slot_index[3] = { NULL, NULL, NULL };</span></a>
<a name="4296"><span class="lineNum">    4296 </span>            : </a>
<a name="4297"><span class="lineNum">    4297 </span><span class="lineCov">        168 :         array_init_size(return_value, zend_hash_num_elements(input));</span></a>
<a name="4298"><span class="lineNum">    4298 </span>            :         /* Index param is not passed */</a>
<a name="4299"><span class="lineNum">    4299 </span><span class="lineCov">        168 :         if (index_is_null) {</span></a>
<a name="4300"><span class="lineNum">    4300 </span><span class="lineCov">         93 :                 zend_hash_real_init_packed(Z_ARRVAL_P(return_value));</span></a>
<a name="4301"><span class="lineNum">    4301 </span><span class="lineCov">         93 :                 ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="4302"><span class="lineNum">    4302 </span><span class="lineCov">        681 :                         ZEND_HASH_FOREACH_VAL(input, data) {</span></a>
<a name="4303"><span class="lineNum">    4303 </span><span class="lineCov">        294 :                                 ZVAL_DEREF(data);</span></a>
<a name="4304"><span class="lineNum">    4304 </span><span class="lineCov">        294 :                                 if (column_is_null) {</span></a>
<a name="4305"><span class="lineNum">    4305 </span><span class="lineCov">          6 :                                         Z_TRY_ADDREF_P(data);</span></a>
<a name="4306"><span class="lineNum">    4306 </span><span class="lineCov">          6 :                                         colval = data;</span></a>
<a name="4307"><span class="lineNum">    4307 </span><span class="lineCov">        288 :                                 } else if ((colval = array_column_fetch_prop(data, column_str, column_long, cache_slot_column, &amp;rv)) == NULL) {</span></a>
<a name="4308"><span class="lineNum">    4308 </span><span class="lineCov">        105 :                                         continue;</span></a>
<a name="4309"><span class="lineNum">    4309 </span>            :                                 }</a>
<a name="4310"><span class="lineNum">    4310 </span><span class="lineCov">        189 :                                 ZEND_HASH_FILL_ADD(colval);</span></a>
<a name="4311"><span class="lineNum">    4311 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="4312"><span class="lineNum">    4312 </span><span class="lineCov">         93 :                 } ZEND_HASH_FILL_END();</span></a>
<a name="4313"><span class="lineNum">    4313 </span>            :         } else {</a>
<a name="4314"><span class="lineNum">    4314 </span><span class="lineCov">        621 :                 ZEND_HASH_FOREACH_VAL(input, data) {</span></a>
<a name="4315"><span class="lineNum">    4315 </span><span class="lineCov">        273 :                         ZVAL_DEREF(data);</span></a>
<a name="4316"><span class="lineNum">    4316 </span>            : </a>
<a name="4317"><span class="lineNum">    4317 </span><span class="lineCov">        273 :                         if (column_is_null) {</span></a>
<a name="4318"><span class="lineNum">    4318 </span><span class="lineCov">         45 :                                 Z_TRY_ADDREF_P(data);</span></a>
<a name="4319"><span class="lineNum">    4319 </span><span class="lineCov">         45 :                                 colval = data;</span></a>
<a name="4320"><span class="lineNum">    4320 </span><span class="lineCov">        228 :                         } else if ((colval = array_column_fetch_prop(data, column_str, column_long, cache_slot_column, &amp;rv)) == NULL) {</span></a>
<a name="4321"><span class="lineNum">    4321 </span><span class="lineCov">         57 :                                 continue;</span></a>
<a name="4322"><span class="lineNum">    4322 </span>            :                         }</a>
<a name="4323"><span class="lineNum">    4323 </span>            : </a>
<a name="4324"><span class="lineNum">    4324 </span>            :                         zval rv;</a>
<a name="4325"><span class="lineNum">    4325 </span><span class="lineCov">        216 :                         zval *keyval = array_column_fetch_prop(data, index_str, index_long, cache_slot_index, &amp;rv);</span></a>
<a name="4326"><span class="lineNum">    4326 </span><span class="lineCov">        216 :                         if (keyval) {</span></a>
<a name="4327"><span class="lineNum">    4327 </span><span class="lineCov">        180 :                                 array_set_zval_key(Z_ARRVAL_P(return_value), keyval, colval);</span></a>
<a name="4328"><span class="lineNum">    4328 </span><span class="lineCov">        180 :                                 zval_ptr_dtor(colval);</span></a>
<a name="4329"><span class="lineNum">    4329 </span><span class="lineCov">        180 :                                 zval_ptr_dtor(keyval);</span></a>
<a name="4330"><span class="lineNum">    4330 </span>            :                         } else {</a>
<a name="4331"><span class="lineNum">    4331 </span><span class="lineCov">         36 :                                 zend_hash_next_index_insert(Z_ARRVAL_P(return_value), colval);</span></a>
<a name="4332"><span class="lineNum">    4332 </span>            :                         }</a>
<a name="4333"><span class="lineNum">    4333 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="4334"><span class="lineNum">    4334 </span>            :         }</a>
<a name="4335"><span class="lineNum">    4335 </span>            : }</a>
<a name="4336"><span class="lineNum">    4336 </span>            : /* }}} */</a>
<a name="4337"><span class="lineNum">    4337 </span>            : </a>
<a name="4338"><span class="lineNum">    4338 </span>            : /* {{{ Return input as a new array with the order of the entries reversed */</a>
<a name="4339"><span class="lineNum">    4339 </span><span class="lineCov">        438 : PHP_FUNCTION(array_reverse)</span></a>
<a name="4340"><span class="lineNum">    4340 </span>            : {</a>
<a name="4341"><span class="lineNum">    4341 </span>            :         zval     *input,                                /* Input array */</a>
<a name="4342"><span class="lineNum">    4342 </span>            :                          *entry;                                /* An entry in the input array */</a>
<a name="4343"><span class="lineNum">    4343 </span>            :         zend_string *string_key;</a>
<a name="4344"><span class="lineNum">    4344 </span>            :         zend_ulong        num_key;</a>
<a name="4345"><span class="lineNum">    4345 </span><span class="lineCov">        438 :         bool preserve_keys = 0; /* whether to preserve keys */</span></a>
<a name="4346"><span class="lineNum">    4346 </span>            : </a>
<a name="4347"><span class="lineNum">    4347 </span><span class="lineCov">        438 :         ZEND_PARSE_PARAMETERS_START(1, 2)</span></a>
<a name="4348"><span class="lineNum">    4348 </span><span class="lineCov">        792 :                 Z_PARAM_ARRAY(input)</span></a>
<a name="4349"><span class="lineNum">    4349 </span><span class="lineCov">        384 :                 Z_PARAM_OPTIONAL</span></a>
<a name="4350"><span class="lineNum">    4350 </span><span class="lineCov">        636 :                 Z_PARAM_BOOL(preserve_keys)</span></a>
<a name="4351"><span class="lineNum">    4351 </span><span class="lineCov">        438 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="4352"><span class="lineNum">    4352 </span>            : </a>
<a name="4353"><span class="lineNum">    4353 </span>            :         /* Initialize return array */</a>
<a name="4354"><span class="lineNum">    4354 </span><span class="lineCov">        384 :         array_init_size(return_value, zend_hash_num_elements(Z_ARRVAL_P(input)));</span></a>
<a name="4355"><span class="lineNum">    4355 </span><span class="lineCov">        384 :         if (HT_IS_PACKED(Z_ARRVAL_P(input)) &amp;&amp; !preserve_keys) {</span></a>
<a name="4356"><span class="lineNum">    4356 </span><span class="lineCov">        102 :                 zend_hash_real_init_packed(Z_ARRVAL_P(return_value));</span></a>
<a name="4357"><span class="lineNum">    4357 </span><span class="lineCov">        102 :                 ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="4358"><span class="lineNum">    4358 </span><span class="lineCov">        738 :                         ZEND_HASH_PACKED_REVERSE_FOREACH_VAL(Z_ARRVAL_P(input), entry) {</span></a>
<a name="4359"><span class="lineNum">    4359 </span><span class="lineCov">        315 :                                 if (UNEXPECTED(Z_ISREF_P(entry) &amp;&amp;</span></a>
<a name="4360"><span class="lineNum">    4360 </span>            :                                         Z_REFCOUNT_P(entry) == 1)) {</a>
<a name="4361"><span class="lineNum">    4361 </span><span class="lineCov">          9 :                                         entry = Z_REFVAL_P(entry);</span></a>
<a name="4362"><span class="lineNum">    4362 </span>            :                                 }</a>
<a name="4363"><span class="lineNum">    4363 </span><span class="lineCov">        303 :                                 Z_TRY_ADDREF_P(entry);</span></a>
<a name="4364"><span class="lineNum">    4364 </span><span class="lineCov">        303 :                                 ZEND_HASH_FILL_ADD(entry);</span></a>
<a name="4365"><span class="lineNum">    4365 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="4366"><span class="lineNum">    4366 </span><span class="lineCov">        102 :                 } ZEND_HASH_FILL_END();</span></a>
<a name="4367"><span class="lineNum">    4367 </span>            :         } else {</a>
<a name="4368"><span class="lineNum">    4368 </span><span class="lineCov">       2031 :                 ZEND_HASH_REVERSE_FOREACH_KEY_VAL(Z_ARRVAL_P(input), num_key, string_key, entry) {</span></a>
<a name="4369"><span class="lineNum">    4369 </span><span class="lineCov">        867 :                         if (string_key) {</span></a>
<a name="4370"><span class="lineNum">    4370 </span><span class="lineCov">        468 :                                 entry = zend_hash_add_new(Z_ARRVAL_P(return_value), string_key, entry);</span></a>
<a name="4371"><span class="lineNum">    4371 </span>            :                         } else {</a>
<a name="4372"><span class="lineNum">    4372 </span><span class="lineCov">        399 :                                 if (preserve_keys) {</span></a>
<a name="4373"><span class="lineNum">    4373 </span><span class="lineCov">        225 :                                         entry = zend_hash_index_add_new(Z_ARRVAL_P(return_value), num_key, entry);</span></a>
<a name="4374"><span class="lineNum">    4374 </span>            :                                 } else {</a>
<a name="4375"><span class="lineNum">    4375 </span><span class="lineCov">        174 :                                         entry = zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), entry);</span></a>
<a name="4376"><span class="lineNum">    4376 </span>            :                                 }</a>
<a name="4377"><span class="lineNum">    4377 </span>            :                         }</a>
<a name="4378"><span class="lineNum">    4378 </span><span class="lineCov">        867 :                         zval_add_ref(entry);</span></a>
<a name="4379"><span class="lineNum">    4379 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="4380"><span class="lineNum">    4380 </span>            :         }</a>
<a name="4381"><span class="lineNum">    4381 </span>            : }</a>
<a name="4382"><span class="lineNum">    4382 </span>            : /* }}} */</a>
<a name="4383"><span class="lineNum">    4383 </span>            : </a>
<a name="4384"><span class="lineNum">    4384 </span>            : /* {{{ Returns a copy of input array padded with pad_value to size pad_size */</a>
<a name="4385"><span class="lineNum">    4385 </span><span class="lineCov">        411 : PHP_FUNCTION(array_pad)</span></a>
<a name="4386"><span class="lineNum">    4386 </span>            : {</a>
<a name="4387"><span class="lineNum">    4387 </span>            :         zval  *input;           /* Input array */</a>
<a name="4388"><span class="lineNum">    4388 </span>            :         zval  *pad_value;       /* Padding value obviously */</a>
<a name="4389"><span class="lineNum">    4389 </span>            :         zend_long pad_size;             /* Size to pad to */</a>
<a name="4390"><span class="lineNum">    4390 </span>            :         zend_long pad_size_abs; /* Absolute value of pad_size */</a>
<a name="4391"><span class="lineNum">    4391 </span>            :         zend_long input_size;           /* Size of the input array */</a>
<a name="4392"><span class="lineNum">    4392 </span>            :         zend_long num_pads;             /* How many pads do we need */</a>
<a name="4393"><span class="lineNum">    4393 </span>            :         zend_long i;</a>
<a name="4394"><span class="lineNum">    4394 </span>            :         zend_string *key;</a>
<a name="4395"><span class="lineNum">    4395 </span>            :         zval *value;</a>
<a name="4396"><span class="lineNum">    4396 </span>            : </a>
<a name="4397"><span class="lineNum">    4397 </span><span class="lineCov">        411 :         ZEND_PARSE_PARAMETERS_START(3, 3)</span></a>
<a name="4398"><span class="lineNum">    4398 </span><span class="lineCov">        726 :                 Z_PARAM_ARRAY(input)</span></a>
<a name="4399"><span class="lineNum">    4399 </span><span class="lineCov">        714 :                 Z_PARAM_LONG(pad_size)</span></a>
<a name="4400"><span class="lineNum">    4400 </span><span class="lineCov">        357 :                 Z_PARAM_ZVAL(pad_value)</span></a>
<a name="4401"><span class="lineNum">    4401 </span><span class="lineCov">        411 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="4402"><span class="lineNum">    4402 </span>            : </a>
<a name="4403"><span class="lineNum">    4403 </span>            :         /* Do some initial calculations */</a>
<a name="4404"><span class="lineNum">    4404 </span><span class="lineCov">        357 :         input_size = zend_hash_num_elements(Z_ARRVAL_P(input));</span></a>
<a name="4405"><span class="lineNum">    4405 </span><span class="lineCov">        357 :         pad_size_abs = ZEND_ABS(pad_size);</span></a>
<a name="4406"><span class="lineNum">    4406 </span><span class="lineCov">        357 :         if (pad_size_abs &lt; 0 || pad_size_abs - input_size &gt; Z_L(1048576)) {</span></a>
<a name="4407"><span class="lineNum">    4407 </span><span class="lineCov">          3 :                 zend_argument_value_error(2, &quot;must be less than or equal to 1048576&quot;);</span></a>
<a name="4408"><span class="lineNum">    4408 </span><span class="lineCov">          3 :                 RETURN_THROWS();</span></a>
<a name="4409"><span class="lineNum">    4409 </span>            :         }</a>
<a name="4410"><span class="lineNum">    4410 </span>            : </a>
<a name="4411"><span class="lineNum">    4411 </span><span class="lineCov">        354 :         if (input_size &gt;= pad_size_abs) {</span></a>
<a name="4412"><span class="lineNum">    4412 </span>            :                 /* Copy the original array */</a>
<a name="4413"><span class="lineNum">    4413 </span><span class="lineCov">         15 :                 ZVAL_COPY(return_value, input);</span></a>
<a name="4414"><span class="lineNum">    4414 </span><span class="lineCov">         15 :                 return;</span></a>
<a name="4415"><span class="lineNum">    4415 </span>            :         }</a>
<a name="4416"><span class="lineNum">    4416 </span>            : </a>
<a name="4417"><span class="lineNum">    4417 </span><span class="lineCov">        339 :         num_pads = pad_size_abs - input_size;</span></a>
<a name="4418"><span class="lineNum">    4418 </span><span class="lineCov">        339 :         if (Z_REFCOUNTED_P(pad_value)) {</span></a>
<a name="4419"><span class="lineNum">    4419 </span><span class="lineCov">         42 :                 GC_ADDREF_EX(Z_COUNTED_P(pad_value), num_pads);</span></a>
<a name="4420"><span class="lineNum">    4420 </span>            :         }</a>
<a name="4421"><span class="lineNum">    4421 </span>            : </a>
<a name="4422"><span class="lineNum">    4422 </span><span class="lineCov">        339 :         array_init_size(return_value, pad_size_abs);</span></a>
<a name="4423"><span class="lineNum">    4423 </span><span class="lineCov">        339 :         if (HT_IS_PACKED(Z_ARRVAL_P(input))) {</span></a>
<a name="4424"><span class="lineNum">    4424 </span><span class="lineCov">        267 :                 zend_hash_real_init_packed(Z_ARRVAL_P(return_value));</span></a>
<a name="4425"><span class="lineNum">    4425 </span>            : </a>
<a name="4426"><span class="lineNum">    4426 </span><span class="lineCov">        267 :                 if (pad_size &lt; 0) {</span></a>
<a name="4427"><span class="lineNum">    4427 </span><span class="lineCov">        132 :                         ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="4428"><span class="lineNum">    4428 </span><span class="lineCov">        429 :                                 for (i = 0; i &lt; num_pads; i++) {</span></a>
<a name="4429"><span class="lineNum">    4429 </span><span class="lineCov">        297 :                                         ZEND_HASH_FILL_ADD(pad_value);</span></a>
<a name="4430"><span class="lineNum">    4430 </span>            :                                 }</a>
<a name="4431"><span class="lineNum">    4431 </span><span class="lineCov">        132 :                         } ZEND_HASH_FILL_END();</span></a>
<a name="4432"><span class="lineNum">    4432 </span>            :                 }</a>
<a name="4433"><span class="lineNum">    4433 </span>            : </a>
<a name="4434"><span class="lineNum">    4434 </span><span class="lineCov">        267 :                 ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="4435"><span class="lineNum">    4435 </span><span class="lineCov">       1443 :                         ZEND_HASH_PACKED_FOREACH_VAL(Z_ARRVAL_P(input), value) {</span></a>
<a name="4436"><span class="lineNum">    4436 </span><span class="lineCov">        585 :                                 Z_TRY_ADDREF_P(value);</span></a>
<a name="4437"><span class="lineNum">    4437 </span><span class="lineCov">        585 :                                 ZEND_HASH_FILL_ADD(value);</span></a>
<a name="4438"><span class="lineNum">    4438 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="4439"><span class="lineNum">    4439 </span><span class="lineCov">        267 :                 } ZEND_HASH_FILL_END();</span></a>
<a name="4440"><span class="lineNum">    4440 </span>            : </a>
<a name="4441"><span class="lineNum">    4441 </span><span class="lineCov">        267 :                 if (pad_size &gt; 0) {</span></a>
<a name="4442"><span class="lineNum">    4442 </span><span class="lineCov">        135 :                         ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="4443"><span class="lineNum">    4443 </span><span class="lineCov">        441 :                                 for (i = 0; i &lt; num_pads; i++) {</span></a>
<a name="4444"><span class="lineNum">    4444 </span><span class="lineCov">        306 :                                         ZEND_HASH_FILL_ADD(pad_value);</span></a>
<a name="4445"><span class="lineNum">    4445 </span>            :                                 }</a>
<a name="4446"><span class="lineNum">    4446 </span><span class="lineCov">        135 :                         } ZEND_HASH_FILL_END();</span></a>
<a name="4447"><span class="lineNum">    4447 </span>            :                 }</a>
<a name="4448"><span class="lineNum">    4448 </span>            :         } else {</a>
<a name="4449"><span class="lineNum">    4449 </span><span class="lineCov">         72 :                 if (pad_size &lt; 0) {</span></a>
<a name="4450"><span class="lineNum">    4450 </span><span class="lineCov">        138 :                         for (i = 0; i &lt; num_pads; i++) {</span></a>
<a name="4451"><span class="lineNum">    4451 </span><span class="lineCov">        102 :                                 zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), pad_value);</span></a>
<a name="4452"><span class="lineNum">    4452 </span>            :                         }</a>
<a name="4453"><span class="lineNum">    4453 </span>            :                 }</a>
<a name="4454"><span class="lineNum">    4454 </span>            : </a>
<a name="4455"><span class="lineNum">    4455 </span><span class="lineCov">        468 :                 ZEND_HASH_MAP_FOREACH_STR_KEY_VAL(Z_ARRVAL_P(input), key, value) {</span></a>
<a name="4456"><span class="lineNum">    4456 </span><span class="lineCov">        198 :                         Z_TRY_ADDREF_P(value);</span></a>
<a name="4457"><span class="lineNum">    4457 </span><span class="lineCov">        198 :                         if (key) {</span></a>
<a name="4458"><span class="lineNum">    4458 </span><span class="lineCov">        132 :                                 zend_hash_add_new(Z_ARRVAL_P(return_value), key, value);</span></a>
<a name="4459"><span class="lineNum">    4459 </span>            :                         } else {</a>
<a name="4460"><span class="lineNum">    4460 </span><span class="lineCov">         66 :                                 zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), value);</span></a>
<a name="4461"><span class="lineNum">    4461 </span>            :                         }</a>
<a name="4462"><span class="lineNum">    4462 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="4463"><span class="lineNum">    4463 </span>            : </a>
<a name="4464"><span class="lineNum">    4464 </span><span class="lineCov">         72 :                 if (pad_size &gt; 0) {</span></a>
<a name="4465"><span class="lineNum">    4465 </span><span class="lineCov">        138 :                         for (i = 0; i &lt; num_pads; i++) {</span></a>
<a name="4466"><span class="lineNum">    4466 </span><span class="lineCov">        102 :                                 zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), pad_value);</span></a>
<a name="4467"><span class="lineNum">    4467 </span>            :                         }</a>
<a name="4468"><span class="lineNum">    4468 </span>            :                 }</a>
<a name="4469"><span class="lineNum">    4469 </span>            :         }</a>
<a name="4470"><span class="lineNum">    4470 </span>            : }</a>
<a name="4471"><span class="lineNum">    4471 </span>            : /* }}} */</a>
<a name="4472"><span class="lineNum">    4472 </span>            : </a>
<a name="4473"><span class="lineNum">    4473 </span>            : /* {{{ Return array with key &lt;-&gt; value flipped */</a>
<a name="4474"><span class="lineNum">    4474 </span><span class="lineCov">        240 : PHP_FUNCTION(array_flip)</span></a>
<a name="4475"><span class="lineNum">    4475 </span>            : {</a>
<a name="4476"><span class="lineNum">    4476 </span>            :         zval *array, *entry, data;</a>
<a name="4477"><span class="lineNum">    4477 </span>            :         zend_ulong num_idx;</a>
<a name="4478"><span class="lineNum">    4478 </span>            :         zend_string *str_idx;</a>
<a name="4479"><span class="lineNum">    4479 </span>            : </a>
<a name="4480"><span class="lineNum">    4480 </span><span class="lineCov">        240 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="4481"><span class="lineNum">    4481 </span><span class="lineCov">        384 :                 Z_PARAM_ARRAY(array)</span></a>
<a name="4482"><span class="lineNum">    4482 </span><span class="lineCov">        240 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="4483"><span class="lineNum">    4483 </span>            : </a>
<a name="4484"><span class="lineNum">    4484 </span><span class="lineCov">        186 :         array_init_size(return_value, zend_hash_num_elements(Z_ARRVAL_P(array)));</span></a>
<a name="4485"><span class="lineNum">    4485 </span>            : </a>
<a name="4486"><span class="lineNum">    4486 </span><span class="lineCov">       5256 :         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(array), num_idx, str_idx, entry) {</span></a>
<a name="4487"><span class="lineNum">    4487 </span><span class="lineCov">       2532 :                 ZVAL_DEREF(entry);</span></a>
<a name="4488"><span class="lineNum">    4488 </span><span class="lineCov">       2532 :                 if (Z_TYPE_P(entry) == IS_LONG) {</span></a>
<a name="4489"><span class="lineNum">    4489 </span><span class="lineCov">       2244 :                         if (str_idx) {</span></a>
<a name="4490"><span class="lineNum">    4490 </span><span class="lineCov">       2565 :                                 ZVAL_STR_COPY(&amp;data, str_idx);</span></a>
<a name="4491"><span class="lineNum">    4491 </span>            :                         } else {</a>
<a name="4492"><span class="lineNum">    4492 </span><span class="lineCov">        972 :                                 ZVAL_LONG(&amp;data, num_idx);</span></a>
<a name="4493"><span class="lineNum">    4493 </span>            :                         }</a>
<a name="4494"><span class="lineNum">    4494 </span><span class="lineCov">       2244 :                         zend_hash_index_update(Z_ARRVAL_P(return_value), Z_LVAL_P(entry), &amp;data);</span></a>
<a name="4495"><span class="lineNum">    4495 </span><span class="lineCov">        288 :                 } else if (Z_TYPE_P(entry) == IS_STRING) {</span></a>
<a name="4496"><span class="lineNum">    4496 </span><span class="lineCov">        243 :                         if (str_idx) {</span></a>
<a name="4497"><span class="lineNum">    4497 </span><span class="lineCov">        225 :                                 ZVAL_STR_COPY(&amp;data, str_idx);</span></a>
<a name="4498"><span class="lineNum">    4498 </span>            :                         } else {</a>
<a name="4499"><span class="lineNum">    4499 </span><span class="lineCov">        138 :                                 ZVAL_LONG(&amp;data, num_idx);</span></a>
<a name="4500"><span class="lineNum">    4500 </span>            :                         }</a>
<a name="4501"><span class="lineNum">    4501 </span><span class="lineCov">        243 :                         zend_symtable_update(Z_ARRVAL_P(return_value), Z_STR_P(entry), &amp;data);</span></a>
<a name="4502"><span class="lineNum">    4502 </span>            :                 } else {</a>
<a name="4503"><span class="lineNum">    4503 </span><span class="lineCov">         45 :                         php_error_docref(NULL, E_WARNING, &quot;Can only flip string and integer values, entry skipped&quot;);</span></a>
<a name="4504"><span class="lineNum">    4504 </span>            :                 }</a>
<a name="4505"><span class="lineNum">    4505 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="4506"><span class="lineNum">    4506 </span>            : }</a>
<a name="4507"><span class="lineNum">    4507 </span>            : /* }}} */</a>
<a name="4508"><span class="lineNum">    4508 </span>            : </a>
<a name="4509"><span class="lineNum">    4509 </span>            : /* {{{ Returns an array with all string keys lowercased [or uppercased] */</a>
<a name="4510"><span class="lineNum">    4510 </span><span class="lineCov">        489 : PHP_FUNCTION(array_change_key_case)</span></a>
<a name="4511"><span class="lineNum">    4511 </span>            : {</a>
<a name="4512"><span class="lineNum">    4512 </span>            :         zval *array, *entry;</a>
<a name="4513"><span class="lineNum">    4513 </span>            :         zend_string *string_key;</a>
<a name="4514"><span class="lineNum">    4514 </span>            :         zend_string *new_key;</a>
<a name="4515"><span class="lineNum">    4515 </span>            :         zend_ulong num_key;</a>
<a name="4516"><span class="lineNum">    4516 </span><span class="lineCov">        489 :         zend_long change_to_upper=0;</span></a>
<a name="4517"><span class="lineNum">    4517 </span>            : </a>
<a name="4518"><span class="lineNum">    4518 </span><span class="lineCov">        489 :         ZEND_PARSE_PARAMETERS_START(1, 2)</span></a>
<a name="4519"><span class="lineNum">    4519 </span><span class="lineCov">        894 :                 Z_PARAM_ARRAY(array)</span></a>
<a name="4520"><span class="lineNum">    4520 </span><span class="lineCov">        435 :                 Z_PARAM_OPTIONAL</span></a>
<a name="4521"><span class="lineNum">    4521 </span><span class="lineCov">        750 :                 Z_PARAM_LONG(change_to_upper)</span></a>
<a name="4522"><span class="lineNum">    4522 </span><span class="lineCov">        489 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="4523"><span class="lineNum">    4523 </span>            : </a>
<a name="4524"><span class="lineNum">    4524 </span><span class="lineCov">        432 :         array_init_size(return_value, zend_hash_num_elements(Z_ARRVAL_P(array)));</span></a>
<a name="4525"><span class="lineNum">    4525 </span>            : </a>
<a name="4526"><span class="lineNum">    4526 </span><span class="lineCov">       2514 :         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(array), num_key, string_key, entry) {</span></a>
<a name="4527"><span class="lineNum">    4527 </span><span class="lineCov">       1041 :                 if (!string_key) {</span></a>
<a name="4528"><span class="lineNum">    4528 </span><span class="lineCov">        177 :                         entry = zend_hash_index_update(Z_ARRVAL_P(return_value), num_key, entry);</span></a>
<a name="4529"><span class="lineNum">    4529 </span>            :                 } else {</a>
<a name="4530"><span class="lineNum">    4530 </span><span class="lineCov">        864 :                         if (change_to_upper) {</span></a>
<a name="4531"><span class="lineNum">    4531 </span><span class="lineCov">        426 :                                 new_key = php_string_toupper(string_key);</span></a>
<a name="4532"><span class="lineNum">    4532 </span>            :                         } else {</a>
<a name="4533"><span class="lineNum">    4533 </span><span class="lineCov">        438 :                                 new_key = php_string_tolower(string_key);</span></a>
<a name="4534"><span class="lineNum">    4534 </span>            :                         }</a>
<a name="4535"><span class="lineNum">    4535 </span><span class="lineCov">        864 :                         entry = zend_hash_update(Z_ARRVAL_P(return_value), new_key, entry);</span></a>
<a name="4536"><span class="lineNum">    4536 </span>            :                         zend_string_release_ex(new_key, 0);</a>
<a name="4537"><span class="lineNum">    4537 </span>            :                 }</a>
<a name="4538"><span class="lineNum">    4538 </span>            : </a>
<a name="4539"><span class="lineNum">    4539 </span><span class="lineCov">       1041 :                 zval_add_ref(entry);</span></a>
<a name="4540"><span class="lineNum">    4540 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="4541"><span class="lineNum">    4541 </span>            : }</a>
<a name="4542"><span class="lineNum">    4542 </span>            : /* }}} */</a>
<a name="4543"><span class="lineNum">    4543 </span>            : </a>
<a name="4544"><span class="lineNum">    4544 </span>            : struct bucketindex {</a>
<a name="4545"><span class="lineNum">    4545 </span>            :         Bucket b;</a>
<a name="4546"><span class="lineNum">    4546 </span>            :         unsigned int i;</a>
<a name="4547"><span class="lineNum">    4547 </span>            : };</a>
<a name="4548"><span class="lineNum">    4548 </span>            : </a>
<a name="4549"><span class="lineNum">    4549 </span><span class="lineCov">          3 : static void array_bucketindex_swap(void *p, void *q)</span></a>
<a name="4550"><span class="lineNum">    4550 </span>            : {</a>
<a name="4551"><span class="lineNum">    4551 </span><span class="lineCov">          3 :         struct bucketindex *f = (struct bucketindex *)p;</span></a>
<a name="4552"><span class="lineNum">    4552 </span><span class="lineCov">          3 :         struct bucketindex *g = (struct bucketindex *)q;</span></a>
<a name="4553"><span class="lineNum">    4553 </span>            :         struct bucketindex t;</a>
<a name="4554"><span class="lineNum">    4554 </span><span class="lineCov">          3 :         t = *f;</span></a>
<a name="4555"><span class="lineNum">    4555 </span><span class="lineCov">          3 :         *f = *g;</span></a>
<a name="4556"><span class="lineNum">    4556 </span><span class="lineCov">          3 :         *g = t;</span></a>
<a name="4557"><span class="lineNum">    4557 </span><span class="lineCov">          3 : }</span></a>
<a name="4558"><span class="lineNum">    4558 </span>            : </a>
<a name="4559"><span class="lineNum">    4559 </span>            : /* {{{ Removes duplicate values from array */</a>
<a name="4560"><span class="lineNum">    4560 </span><span class="lineCov">        177 : PHP_FUNCTION(array_unique)</span></a>
<a name="4561"><span class="lineNum">    4561 </span>            : {</a>
<a name="4562"><span class="lineNum">    4562 </span>            :         zval *array;</a>
<a name="4563"><span class="lineNum">    4563 </span>            :         Bucket *p;</a>
<a name="4564"><span class="lineNum">    4564 </span><span class="lineCov">        177 :         zend_long sort_type = PHP_SORT_STRING;</span></a>
<a name="4565"><span class="lineNum">    4565 </span>            :         bucket_compare_func_t cmp;</a>
<a name="4566"><span class="lineNum">    4566 </span>            :         struct bucketindex *arTmp, *cmpdata, *lastkept;</a>
<a name="4567"><span class="lineNum">    4567 </span>            :         uint32_t i, idx;</a>
<a name="4568"><span class="lineNum">    4568 </span>            : </a>
<a name="4569"><span class="lineNum">    4569 </span><span class="lineCov">        177 :         ZEND_PARSE_PARAMETERS_START(1, 2)</span></a>
<a name="4570"><span class="lineNum">    4570 </span><span class="lineCov">        270 :                 Z_PARAM_ARRAY(array)</span></a>
<a name="4571"><span class="lineNum">    4571 </span><span class="lineCov">        120 :                 Z_PARAM_OPTIONAL</span></a>
<a name="4572"><span class="lineNum">    4572 </span><span class="lineCov">        183 :                 Z_PARAM_LONG(sort_type)</span></a>
<a name="4573"><span class="lineNum">    4573 </span><span class="lineCov">        177 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="4574"><span class="lineNum">    4574 </span>            : </a>
<a name="4575"><span class="lineNum">    4575 </span><span class="lineCov">        120 :         if (Z_ARRVAL_P(array)-&gt;nNumOfElements &lt;= 1) {     /* nothing to do */</span></a>
<a name="4576"><span class="lineNum">    4576 </span><span class="lineCov">          3 :                 ZVAL_COPY(return_value, array);</span></a>
<a name="4577"><span class="lineNum">    4577 </span><span class="lineCov">          3 :                 return;</span></a>
<a name="4578"><span class="lineNum">    4578 </span>            :         }</a>
<a name="4579"><span class="lineNum">    4579 </span>            : </a>
<a name="4580"><span class="lineNum">    4580 </span><span class="lineCov">        117 :         if (sort_type == PHP_SORT_STRING) {</span></a>
<a name="4581"><span class="lineNum">    4581 </span>            :                 HashTable seen;</a>
<a name="4582"><span class="lineNum">    4582 </span>            :                 zend_long num_key;</a>
<a name="4583"><span class="lineNum">    4583 </span>            :                 zend_string *str_key;</a>
<a name="4584"><span class="lineNum">    4584 </span>            :                 zval *val;</a>
<a name="4585"><span class="lineNum">    4585 </span>            : </a>
<a name="4586"><span class="lineNum">    4586 </span><span class="lineCov">        114 :                 zend_hash_init(&amp;seen, zend_hash_num_elements(Z_ARRVAL_P(array)), NULL, NULL, 0);</span></a>
<a name="4587"><span class="lineNum">    4587 </span><span class="lineCov">        114 :                 array_init(return_value);</span></a>
<a name="4588"><span class="lineNum">    4588 </span>            : </a>
<a name="4589"><span class="lineNum">    4589 </span><span class="lineCov">       1404 :                 ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(array), num_key, str_key, val) {</span></a>
<a name="4590"><span class="lineNum">    4590 </span>            :                         zval *retval;</a>
<a name="4591"><span class="lineNum">    4591 </span><span class="lineCov">        633 :                         if (Z_TYPE_P(val) == IS_STRING) {</span></a>
<a name="4592"><span class="lineNum">    4592 </span><span class="lineCov">        432 :                                 retval = zend_hash_add_empty_element(&amp;seen, Z_STR_P(val));</span></a>
<a name="4593"><span class="lineNum">    4593 </span>            :                         } else {</a>
<a name="4594"><span class="lineNum">    4594 </span>            :                                 zend_string *tmp_str_val;</a>
<a name="4595"><span class="lineNum">    4595 </span><span class="lineCov">        201 :                                 zend_string *str_val = zval_get_tmp_string(val, &amp;tmp_str_val);</span></a>
<a name="4596"><span class="lineNum">    4596 </span><span class="lineCov">        201 :                                 retval = zend_hash_add_empty_element(&amp;seen, str_val);</span></a>
<a name="4597"><span class="lineNum">    4597 </span><span class="lineCov">        201 :                                 zend_tmp_string_release(tmp_str_val);</span></a>
<a name="4598"><span class="lineNum">    4598 </span>            :                         }</a>
<a name="4599"><span class="lineNum">    4599 </span>            : </a>
<a name="4600"><span class="lineNum">    4600 </span><span class="lineCov">        633 :                         if (retval) {</span></a>
<a name="4601"><span class="lineNum">    4601 </span>            :                                 /* First occurrence of the value */</a>
<a name="4602"><span class="lineNum">    4602 </span><span class="lineCov">        348 :                                 if (UNEXPECTED(Z_ISREF_P(val) &amp;&amp; Z_REFCOUNT_P(val) == 1)) {</span></a>
<a name="4603"><span class="lineNum">    4603 </span><span class="lineNoCov">          0 :                                         ZVAL_DEREF(val);</span></a>
<a name="4604"><span class="lineNum">    4604 </span>            :                                 }</a>
<a name="4605"><span class="lineNum">    4605 </span><span class="lineCov">        345 :                                 Z_TRY_ADDREF_P(val);</span></a>
<a name="4606"><span class="lineNum">    4606 </span>            : </a>
<a name="4607"><span class="lineNum">    4607 </span><span class="lineCov">        345 :                                 if (str_key) {</span></a>
<a name="4608"><span class="lineNum">    4608 </span><span class="lineCov">         99 :                                         zend_hash_add_new(Z_ARRVAL_P(return_value), str_key, val);</span></a>
<a name="4609"><span class="lineNum">    4609 </span>            :                                 } else {</a>
<a name="4610"><span class="lineNum">    4610 </span><span class="lineCov">        246 :                                         zend_hash_index_add_new(Z_ARRVAL_P(return_value), num_key, val);</span></a>
<a name="4611"><span class="lineNum">    4611 </span>            :                                 }</a>
<a name="4612"><span class="lineNum">    4612 </span>            :                         }</a>
<a name="4613"><span class="lineNum">    4613 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="4614"><span class="lineNum">    4614 </span>            : </a>
<a name="4615"><span class="lineNum">    4615 </span><span class="lineCov">        114 :                 zend_hash_destroy(&amp;seen);</span></a>
<a name="4616"><span class="lineNum">    4616 </span><span class="lineCov">        114 :                 return;</span></a>
<a name="4617"><span class="lineNum">    4617 </span>            :         }</a>
<a name="4618"><span class="lineNum">    4618 </span>            : </a>
<a name="4619"><span class="lineNum">    4619 </span><span class="lineCov">          3 :         cmp = php_get_data_compare_func_unstable(sort_type, 0);</span></a>
<a name="4620"><span class="lineNum">    4620 </span>            : </a>
<a name="4621"><span class="lineNum">    4621 </span><span class="lineCov">          3 :         RETVAL_ARR(zend_array_dup(Z_ARRVAL_P(array)));</span></a>
<a name="4622"><span class="lineNum">    4622 </span>            : </a>
<a name="4623"><span class="lineNum">    4623 </span>            :         /* create and sort array with pointers to the target_hash buckets */</a>
<a name="4624"><span class="lineNum">    4624 </span><span class="lineCov">          6 :         arTmp = pemalloc((Z_ARRVAL_P(array)-&gt;nNumOfElements + 1) * sizeof(struct bucketindex), GC_FLAGS(Z_ARRVAL_P(array)) &amp; IS_ARRAY_PERSISTENT);</span></a>
<a name="4625"><span class="lineNum">    4625 </span><span class="lineCov">          3 :         if (HT_IS_PACKED(Z_ARRVAL_P(array))) {</span></a>
<a name="4626"><span class="lineNum">    4626 </span><span class="lineCov">          3 :                 zval *zv = Z_ARRVAL_P(array)-&gt;arPacked;</span></a>
<a name="4627"><span class="lineNum">    4627 </span><span class="lineCov">         12 :                 for (i = 0, idx = 0; idx &lt; Z_ARRVAL_P(array)-&gt;nNumUsed; idx++, zv++) {</span></a>
<a name="4628"><span class="lineNum">    4628 </span><span class="lineCov">          9 :                         if (Z_TYPE_P(zv) == IS_UNDEF) continue;</span></a>
<a name="4629"><span class="lineNum">    4629 </span><span class="lineCov">          9 :                         ZVAL_COPY_VALUE(&amp;arTmp[i].b.val, zv);</span></a>
<a name="4630"><span class="lineNum">    4630 </span><span class="lineCov">          9 :                         arTmp[i].b.h = idx;</span></a>
<a name="4631"><span class="lineNum">    4631 </span><span class="lineCov">          9 :                         arTmp[i].b.key = NULL;</span></a>
<a name="4632"><span class="lineNum">    4632 </span><span class="lineCov">          9 :                         arTmp[i].i = i;</span></a>
<a name="4633"><span class="lineNum">    4633 </span><span class="lineCov">          9 :                         i++;</span></a>
<a name="4634"><span class="lineNum">    4634 </span>            :                 }</a>
<a name="4635"><span class="lineNum">    4635 </span>            :         } else {</a>
<a name="4636"><span class="lineNum">    4636 </span><span class="lineNoCov">          0 :                 p = Z_ARRVAL_P(array)-&gt;arData;</span></a>
<a name="4637"><span class="lineNum">    4637 </span><span class="lineNoCov">          0 :                 for (i = 0, idx = 0; idx &lt; Z_ARRVAL_P(array)-&gt;nNumUsed; idx++, p++) {</span></a>
<a name="4638"><span class="lineNum">    4638 </span><span class="lineNoCov">          0 :                         if (Z_TYPE(p-&gt;val) == IS_UNDEF) continue;</span></a>
<a name="4639"><span class="lineNum">    4639 </span><span class="lineNoCov">          0 :                         arTmp[i].b = *p;</span></a>
<a name="4640"><span class="lineNum">    4640 </span><span class="lineNoCov">          0 :                         arTmp[i].i = i;</span></a>
<a name="4641"><span class="lineNum">    4641 </span><span class="lineNoCov">          0 :                         i++;</span></a>
<a name="4642"><span class="lineNum">    4642 </span>            :                 }</a>
<a name="4643"><span class="lineNum">    4643 </span>            :         }</a>
<a name="4644"><span class="lineNum">    4644 </span><span class="lineCov">          3 :         ZVAL_UNDEF(&amp;arTmp[i].b.val);</span></a>
<a name="4645"><span class="lineNum">    4645 </span><span class="lineCov">          3 :         zend_sort((void *) arTmp, i, sizeof(struct bucketindex),</span></a>
<a name="4646"><span class="lineNum">    4646 </span>            :                         (compare_func_t) cmp, (swap_func_t) array_bucketindex_swap);</a>
<a name="4647"><span class="lineNum">    4647 </span>            :         /* go through the sorted array and delete duplicates from the copy */</a>
<a name="4648"><span class="lineNum">    4648 </span><span class="lineCov">          3 :         lastkept = arTmp;</span></a>
<a name="4649"><span class="lineNum">    4649 </span><span class="lineCov">         18 :         for (cmpdata = arTmp + 1; Z_TYPE(cmpdata-&gt;b.val) != IS_UNDEF; cmpdata++) {</span></a>
<a name="4650"><span class="lineNum">    4650 </span><span class="lineCov">          6 :                 if (cmp(&amp;lastkept-&gt;b, &amp;cmpdata-&gt;b)) {</span></a>
<a name="4651"><span class="lineNum">    4651 </span><span class="lineCov">          3 :                         lastkept = cmpdata;</span></a>
<a name="4652"><span class="lineNum">    4652 </span>            :                 } else {</a>
<a name="4653"><span class="lineNum">    4653 </span><span class="lineCov">          3 :                         if (lastkept-&gt;i &gt; cmpdata-&gt;i) {</span></a>
<a name="4654"><span class="lineNum">    4654 </span><span class="lineNoCov">          0 :                                 p = &amp;lastkept-&gt;b;</span></a>
<a name="4655"><span class="lineNum">    4655 </span><span class="lineNoCov">          0 :                                 lastkept = cmpdata;</span></a>
<a name="4656"><span class="lineNum">    4656 </span>            :                         } else {</a>
<a name="4657"><span class="lineNum">    4657 </span><span class="lineCov">          3 :                                 p = &amp;cmpdata-&gt;b;</span></a>
<a name="4658"><span class="lineNum">    4658 </span>            :                         }</a>
<a name="4659"><span class="lineNum">    4659 </span><span class="lineCov">          3 :                         if (p-&gt;key == NULL) {</span></a>
<a name="4660"><span class="lineNum">    4660 </span><span class="lineCov">          3 :                                 zend_hash_index_del(Z_ARRVAL_P(return_value), p-&gt;h);</span></a>
<a name="4661"><span class="lineNum">    4661 </span>            :                         } else {</a>
<a name="4662"><span class="lineNum">    4662 </span><span class="lineNoCov">          0 :                                 zend_hash_del(Z_ARRVAL_P(return_value), p-&gt;key);</span></a>
<a name="4663"><span class="lineNum">    4663 </span>            :                         }</a>
<a name="4664"><span class="lineNum">    4664 </span>            :                 }</a>
<a name="4665"><span class="lineNum">    4665 </span>            :         }</a>
<a name="4666"><span class="lineNum">    4666 </span><span class="lineCov">          6 :         pefree(arTmp, GC_FLAGS(Z_ARRVAL_P(array)) &amp; IS_ARRAY_PERSISTENT);</span></a>
<a name="4667"><span class="lineNum">    4667 </span>            : }</a>
<a name="4668"><span class="lineNum">    4668 </span>            : /* }}} */</a>
<a name="4669"><span class="lineNum">    4669 </span>            : </a>
<a name="4670"><span class="lineNum">    4670 </span><span class="lineCov">       3237 : static int zval_compare(zval *first, zval *second) /* {{{ */</span></a>
<a name="4671"><span class="lineNum">    4671 </span>            : {</a>
<a name="4672"><span class="lineNum">    4672 </span><span class="lineCov">       3237 :         return string_compare_function(first, second);</span></a>
<a name="4673"><span class="lineNum">    4673 </span>            : }</a>
<a name="4674"><span class="lineNum">    4674 </span>            : /* }}} */</a>
<a name="4675"><span class="lineNum">    4675 </span>            : </a>
<a name="4676"><span class="lineNum">    4676 </span><span class="lineCov">        132 : static int zval_user_compare(zval *a, zval *b) /* {{{ */</span></a>
<a name="4677"><span class="lineNum">    4677 </span>            : {</a>
<a name="4678"><span class="lineNum">    4678 </span>            :         zval args[2];</a>
<a name="4679"><span class="lineNum">    4679 </span>            :         zval retval;</a>
<a name="4680"><span class="lineNum">    4680 </span>            : </a>
<a name="4681"><span class="lineNum">    4681 </span><span class="lineCov">        132 :         ZVAL_COPY_VALUE(&amp;args[0], a);</span></a>
<a name="4682"><span class="lineNum">    4682 </span><span class="lineCov">        132 :         ZVAL_COPY_VALUE(&amp;args[1], b);</span></a>
<a name="4683"><span class="lineNum">    4683 </span>            : </a>
<a name="4684"><span class="lineNum">    4684 </span><span class="lineCov">        132 :         BG(user_compare_fci).param_count = 2;</span></a>
<a name="4685"><span class="lineNum">    4685 </span><span class="lineCov">        132 :         BG(user_compare_fci).params = args;</span></a>
<a name="4686"><span class="lineNum">    4686 </span><span class="lineCov">        132 :         BG(user_compare_fci).retval = &amp;retval;</span></a>
<a name="4687"><span class="lineNum">    4687 </span>            : </a>
<a name="4688"><span class="lineNum">    4688 </span><span class="lineCov">        264 :         if (zend_call_function(&amp;BG(user_compare_fci), &amp;BG(user_compare_fci_cache)) == SUCCESS &amp;&amp; Z_TYPE(retval) != IS_UNDEF) {</span></a>
<a name="4689"><span class="lineNum">    4689 </span><span class="lineCov">        126 :                 zend_long ret = zval_get_long(&amp;retval);</span></a>
<a name="4690"><span class="lineNum">    4690 </span><span class="lineCov">        126 :                 zval_ptr_dtor(&amp;retval);</span></a>
<a name="4691"><span class="lineNum">    4691 </span><span class="lineCov">        126 :                 return ZEND_NORMALIZE_BOOL(ret);</span></a>
<a name="4692"><span class="lineNum">    4692 </span>            :         } else {</a>
<a name="4693"><span class="lineNum">    4693 </span><span class="lineCov">          6 :                 return 0;</span></a>
<a name="4694"><span class="lineNum">    4694 </span>            :         }</a>
<a name="4695"><span class="lineNum">    4695 </span>            : }</a>
<a name="4696"><span class="lineNum">    4696 </span>            : /* }}} */</a>
<a name="4697"><span class="lineNum">    4697 </span>            : </a>
<a name="4698"><span class="lineNum">    4698 </span><span class="lineCov">       1590 : static void php_array_intersect_key(INTERNAL_FUNCTION_PARAMETERS, int data_compare_type) /* {{{ */</span></a>
<a name="4699"><span class="lineNum">    4699 </span>            : {</a>
<a name="4700"><span class="lineNum">    4700 </span>            :         int argc, i;</a>
<a name="4701"><span class="lineNum">    4701 </span>            :         zval *args;</a>
<a name="4702"><span class="lineNum">    4702 </span><span class="lineCov">       1590 :         int (*intersect_data_compare_func)(zval *, zval *) = NULL;</span></a>
<a name="4703"><span class="lineNum">    4703 </span>            :         bool ok;</a>
<a name="4704"><span class="lineNum">    4704 </span>            :         zval *val, *data;</a>
<a name="4705"><span class="lineNum">    4705 </span>            :         char *param_spec;</a>
<a name="4706"><span class="lineNum">    4706 </span>            :         zend_string *key;</a>
<a name="4707"><span class="lineNum">    4707 </span>            :         zend_ulong h;</a>
<a name="4708"><span class="lineNum">    4708 </span>            : </a>
<a name="4709"><span class="lineNum">    4709 </span>            :         /* Get the argument count */</a>
<a name="4710"><span class="lineNum">    4710 </span><span class="lineCov">       1590 :         argc = ZEND_NUM_ARGS();</span></a>
<a name="4711"><span class="lineNum">    4711 </span><span class="lineCov">       1590 :         if (data_compare_type == INTERSECT_COMP_DATA_USER) {</span></a>
<a name="4712"><span class="lineNum">    4712 </span>            :                 /* INTERSECT_COMP_DATA_USER - array_uintersect_assoc() */</a>
<a name="4713"><span class="lineNum">    4713 </span><span class="lineCov">        222 :                 param_spec = &quot;+f&quot;;</span></a>
<a name="4714"><span class="lineNum">    4714 </span><span class="lineCov">        222 :                 intersect_data_compare_func = zval_user_compare;</span></a>
<a name="4715"><span class="lineNum">    4715 </span>            :         } else {</a>
<a name="4716"><span class="lineNum">    4716 </span>            :                 /*      INTERSECT_COMP_DATA_NONE - array_intersect_key()</a>
<a name="4717"><span class="lineNum">    4717 </span>            :                         INTERSECT_COMP_DATA_INTERNAL - array_intersect_assoc() */</a>
<a name="4718"><span class="lineNum">    4718 </span><span class="lineCov">       1368 :                 param_spec = &quot;+&quot;;</span></a>
<a name="4719"><span class="lineNum">    4719 </span>            : </a>
<a name="4720"><span class="lineNum">    4720 </span><span class="lineCov">       1368 :                 if (data_compare_type == INTERSECT_COMP_DATA_INTERNAL) {</span></a>
<a name="4721"><span class="lineNum">    4721 </span><span class="lineCov">        861 :                         intersect_data_compare_func = zval_compare;</span></a>
<a name="4722"><span class="lineNum">    4722 </span>            :                 }</a>
<a name="4723"><span class="lineNum">    4723 </span>            :         }</a>
<a name="4724"><span class="lineNum">    4724 </span>            : </a>
<a name="4725"><span class="lineNum">    4725 </span><span class="lineCov">       1590 :         if (zend_parse_parameters(ZEND_NUM_ARGS(), param_spec, &amp;args, &amp;argc, &amp;BG(user_compare_fci), &amp;BG(user_compare_fci_cache)) == FAILURE) {</span></a>
<a name="4726"><span class="lineNum">    4726 </span><span class="lineCov">        912 :                 RETURN_THROWS();</span></a>
<a name="4727"><span class="lineNum">    4727 </span>            :         }</a>
<a name="4728"><span class="lineNum">    4728 </span>            : </a>
<a name="4729"><span class="lineNum">    4729 </span><span class="lineCov">       3531 :         for (i = 0; i &lt; argc; i++) {</span></a>
<a name="4730"><span class="lineNum">    4730 </span><span class="lineCov">       5706 :                 if (Z_TYPE(args[i]) != IS_ARRAY) {</span></a>
<a name="4731"><span class="lineNum">    4731 </span><span class="lineCov">        846 :                         zend_argument_type_error(i + 1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;args[i]));</span></a>
<a name="4732"><span class="lineNum">    4732 </span><span class="lineCov">        846 :                         RETURN_THROWS();</span></a>
<a name="4733"><span class="lineNum">    4733 </span>            :                 }</a>
<a name="4734"><span class="lineNum">    4734 </span>            :         }</a>
<a name="4735"><span class="lineNum">    4735 </span>            : </a>
<a name="4736"><span class="lineNum">    4736 </span><span class="lineCov">        678 :         array_init(return_value);</span></a>
<a name="4737"><span class="lineNum">    4737 </span>            : </a>
<a name="4738"><span class="lineNum">    4738 </span>            :         /* Iterate over keys of the first array, to compute keys that are in all of the other arrays. */</a>
<a name="4739"><span class="lineNum">    4739 </span><span class="lineCov">      13878 :         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL(args[0]), h, key, val) {</span></a>
<a name="4740"><span class="lineNum">    4740 </span><span class="lineCov">       6774 :                 if (Z_ISREF_P(val) &amp;&amp; Z_REFCOUNT_P(val) == 1) {</span></a>
<a name="4741"><span class="lineNum">    4741 </span><span class="lineCov">        162 :                         val = Z_REFVAL_P(val);</span></a>
<a name="4742"><span class="lineNum">    4742 </span>            :                 }</a>
<a name="4743"><span class="lineNum">    4743 </span><span class="lineCov">       6585 :                 if (key == NULL) {</span></a>
<a name="4744"><span class="lineNum">    4744 </span><span class="lineCov">       3285 :                         ok = 1;</span></a>
<a name="4745"><span class="lineNum">    4745 </span><span class="lineCov">       3828 :                         for (i = 1; i &lt; argc; i++) {</span></a>
<a name="4746"><span class="lineNum">    4746 </span><span class="lineCov">       3468 :                                 if ((data = zend_hash_index_find(Z_ARRVAL(args[i]), h)) == NULL ||</span></a>
<a name="4747"><span class="lineNum">    4747 </span><span class="lineCov">       1008 :                                         (intersect_data_compare_func &amp;&amp;</span></a>
<a name="4748"><span class="lineNum">    4748 </span><span class="lineCov">       1008 :                                         intersect_data_compare_func(val, data) != 0)</span></a>
<a name="4749"><span class="lineNum">    4749 </span>            :                                 ) {</a>
<a name="4750"><span class="lineNum">    4750 </span><span class="lineCov">       2925 :                                         ok = 0;</span></a>
<a name="4751"><span class="lineNum">    4751 </span><span class="lineCov">       2925 :                                         break;</span></a>
<a name="4752"><span class="lineNum">    4752 </span>            :                                 }</a>
<a name="4753"><span class="lineNum">    4753 </span>            :                         }</a>
<a name="4754"><span class="lineNum">    4754 </span><span class="lineCov">       3285 :                         if (ok) {</span></a>
<a name="4755"><span class="lineNum">    4755 </span><span class="lineCov">        360 :                                 Z_TRY_ADDREF_P(val);</span></a>
<a name="4756"><span class="lineNum">    4756 </span><span class="lineCov">        360 :                                 zend_hash_index_add_new(Z_ARRVAL_P(return_value), h, val);</span></a>
<a name="4757"><span class="lineNum">    4757 </span>            :                         }</a>
<a name="4758"><span class="lineNum">    4758 </span>            :                 } else {</a>
<a name="4759"><span class="lineNum">    4759 </span><span class="lineCov">       3300 :                         ok = 1;</span></a>
<a name="4760"><span class="lineNum">    4760 </span><span class="lineCov">       3717 :                         for (i = 1; i &lt; argc; i++) {</span></a>
<a name="4761"><span class="lineNum">    4761 </span><span class="lineCov">       3420 :                                 if ((data = zend_hash_find_known_hash(Z_ARRVAL(args[i]), key)) == NULL ||</span></a>
<a name="4762"><span class="lineNum">    4762 </span><span class="lineCov">        459 :                                         (intersect_data_compare_func &amp;&amp;</span></a>
<a name="4763"><span class="lineNum">    4763 </span><span class="lineCov">        459 :                                         intersect_data_compare_func(val, data) != 0)</span></a>
<a name="4764"><span class="lineNum">    4764 </span>            :                                 ) {</a>
<a name="4765"><span class="lineNum">    4765 </span><span class="lineCov">       3003 :                                         ok = 0;</span></a>
<a name="4766"><span class="lineNum">    4766 </span><span class="lineCov">       3003 :                                         break;</span></a>
<a name="4767"><span class="lineNum">    4767 </span>            :                                 }</a>
<a name="4768"><span class="lineNum">    4768 </span>            :                         }</a>
<a name="4769"><span class="lineNum">    4769 </span><span class="lineCov">       3300 :                         if (ok) {</span></a>
<a name="4770"><span class="lineNum">    4770 </span><span class="lineCov">        297 :                                 Z_TRY_ADDREF_P(val);</span></a>
<a name="4771"><span class="lineNum">    4771 </span><span class="lineCov">        297 :                                 zend_hash_add_new(Z_ARRVAL_P(return_value), key, val);</span></a>
<a name="4772"><span class="lineNum">    4772 </span>            :                         }</a>
<a name="4773"><span class="lineNum">    4773 </span>            :                 }</a>
<a name="4774"><span class="lineNum">    4774 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="4775"><span class="lineNum">    4775 </span>            : }</a>
<a name="4776"><span class="lineNum">    4776 </span>            : /* }}} */</a>
<a name="4777"><span class="lineNum">    4777 </span>            : </a>
<a name="4778"><span class="lineNum">    4778 </span><span class="lineCov">       2169 : static void php_array_intersect(INTERNAL_FUNCTION_PARAMETERS, int behavior, int data_compare_type, int key_compare_type) /* {{{ */</span></a>
<a name="4779"><span class="lineNum">    4779 </span>            : {</a>
<a name="4780"><span class="lineNum">    4780 </span><span class="lineCov">       2169 :         zval *args = NULL;</span></a>
<a name="4781"><span class="lineNum">    4781 </span>            :         HashTable *hash;</a>
<a name="4782"><span class="lineNum">    4782 </span><span class="lineCov">       2169 :         int arr_argc, i, c = 0;</span></a>
<a name="4783"><span class="lineNum">    4783 </span>            :         uint32_t idx;</a>
<a name="4784"><span class="lineNum">    4784 </span>            :         Bucket **lists, *list, **ptrs, *p;</a>
<a name="4785"><span class="lineNum">    4785 </span>            :         char *param_spec;</a>
<a name="4786"><span class="lineNum">    4786 </span>            :         zend_fcall_info fci1, fci2;</a>
<a name="4787"><span class="lineNum">    4787 </span><span class="lineCov">       2169 :         zend_fcall_info_cache fci1_cache = empty_fcall_info_cache, fci2_cache = empty_fcall_info_cache;</span></a>
<a name="4788"><span class="lineNum">    4788 </span><span class="lineCov">       2169 :         zend_fcall_info *fci_key = NULL, *fci_data;</span></a>
<a name="4789"><span class="lineNum">    4789 </span><span class="lineCov">       2169 :         zend_fcall_info_cache *fci_key_cache = NULL, *fci_data_cache;</span></a>
<a name="4790"><span class="lineNum">    4790 </span>            :         PHP_ARRAY_CMP_FUNC_VARS;</a>
<a name="4791"><span class="lineNum">    4791 </span>            : </a>
<a name="4792"><span class="lineNum">    4792 </span>            :         bucket_compare_func_t intersect_key_compare_func;</a>
<a name="4793"><span class="lineNum">    4793 </span>            :         bucket_compare_func_t intersect_data_compare_func;</a>
<a name="4794"><span class="lineNum">    4794 </span>            : </a>
<a name="4795"><span class="lineNum">    4795 </span><span class="lineCov">       2169 :         if (behavior == INTERSECT_NORMAL) {</span></a>
<a name="4796"><span class="lineNum">    4796 </span><span class="lineCov">       1101 :                 intersect_key_compare_func = php_array_key_compare_string;</span></a>
<a name="4797"><span class="lineNum">    4797 </span>            : </a>
<a name="4798"><span class="lineNum">    4798 </span><span class="lineCov">       1101 :                 if (data_compare_type == INTERSECT_COMP_DATA_INTERNAL) {</span></a>
<a name="4799"><span class="lineNum">    4799 </span>            :                         /* array_intersect() */</a>
<a name="4800"><span class="lineNum">    4800 </span><span class="lineCov">        873 :                         param_spec = &quot;+&quot;;</span></a>
<a name="4801"><span class="lineNum">    4801 </span><span class="lineCov">        873 :                         intersect_data_compare_func = php_array_data_compare_string_unstable;</span></a>
<a name="4802"><span class="lineNum">    4802 </span><span class="lineCov">        228 :                 } else if (data_compare_type == INTERSECT_COMP_DATA_USER) {</span></a>
<a name="4803"><span class="lineNum">    4803 </span>            :                         /* array_uintersect() */</a>
<a name="4804"><span class="lineNum">    4804 </span><span class="lineCov">        228 :                         param_spec = &quot;+f&quot;;</span></a>
<a name="4805"><span class="lineNum">    4805 </span><span class="lineCov">        228 :                         intersect_data_compare_func = php_array_user_compare_unstable;</span></a>
<a name="4806"><span class="lineNum">    4806 </span>            :                 } else {</a>
<a name="4807"><span class="lineNum">    4807 </span><span class="lineNoCov">          0 :                         ZEND_ASSERT(0 &amp;&amp; &quot;Invalid data_compare_type&quot;);</span></a>
<a name="4808"><span class="lineNum">    4808 </span><span class="lineCov">        228 :                         return;</span></a>
<a name="4809"><span class="lineNum">    4809 </span>            :                 }</a>
<a name="4810"><span class="lineNum">    4810 </span>            : </a>
<a name="4811"><span class="lineNum">    4811 </span><span class="lineCov">       1101 :                 if (zend_parse_parameters(ZEND_NUM_ARGS(), param_spec, &amp;args, &amp;arr_argc, &amp;fci1, &amp;fci1_cache) == FAILURE) {</span></a>
<a name="4812"><span class="lineNum">    4812 </span><span class="lineCov">         60 :                         RETURN_THROWS();</span></a>
<a name="4813"><span class="lineNum">    4813 </span>            :                 }</a>
<a name="4814"><span class="lineNum">    4814 </span><span class="lineCov">       1041 :                 fci_data = &amp;fci1;</span></a>
<a name="4815"><span class="lineNum">    4815 </span><span class="lineCov">       1041 :                 fci_data_cache = &amp;fci1_cache;</span></a>
<a name="4816"><span class="lineNum">    4816 </span>            : </a>
<a name="4817"><span class="lineNum">    4817 </span><span class="lineCov">       1068 :         } else if (behavior &amp; INTERSECT_ASSOC) { /* triggered also when INTERSECT_KEY */</span></a>
<a name="4818"><span class="lineNum">    4818 </span>            :                 /* INTERSECT_KEY is subset of INTERSECT_ASSOC. When having the former</a>
<a name="4819"><span class="lineNum">    4819 </span>            :                  * no comparison of the data is done (part of INTERSECT_ASSOC) */</a>
<a name="4820"><span class="lineNum">    4820 </span>            : </a>
<a name="4821"><span class="lineNum">    4821 </span><span class="lineCov">       1068 :                 if (data_compare_type == INTERSECT_COMP_DATA_INTERNAL &amp;&amp; key_compare_type == INTERSECT_COMP_KEY_INTERNAL) {</span></a>
<a name="4822"><span class="lineNum">    4822 </span>            :                         /* array_intersect_assoc() or array_intersect_key() */</a>
<a name="4823"><span class="lineNum">    4823 </span><span class="lineNoCov">          0 :                         param_spec = &quot;+&quot;;</span></a>
<a name="4824"><span class="lineNum">    4824 </span><span class="lineNoCov">          0 :                         intersect_key_compare_func = php_array_key_compare_string_unstable;</span></a>
<a name="4825"><span class="lineNum">    4825 </span><span class="lineNoCov">          0 :                         intersect_data_compare_func = php_array_data_compare_string_unstable;</span></a>
<a name="4826"><span class="lineNum">    4826 </span><span class="lineCov">       1068 :                 } else if (data_compare_type == INTERSECT_COMP_DATA_USER &amp;&amp; key_compare_type == INTERSECT_COMP_KEY_INTERNAL) {</span></a>
<a name="4827"><span class="lineNum">    4827 </span>            :                         /* array_uintersect_assoc() */</a>
<a name="4828"><span class="lineNum">    4828 </span><span class="lineNoCov">          0 :                         param_spec = &quot;+f&quot;;</span></a>
<a name="4829"><span class="lineNum">    4829 </span><span class="lineNoCov">          0 :                         intersect_key_compare_func = php_array_key_compare_string_unstable;</span></a>
<a name="4830"><span class="lineNum">    4830 </span><span class="lineNoCov">          0 :                         intersect_data_compare_func = php_array_user_compare_unstable;</span></a>
<a name="4831"><span class="lineNum">    4831 </span><span class="lineNoCov">          0 :                         fci_data = &amp;fci1;</span></a>
<a name="4832"><span class="lineNum">    4832 </span><span class="lineNoCov">          0 :                         fci_data_cache = &amp;fci1_cache;</span></a>
<a name="4833"><span class="lineNum">    4833 </span><span class="lineCov">       1068 :                 } else if (data_compare_type == INTERSECT_COMP_DATA_INTERNAL &amp;&amp; key_compare_type == INTERSECT_COMP_KEY_USER) {</span></a>
<a name="4834"><span class="lineNum">    4834 </span>            :                         /* array_intersect_uassoc() or array_intersect_ukey() */</a>
<a name="4835"><span class="lineNum">    4835 </span><span class="lineCov">        846 :                         param_spec = &quot;+f&quot;;</span></a>
<a name="4836"><span class="lineNum">    4836 </span><span class="lineCov">        846 :                         intersect_key_compare_func = php_array_user_key_compare_unstable;</span></a>
<a name="4837"><span class="lineNum">    4837 </span><span class="lineCov">        846 :                         intersect_data_compare_func = php_array_data_compare_string_unstable;</span></a>
<a name="4838"><span class="lineNum">    4838 </span><span class="lineCov">        846 :                         fci_key = &amp;fci1;</span></a>
<a name="4839"><span class="lineNum">    4839 </span><span class="lineCov">        846 :                         fci_key_cache = &amp;fci1_cache;</span></a>
<a name="4840"><span class="lineNum">    4840 </span><span class="lineCov">        222 :                 } else if (data_compare_type == INTERSECT_COMP_DATA_USER &amp;&amp; key_compare_type == INTERSECT_COMP_KEY_USER) {</span></a>
<a name="4841"><span class="lineNum">    4841 </span>            :                         /* array_uintersect_uassoc() */</a>
<a name="4842"><span class="lineNum">    4842 </span><span class="lineCov">        222 :                         param_spec = &quot;+ff&quot;;</span></a>
<a name="4843"><span class="lineNum">    4843 </span><span class="lineCov">        222 :                         intersect_key_compare_func = php_array_user_key_compare_unstable;</span></a>
<a name="4844"><span class="lineNum">    4844 </span><span class="lineCov">        222 :                         intersect_data_compare_func = php_array_user_compare_unstable;</span></a>
<a name="4845"><span class="lineNum">    4845 </span><span class="lineCov">        222 :                         fci_data = &amp;fci1;</span></a>
<a name="4846"><span class="lineNum">    4846 </span><span class="lineCov">        222 :                         fci_data_cache = &amp;fci1_cache;</span></a>
<a name="4847"><span class="lineNum">    4847 </span><span class="lineCov">        222 :                         fci_key = &amp;fci2;</span></a>
<a name="4848"><span class="lineNum">    4848 </span><span class="lineCov">        222 :                         fci_key_cache = &amp;fci2_cache;</span></a>
<a name="4849"><span class="lineNum">    4849 </span>            :                 } else {</a>
<a name="4850"><span class="lineNum">    4850 </span><span class="lineNoCov">          0 :                         ZEND_ASSERT(0 &amp;&amp; &quot;Invalid data_compare_type / key_compare_type&quot;);</span></a>
<a name="4851"><span class="lineNum">    4851 </span>            :                         return;</a>
<a name="4852"><span class="lineNum">    4852 </span>            :                 }</a>
<a name="4853"><span class="lineNum">    4853 </span>            : </a>
<a name="4854"><span class="lineNum">    4854 </span><span class="lineCov">       1068 :                 if (zend_parse_parameters(ZEND_NUM_ARGS(), param_spec, &amp;args, &amp;arr_argc, &amp;fci1, &amp;fci1_cache, &amp;fci2, &amp;fci2_cache) == FAILURE) {</span></a>
<a name="4855"><span class="lineNum">    4855 </span><span class="lineCov">        168 :                         RETURN_THROWS();</span></a>
<a name="4856"><span class="lineNum">    4856 </span>            :                 }</a>
<a name="4857"><span class="lineNum">    4857 </span>            : </a>
<a name="4858"><span class="lineNum">    4858 </span>            :         } else {</a>
<a name="4859"><span class="lineNum">    4859 </span><span class="lineNoCov">          0 :                 ZEND_ASSERT(0 &amp;&amp; &quot;Invalid behavior&quot;);</span></a>
<a name="4860"><span class="lineNum">    4860 </span>            :                 return;</a>
<a name="4861"><span class="lineNum">    4861 </span>            :         }</a>
<a name="4862"><span class="lineNum">    4862 </span>            : </a>
<a name="4863"><span class="lineNum">    4863 </span><span class="lineCov">       1941 :         PHP_ARRAY_CMP_FUNC_BACKUP();</span></a>
<a name="4864"><span class="lineNum">    4864 </span>            : </a>
<a name="4865"><span class="lineNum">    4865 </span>            :         /* for each argument, create and sort list with pointers to the hash buckets */</a>
<a name="4866"><span class="lineNum">    4866 </span><span class="lineCov">       1941 :         lists = (Bucket **)safe_emalloc(arr_argc, sizeof(Bucket *), 0);</span></a>
<a name="4867"><span class="lineNum">    4867 </span><span class="lineCov">       1941 :         ptrs = (Bucket **)safe_emalloc(arr_argc, sizeof(Bucket *), 0);</span></a>
<a name="4868"><span class="lineNum">    4868 </span>            : </a>
<a name="4869"><span class="lineNum">    4869 </span><span class="lineCov">       1941 :         if (behavior == INTERSECT_NORMAL &amp;&amp; data_compare_type == INTERSECT_COMP_DATA_USER) {</span></a>
<a name="4870"><span class="lineNum">    4870 </span><span class="lineCov">        174 :                 BG(user_compare_fci) = *fci_data;</span></a>
<a name="4871"><span class="lineNum">    4871 </span><span class="lineCov">        174 :                 BG(user_compare_fci_cache) = *fci_data_cache;</span></a>
<a name="4872"><span class="lineNum">    4872 </span><span class="lineCov">       1767 :         } else if ((behavior &amp; INTERSECT_ASSOC) &amp;&amp; key_compare_type == INTERSECT_COMP_KEY_USER) {</span></a>
<a name="4873"><span class="lineNum">    4873 </span><span class="lineCov">        900 :                 BG(user_compare_fci) = *fci_key;</span></a>
<a name="4874"><span class="lineNum">    4874 </span><span class="lineCov">        900 :                 BG(user_compare_fci_cache) = *fci_key_cache;</span></a>
<a name="4875"><span class="lineNum">    4875 </span>            :         }</a>
<a name="4876"><span class="lineNum">    4876 </span>            : </a>
<a name="4877"><span class="lineNum">    4877 </span><span class="lineCov">       4197 :         for (i = 0; i &lt; arr_argc; i++) {</span></a>
<a name="4878"><span class="lineNum">    4878 </span><span class="lineCov">       7032 :                 if (Z_TYPE(args[i]) != IS_ARRAY) {</span></a>
<a name="4879"><span class="lineNum">    4879 </span><span class="lineCov">       1260 :                         zend_argument_type_error(i + 1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;args[i]));</span></a>
<a name="4880"><span class="lineNum">    4880 </span><span class="lineCov">       1260 :                         arr_argc = i; /* only free up to i - 1 */</span></a>
<a name="4881"><span class="lineNum">    4881 </span><span class="lineCov">       1260 :                         goto out;</span></a>
<a name="4882"><span class="lineNum">    4882 </span>            :                 }</a>
<a name="4883"><span class="lineNum">    4883 </span><span class="lineCov">       2256 :                 hash = Z_ARRVAL(args[i]);</span></a>
<a name="4884"><span class="lineNum">    4884 </span><span class="lineCov">       4512 :                 list = (Bucket *) pemalloc((hash-&gt;nNumOfElements + 1) * sizeof(Bucket), GC_FLAGS(hash) &amp; IS_ARRAY_PERSISTENT);</span></a>
<a name="4885"><span class="lineNum">    4885 </span><span class="lineCov">       2256 :                 lists[i] = list;</span></a>
<a name="4886"><span class="lineNum">    4886 </span><span class="lineCov">       2256 :                 ptrs[i] = list;</span></a>
<a name="4887"><span class="lineNum">    4887 </span><span class="lineCov">       2256 :                 if (HT_IS_PACKED(hash)) {</span></a>
<a name="4888"><span class="lineNum">    4888 </span><span class="lineCov">       1068 :                         zval *zv = hash-&gt;arPacked;</span></a>
<a name="4889"><span class="lineNum">    4889 </span><span class="lineCov">       6549 :                         for (idx = 0; idx &lt; hash-&gt;nNumUsed; idx++, zv++) {</span></a>
<a name="4890"><span class="lineNum">    4890 </span><span class="lineCov">       5481 :                                 if (Z_TYPE_P(zv) == IS_UNDEF) continue;</span></a>
<a name="4891"><span class="lineNum">    4891 </span><span class="lineCov">       5406 :                                 ZVAL_COPY_VALUE(&amp;list-&gt;val, zv);</span></a>
<a name="4892"><span class="lineNum">    4892 </span><span class="lineCov">       5406 :                                 list-&gt;h = idx;</span></a>
<a name="4893"><span class="lineNum">    4893 </span><span class="lineCov">       5406 :                                 list-&gt;key = NULL;</span></a>
<a name="4894"><span class="lineNum">    4894 </span><span class="lineCov">       5406 :                                 list++;</span></a>
<a name="4895"><span class="lineNum">    4895 </span>            :                         }</a>
<a name="4896"><span class="lineNum">    4896 </span>            :                 } else {</a>
<a name="4897"><span class="lineNum">    4897 </span><span class="lineCov">       1188 :                         p = hash-&gt;arData;</span></a>
<a name="4898"><span class="lineNum">    4898 </span><span class="lineCov">       9618 :                         for (idx = 0; idx &lt; hash-&gt;nNumUsed; idx++, p++) {</span></a>
<a name="4899"><span class="lineNum">    4899 </span><span class="lineCov">      16860 :                                 if (Z_TYPE(p-&gt;val) == IS_UNDEF) continue;</span></a>
<a name="4900"><span class="lineNum">    4900 </span><span class="lineCov">       8430 :                                 *list++ = *p;</span></a>
<a name="4901"><span class="lineNum">    4901 </span>            :                         }</a>
<a name="4902"><span class="lineNum">    4902 </span>            :                 }</a>
<a name="4903"><span class="lineNum">    4903 </span><span class="lineCov">       2256 :                 ZVAL_UNDEF(&amp;list-&gt;val);</span></a>
<a name="4904"><span class="lineNum">    4904 </span><span class="lineCov">       2256 :                 if (hash-&gt;nNumOfElements &gt; 1) {</span></a>
<a name="4905"><span class="lineNum">    4905 </span><span class="lineCov">       2088 :                         if (behavior == INTERSECT_NORMAL) {</span></a>
<a name="4906"><span class="lineNum">    4906 </span><span class="lineCov">       1443 :                                 zend_sort((void *) lists[i], hash-&gt;nNumOfElements,</span></a>
<a name="4907"><span class="lineNum">    4907 </span>            :                                                 sizeof(Bucket), (compare_func_t) intersect_data_compare_func,</a>
<a name="4908"><span class="lineNum">    4908 </span>            :                                                 (swap_func_t)zend_hash_bucket_swap);</a>
<a name="4909"><span class="lineNum">    4909 </span><span class="lineCov">        645 :                         } else if (behavior &amp; INTERSECT_ASSOC) { /* triggered also when INTERSECT_KEY */</span></a>
<a name="4910"><span class="lineNum">    4910 </span><span class="lineCov">        645 :                                 zend_sort((void *) lists[i], hash-&gt;nNumOfElements,</span></a>
<a name="4911"><span class="lineNum">    4911 </span>            :                                                 sizeof(Bucket), (compare_func_t) intersect_key_compare_func,</a>
<a name="4912"><span class="lineNum">    4912 </span>            :                                                 (swap_func_t)zend_hash_bucket_swap);</a>
<a name="4913"><span class="lineNum">    4913 </span>            :                         }</a>
<a name="4914"><span class="lineNum">    4914 </span>            :                 }</a>
<a name="4915"><span class="lineNum">    4915 </span>            :         }</a>
<a name="4916"><span class="lineNum">    4916 </span>            : </a>
<a name="4917"><span class="lineNum">    4917 </span>            :         /* copy the argument array */</a>
<a name="4918"><span class="lineNum">    4918 </span><span class="lineCov">        681 :         RETVAL_ARR(zend_array_dup(Z_ARRVAL(args[0])));</span></a>
<a name="4919"><span class="lineNum">    4919 </span>            : </a>
<a name="4920"><span class="lineNum">    4920 </span>            :         /* go through the lists and look for common values */</a>
<a name="4921"><span class="lineNum">    4921 </span><span class="lineCov">       4368 :         while (Z_TYPE(ptrs[0]-&gt;val) != IS_UNDEF) {</span></a>
<a name="4922"><span class="lineNum">    4922 </span><span class="lineCov">       2166 :                 if ((behavior &amp; INTERSECT_ASSOC) /* triggered also when INTERSECT_KEY */</span></a>
<a name="4923"><span class="lineNum">    4923 </span><span class="lineCov">        441 :                         &amp;&amp; key_compare_type == INTERSECT_COMP_KEY_USER) {</span></a>
<a name="4924"><span class="lineNum">    4924 </span><span class="lineCov">        441 :                         BG(user_compare_fci) = *fci_key;</span></a>
<a name="4925"><span class="lineNum">    4925 </span><span class="lineCov">        441 :                         BG(user_compare_fci_cache) = *fci_key_cache;</span></a>
<a name="4926"><span class="lineNum">    4926 </span>            :                 }</a>
<a name="4927"><span class="lineNum">    4927 </span>            : </a>
<a name="4928"><span class="lineNum">    4928 </span><span class="lineCov">       3627 :                 for (i = 1; i &lt; arr_argc; i++) {</span></a>
<a name="4929"><span class="lineNum">    4929 </span><span class="lineCov">       2625 :                         if (behavior &amp; INTERSECT_NORMAL) {</span></a>
<a name="4930"><span class="lineNum">    4930 </span><span class="lineCov">       9288 :                                 while (Z_TYPE(ptrs[i]-&gt;val) != IS_UNDEF &amp;&amp; (0 &lt; (c = intersect_data_compare_func(ptrs[0], ptrs[i])))) {</span></a>
<a name="4931"><span class="lineNum">    4931 </span><span class="lineCov">       2508 :                                         ptrs[i]++;</span></a>
<a name="4932"><span class="lineNum">    4932 </span>            :                                 }</a>
<a name="4933"><span class="lineNum">    4933 </span><span class="lineCov">        489 :                         } else if (behavior &amp; INTERSECT_ASSOC) { /* triggered also when INTERSECT_KEY */</span></a>
<a name="4934"><span class="lineNum">    4934 </span><span class="lineCov">       1422 :                                 while (Z_TYPE(ptrs[i]-&gt;val) != IS_UNDEF &amp;&amp; (0 &lt; (c = intersect_key_compare_func(ptrs[0], ptrs[i])))) {</span></a>
<a name="4935"><span class="lineNum">    4935 </span><span class="lineCov">        222 :                                         ptrs[i]++;</span></a>
<a name="4936"><span class="lineNum">    4936 </span>            :                                 }</a>
<a name="4937"><span class="lineNum">    4937 </span><span class="lineCov">        801 :                                 if ((!c &amp;&amp; Z_TYPE(ptrs[i]-&gt;val) != IS_UNDEF) &amp;&amp; (behavior == INTERSECT_ASSOC)) { /* only when INTERSECT_ASSOC */</span></a>
<a name="4938"><span class="lineNum">    4938 </span>            :                                         /* this means that ptrs[i] is not NULL so we can compare</a>
<a name="4939"><span class="lineNum">    4939 </span>            :                                          * and &quot;c==0&quot; is from last operation</a>
<a name="4940"><span class="lineNum">    4940 </span>            :                                          * in this branch of code we enter only when INTERSECT_ASSOC</a>
<a name="4941"><span class="lineNum">    4941 </span>            :                                          * since when we have INTERSECT_KEY compare of data is not wanted. */</a>
<a name="4942"><span class="lineNum">    4942 </span><span class="lineCov">        123 :                                         if (data_compare_type == INTERSECT_COMP_DATA_USER) {</span></a>
<a name="4943"><span class="lineNum">    4943 </span><span class="lineCov">         39 :                                                 BG(user_compare_fci) = *fci_data;</span></a>
<a name="4944"><span class="lineNum">    4944 </span><span class="lineCov">         39 :                                                 BG(user_compare_fci_cache) = *fci_data_cache;</span></a>
<a name="4945"><span class="lineNum">    4945 </span>            :                                         }</a>
<a name="4946"><span class="lineNum">    4946 </span><span class="lineCov">        123 :                                         if (intersect_data_compare_func(ptrs[0], ptrs[i]) != 0) {</span></a>
<a name="4947"><span class="lineNum">    4947 </span><span class="lineCov">         57 :                                                 c = 1;</span></a>
<a name="4948"><span class="lineNum">    4948 </span><span class="lineCov">         57 :                                                 if (key_compare_type == INTERSECT_COMP_KEY_USER) {</span></a>
<a name="4949"><span class="lineNum">    4949 </span><span class="lineCov">         57 :                                                         BG(user_compare_fci) = *fci_key;</span></a>
<a name="4950"><span class="lineNum">    4950 </span><span class="lineCov">         57 :                                                         BG(user_compare_fci_cache) = *fci_key_cache;</span></a>
<a name="4951"><span class="lineNum">    4951 </span>            :                                                         /* When KEY_USER, the last parameter is always the callback */</a>
<a name="4952"><span class="lineNum">    4952 </span>            :                                                 }</a>
<a name="4953"><span class="lineNum">    4953 </span>            :                                                 /* we are going to the break */</a>
<a name="4954"><span class="lineNum">    4954 </span>            :                                         } else {</a>
<a name="4955"><span class="lineNum">    4955 </span>            :                                                 /* continue looping */</a>
<a name="4956"><span class="lineNum">    4956 </span>            :                                         }</a>
<a name="4957"><span class="lineNum">    4957 </span>            :                                 }</a>
<a name="4958"><span class="lineNum">    4958 </span>            :                         }</a>
<a name="4959"><span class="lineNum">    4959 </span><span class="lineCov">       5250 :                         if (Z_TYPE(ptrs[i]-&gt;val) == IS_UNDEF) {</span></a>
<a name="4960"><span class="lineNum">    4960 </span>            :                                 /* delete any values corresponding to remains of ptrs[0] */</a>
<a name="4961"><span class="lineNum">    4961 </span>            :                                 /* and exit because they do not present in at least one of */</a>
<a name="4962"><span class="lineNum">    4962 </span>            :                                 /* the other arguments */</a>
<a name="4963"><span class="lineNum">    4963 </span>            :                                 for (;;) {</a>
<a name="4964"><span class="lineNum">    4964 </span><span class="lineCov">       2037 :                                         p = ptrs[0]++;</span></a>
<a name="4965"><span class="lineNum">    4965 </span><span class="lineCov">       4074 :                                         if (Z_TYPE(p-&gt;val) == IS_UNDEF) {</span></a>
<a name="4966"><span class="lineNum">    4966 </span><span class="lineCov">        312 :                                                 goto out;</span></a>
<a name="4967"><span class="lineNum">    4967 </span>            :                                         }</a>
<a name="4968"><span class="lineNum">    4968 </span><span class="lineCov">       1725 :                                         if (p-&gt;key == NULL) {</span></a>
<a name="4969"><span class="lineNum">    4969 </span><span class="lineCov">       1518 :                                                 zend_hash_index_del(Z_ARRVAL_P(return_value), p-&gt;h);</span></a>
<a name="4970"><span class="lineNum">    4970 </span>            :                                         } else {</a>
<a name="4971"><span class="lineNum">    4971 </span><span class="lineCov">        207 :                                                 zend_hash_del(Z_ARRVAL_P(return_value), p-&gt;key);</span></a>
<a name="4972"><span class="lineNum">    4972 </span>            :                                         }</a>
<a name="4973"><span class="lineNum">    4973 </span>            :                                 }</a>
<a name="4974"><span class="lineNum">    4974 </span>            :                         }</a>
<a name="4975"><span class="lineNum">    4975 </span><span class="lineCov">       2313 :                         if (c) /* here we get if not all are equal */</span></a>
<a name="4976"><span class="lineNum">    4976 </span><span class="lineCov">        852 :                                 break;</span></a>
<a name="4977"><span class="lineNum">    4977 </span><span class="lineCov">       1461 :                         ptrs[i]++;</span></a>
<a name="4978"><span class="lineNum">    4978 </span>            :                 }</a>
<a name="4979"><span class="lineNum">    4979 </span><span class="lineCov">       1854 :                 if (c) {</span></a>
<a name="4980"><span class="lineNum">    4980 </span>            :                         /* Value of ptrs[0] not in all arguments, delete all entries */</a>
<a name="4981"><span class="lineNum">    4981 </span>            :                         /* with value &lt; value of ptrs[i] */</a>
<a name="4982"><span class="lineNum">    4982 </span>            :                         for (;;) {</a>
<a name="4983"><span class="lineNum">    4983 </span><span class="lineCov">       1962 :                                 p = ptrs[0];</span></a>
<a name="4984"><span class="lineNum">    4984 </span><span class="lineCov">       1962 :                                 if (p-&gt;key == NULL) {</span></a>
<a name="4985"><span class="lineNum">    4985 </span><span class="lineCov">       1626 :                                         zend_hash_index_del(Z_ARRVAL_P(return_value), p-&gt;h);</span></a>
<a name="4986"><span class="lineNum">    4986 </span>            :                                 } else {</a>
<a name="4987"><span class="lineNum">    4987 </span><span class="lineCov">        336 :                                         zend_hash_del(Z_ARRVAL_P(return_value), p-&gt;key);</span></a>
<a name="4988"><span class="lineNum">    4988 </span>            :                                 }</a>
<a name="4989"><span class="lineNum">    4989 </span><span class="lineCov">       3924 :                                 if (Z_TYPE((++ptrs[0])-&gt;val) == IS_UNDEF) {</span></a>
<a name="4990"><span class="lineNum">    4990 </span><span class="lineCov">        159 :                                         goto out;</span></a>
<a name="4991"><span class="lineNum">    4991 </span>            :                                 }</a>
<a name="4992"><span class="lineNum">    4992 </span><span class="lineCov">       1803 :                                 if (behavior == INTERSECT_NORMAL) {</span></a>
<a name="4993"><span class="lineNum">    4993 </span><span class="lineCov">       1635 :                                         if (0 &lt;= intersect_data_compare_func(ptrs[0], ptrs[i])) {</span></a>
<a name="4994"><span class="lineNum">    4994 </span><span class="lineCov">        525 :                                                 break;</span></a>
<a name="4995"><span class="lineNum">    4995 </span>            :                                         }</a>
<a name="4996"><span class="lineNum">    4996 </span><span class="lineCov">        168 :                                 } else if (behavior &amp; INTERSECT_ASSOC) { /* triggered also when INTERSECT_KEY */</span></a>
<a name="4997"><span class="lineNum">    4997 </span>            :                                         /* no need of looping because indexes are unique */</a>
<a name="4998"><span class="lineNum">    4998 </span><span class="lineCov">        168 :                                         break;</span></a>
<a name="4999"><span class="lineNum">    4999 </span>            :                                 }</a>
<a name="5000"><span class="lineNum">    5000 </span>            :                         }</a>
<a name="5001"><span class="lineNum">    5001 </span>            :                 } else {</a>
<a name="5002"><span class="lineNum">    5002 </span>            :                         /* ptrs[0] is present in all the arguments */</a>
<a name="5003"><span class="lineNum">    5003 </span>            :                         /* Skip all entries with same value as ptrs[0] */</a>
<a name="5004"><span class="lineNum">    5004 </span>            :                         for (;;) {</a>
<a name="5005"><span class="lineNum">    5005 </span><span class="lineCov">       2352 :                                 if (Z_TYPE((++ptrs[0])-&gt;val) == IS_UNDEF) {</span></a>
<a name="5006"><span class="lineNum">    5006 </span><span class="lineCov">        192 :                                         goto out;</span></a>
<a name="5007"><span class="lineNum">    5007 </span>            :                                 }</a>
<a name="5008"><span class="lineNum">    5008 </span><span class="lineCov">        984 :                                 if (behavior == INTERSECT_NORMAL) {</span></a>
<a name="5009"><span class="lineNum">    5009 </span><span class="lineCov">        837 :                                         if (intersect_data_compare_func(ptrs[0] - 1, ptrs[0])) {</span></a>
<a name="5010"><span class="lineNum">    5010 </span><span class="lineCov">        663 :                                                 break;</span></a>
<a name="5011"><span class="lineNum">    5011 </span>            :                                         }</a>
<a name="5012"><span class="lineNum">    5012 </span><span class="lineCov">        147 :                                 } else if (behavior &amp; INTERSECT_ASSOC) { /* triggered also when INTERSECT_KEY */</span></a>
<a name="5013"><span class="lineNum">    5013 </span>            :                                         /* no need of looping because indexes are unique */</a>
<a name="5014"><span class="lineNum">    5014 </span><span class="lineCov">        147 :                                         break;</span></a>
<a name="5015"><span class="lineNum">    5015 </span>            :                                 }</a>
<a name="5016"><span class="lineNum">    5016 </span>            :                         }</a>
<a name="5017"><span class="lineNum">    5017 </span>            :                 }</a>
<a name="5018"><span class="lineNum">    5018 </span>            :         }</a>
<a name="5019"><span class="lineNum">    5019 </span><span class="lineCov">         18 : out:</span></a>
<a name="5020"><span class="lineNum">    5020 </span><span class="lineCov">       4197 :         for (i = 0; i &lt; arr_argc; i++) {</span></a>
<a name="5021"><span class="lineNum">    5021 </span><span class="lineCov">       2256 :                 hash = Z_ARRVAL(args[i]);</span></a>
<a name="5022"><span class="lineNum">    5022 </span><span class="lineCov">       4512 :                 pefree(lists[i], GC_FLAGS(hash) &amp; IS_ARRAY_PERSISTENT);</span></a>
<a name="5023"><span class="lineNum">    5023 </span>            :         }</a>
<a name="5024"><span class="lineNum">    5024 </span>            : </a>
<a name="5025"><span class="lineNum">    5025 </span><span class="lineCov">       1941 :         PHP_ARRAY_CMP_FUNC_RESTORE();</span></a>
<a name="5026"><span class="lineNum">    5026 </span>            : </a>
<a name="5027"><span class="lineNum">    5027 </span><span class="lineCov">       1941 :         efree(ptrs);</span></a>
<a name="5028"><span class="lineNum">    5028 </span><span class="lineCov">       1941 :         efree(lists);</span></a>
<a name="5029"><span class="lineNum">    5029 </span>            : }</a>
<a name="5030"><span class="lineNum">    5030 </span>            : /* }}} */</a>
<a name="5031"><span class="lineNum">    5031 </span>            : </a>
<a name="5032"><span class="lineNum">    5032 </span>            : /* {{{ Returns the entries of arr1 that have keys which are present in all the other arguments. Kind of equivalent to array_diff(array_keys($arr1), array_keys($arr2)[,array_keys(...)]). Equivalent of array_intersect_assoc() but does not do compare of the data. */</a>
<a name="5033"><span class="lineNum">    5033 </span><span class="lineCov">        507 : PHP_FUNCTION(array_intersect_key)</span></a>
<a name="5034"><span class="lineNum">    5034 </span>            : {</a>
<a name="5035"><span class="lineNum">    5035 </span><span class="lineCov">        507 :         php_array_intersect_key(INTERNAL_FUNCTION_PARAM_PASSTHRU, INTERSECT_COMP_DATA_NONE);</span></a>
<a name="5036"><span class="lineNum">    5036 </span><span class="lineCov">        507 : }</span></a>
<a name="5037"><span class="lineNum">    5037 </span>            : /* }}} */</a>
<a name="5038"><span class="lineNum">    5038 </span>            : </a>
<a name="5039"><span class="lineNum">    5039 </span>            : /* {{{ Returns the entries of arr1 that have keys which are present in all the other arguments. Kind of equivalent to array_diff(array_keys($arr1), array_keys($arr2)[,array_keys(...)]). The comparison of the keys is performed by a user supplied function. Equivalent of array_intersect_uassoc() but does not do compare of the data. */</a>
<a name="5040"><span class="lineNum">    5040 </span><span class="lineCov">        435 : PHP_FUNCTION(array_intersect_ukey)</span></a>
<a name="5041"><span class="lineNum">    5041 </span>            : {</a>
<a name="5042"><span class="lineNum">    5042 </span><span class="lineCov">        435 :         php_array_intersect(INTERNAL_FUNCTION_PARAM_PASSTHRU, INTERSECT_KEY, INTERSECT_COMP_DATA_INTERNAL, INTERSECT_COMP_KEY_USER);</span></a>
<a name="5043"><span class="lineNum">    5043 </span><span class="lineCov">        435 : }</span></a>
<a name="5044"><span class="lineNum">    5044 </span>            : /* }}} */</a>
<a name="5045"><span class="lineNum">    5045 </span>            : </a>
<a name="5046"><span class="lineNum">    5046 </span>            : /* {{{ Returns the entries of arr1 that have values which are present in all the other arguments */</a>
<a name="5047"><span class="lineNum">    5047 </span><span class="lineCov">        873 : PHP_FUNCTION(array_intersect)</span></a>
<a name="5048"><span class="lineNum">    5048 </span>            : {</a>
<a name="5049"><span class="lineNum">    5049 </span><span class="lineCov">        873 :         php_array_intersect(INTERNAL_FUNCTION_PARAM_PASSTHRU, INTERSECT_NORMAL, INTERSECT_COMP_DATA_INTERNAL, INTERSECT_COMP_KEY_INTERNAL);</span></a>
<a name="5050"><span class="lineNum">    5050 </span><span class="lineCov">        873 : }</span></a>
<a name="5051"><span class="lineNum">    5051 </span>            : /* }}} */</a>
<a name="5052"><span class="lineNum">    5052 </span>            : </a>
<a name="5053"><span class="lineNum">    5053 </span>            : /* {{{ Returns the entries of arr1 that have values which are present in all the other arguments. Data is compared by using a user-supplied callback. */</a>
<a name="5054"><span class="lineNum">    5054 </span><span class="lineCov">        228 : PHP_FUNCTION(array_uintersect)</span></a>
<a name="5055"><span class="lineNum">    5055 </span>            : {</a>
<a name="5056"><span class="lineNum">    5056 </span><span class="lineCov">        228 :         php_array_intersect(INTERNAL_FUNCTION_PARAM_PASSTHRU, INTERSECT_NORMAL, INTERSECT_COMP_DATA_USER, INTERSECT_COMP_KEY_INTERNAL);</span></a>
<a name="5057"><span class="lineNum">    5057 </span><span class="lineCov">        228 : }</span></a>
<a name="5058"><span class="lineNum">    5058 </span>            : /* }}} */</a>
<a name="5059"><span class="lineNum">    5059 </span>            : </a>
<a name="5060"><span class="lineNum">    5060 </span>            : /* {{{ Returns the entries of arr1 that have values which are present in all the other arguments. Keys are used to do more restrictive check */</a>
<a name="5061"><span class="lineNum">    5061 </span><span class="lineCov">        861 : PHP_FUNCTION(array_intersect_assoc)</span></a>
<a name="5062"><span class="lineNum">    5062 </span>            : {</a>
<a name="5063"><span class="lineNum">    5063 </span><span class="lineCov">        861 :         php_array_intersect_key(INTERNAL_FUNCTION_PARAM_PASSTHRU, INTERSECT_COMP_DATA_INTERNAL);</span></a>
<a name="5064"><span class="lineNum">    5064 </span><span class="lineCov">        861 : }</span></a>
<a name="5065"><span class="lineNum">    5065 </span>            : /* }}} */</a>
<a name="5066"><span class="lineNum">    5066 </span>            : </a>
<a name="5067"><span class="lineNum">    5067 </span>            : /* {{{ Returns the entries of arr1 that have values which are present in all the other arguments. Keys are used to do more restrictive check and they are compared by using a user-supplied callback. */</a>
<a name="5068"><span class="lineNum">    5068 </span><span class="lineCov">        411 : PHP_FUNCTION(array_intersect_uassoc)</span></a>
<a name="5069"><span class="lineNum">    5069 </span>            : {</a>
<a name="5070"><span class="lineNum">    5070 </span><span class="lineCov">        411 :         php_array_intersect(INTERNAL_FUNCTION_PARAM_PASSTHRU, INTERSECT_ASSOC, INTERSECT_COMP_DATA_INTERNAL, INTERSECT_COMP_KEY_USER);</span></a>
<a name="5071"><span class="lineNum">    5071 </span><span class="lineCov">        411 : }</span></a>
<a name="5072"><span class="lineNum">    5072 </span>            : /* }}} */</a>
<a name="5073"><span class="lineNum">    5073 </span>            : </a>
<a name="5074"><span class="lineNum">    5074 </span>            : /* {{{ Returns the entries of arr1 that have values which are present in all the other arguments. Keys are used to do more restrictive check. Data is compared by using a user-supplied callback. */</a>
<a name="5075"><span class="lineNum">    5075 </span><span class="lineCov">        222 : PHP_FUNCTION(array_uintersect_assoc)</span></a>
<a name="5076"><span class="lineNum">    5076 </span>            : {</a>
<a name="5077"><span class="lineNum">    5077 </span><span class="lineCov">        222 :         php_array_intersect_key(INTERNAL_FUNCTION_PARAM_PASSTHRU, INTERSECT_COMP_DATA_USER);</span></a>
<a name="5078"><span class="lineNum">    5078 </span><span class="lineCov">        222 : }</span></a>
<a name="5079"><span class="lineNum">    5079 </span>            : /* }}} */</a>
<a name="5080"><span class="lineNum">    5080 </span>            : </a>
<a name="5081"><span class="lineNum">    5081 </span>            : /* {{{ Returns the entries of arr1 that have values which are present in all the other arguments. Keys are used to do more restrictive check. Both data and keys are compared by using user-supplied callbacks. */</a>
<a name="5082"><span class="lineNum">    5082 </span><span class="lineCov">        222 : PHP_FUNCTION(array_uintersect_uassoc)</span></a>
<a name="5083"><span class="lineNum">    5083 </span>            : {</a>
<a name="5084"><span class="lineNum">    5084 </span><span class="lineCov">        222 :         php_array_intersect(INTERNAL_FUNCTION_PARAM_PASSTHRU, INTERSECT_ASSOC, INTERSECT_COMP_DATA_USER, INTERSECT_COMP_KEY_USER);</span></a>
<a name="5085"><span class="lineNum">    5085 </span><span class="lineCov">        222 : }</span></a>
<a name="5086"><span class="lineNum">    5086 </span>            : /* }}} */</a>
<a name="5087"><span class="lineNum">    5087 </span>            : </a>
<a name="5088"><span class="lineNum">    5088 </span><span class="lineCov">       1155 : static void php_array_diff_key(INTERNAL_FUNCTION_PARAMETERS, int data_compare_type) /* {{{ */</span></a>
<a name="5089"><span class="lineNum">    5089 </span>            : {</a>
<a name="5090"><span class="lineNum">    5090 </span>            :         int argc, i;</a>
<a name="5091"><span class="lineNum">    5091 </span>            :         zval *args;</a>
<a name="5092"><span class="lineNum">    5092 </span><span class="lineCov">       1155 :         int (*diff_data_compare_func)(zval *, zval *) = NULL;</span></a>
<a name="5093"><span class="lineNum">    5093 </span>            :         bool ok;</a>
<a name="5094"><span class="lineNum">    5094 </span>            :         zval *val, *data;</a>
<a name="5095"><span class="lineNum">    5095 </span>            :         zend_string *key;</a>
<a name="5096"><span class="lineNum">    5096 </span>            :         zend_ulong h;</a>
<a name="5097"><span class="lineNum">    5097 </span>            : </a>
<a name="5098"><span class="lineNum">    5098 </span>            :         /* Get the argument count */</a>
<a name="5099"><span class="lineNum">    5099 </span><span class="lineCov">       1155 :         argc = ZEND_NUM_ARGS();</span></a>
<a name="5100"><span class="lineNum">    5100 </span><span class="lineCov">       1155 :         if (data_compare_type == DIFF_COMP_DATA_USER) {</span></a>
<a name="5101"><span class="lineNum">    5101 </span><span class="lineCov">        231 :                 if (zend_parse_parameters(ZEND_NUM_ARGS(), &quot;+f&quot;, &amp;args, &amp;argc, &amp;BG(user_compare_fci), &amp;BG(user_compare_fci_cache)) == FAILURE) {</span></a>
<a name="5102"><span class="lineNum">    5102 </span><span class="lineCov">        783 :                         RETURN_THROWS();</span></a>
<a name="5103"><span class="lineNum">    5103 </span>            :                 }</a>
<a name="5104"><span class="lineNum">    5104 </span><span class="lineCov">        177 :                 diff_data_compare_func = zval_user_compare;</span></a>
<a name="5105"><span class="lineNum">    5105 </span>            :         } else {</a>
<a name="5106"><span class="lineNum">    5106 </span><span class="lineCov">        924 :                 if (zend_parse_parameters(ZEND_NUM_ARGS(), &quot;+&quot;, &amp;args, &amp;argc) == FAILURE) {</span></a>
<a name="5107"><span class="lineNum">    5107 </span><span class="lineCov">         15 :                         RETURN_THROWS();</span></a>
<a name="5108"><span class="lineNum">    5108 </span>            :                 }</a>
<a name="5109"><span class="lineNum">    5109 </span><span class="lineCov">        909 :                 if (data_compare_type == DIFF_COMP_DATA_INTERNAL) {</span></a>
<a name="5110"><span class="lineNum">    5110 </span><span class="lineCov">        456 :                         diff_data_compare_func = zval_compare;</span></a>
<a name="5111"><span class="lineNum">    5111 </span>            :                 }</a>
<a name="5112"><span class="lineNum">    5112 </span>            :         }</a>
<a name="5113"><span class="lineNum">    5113 </span>            : </a>
<a name="5114"><span class="lineNum">    5114 </span><span class="lineCov">       2169 :         for (i = 0; i &lt; argc; i++) {</span></a>
<a name="5115"><span class="lineNum">    5115 </span><span class="lineCov">       3594 :                 if (Z_TYPE(args[i]) != IS_ARRAY) {</span></a>
<a name="5116"><span class="lineNum">    5116 </span><span class="lineCov">        714 :                         zend_argument_type_error(i + 1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;args[i]));</span></a>
<a name="5117"><span class="lineNum">    5117 </span><span class="lineCov">        714 :                         RETURN_THROWS();</span></a>
<a name="5118"><span class="lineNum">    5118 </span>            :                 }</a>
<a name="5119"><span class="lineNum">    5119 </span>            :         }</a>
<a name="5120"><span class="lineNum">    5120 </span>            : </a>
<a name="5121"><span class="lineNum">    5121 </span><span class="lineCov">        372 :         array_init(return_value);</span></a>
<a name="5122"><span class="lineNum">    5122 </span>            : </a>
<a name="5123"><span class="lineNum">    5123 </span>            :         /* Iterate over keys of the first array, to compute keys that aren't in the other arrays. */</a>
<a name="5124"><span class="lineNum">    5124 </span><span class="lineCov">       5478 :         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL(args[0]), h, key, val) {</span></a>
<a name="5125"><span class="lineNum">    5125 </span><span class="lineCov">       2742 :                 if (Z_ISREF_P(val) &amp;&amp; Z_REFCOUNT_P(val) == 1) {</span></a>
<a name="5126"><span class="lineNum">    5126 </span><span class="lineCov">        162 :                         val = Z_REFVAL_P(val);</span></a>
<a name="5127"><span class="lineNum">    5127 </span>            :                 }</a>
<a name="5128"><span class="lineNum">    5128 </span><span class="lineCov">       2547 :                 if (key == NULL) {</span></a>
<a name="5129"><span class="lineNum">    5129 </span><span class="lineCov">       2187 :                         ok = 1;</span></a>
<a name="5130"><span class="lineNum">    5130 </span><span class="lineCov">       4040 :                         for (i = 1; i &lt; argc; i++) {</span></a>
<a name="5131"><span class="lineNum">    5131 </span><span class="lineCov">       2289 :                                 if ((data = zend_hash_index_find(Z_ARRVAL(args[i]), h)) != NULL &amp;&amp;</span></a>
<a name="5132"><span class="lineNum">    5132 </span><span class="lineCov">       1800 :                                         (!diff_data_compare_func ||</span></a>
<a name="5133"><span class="lineNum">    5133 </span><span class="lineCov">       1800 :                                         diff_data_compare_func(val, data) == 0)</span></a>
<a name="5134"><span class="lineNum">    5134 </span>            :                                 ) {</a>
<a name="5135"><span class="lineNum">    5135 </span><span class="lineCov">        436 :                                         ok = 0;</span></a>
<a name="5136"><span class="lineNum">    5136 </span><span class="lineCov">        436 :                                         break;</span></a>
<a name="5137"><span class="lineNum">    5137 </span>            :                                 }</a>
<a name="5138"><span class="lineNum">    5138 </span>            :                         }</a>
<a name="5139"><span class="lineNum">    5139 </span><span class="lineCov">       2187 :                         if (ok) {</span></a>
<a name="5140"><span class="lineNum">    5140 </span><span class="lineCov">       1751 :                                 Z_TRY_ADDREF_P(val);</span></a>
<a name="5141"><span class="lineNum">    5141 </span><span class="lineCov">       1751 :                                 zend_hash_index_add_new(Z_ARRVAL_P(return_value), h, val);</span></a>
<a name="5142"><span class="lineNum">    5142 </span>            :                         }</a>
<a name="5143"><span class="lineNum">    5143 </span>            :                 } else {</a>
<a name="5144"><span class="lineNum">    5144 </span><span class="lineCov">        360 :                         ok = 1;</span></a>
<a name="5145"><span class="lineNum">    5145 </span><span class="lineCov">        633 :                         for (i = 1; i &lt; argc; i++) {</span></a>
<a name="5146"><span class="lineNum">    5146 </span><span class="lineCov">        393 :                                 if ((data = zend_hash_find_known_hash(Z_ARRVAL(args[i]), key)) != NULL &amp;&amp;</span></a>
<a name="5147"><span class="lineNum">    5147 </span><span class="lineCov">        102 :                                         (!diff_data_compare_func ||</span></a>
<a name="5148"><span class="lineNum">    5148 </span><span class="lineCov">        102 :                                         diff_data_compare_func(val, data) == 0)</span></a>
<a name="5149"><span class="lineNum">    5149 </span>            :                                 ) {</a>
<a name="5150"><span class="lineNum">    5150 </span><span class="lineCov">        120 :                                         ok = 0;</span></a>
<a name="5151"><span class="lineNum">    5151 </span><span class="lineCov">        120 :                                         break;</span></a>
<a name="5152"><span class="lineNum">    5152 </span>            :                                 }</a>
<a name="5153"><span class="lineNum">    5153 </span>            :                         }</a>
<a name="5154"><span class="lineNum">    5154 </span><span class="lineCov">        360 :                         if (ok) {</span></a>
<a name="5155"><span class="lineNum">    5155 </span><span class="lineCov">        240 :                                 Z_TRY_ADDREF_P(val);</span></a>
<a name="5156"><span class="lineNum">    5156 </span><span class="lineCov">        240 :                                 zend_hash_add_new(Z_ARRVAL_P(return_value), key, val);</span></a>
<a name="5157"><span class="lineNum">    5157 </span>            :                         }</a>
<a name="5158"><span class="lineNum">    5158 </span>            :                 }</a>
<a name="5159"><span class="lineNum">    5159 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="5160"><span class="lineNum">    5160 </span>            : }</a>
<a name="5161"><span class="lineNum">    5161 </span>            : /* }}} */</a>
<a name="5162"><span class="lineNum">    5162 </span>            : </a>
<a name="5163"><span class="lineNum">    5163 </span><span class="lineCov">       1227 : static void php_array_diff(INTERNAL_FUNCTION_PARAMETERS, int behavior, int data_compare_type, int key_compare_type) /* {{{ */</span></a>
<a name="5164"><span class="lineNum">    5164 </span>            : {</a>
<a name="5165"><span class="lineNum">    5165 </span><span class="lineCov">       1227 :         zval *args = NULL;</span></a>
<a name="5166"><span class="lineNum">    5166 </span>            :         HashTable *hash;</a>
<a name="5167"><span class="lineNum">    5167 </span>            :         int arr_argc, i, c;</a>
<a name="5168"><span class="lineNum">    5168 </span>            :         uint32_t idx;</a>
<a name="5169"><span class="lineNum">    5169 </span>            :         Bucket **lists, *list, **ptrs, *p;</a>
<a name="5170"><span class="lineNum">    5170 </span>            :         char *param_spec;</a>
<a name="5171"><span class="lineNum">    5171 </span>            :         zend_fcall_info fci1, fci2;</a>
<a name="5172"><span class="lineNum">    5172 </span><span class="lineCov">       1227 :         zend_fcall_info_cache fci1_cache = empty_fcall_info_cache, fci2_cache = empty_fcall_info_cache;</span></a>
<a name="5173"><span class="lineNum">    5173 </span><span class="lineCov">       1227 :         zend_fcall_info *fci_key = NULL, *fci_data;</span></a>
<a name="5174"><span class="lineNum">    5174 </span><span class="lineCov">       1227 :         zend_fcall_info_cache *fci_key_cache = NULL, *fci_data_cache;</span></a>
<a name="5175"><span class="lineNum">    5175 </span>            :         PHP_ARRAY_CMP_FUNC_VARS;</a>
<a name="5176"><span class="lineNum">    5176 </span>            : </a>
<a name="5177"><span class="lineNum">    5177 </span>            :         bucket_compare_func_t diff_key_compare_func;</a>
<a name="5178"><span class="lineNum">    5178 </span>            :         bucket_compare_func_t diff_data_compare_func;</a>
<a name="5179"><span class="lineNum">    5179 </span>            : </a>
<a name="5180"><span class="lineNum">    5180 </span><span class="lineCov">       1227 :         if (behavior == DIFF_NORMAL) {</span></a>
<a name="5181"><span class="lineNum">    5181 </span><span class="lineCov">        225 :                 diff_key_compare_func = php_array_key_compare_string_unstable;</span></a>
<a name="5182"><span class="lineNum">    5182 </span>            : </a>
<a name="5183"><span class="lineNum">    5183 </span><span class="lineCov">        225 :                 if (data_compare_type == DIFF_COMP_DATA_INTERNAL) {</span></a>
<a name="5184"><span class="lineNum">    5184 </span>            :                         /* array_diff */</a>
<a name="5185"><span class="lineNum">    5185 </span><span class="lineNoCov">          0 :                         param_spec = &quot;+&quot;;</span></a>
<a name="5186"><span class="lineNum">    5186 </span><span class="lineNoCov">          0 :                         diff_data_compare_func = php_array_data_compare_string_unstable;</span></a>
<a name="5187"><span class="lineNum">    5187 </span><span class="lineCov">        225 :                 } else if (data_compare_type == DIFF_COMP_DATA_USER) {</span></a>
<a name="5188"><span class="lineNum">    5188 </span>            :                         /* array_udiff */</a>
<a name="5189"><span class="lineNum">    5189 </span><span class="lineCov">        225 :                         param_spec = &quot;+f&quot;;</span></a>
<a name="5190"><span class="lineNum">    5190 </span><span class="lineCov">        225 :                         diff_data_compare_func = php_array_user_compare_unstable;</span></a>
<a name="5191"><span class="lineNum">    5191 </span>            :                 } else {</a>
<a name="5192"><span class="lineNum">    5192 </span><span class="lineNoCov">          0 :                         ZEND_ASSERT(0 &amp;&amp; &quot;Invalid data_compare_type&quot;);</span></a>
<a name="5193"><span class="lineNum">    5193 </span><span class="lineCov">        231 :                         return;</span></a>
<a name="5194"><span class="lineNum">    5194 </span>            :                 }</a>
<a name="5195"><span class="lineNum">    5195 </span>            : </a>
<a name="5196"><span class="lineNum">    5196 </span><span class="lineCov">        225 :                 if (zend_parse_parameters(ZEND_NUM_ARGS(), param_spec, &amp;args, &amp;arr_argc, &amp;fci1, &amp;fci1_cache) == FAILURE) {</span></a>
<a name="5197"><span class="lineNum">    5197 </span><span class="lineCov">         54 :                         RETURN_THROWS();</span></a>
<a name="5198"><span class="lineNum">    5198 </span>            :                 }</a>
<a name="5199"><span class="lineNum">    5199 </span><span class="lineCov">        171 :                 fci_data = &amp;fci1;</span></a>
<a name="5200"><span class="lineNum">    5200 </span><span class="lineCov">        171 :                 fci_data_cache = &amp;fci1_cache;</span></a>
<a name="5201"><span class="lineNum">    5201 </span>            : </a>
<a name="5202"><span class="lineNum">    5202 </span><span class="lineCov">       1002 :         } else if (behavior &amp; DIFF_ASSOC) { /* triggered also if DIFF_KEY */</span></a>
<a name="5203"><span class="lineNum">    5203 </span>            :                 /* DIFF_KEY is subset of DIFF_ASSOC. When having the former</a>
<a name="5204"><span class="lineNum">    5204 </span>            :                  * no comparison of the data is done (part of DIFF_ASSOC) */</a>
<a name="5205"><span class="lineNum">    5205 </span>            : </a>
<a name="5206"><span class="lineNum">    5206 </span><span class="lineCov">       1002 :                 if (data_compare_type == DIFF_COMP_DATA_INTERNAL &amp;&amp; key_compare_type == DIFF_COMP_KEY_INTERNAL) {</span></a>
<a name="5207"><span class="lineNum">    5207 </span>            :                         /* array_diff_assoc() or array_diff_key() */</a>
<a name="5208"><span class="lineNum">    5208 </span><span class="lineNoCov">          0 :                         param_spec = &quot;+&quot;;</span></a>
<a name="5209"><span class="lineNum">    5209 </span><span class="lineNoCov">          0 :                         diff_key_compare_func = php_array_key_compare_string_unstable;</span></a>
<a name="5210"><span class="lineNum">    5210 </span><span class="lineNoCov">          0 :                         diff_data_compare_func = php_array_data_compare_string_unstable;</span></a>
<a name="5211"><span class="lineNum">    5211 </span><span class="lineCov">       1002 :                 } else if (data_compare_type == DIFF_COMP_DATA_USER &amp;&amp; key_compare_type == DIFF_COMP_KEY_INTERNAL) {</span></a>
<a name="5212"><span class="lineNum">    5212 </span>            :                         /* array_udiff_assoc() */</a>
<a name="5213"><span class="lineNum">    5213 </span><span class="lineNoCov">          0 :                         param_spec = &quot;+f&quot;;</span></a>
<a name="5214"><span class="lineNum">    5214 </span><span class="lineNoCov">          0 :                         diff_key_compare_func = php_array_key_compare_string_unstable;</span></a>
<a name="5215"><span class="lineNum">    5215 </span><span class="lineNoCov">          0 :                         diff_data_compare_func = php_array_user_compare_unstable;</span></a>
<a name="5216"><span class="lineNum">    5216 </span><span class="lineNoCov">          0 :                         fci_data = &amp;fci1;</span></a>
<a name="5217"><span class="lineNum">    5217 </span><span class="lineNoCov">          0 :                         fci_data_cache = &amp;fci1_cache;</span></a>
<a name="5218"><span class="lineNum">    5218 </span><span class="lineCov">       1002 :                 } else if (data_compare_type == DIFF_COMP_DATA_INTERNAL &amp;&amp; key_compare_type == DIFF_COMP_KEY_USER) {</span></a>
<a name="5219"><span class="lineNum">    5219 </span>            :                         /* array_diff_uassoc() or array_diff_ukey() */</a>
<a name="5220"><span class="lineNum">    5220 </span><span class="lineCov">        777 :                         param_spec = &quot;+f&quot;;</span></a>
<a name="5221"><span class="lineNum">    5221 </span><span class="lineCov">        777 :                         diff_key_compare_func = php_array_user_key_compare_unstable;</span></a>
<a name="5222"><span class="lineNum">    5222 </span><span class="lineCov">        777 :                         diff_data_compare_func = php_array_data_compare_string_unstable;</span></a>
<a name="5223"><span class="lineNum">    5223 </span><span class="lineCov">        777 :                         fci_key = &amp;fci1;</span></a>
<a name="5224"><span class="lineNum">    5224 </span><span class="lineCov">        777 :                         fci_key_cache = &amp;fci1_cache;</span></a>
<a name="5225"><span class="lineNum">    5225 </span><span class="lineCov">        225 :                 } else if (data_compare_type == DIFF_COMP_DATA_USER &amp;&amp; key_compare_type == DIFF_COMP_KEY_USER) {</span></a>
<a name="5226"><span class="lineNum">    5226 </span>            :                         /* array_udiff_uassoc() */</a>
<a name="5227"><span class="lineNum">    5227 </span><span class="lineCov">        225 :                         param_spec = &quot;+ff&quot;;</span></a>
<a name="5228"><span class="lineNum">    5228 </span><span class="lineCov">        225 :                         diff_key_compare_func = php_array_user_key_compare_unstable;</span></a>
<a name="5229"><span class="lineNum">    5229 </span><span class="lineCov">        225 :                         diff_data_compare_func = php_array_user_compare_unstable;</span></a>
<a name="5230"><span class="lineNum">    5230 </span><span class="lineCov">        225 :                         fci_data = &amp;fci1;</span></a>
<a name="5231"><span class="lineNum">    5231 </span><span class="lineCov">        225 :                         fci_data_cache = &amp;fci1_cache;</span></a>
<a name="5232"><span class="lineNum">    5232 </span><span class="lineCov">        225 :                         fci_key = &amp;fci2;</span></a>
<a name="5233"><span class="lineNum">    5233 </span><span class="lineCov">        225 :                         fci_key_cache = &amp;fci2_cache;</span></a>
<a name="5234"><span class="lineNum">    5234 </span>            :                 } else {</a>
<a name="5235"><span class="lineNum">    5235 </span><span class="lineNoCov">          0 :                         ZEND_ASSERT(0 &amp;&amp; &quot;Invalid data_compare_type / key_compare_type&quot;);</span></a>
<a name="5236"><span class="lineNum">    5236 </span>            :                         return;</a>
<a name="5237"><span class="lineNum">    5237 </span>            :                 }</a>
<a name="5238"><span class="lineNum">    5238 </span>            : </a>
<a name="5239"><span class="lineNum">    5239 </span><span class="lineCov">       1002 :                 if (zend_parse_parameters(ZEND_NUM_ARGS(), param_spec, &amp;args, &amp;arr_argc, &amp;fci1, &amp;fci1_cache, &amp;fci2, &amp;fci2_cache) == FAILURE) {</span></a>
<a name="5240"><span class="lineNum">    5240 </span><span class="lineCov">        177 :                         RETURN_THROWS();</span></a>
<a name="5241"><span class="lineNum">    5241 </span>            :                 }</a>
<a name="5242"><span class="lineNum">    5242 </span>            : </a>
<a name="5243"><span class="lineNum">    5243 </span>            :         } else {</a>
<a name="5244"><span class="lineNum">    5244 </span><span class="lineNoCov">          0 :                 ZEND_ASSERT(0 &amp;&amp; &quot;Invalid behavior&quot;);</span></a>
<a name="5245"><span class="lineNum">    5245 </span>            :                 return;</a>
<a name="5246"><span class="lineNum">    5246 </span>            :         }</a>
<a name="5247"><span class="lineNum">    5247 </span>            : </a>
<a name="5248"><span class="lineNum">    5248 </span><span class="lineCov">        996 :         PHP_ARRAY_CMP_FUNC_BACKUP();</span></a>
<a name="5249"><span class="lineNum">    5249 </span>            : </a>
<a name="5250"><span class="lineNum">    5250 </span>            :         /* for each argument, create and sort list with pointers to the hash buckets */</a>
<a name="5251"><span class="lineNum">    5251 </span><span class="lineCov">        996 :         lists = (Bucket **)safe_emalloc(arr_argc, sizeof(Bucket *), 0);</span></a>
<a name="5252"><span class="lineNum">    5252 </span><span class="lineCov">        996 :         ptrs = (Bucket **)safe_emalloc(arr_argc, sizeof(Bucket *), 0);</span></a>
<a name="5253"><span class="lineNum">    5253 </span>            : </a>
<a name="5254"><span class="lineNum">    5254 </span><span class="lineCov">        996 :         if (behavior == DIFF_NORMAL &amp;&amp; data_compare_type == DIFF_COMP_DATA_USER) {</span></a>
<a name="5255"><span class="lineNum">    5255 </span><span class="lineCov">        171 :                 BG(user_compare_fci) = *fci_data;</span></a>
<a name="5256"><span class="lineNum">    5256 </span><span class="lineCov">        171 :                 BG(user_compare_fci_cache) = *fci_data_cache;</span></a>
<a name="5257"><span class="lineNum">    5257 </span><span class="lineCov">        825 :         } else if ((behavior &amp; DIFF_ASSOC) &amp;&amp; key_compare_type == DIFF_COMP_KEY_USER) {</span></a>
<a name="5258"><span class="lineNum">    5258 </span><span class="lineCov">        825 :                 BG(user_compare_fci) = *fci_key;</span></a>
<a name="5259"><span class="lineNum">    5259 </span><span class="lineCov">        825 :                 BG(user_compare_fci_cache) = *fci_key_cache;</span></a>
<a name="5260"><span class="lineNum">    5260 </span>            :         }</a>
<a name="5261"><span class="lineNum">    5261 </span>            : </a>
<a name="5262"><span class="lineNum">    5262 </span><span class="lineCov">       1839 :         for (i = 0; i &lt; arr_argc; i++) {</span></a>
<a name="5263"><span class="lineNum">    5263 </span><span class="lineCov">       3222 :                 if (Z_TYPE(args[i]) != IS_ARRAY) {</span></a>
<a name="5264"><span class="lineNum">    5264 </span><span class="lineCov">        768 :                         zend_argument_type_error(i + 1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;args[i]));</span></a>
<a name="5265"><span class="lineNum">    5265 </span><span class="lineCov">        768 :                         arr_argc = i; /* only free up to i - 1 */</span></a>
<a name="5266"><span class="lineNum">    5266 </span><span class="lineCov">        768 :                         goto out;</span></a>
<a name="5267"><span class="lineNum">    5267 </span>            :                 }</a>
<a name="5268"><span class="lineNum">    5268 </span><span class="lineCov">        843 :                 hash = Z_ARRVAL(args[i]);</span></a>
<a name="5269"><span class="lineNum">    5269 </span><span class="lineCov">       1686 :                 list = (Bucket *) pemalloc((hash-&gt;nNumOfElements + 1) * sizeof(Bucket), GC_FLAGS(hash) &amp; IS_ARRAY_PERSISTENT);</span></a>
<a name="5270"><span class="lineNum">    5270 </span><span class="lineCov">        843 :                 lists[i] = list;</span></a>
<a name="5271"><span class="lineNum">    5271 </span><span class="lineCov">        843 :                 ptrs[i] = list;</span></a>
<a name="5272"><span class="lineNum">    5272 </span><span class="lineCov">        843 :                 if (HT_IS_PACKED(hash)) {</span></a>
<a name="5273"><span class="lineNum">    5273 </span><span class="lineCov">        267 :                         zval *zv = hash-&gt;arPacked;</span></a>
<a name="5274"><span class="lineNum">    5274 </span><span class="lineCov">        804 :                         for (idx = 0; idx &lt; hash-&gt;nNumUsed; idx++, zv++) {</span></a>
<a name="5275"><span class="lineNum">    5275 </span><span class="lineCov">        537 :                                 if (Z_TYPE_P(zv) == IS_UNDEF) continue;</span></a>
<a name="5276"><span class="lineNum">    5276 </span><span class="lineCov">        537 :                                 ZVAL_COPY_VALUE(&amp;list-&gt;val, zv);</span></a>
<a name="5277"><span class="lineNum">    5277 </span><span class="lineCov">        537 :                                 list-&gt;h = idx;</span></a>
<a name="5278"><span class="lineNum">    5278 </span><span class="lineCov">        537 :                                 list-&gt;key = NULL;</span></a>
<a name="5279"><span class="lineNum">    5279 </span><span class="lineCov">        537 :                                 list++;</span></a>
<a name="5280"><span class="lineNum">    5280 </span>            :                         }</a>
<a name="5281"><span class="lineNum">    5281 </span>            :                 } else {</a>
<a name="5282"><span class="lineNum">    5282 </span><span class="lineCov">        576 :                         p = hash-&gt;arData;</span></a>
<a name="5283"><span class="lineNum">    5283 </span><span class="lineCov">       2667 :                         for (idx = 0; idx &lt; hash-&gt;nNumUsed; idx++, p++) {</span></a>
<a name="5284"><span class="lineNum">    5284 </span><span class="lineCov">       4182 :                                 if (Z_TYPE(p-&gt;val) == IS_UNDEF) continue;</span></a>
<a name="5285"><span class="lineNum">    5285 </span><span class="lineCov">       2091 :                                 *list++ = *p;</span></a>
<a name="5286"><span class="lineNum">    5286 </span>            :                         }</a>
<a name="5287"><span class="lineNum">    5287 </span>            :                 }</a>
<a name="5288"><span class="lineNum">    5288 </span><span class="lineCov">        843 :                 ZVAL_UNDEF(&amp;list-&gt;val);</span></a>
<a name="5289"><span class="lineNum">    5289 </span><span class="lineCov">        843 :                 if (hash-&gt;nNumOfElements &gt; 1) {</span></a>
<a name="5290"><span class="lineNum">    5290 </span><span class="lineCov">        759 :                         if (behavior == DIFF_NORMAL) {</span></a>
<a name="5291"><span class="lineNum">    5291 </span><span class="lineCov">         93 :                                 zend_sort((void *) lists[i], hash-&gt;nNumOfElements,</span></a>
<a name="5292"><span class="lineNum">    5292 </span>            :                                                 sizeof(Bucket), (compare_func_t) diff_data_compare_func,</a>
<a name="5293"><span class="lineNum">    5293 </span>            :                                                 (swap_func_t)zend_hash_bucket_swap);</a>
<a name="5294"><span class="lineNum">    5294 </span><span class="lineCov">        666 :                         } else if (behavior &amp; DIFF_ASSOC) { /* triggered also when DIFF_KEY */</span></a>
<a name="5295"><span class="lineNum">    5295 </span><span class="lineCov">        666 :                                 zend_sort((void *) lists[i], hash-&gt;nNumOfElements,</span></a>
<a name="5296"><span class="lineNum">    5296 </span>            :                                                 sizeof(Bucket), (compare_func_t) diff_key_compare_func,</a>
<a name="5297"><span class="lineNum">    5297 </span>            :                                                 (swap_func_t)zend_hash_bucket_swap);</a>
<a name="5298"><span class="lineNum">    5298 </span>            :                         }</a>
<a name="5299"><span class="lineNum">    5299 </span>            :                 }</a>
<a name="5300"><span class="lineNum">    5300 </span>            :         }</a>
<a name="5301"><span class="lineNum">    5301 </span>            : </a>
<a name="5302"><span class="lineNum">    5302 </span>            :         /* copy the argument array */</a>
<a name="5303"><span class="lineNum">    5303 </span><span class="lineCov">        228 :         RETVAL_ARR(zend_array_dup(Z_ARRVAL(args[0])));</span></a>
<a name="5304"><span class="lineNum">    5304 </span>            : </a>
<a name="5305"><span class="lineNum">    5305 </span>            :         /* go through the lists and look for values of ptr[0] that are not in the others */</a>
<a name="5306"><span class="lineNum">    5306 </span><span class="lineCov">       1302 :         while (Z_TYPE(ptrs[0]-&gt;val) != IS_UNDEF) {</span></a>
<a name="5307"><span class="lineNum">    5307 </span><span class="lineCov">        651 :                 if ((behavior &amp; DIFF_ASSOC) /* triggered also when DIFF_KEY */</span></a>
<a name="5308"><span class="lineNum">    5308 </span><span class="lineCov">        600 :                         &amp;&amp;</span></a>
<a name="5309"><span class="lineNum">    5309 </span>            :                         key_compare_type == DIFF_COMP_KEY_USER</a>
<a name="5310"><span class="lineNum">    5310 </span>            :                 ) {</a>
<a name="5311"><span class="lineNum">    5311 </span><span class="lineCov">        600 :                         BG(user_compare_fci) = *fci_key;</span></a>
<a name="5312"><span class="lineNum">    5312 </span><span class="lineCov">        600 :                         BG(user_compare_fci_cache) = *fci_key_cache;</span></a>
<a name="5313"><span class="lineNum">    5313 </span>            :                 }</a>
<a name="5314"><span class="lineNum">    5314 </span><span class="lineCov">        651 :                 c = 1;</span></a>
<a name="5315"><span class="lineNum">    5315 </span><span class="lineCov">       1026 :                 for (i = 1; i &lt; arr_argc; i++) {</span></a>
<a name="5316"><span class="lineNum">    5316 </span><span class="lineCov">        693 :                         Bucket *ptr = ptrs[i];</span></a>
<a name="5317"><span class="lineNum">    5317 </span><span class="lineCov">        693 :                         if (behavior == DIFF_NORMAL) {</span></a>
<a name="5318"><span class="lineNum">    5318 </span><span class="lineCov">        126 :                                 while (Z_TYPE(ptrs[i]-&gt;val) != IS_UNDEF &amp;&amp; (0 &lt; (c = diff_data_compare_func(ptrs[0], ptrs[i])))) {</span></a>
<a name="5319"><span class="lineNum">    5319 </span><span class="lineCov">         15 :                                         ptrs[i]++;</span></a>
<a name="5320"><span class="lineNum">    5320 </span>            :                                 }</a>
<a name="5321"><span class="lineNum">    5321 </span><span class="lineCov">        645 :                         } else if (behavior &amp; DIFF_ASSOC) { /* triggered also when DIFF_KEY */</span></a>
<a name="5322"><span class="lineNum">    5322 </span><span class="lineCov">       4854 :                                 while (Z_TYPE(ptr-&gt;val) != IS_UNDEF &amp;&amp; (0 != (c = diff_key_compare_func(ptrs[0], ptr)))) {</span></a>
<a name="5323"><span class="lineNum">    5323 </span><span class="lineCov">       1782 :                                         ptr++;</span></a>
<a name="5324"><span class="lineNum">    5324 </span>            :                                 }</a>
<a name="5325"><span class="lineNum">    5325 </span>            :                         }</a>
<a name="5326"><span class="lineNum">    5326 </span><span class="lineCov">        693 :                         if (!c) {</span></a>
<a name="5327"><span class="lineNum">    5327 </span><span class="lineCov">        375 :                                 if (behavior == DIFF_NORMAL) {</span></a>
<a name="5328"><span class="lineNum">    5328 </span><span class="lineCov">         60 :                                         if (Z_TYPE(ptrs[i]-&gt;val) != IS_UNDEF) {</span></a>
<a name="5329"><span class="lineNum">    5329 </span><span class="lineCov">         30 :                                                 ptrs[i]++;</span></a>
<a name="5330"><span class="lineNum">    5330 </span>            :                                         }</a>
<a name="5331"><span class="lineNum">    5331 </span><span class="lineCov">         30 :                                         break;</span></a>
<a name="5332"><span class="lineNum">    5332 </span><span class="lineCov">        345 :                                 } else if (behavior == DIFF_ASSOC) {  /* only when DIFF_ASSOC */</span></a>
<a name="5333"><span class="lineNum">    5333 </span>            :                                         /* In this branch is execute only when DIFF_ASSOC. If behavior == DIFF_KEY</a>
<a name="5334"><span class="lineNum">    5334 </span>            :                                          * data comparison is not needed - skipped. */</a>
<a name="5335"><span class="lineNum">    5335 </span><span class="lineCov">        390 :                                         if (Z_TYPE(ptr-&gt;val) != IS_UNDEF) {</span></a>
<a name="5336"><span class="lineNum">    5336 </span><span class="lineCov">        195 :                                                 if (data_compare_type == DIFF_COMP_DATA_USER) {</span></a>
<a name="5337"><span class="lineNum">    5337 </span><span class="lineCov">         39 :                                                         BG(user_compare_fci) = *fci_data;</span></a>
<a name="5338"><span class="lineNum">    5338 </span><span class="lineCov">         39 :                                                         BG(user_compare_fci_cache) = *fci_data_cache;</span></a>
<a name="5339"><span class="lineNum">    5339 </span>            :                                                 }</a>
<a name="5340"><span class="lineNum">    5340 </span><span class="lineCov">        195 :                                                 if (diff_data_compare_func(ptrs[0], ptr) != 0) {</span></a>
<a name="5341"><span class="lineNum">    5341 </span>            :                                                         /* the data is not the same */</a>
<a name="5342"><span class="lineNum">    5342 </span><span class="lineCov">         57 :                                                         c = -1;</span></a>
<a name="5343"><span class="lineNum">    5343 </span><span class="lineCov">         57 :                                                         if (key_compare_type == DIFF_COMP_KEY_USER) {</span></a>
<a name="5344"><span class="lineNum">    5344 </span><span class="lineCov">         57 :                                                                 BG(user_compare_fci) = *fci_key;</span></a>
<a name="5345"><span class="lineNum">    5345 </span><span class="lineCov">         57 :                                                                 BG(user_compare_fci_cache) = *fci_key_cache;</span></a>
<a name="5346"><span class="lineNum">    5346 </span>            :                                                         }</a>
<a name="5347"><span class="lineNum">    5347 </span>            :                                                 } else {</a>
<a name="5348"><span class="lineNum">    5348 </span><span class="lineCov">        138 :                                                         break;</span></a>
<a name="5349"><span class="lineNum">    5349 </span>            :                                                         /* we have found the element in other arrays thus we don't want it</a>
<a name="5350"><span class="lineNum">    5350 </span>            :                                                          * in the return_value -&gt; delete from there */</a>
<a name="5351"><span class="lineNum">    5351 </span>            :                                                 }</a>
<a name="5352"><span class="lineNum">    5352 </span>            :                                         }</a>
<a name="5353"><span class="lineNum">    5353 </span><span class="lineCov">        150 :                                 } else if (behavior == DIFF_KEY) { /* only when DIFF_KEY */</span></a>
<a name="5354"><span class="lineNum">    5354 </span>            :                                         /* the behavior here differs from INTERSECT_KEY in php_intersect</a>
<a name="5355"><span class="lineNum">    5355 </span>            :                                          * since in the &quot;diff&quot; case we have to remove the entry from</a>
<a name="5356"><span class="lineNum">    5356 </span>            :                                          * return_value while when doing intersection the entry must not</a>
<a name="5357"><span class="lineNum">    5357 </span>            :                                          * be deleted. */</a>
<a name="5358"><span class="lineNum">    5358 </span><span class="lineCov">        150 :                                         break; /* remove the key */</span></a>
<a name="5359"><span class="lineNum">    5359 </span>            :                                 }</a>
<a name="5360"><span class="lineNum">    5360 </span>            :                         }</a>
<a name="5361"><span class="lineNum">    5361 </span>            :                 }</a>
<a name="5362"><span class="lineNum">    5362 </span><span class="lineCov">        651 :                 if (!c) {</span></a>
<a name="5363"><span class="lineNum">    5363 </span>            :                         /* ptrs[0] in one of the other arguments */</a>
<a name="5364"><span class="lineNum">    5364 </span>            :                         /* delete all entries with value as ptrs[0] */</a>
<a name="5365"><span class="lineNum">    5365 </span>            :                         for (;;) {</a>
<a name="5366"><span class="lineNum">    5366 </span><span class="lineCov">        318 :                                 p = ptrs[0];</span></a>
<a name="5367"><span class="lineNum">    5367 </span><span class="lineCov">        318 :                                 if (p-&gt;key == NULL) {</span></a>
<a name="5368"><span class="lineNum">    5368 </span><span class="lineCov">        246 :                                         zend_hash_index_del(Z_ARRVAL_P(return_value), p-&gt;h);</span></a>
<a name="5369"><span class="lineNum">    5369 </span>            :                                 } else {</a>
<a name="5370"><span class="lineNum">    5370 </span><span class="lineCov">         72 :                                         zend_hash_del(Z_ARRVAL_P(return_value), p-&gt;key);</span></a>
<a name="5371"><span class="lineNum">    5371 </span>            :                                 }</a>
<a name="5372"><span class="lineNum">    5372 </span><span class="lineCov">        636 :                                 if (Z_TYPE((++ptrs[0])-&gt;val) == IS_UNDEF) {</span></a>
<a name="5373"><span class="lineNum">    5373 </span><span class="lineCov">         90 :                                         goto out;</span></a>
<a name="5374"><span class="lineNum">    5374 </span>            :                                 }</a>
<a name="5375"><span class="lineNum">    5375 </span><span class="lineCov">        228 :                                 if (behavior == DIFF_NORMAL) {</span></a>
<a name="5376"><span class="lineNum">    5376 </span><span class="lineCov">         21 :                                         if (diff_data_compare_func(ptrs[0] - 1, ptrs[0])) {</span></a>
<a name="5377"><span class="lineNum">    5377 </span><span class="lineCov">         21 :                                                 break;</span></a>
<a name="5378"><span class="lineNum">    5378 </span>            :                                         }</a>
<a name="5379"><span class="lineNum">    5379 </span><span class="lineCov">        207 :                                 } else if (behavior &amp; DIFF_ASSOC) { /* triggered also when DIFF_KEY */</span></a>
<a name="5380"><span class="lineNum">    5380 </span>            :                                         /* in this case no array_key_compare is needed */</a>
<a name="5381"><span class="lineNum">    5381 </span><span class="lineCov">        207 :                                         break;</span></a>
<a name="5382"><span class="lineNum">    5382 </span>            :                                 }</a>
<a name="5383"><span class="lineNum">    5383 </span>            :                         }</a>
<a name="5384"><span class="lineNum">    5384 </span>            :                 } else {</a>
<a name="5385"><span class="lineNum">    5385 </span>            :                         /* ptrs[0] in none of the other arguments */</a>
<a name="5386"><span class="lineNum">    5386 </span>            :                         /* skip all entries with value as ptrs[0] */</a>
<a name="5387"><span class="lineNum">    5387 </span>            :                         for (;;) {</a>
<a name="5388"><span class="lineNum">    5388 </span><span class="lineCov">        666 :                                 if (Z_TYPE((++ptrs[0])-&gt;val) == IS_UNDEF) {</span></a>
<a name="5389"><span class="lineNum">    5389 </span><span class="lineCov">        138 :                                         goto out;</span></a>
<a name="5390"><span class="lineNum">    5390 </span>            :                                 }</a>
<a name="5391"><span class="lineNum">    5391 </span><span class="lineCov">        195 :                                 if (behavior == DIFF_NORMAL) {</span></a>
<a name="5392"><span class="lineNum">    5392 </span><span class="lineCov">          9 :                                         if (diff_data_compare_func(ptrs[0] - 1, ptrs[0])) {</span></a>
<a name="5393"><span class="lineNum">    5393 </span><span class="lineCov">          9 :                                                 break;</span></a>
<a name="5394"><span class="lineNum">    5394 </span>            :                                         }</a>
<a name="5395"><span class="lineNum">    5395 </span><span class="lineCov">        186 :                                 } else if (behavior &amp; DIFF_ASSOC) { /* triggered also when DIFF_KEY */</span></a>
<a name="5396"><span class="lineNum">    5396 </span>            :                                         /* in this case no array_key_compare is needed */</a>
<a name="5397"><span class="lineNum">    5397 </span><span class="lineCov">        186 :                                         break;</span></a>
<a name="5398"><span class="lineNum">    5398 </span>            :                                 }</a>
<a name="5399"><span class="lineNum">    5399 </span>            :                         }</a>
<a name="5400"><span class="lineNum">    5400 </span>            :                 }</a>
<a name="5401"><span class="lineNum">    5401 </span>            :         }</a>
<a name="5402"><span class="lineNum">    5402 </span><span class="lineNoCov">          0 : out:</span></a>
<a name="5403"><span class="lineNum">    5403 </span><span class="lineCov">       1839 :         for (i = 0; i &lt; arr_argc; i++) {</span></a>
<a name="5404"><span class="lineNum">    5404 </span><span class="lineCov">        843 :                 hash = Z_ARRVAL(args[i]);</span></a>
<a name="5405"><span class="lineNum">    5405 </span><span class="lineCov">       1686 :                 pefree(lists[i], GC_FLAGS(hash) &amp; IS_ARRAY_PERSISTENT);</span></a>
<a name="5406"><span class="lineNum">    5406 </span>            :         }</a>
<a name="5407"><span class="lineNum">    5407 </span>            : </a>
<a name="5408"><span class="lineNum">    5408 </span><span class="lineCov">        996 :         PHP_ARRAY_CMP_FUNC_RESTORE();</span></a>
<a name="5409"><span class="lineNum">    5409 </span>            : </a>
<a name="5410"><span class="lineNum">    5410 </span><span class="lineCov">        996 :         efree(ptrs);</span></a>
<a name="5411"><span class="lineNum">    5411 </span><span class="lineCov">        996 :         efree(lists);</span></a>
<a name="5412"><span class="lineNum">    5412 </span>            : }</a>
<a name="5413"><span class="lineNum">    5413 </span>            : /* }}} */</a>
<a name="5414"><span class="lineNum">    5414 </span>            : </a>
<a name="5415"><span class="lineNum">    5415 </span>            : /* {{{ Returns the entries of arr1 that have keys which are not present in any of the others arguments. This function is like array_diff() but works on the keys instead of the values. The associativity is preserved. */</a>
<a name="5416"><span class="lineNum">    5416 </span><span class="lineCov">        462 : PHP_FUNCTION(array_diff_key)</span></a>
<a name="5417"><span class="lineNum">    5417 </span>            : {</a>
<a name="5418"><span class="lineNum">    5418 </span><span class="lineCov">        462 :         php_array_diff_key(INTERNAL_FUNCTION_PARAM_PASSTHRU, DIFF_COMP_DATA_NONE);</span></a>
<a name="5419"><span class="lineNum">    5419 </span><span class="lineCov">        462 : }</span></a>
<a name="5420"><span class="lineNum">    5420 </span>            : /* }}} */</a>
<a name="5421"><span class="lineNum">    5421 </span>            : </a>
<a name="5422"><span class="lineNum">    5422 </span>            : /* {{{ Returns the entries of arr1 that have keys which are not present in any of the others arguments. User supplied function is used for comparing the keys. This function is like array_udiff() but works on the keys instead of the values. The associativity is preserved. */</a>
<a name="5423"><span class="lineNum">    5423 </span><span class="lineCov">        453 : PHP_FUNCTION(array_diff_ukey)</span></a>
<a name="5424"><span class="lineNum">    5424 </span>            : {</a>
<a name="5425"><span class="lineNum">    5425 </span><span class="lineCov">        453 :         php_array_diff(INTERNAL_FUNCTION_PARAM_PASSTHRU, DIFF_KEY, DIFF_COMP_DATA_INTERNAL, DIFF_COMP_KEY_USER);</span></a>
<a name="5426"><span class="lineNum">    5426 </span><span class="lineCov">        453 : }</span></a>
<a name="5427"><span class="lineNum">    5427 </span>            : /* }}} */</a>
<a name="5428"><span class="lineNum">    5428 </span>            : </a>
<a name="5429"><span class="lineNum">    5429 </span>            : /* {{{ Returns the entries of arr1 that have values which are not present in any of the others arguments. */</a>
<a name="5430"><span class="lineNum">    5430 </span><span class="lineCov">        468 : PHP_FUNCTION(array_diff)</span></a>
<a name="5431"><span class="lineNum">    5431 </span>            : {</a>
<a name="5432"><span class="lineNum">    5432 </span>            :         zval *args;</a>
<a name="5433"><span class="lineNum">    5433 </span>            :         int argc, i;</a>
<a name="5434"><span class="lineNum">    5434 </span>            :         uint32_t num;</a>
<a name="5435"><span class="lineNum">    5435 </span>            :         HashTable exclude;</a>
<a name="5436"><span class="lineNum">    5436 </span>            :         zval *value;</a>
<a name="5437"><span class="lineNum">    5437 </span>            :         zend_string *str, *tmp_str, *key;</a>
<a name="5438"><span class="lineNum">    5438 </span>            :         zend_long idx;</a>
<a name="5439"><span class="lineNum">    5439 </span>            :         zval dummy;</a>
<a name="5440"><span class="lineNum">    5440 </span>            : </a>
<a name="5441"><span class="lineNum">    5441 </span><span class="lineCov">        468 :         ZEND_PARSE_PARAMETERS_START(1, -1)</span></a>
<a name="5442"><span class="lineNum">    5442 </span><span class="lineCov">        459 :                 Z_PARAM_VARIADIC('+', args, argc)</span></a>
<a name="5443"><span class="lineNum">    5443 </span><span class="lineCov">        690 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="5444"><span class="lineNum">    5444 </span>            : </a>
<a name="5445"><span class="lineNum">    5445 </span><span class="lineCov">        459 :         if (Z_TYPE(args[0]) != IS_ARRAY) {</span></a>
<a name="5446"><span class="lineNum">    5446 </span><span class="lineCov">        126 :                 zend_argument_type_error(1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;args[0]));</span></a>
<a name="5447"><span class="lineNum">    5447 </span><span class="lineCov">        126 :                 RETURN_THROWS();</span></a>
<a name="5448"><span class="lineNum">    5448 </span>            :         }</a>
<a name="5449"><span class="lineNum">    5449 </span>            : </a>
<a name="5450"><span class="lineNum">    5450 </span><span class="lineCov">        333 :         num = zend_hash_num_elements(Z_ARRVAL(args[0]));</span></a>
<a name="5451"><span class="lineNum">    5451 </span><span class="lineCov">        333 :         if (num == 0) {</span></a>
<a name="5452"><span class="lineNum">    5452 </span><span class="lineCov">          9 :                 for (i = 1; i &lt; argc; i++) {</span></a>
<a name="5453"><span class="lineNum">    5453 </span><span class="lineCov">         12 :                         if (Z_TYPE(args[i]) != IS_ARRAY) {</span></a>
<a name="5454"><span class="lineNum">    5454 </span><span class="lineCov">          3 :                                 zend_argument_type_error(i + 1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;args[i]));</span></a>
<a name="5455"><span class="lineNum">    5455 </span><span class="lineCov">          3 :                                 RETURN_THROWS();</span></a>
<a name="5456"><span class="lineNum">    5456 </span>            :                         }</a>
<a name="5457"><span class="lineNum">    5457 </span>            :                 }</a>
<a name="5458"><span class="lineNum">    5458 </span><span class="lineCov">          3 :                 RETURN_EMPTY_ARRAY();</span></a>
<a name="5459"><span class="lineNum">    5459 </span><span class="lineCov">        327 :         } else if (num == 1) {</span></a>
<a name="5460"><span class="lineNum">    5460 </span><span class="lineCov">          9 :                 int found = 0;</span></a>
<a name="5461"><span class="lineNum">    5461 </span>            :                 zend_string *search_str, *tmp_search_str;</a>
<a name="5462"><span class="lineNum">    5462 </span>            : </a>
<a name="5463"><span class="lineNum">    5463 </span><span class="lineCov">          9 :                 value = NULL;</span></a>
<a name="5464"><span class="lineNum">    5464 </span><span class="lineCov">         18 :                 ZEND_HASH_FOREACH_VAL(Z_ARRVAL(args[0]), value) {</span></a>
<a name="5465"><span class="lineNum">    5465 </span><span class="lineCov">          9 :                         break;</span></a>
<a name="5466"><span class="lineNum">    5466 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="5467"><span class="lineNum">    5467 </span>            : </a>
<a name="5468"><span class="lineNum">    5468 </span><span class="lineCov">          9 :                 if (!value) {</span></a>
<a name="5469"><span class="lineNum">    5469 </span><span class="lineNoCov">          0 :                         for (i = 1; i &lt; argc; i++) {</span></a>
<a name="5470"><span class="lineNum">    5470 </span><span class="lineNoCov">          0 :                                 if (Z_TYPE(args[i]) != IS_ARRAY) {</span></a>
<a name="5471"><span class="lineNum">    5471 </span><span class="lineNoCov">          0 :                                         zend_argument_type_error(i + 1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;args[i]));</span></a>
<a name="5472"><span class="lineNum">    5472 </span><span class="lineNoCov">          0 :                                         RETURN_THROWS();</span></a>
<a name="5473"><span class="lineNum">    5473 </span>            :                                 }</a>
<a name="5474"><span class="lineNum">    5474 </span>            :                         }</a>
<a name="5475"><span class="lineNum">    5475 </span><span class="lineNoCov">          0 :                         RETURN_EMPTY_ARRAY();</span></a>
<a name="5476"><span class="lineNum">    5476 </span>            :                 }</a>
<a name="5477"><span class="lineNum">    5477 </span>            : </a>
<a name="5478"><span class="lineNum">    5478 </span><span class="lineCov">          9 :                 search_str = zval_get_tmp_string(value, &amp;tmp_search_str);</span></a>
<a name="5479"><span class="lineNum">    5479 </span>            : </a>
<a name="5480"><span class="lineNum">    5480 </span><span class="lineCov">         15 :                 for (i = 1; i &lt; argc; i++) {</span></a>
<a name="5481"><span class="lineNum">    5481 </span><span class="lineCov">         12 :                         if (Z_TYPE(args[i]) != IS_ARRAY) {</span></a>
<a name="5482"><span class="lineNum">    5482 </span><span class="lineNoCov">          0 :                                 zend_argument_type_error(i + 1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;args[i]));</span></a>
<a name="5483"><span class="lineNum">    5483 </span><span class="lineNoCov">          0 :                                 RETURN_THROWS();</span></a>
<a name="5484"><span class="lineNum">    5484 </span>            :                         }</a>
<a name="5485"><span class="lineNum">    5485 </span><span class="lineCov">          6 :                         if (!found) {</span></a>
<a name="5486"><span class="lineNum">    5486 </span><span class="lineCov">         30 :                                 ZEND_HASH_FOREACH_VAL(Z_ARRVAL(args[i]), value) {</span></a>
<a name="5487"><span class="lineNum">    5487 </span><span class="lineCov">         12 :                                         str = zval_get_tmp_string(value, &amp;tmp_str);</span></a>
<a name="5488"><span class="lineNum">    5488 </span><span class="lineCov">         12 :                                         if (zend_string_equals(search_str, str)) {</span></a>
<a name="5489"><span class="lineNum">    5489 </span><span class="lineNoCov">          0 :                                                 zend_tmp_string_release(tmp_str);</span></a>
<a name="5490"><span class="lineNum">    5490 </span><span class="lineNoCov">          0 :                                                 found = 1;</span></a>
<a name="5491"><span class="lineNum">    5491 </span><span class="lineNoCov">          0 :                                                 break;</span></a>
<a name="5492"><span class="lineNum">    5492 </span>            :                                         }</a>
<a name="5493"><span class="lineNum">    5493 </span><span class="lineCov">         12 :                                         zend_tmp_string_release(tmp_str);</span></a>
<a name="5494"><span class="lineNum">    5494 </span>            :                                 } ZEND_HASH_FOREACH_END();</a>
<a name="5495"><span class="lineNum">    5495 </span>            :                         }</a>
<a name="5496"><span class="lineNum">    5496 </span>            :                 }</a>
<a name="5497"><span class="lineNum">    5497 </span>            : </a>
<a name="5498"><span class="lineNum">    5498 </span><span class="lineCov">          9 :                 zend_tmp_string_release(tmp_search_str);</span></a>
<a name="5499"><span class="lineNum">    5499 </span>            : </a>
<a name="5500"><span class="lineNum">    5500 </span><span class="lineCov">          9 :                 if (found) {</span></a>
<a name="5501"><span class="lineNum">    5501 </span><span class="lineNoCov">          0 :                         RETVAL_EMPTY_ARRAY();</span></a>
<a name="5502"><span class="lineNum">    5502 </span>            :                 } else {</a>
<a name="5503"><span class="lineNum">    5503 </span><span class="lineCov">          9 :                         ZVAL_COPY(return_value, &amp;args[0]);</span></a>
<a name="5504"><span class="lineNum">    5504 </span>            :                 }</a>
<a name="5505"><span class="lineNum">    5505 </span><span class="lineCov">          9 :                 return;</span></a>
<a name="5506"><span class="lineNum">    5506 </span>            :         }</a>
<a name="5507"><span class="lineNum">    5507 </span>            : </a>
<a name="5508"><span class="lineNum">    5508 </span>            :         /* count number of elements */</a>
<a name="5509"><span class="lineNum">    5509 </span><span class="lineCov">        318 :         num = 0;</span></a>
<a name="5510"><span class="lineNum">    5510 </span><span class="lineCov">        570 :         for (i = 1; i &lt; argc; i++) {</span></a>
<a name="5511"><span class="lineNum">    5511 </span><span class="lineCov">        660 :                 if (Z_TYPE(args[i]) != IS_ARRAY) {</span></a>
<a name="5512"><span class="lineNum">    5512 </span><span class="lineCov">         78 :                         zend_argument_type_error(i + 1, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;args[i]));</span></a>
<a name="5513"><span class="lineNum">    5513 </span><span class="lineCov">         78 :                         RETURN_THROWS();</span></a>
<a name="5514"><span class="lineNum">    5514 </span>            :                 }</a>
<a name="5515"><span class="lineNum">    5515 </span><span class="lineCov">        252 :                 num += zend_hash_num_elements(Z_ARRVAL(args[i]));</span></a>
<a name="5516"><span class="lineNum">    5516 </span>            :         }</a>
<a name="5517"><span class="lineNum">    5517 </span>            : </a>
<a name="5518"><span class="lineNum">    5518 </span><span class="lineCov">        240 :         if (num == 0) {</span></a>
<a name="5519"><span class="lineNum">    5519 </span><span class="lineCov">          3 :                 ZVAL_COPY(return_value, &amp;args[0]);</span></a>
<a name="5520"><span class="lineNum">    5520 </span><span class="lineCov">          3 :                 return;</span></a>
<a name="5521"><span class="lineNum">    5521 </span>            :         }</a>
<a name="5522"><span class="lineNum">    5522 </span>            : </a>
<a name="5523"><span class="lineNum">    5523 </span><span class="lineCov">        237 :         ZVAL_NULL(&amp;dummy);</span></a>
<a name="5524"><span class="lineNum">    5524 </span>            :         /* create exclude map */</a>
<a name="5525"><span class="lineNum">    5525 </span><span class="lineCov">        237 :         zend_hash_init(&amp;exclude, num, NULL, NULL, 0);</span></a>
<a name="5526"><span class="lineNum">    5526 </span><span class="lineCov">        486 :         for (i = 1; i &lt; argc; i++) {</span></a>
<a name="5527"><span class="lineNum">    5527 </span><span class="lineCov">       7626 :                 ZEND_HASH_FOREACH_VAL(Z_ARRVAL(args[i]), value) {</span></a>
<a name="5528"><span class="lineNum">    5528 </span><span class="lineCov">       3687 :                         str = zval_get_tmp_string(value, &amp;tmp_str);</span></a>
<a name="5529"><span class="lineNum">    5529 </span><span class="lineCov">       3687 :                         zend_hash_add(&amp;exclude, str, &amp;dummy);</span></a>
<a name="5530"><span class="lineNum">    5530 </span><span class="lineCov">       3687 :                         zend_tmp_string_release(tmp_str);</span></a>
<a name="5531"><span class="lineNum">    5531 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="5532"><span class="lineNum">    5532 </span>            :         }</a>
<a name="5533"><span class="lineNum">    5533 </span>            : </a>
<a name="5534"><span class="lineNum">    5534 </span>            :         /* copy all elements of first array that are not in exclude set */</a>
<a name="5535"><span class="lineNum">    5535 </span><span class="lineCov">        237 :         array_init_size(return_value, zend_hash_num_elements(Z_ARRVAL(args[0])));</span></a>
<a name="5536"><span class="lineNum">    5536 </span><span class="lineCov">       7596 :         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL(args[0]), idx, key, value) {</span></a>
<a name="5537"><span class="lineNum">    5537 </span><span class="lineCov">       3678 :                 str = zval_get_tmp_string(value, &amp;tmp_str);</span></a>
<a name="5538"><span class="lineNum">    5538 </span><span class="lineCov">       3678 :                 if (!zend_hash_exists(&amp;exclude, str)) {</span></a>
<a name="5539"><span class="lineNum">    5539 </span><span class="lineCov">        465 :                         if (key) {</span></a>
<a name="5540"><span class="lineNum">    5540 </span><span class="lineCov">        147 :                                 value = zend_hash_add_new(Z_ARRVAL_P(return_value), key, value);</span></a>
<a name="5541"><span class="lineNum">    5541 </span>            :                         } else {</a>
<a name="5542"><span class="lineNum">    5542 </span><span class="lineCov">        318 :                                 value = zend_hash_index_add_new(Z_ARRVAL_P(return_value), idx, value);</span></a>
<a name="5543"><span class="lineNum">    5543 </span>            :                         }</a>
<a name="5544"><span class="lineNum">    5544 </span><span class="lineCov">        465 :                         zval_add_ref(value);</span></a>
<a name="5545"><span class="lineNum">    5545 </span>            :                 }</a>
<a name="5546"><span class="lineNum">    5546 </span><span class="lineCov">       3678 :                 zend_tmp_string_release(tmp_str);</span></a>
<a name="5547"><span class="lineNum">    5547 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="5548"><span class="lineNum">    5548 </span>            : </a>
<a name="5549"><span class="lineNum">    5549 </span><span class="lineCov">        237 :         zend_hash_destroy(&amp;exclude);</span></a>
<a name="5550"><span class="lineNum">    5550 </span>            : }</a>
<a name="5551"><span class="lineNum">    5551 </span>            : /* }}} */</a>
<a name="5552"><span class="lineNum">    5552 </span>            : </a>
<a name="5553"><span class="lineNum">    5553 </span>            : /* {{{ Returns the entries of arr1 that have values which are not present in any of the others arguments. Elements are compared by user supplied function. */</a>
<a name="5554"><span class="lineNum">    5554 </span><span class="lineCov">        225 : PHP_FUNCTION(array_udiff)</span></a>
<a name="5555"><span class="lineNum">    5555 </span>            : {</a>
<a name="5556"><span class="lineNum">    5556 </span><span class="lineCov">        225 :         php_array_diff(INTERNAL_FUNCTION_PARAM_PASSTHRU, DIFF_NORMAL, DIFF_COMP_DATA_USER, DIFF_COMP_KEY_INTERNAL);</span></a>
<a name="5557"><span class="lineNum">    5557 </span><span class="lineCov">        225 : }</span></a>
<a name="5558"><span class="lineNum">    5558 </span>            : /* }}} */</a>
<a name="5559"><span class="lineNum">    5559 </span>            : </a>
<a name="5560"><span class="lineNum">    5560 </span>            : /* {{{ Returns the entries of arr1 that have values which are not present in any of the others arguments but do additional checks whether the keys are equal */</a>
<a name="5561"><span class="lineNum">    5561 </span><span class="lineCov">        462 : PHP_FUNCTION(array_diff_assoc)</span></a>
<a name="5562"><span class="lineNum">    5562 </span>            : {</a>
<a name="5563"><span class="lineNum">    5563 </span><span class="lineCov">        462 :         php_array_diff_key(INTERNAL_FUNCTION_PARAM_PASSTHRU, DIFF_COMP_DATA_INTERNAL);</span></a>
<a name="5564"><span class="lineNum">    5564 </span><span class="lineCov">        462 : }</span></a>
<a name="5565"><span class="lineNum">    5565 </span>            : /* }}} */</a>
<a name="5566"><span class="lineNum">    5566 </span>            : </a>
<a name="5567"><span class="lineNum">    5567 </span>            : /* {{{ Returns the entries of arr1 that have values which are not present in any of the others arguments but do additional checks whether the keys are equal. Elements are compared by user supplied function. */</a>
<a name="5568"><span class="lineNum">    5568 </span><span class="lineCov">        324 : PHP_FUNCTION(array_diff_uassoc)</span></a>
<a name="5569"><span class="lineNum">    5569 </span>            : {</a>
<a name="5570"><span class="lineNum">    5570 </span><span class="lineCov">        324 :         php_array_diff(INTERNAL_FUNCTION_PARAM_PASSTHRU, DIFF_ASSOC, DIFF_COMP_DATA_INTERNAL, DIFF_COMP_KEY_USER);</span></a>
<a name="5571"><span class="lineNum">    5571 </span><span class="lineCov">        324 : }</span></a>
<a name="5572"><span class="lineNum">    5572 </span>            : /* }}} */</a>
<a name="5573"><span class="lineNum">    5573 </span>            : </a>
<a name="5574"><span class="lineNum">    5574 </span>            : /* {{{ Returns the entries of arr1 that have values which are not present in any of the others arguments but do additional checks whether the keys are equal. Keys are compared by user supplied function. */</a>
<a name="5575"><span class="lineNum">    5575 </span><span class="lineCov">        231 : PHP_FUNCTION(array_udiff_assoc)</span></a>
<a name="5576"><span class="lineNum">    5576 </span>            : {</a>
<a name="5577"><span class="lineNum">    5577 </span><span class="lineCov">        231 :         php_array_diff_key(INTERNAL_FUNCTION_PARAM_PASSTHRU, DIFF_COMP_DATA_USER);</span></a>
<a name="5578"><span class="lineNum">    5578 </span><span class="lineCov">        231 : }</span></a>
<a name="5579"><span class="lineNum">    5579 </span>            : /* }}} */</a>
<a name="5580"><span class="lineNum">    5580 </span>            : </a>
<a name="5581"><span class="lineNum">    5581 </span>            : /* {{{ Returns the entries of arr1 that have values which are not present in any of the others arguments but do additional checks whether the keys are equal. Keys and elements are compared by user supplied functions. */</a>
<a name="5582"><span class="lineNum">    5582 </span><span class="lineCov">        225 : PHP_FUNCTION(array_udiff_uassoc)</span></a>
<a name="5583"><span class="lineNum">    5583 </span>            : {</a>
<a name="5584"><span class="lineNum">    5584 </span><span class="lineCov">        225 :         php_array_diff(INTERNAL_FUNCTION_PARAM_PASSTHRU, DIFF_ASSOC, DIFF_COMP_DATA_USER, DIFF_COMP_KEY_USER);</span></a>
<a name="5585"><span class="lineNum">    5585 </span><span class="lineCov">        225 : }</span></a>
<a name="5586"><span class="lineNum">    5586 </span>            : /* }}} */</a>
<a name="5587"><span class="lineNum">    5587 </span>            : </a>
<a name="5588"><span class="lineNum">    5588 </span>            : #define MULTISORT_ORDER 0</a>
<a name="5589"><span class="lineNum">    5589 </span>            : #define MULTISORT_TYPE  1</a>
<a name="5590"><span class="lineNum">    5590 </span>            : #define MULTISORT_LAST  2</a>
<a name="5591"><span class="lineNum">    5591 </span>            : </a>
<a name="5592"><span class="lineNum">    5592 </span><span class="lineCov">       1629 : PHPAPI int php_multisort_compare(const void *a, const void *b) /* {{{ */</span></a>
<a name="5593"><span class="lineNum">    5593 </span>            : {</a>
<a name="5594"><span class="lineNum">    5594 </span><span class="lineCov">       1629 :         Bucket *ab = *(Bucket **)a;</span></a>
<a name="5595"><span class="lineNum">    5595 </span><span class="lineCov">       1629 :         Bucket *bb = *(Bucket **)b;</span></a>
<a name="5596"><span class="lineNum">    5596 </span>            :         int r;</a>
<a name="5597"><span class="lineNum">    5597 </span>            :         zend_long result;</a>
<a name="5598"><span class="lineNum">    5598 </span>            : </a>
<a name="5599"><span class="lineNum">    5599 </span><span class="lineCov">       1629 :         r = 0;</span></a>
<a name="5600"><span class="lineNum">    5600 </span>            :         do {</a>
<a name="5601"><span class="lineNum">    5601 </span><span class="lineCov">       2769 :                 result = ARRAYG(multisort_func)[r](&amp;ab[r], &amp;bb[r]);</span></a>
<a name="5602"><span class="lineNum">    5602 </span><span class="lineCov">       2769 :                 if (result != 0) {</span></a>
<a name="5603"><span class="lineNum">    5603 </span><span class="lineCov">        459 :                         return result &gt; 0 ? 1 : -1;</span></a>
<a name="5604"><span class="lineNum">    5604 </span>            :                 }</a>
<a name="5605"><span class="lineNum">    5605 </span><span class="lineCov">       2310 :                 r++;</span></a>
<a name="5606"><span class="lineNum">    5606 </span><span class="lineCov">       4620 :         } while (Z_TYPE(ab[r].val) != IS_UNDEF);</span></a>
<a name="5607"><span class="lineNum">    5607 </span>            : </a>
<a name="5608"><span class="lineNum">    5608 </span><span class="lineCov">       1170 :         return stable_sort_fallback(&amp;ab[r], &amp;bb[r]);</span></a>
<a name="5609"><span class="lineNum">    5609 </span>            : }</a>
<a name="5610"><span class="lineNum">    5610 </span>            : /* }}} */</a>
<a name="5611"><span class="lineNum">    5611 </span>            : </a>
<a name="5612"><span class="lineNum">    5612 </span>            : #define MULTISORT_ABORT                         \</a>
<a name="5613"><span class="lineNum">    5613 </span>            :         efree(func);    \</a>
<a name="5614"><span class="lineNum">    5614 </span>            :         efree(arrays);                                  \</a>
<a name="5615"><span class="lineNum">    5615 </span>            :         return;</a>
<a name="5616"><span class="lineNum">    5616 </span>            : </a>
<a name="5617"><span class="lineNum">    5617 </span><span class="lineCov">        324 : static void array_bucket_p_sawp(void *p, void *q) /* {{{ */ {</span></a>
<a name="5618"><span class="lineNum">    5618 </span>            :         Bucket *t;</a>
<a name="5619"><span class="lineNum">    5619 </span><span class="lineCov">        324 :         Bucket **f = (Bucket **)p;</span></a>
<a name="5620"><span class="lineNum">    5620 </span><span class="lineCov">        324 :         Bucket **g = (Bucket **)q;</span></a>
<a name="5621"><span class="lineNum">    5621 </span>            : </a>
<a name="5622"><span class="lineNum">    5622 </span><span class="lineCov">        324 :         t = *f;</span></a>
<a name="5623"><span class="lineNum">    5623 </span><span class="lineCov">        324 :         *f = *g;</span></a>
<a name="5624"><span class="lineNum">    5624 </span><span class="lineCov">        324 :         *g = t;</span></a>
<a name="5625"><span class="lineNum">    5625 </span><span class="lineCov">        324 : }</span></a>
<a name="5626"><span class="lineNum">    5626 </span>            : /* }}} */</a>
<a name="5627"><span class="lineNum">    5627 </span>            : </a>
<a name="5628"><span class="lineNum">    5628 </span>            : /* {{{ Sort multiple arrays at once similar to how ORDER BY clause works in SQL */</a>
<a name="5629"><span class="lineNum">    5629 </span><span class="lineCov">        402 : PHP_FUNCTION(array_multisort)</span></a>
<a name="5630"><span class="lineNum">    5630 </span>            : {</a>
<a name="5631"><span class="lineNum">    5631 </span>            :         zval*                   args;</a>
<a name="5632"><span class="lineNum">    5632 </span>            :         zval**                  arrays;</a>
<a name="5633"><span class="lineNum">    5633 </span>            :         Bucket**                indirect;</a>
<a name="5634"><span class="lineNum">    5634 </span>            :         uint32_t            idx;</a>
<a name="5635"><span class="lineNum">    5635 </span>            :         HashTable*              hash;</a>
<a name="5636"><span class="lineNum">    5636 </span>            :         int                             argc;</a>
<a name="5637"><span class="lineNum">    5637 </span>            :         int                             array_size;</a>
<a name="5638"><span class="lineNum">    5638 </span><span class="lineCov">        402 :         int                             num_arrays = 0;</span></a>
<a name="5639"><span class="lineNum">    5639 </span>            :         int                             parse_state[MULTISORT_LAST];   /* 0 - flag not allowed 1 - flag allowed */</a>
<a name="5640"><span class="lineNum">    5640 </span><span class="lineCov">        402 :         int                             sort_order = PHP_SORT_ASC;</span></a>
<a name="5641"><span class="lineNum">    5641 </span><span class="lineCov">        402 :         int                             sort_type  = PHP_SORT_REGULAR;</span></a>
<a name="5642"><span class="lineNum">    5642 </span>            :         int                             i, k, n;</a>
<a name="5643"><span class="lineNum">    5643 </span>            :         bucket_compare_func_t *func;</a>
<a name="5644"><span class="lineNum">    5644 </span>            : </a>
<a name="5645"><span class="lineNum">    5645 </span><span class="lineCov">        402 :         ZEND_PARSE_PARAMETERS_START(1, -1)</span></a>
<a name="5646"><span class="lineNum">    5646 </span><span class="lineCov">        396 :                 Z_PARAM_VARIADIC('+', args, argc)</span></a>
<a name="5647"><span class="lineNum">    5647 </span><span class="lineCov">        402 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="5648"><span class="lineNum">    5648 </span>            : </a>
<a name="5649"><span class="lineNum">    5649 </span>            :         /* Allocate space for storing pointers to input arrays and sort flags. */</a>
<a name="5650"><span class="lineNum">    5650 </span><span class="lineCov">        396 :         arrays = (zval **)ecalloc(argc, sizeof(zval *));</span></a>
<a name="5651"><span class="lineNum">    5651 </span><span class="lineCov">       1188 :         for (i = 0; i &lt; MULTISORT_LAST; i++) {</span></a>
<a name="5652"><span class="lineNum">    5652 </span><span class="lineCov">        792 :                 parse_state[i] = 0;</span></a>
<a name="5653"><span class="lineNum">    5653 </span>            :         }</a>
<a name="5654"><span class="lineNum">    5654 </span><span class="lineCov">        396 :         func = ARRAYG(multisort_func) = ecalloc(argc, sizeof(bucket_compare_func_t));</span></a>
<a name="5655"><span class="lineNum">    5655 </span>            : </a>
<a name="5656"><span class="lineNum">    5656 </span>            :         /* Here we go through the input arguments and parse them. Each one can</a>
<a name="5657"><span class="lineNum">    5657 </span>            :          * be either an array or a sort flag which follows an array. If not</a>
<a name="5658"><span class="lineNum">    5658 </span>            :          * specified, the sort flags defaults to PHP_SORT_ASC and PHP_SORT_REGULAR</a>
<a name="5659"><span class="lineNum">    5659 </span>            :          * accordingly. There can't be two sort flags of the same type after an</a>
<a name="5660"><span class="lineNum">    5660 </span>            :          * array, and the very first argument has to be an array. */</a>
<a name="5661"><span class="lineNum">    5661 </span><span class="lineCov">        909 :         for (i = 0; i &lt; argc; i++) {</span></a>
<a name="5662"><span class="lineNum">    5662 </span><span class="lineCov">        786 :                 zval *arg = &amp;args[i];</span></a>
<a name="5663"><span class="lineNum">    5663 </span>            : </a>
<a name="5664"><span class="lineNum">    5664 </span><span class="lineCov">        786 :                 ZVAL_DEREF(arg);</span></a>
<a name="5665"><span class="lineNum">    5665 </span><span class="lineCov">        786 :                 if (Z_TYPE_P(arg) == IS_ARRAY) {</span></a>
<a name="5666"><span class="lineNum">    5666 </span><span class="lineCov">        660 :                         SEPARATE_ARRAY(arg);</span></a>
<a name="5667"><span class="lineNum">    5667 </span>            :                         /* We see the next array, so we update the sort flags of</a>
<a name="5668"><span class="lineNum">    5668 </span>            :                          * the previous array and reset the sort flags. */</a>
<a name="5669"><span class="lineNum">    5669 </span><span class="lineCov">        330 :                         if (i &gt; 0) {</span></a>
<a name="5670"><span class="lineNum">    5670 </span><span class="lineCov">         57 :                                 ARRAYG(multisort_func)[num_arrays - 1] = php_get_data_compare_func_unstable(sort_type, sort_order != PHP_SORT_ASC);</span></a>
<a name="5671"><span class="lineNum">    5671 </span><span class="lineCov">         57 :                                 sort_order = PHP_SORT_ASC;</span></a>
<a name="5672"><span class="lineNum">    5672 </span><span class="lineCov">         57 :                                 sort_type = PHP_SORT_REGULAR;</span></a>
<a name="5673"><span class="lineNum">    5673 </span>            :                         }</a>
<a name="5674"><span class="lineNum">    5674 </span><span class="lineCov">        330 :                         arrays[num_arrays++] = arg;</span></a>
<a name="5675"><span class="lineNum">    5675 </span>            : </a>
<a name="5676"><span class="lineNum">    5676 </span>            :                         /* Next one may be an array or a list of sort flags. */</a>
<a name="5677"><span class="lineNum">    5677 </span><span class="lineCov">        990 :                         for (k = 0; k &lt; MULTISORT_LAST; k++) {</span></a>
<a name="5678"><span class="lineNum">    5678 </span><span class="lineCov">        660 :                                 parse_state[k] = 1;</span></a>
<a name="5679"><span class="lineNum">    5679 </span>            :                         }</a>
<a name="5680"><span class="lineNum">    5680 </span><span class="lineCov">        456 :                 } else if (Z_TYPE_P(arg) == IS_LONG) {</span></a>
<a name="5681"><span class="lineNum">    5681 </span><span class="lineCov">        219 :                         switch (Z_LVAL_P(arg) &amp; ~PHP_SORT_FLAG_CASE) {</span></a>
<a name="5682"><span class="lineNum">    5682 </span><span class="lineCov">         48 :                                 case PHP_SORT_ASC:</span></a>
<a name="5683"><span class="lineNum">    5683 </span>            :                                 case PHP_SORT_DESC:</a>
<a name="5684"><span class="lineNum">    5684 </span>            :                                         /* flag allowed here */</a>
<a name="5685"><span class="lineNum">    5685 </span><span class="lineCov">         48 :                                         if (parse_state[MULTISORT_ORDER] == 1) {</span></a>
<a name="5686"><span class="lineNum">    5686 </span>            :                                                 /* Save the flag and make sure then next arg is not the current flag. */</a>
<a name="5687"><span class="lineNum">    5687 </span><span class="lineCov">         45 :                                                 sort_order = Z_LVAL_P(arg) == PHP_SORT_DESC ? PHP_SORT_DESC : PHP_SORT_ASC;</span></a>
<a name="5688"><span class="lineNum">    5688 </span><span class="lineCov">         45 :                                                 parse_state[MULTISORT_ORDER] = 0;</span></a>
<a name="5689"><span class="lineNum">    5689 </span>            :                                         } else {</a>
<a name="5690"><span class="lineNum">    5690 </span><span class="lineCov">          3 :                                                 zend_argument_type_error(i + 1, &quot;must be an array or a sort flag that has not already been specified&quot;);</span></a>
<a name="5691"><span class="lineNum">    5691 </span><span class="lineCov">          3 :                                                 MULTISORT_ABORT;</span></a>
<a name="5692"><span class="lineNum">    5692 </span>            :                                         }</a>
<a name="5693"><span class="lineNum">    5693 </span><span class="lineCov">         45 :                                         break;</span></a>
<a name="5694"><span class="lineNum">    5694 </span>            : </a>
<a name="5695"><span class="lineNum">    5695 </span><span class="lineCov">        153 :                                 case PHP_SORT_REGULAR:</span></a>
<a name="5696"><span class="lineNum">    5696 </span>            :                                 case PHP_SORT_NUMERIC:</a>
<a name="5697"><span class="lineNum">    5697 </span>            :                                 case PHP_SORT_STRING:</a>
<a name="5698"><span class="lineNum">    5698 </span>            :                                 case PHP_SORT_NATURAL:</a>
<a name="5699"><span class="lineNum">    5699 </span>            :                                 case PHP_SORT_LOCALE_STRING:</a>
<a name="5700"><span class="lineNum">    5700 </span>            :                                         /* flag allowed here */</a>
<a name="5701"><span class="lineNum">    5701 </span><span class="lineCov">        153 :                                         if (parse_state[MULTISORT_TYPE] == 1) {</span></a>
<a name="5702"><span class="lineNum">    5702 </span>            :                                                 /* Save the flag and make sure then next arg is not the current flag. */</a>
<a name="5703"><span class="lineNum">    5703 </span><span class="lineCov">        138 :                                                 sort_type = (int)Z_LVAL_P(arg);</span></a>
<a name="5704"><span class="lineNum">    5704 </span><span class="lineCov">        138 :                                                 parse_state[MULTISORT_TYPE] = 0;</span></a>
<a name="5705"><span class="lineNum">    5705 </span>            :                                         } else {</a>
<a name="5706"><span class="lineNum">    5706 </span><span class="lineCov">         15 :                                                 zend_argument_type_error(i + 1, &quot;must be an array or a sort flag that has not already been specified&quot;);</span></a>
<a name="5707"><span class="lineNum">    5707 </span><span class="lineCov">         15 :                                                 MULTISORT_ABORT;</span></a>
<a name="5708"><span class="lineNum">    5708 </span>            :                                         }</a>
<a name="5709"><span class="lineNum">    5709 </span><span class="lineCov">        138 :                                         break;</span></a>
<a name="5710"><span class="lineNum">    5710 </span>            : </a>
<a name="5711"><span class="lineNum">    5711 </span><span class="lineCov">         18 :                                 default:</span></a>
<a name="5712"><span class="lineNum">    5712 </span><span class="lineCov">         18 :                                         zend_argument_value_error(i + 1, &quot;must be a valid sort flag&quot;);</span></a>
<a name="5713"><span class="lineNum">    5713 </span><span class="lineCov">         18 :                                         MULTISORT_ABORT;</span></a>
<a name="5714"><span class="lineNum">    5714 </span>            :                                         break;</a>
<a name="5715"><span class="lineNum">    5715 </span>            : </a>
<a name="5716"><span class="lineNum">    5716 </span>            :                         }</a>
<a name="5717"><span class="lineNum">    5717 </span>            :                 } else {</a>
<a name="5718"><span class="lineNum">    5718 </span><span class="lineCov">        237 :                         zend_argument_type_error(i + 1, &quot;must be an array or a sort flag&quot;);</span></a>
<a name="5719"><span class="lineNum">    5719 </span><span class="lineCov">        237 :                         MULTISORT_ABORT;</span></a>
<a name="5720"><span class="lineNum">    5720 </span>            :                 }</a>
<a name="5721"><span class="lineNum">    5721 </span>            :         }</a>
<a name="5722"><span class="lineNum">    5722 </span>            :         /* Take care of the last array sort flags. */</a>
<a name="5723"><span class="lineNum">    5723 </span><span class="lineCov">        123 :         ARRAYG(multisort_func)[num_arrays - 1] = php_get_data_compare_func_unstable(sort_type, sort_order != PHP_SORT_ASC);</span></a>
<a name="5724"><span class="lineNum">    5724 </span>            : </a>
<a name="5725"><span class="lineNum">    5725 </span>            :         /* Make sure the arrays are of the same size. */</a>
<a name="5726"><span class="lineNum">    5726 </span><span class="lineCov">        123 :         array_size = zend_hash_num_elements(Z_ARRVAL_P(arrays[0]));</span></a>
<a name="5727"><span class="lineNum">    5727 </span><span class="lineCov">        291 :         for (i = 0; i &lt; num_arrays; i++) {</span></a>
<a name="5728"><span class="lineNum">    5728 </span><span class="lineCov">        180 :                 if (zend_hash_num_elements(Z_ARRVAL_P(arrays[i])) != (uint32_t)array_size) {</span></a>
<a name="5729"><span class="lineNum">    5729 </span><span class="lineCov">         12 :                         zend_value_error(&quot;Array sizes are inconsistent&quot;);</span></a>
<a name="5730"><span class="lineNum">    5730 </span><span class="lineCov">         12 :                         MULTISORT_ABORT;</span></a>
<a name="5731"><span class="lineNum">    5731 </span>            :                 }</a>
<a name="5732"><span class="lineNum">    5732 </span>            :         }</a>
<a name="5733"><span class="lineNum">    5733 </span>            : </a>
<a name="5734"><span class="lineNum">    5734 </span>            :         /* If all arrays are empty we don't need to do anything. */</a>
<a name="5735"><span class="lineNum">    5735 </span><span class="lineCov">        111 :         if (array_size &lt; 1) {</span></a>
<a name="5736"><span class="lineNum">    5736 </span><span class="lineCov">          6 :                 efree(func);</span></a>
<a name="5737"><span class="lineNum">    5737 </span><span class="lineCov">          6 :                 efree(arrays);</span></a>
<a name="5738"><span class="lineNum">    5738 </span><span class="lineCov">          6 :                 RETURN_TRUE;</span></a>
<a name="5739"><span class="lineNum">    5739 </span>            :         }</a>
<a name="5740"><span class="lineNum">    5740 </span>            : </a>
<a name="5741"><span class="lineNum">    5741 </span>            :         /* Create the indirection array. This array is of size MxN, where</a>
<a name="5742"><span class="lineNum">    5742 </span>            :          * M is the number of entries in each input array and N is the number</a>
<a name="5743"><span class="lineNum">    5743 </span>            :          * of the input arrays + 1. The last column is UNDEF to indicate the end</a>
<a name="5744"><span class="lineNum">    5744 </span>            :          * of the row. It also stores the original position for stable sorting. */</a>
<a name="5745"><span class="lineNum">    5745 </span><span class="lineCov">        105 :         indirect = (Bucket **)safe_emalloc(array_size, sizeof(Bucket *), 0);</span></a>
<a name="5746"><span class="lineNum">    5746 </span><span class="lineCov">        819 :         for (i = 0; i &lt; array_size; i++) {</span></a>
<a name="5747"><span class="lineNum">    5747 </span><span class="lineCov">        714 :                 indirect[i] = (Bucket *)safe_emalloc((num_arrays + 1), sizeof(Bucket), 0);</span></a>
<a name="5748"><span class="lineNum">    5748 </span>            :         }</a>
<a name="5749"><span class="lineNum">    5749 </span><span class="lineCov">        249 :         for (i = 0; i &lt; num_arrays; i++) {</span></a>
<a name="5750"><span class="lineNum">    5750 </span><span class="lineCov">        144 :                 k = 0;</span></a>
<a name="5751"><span class="lineNum">    5751 </span><span class="lineCov">        144 :                 if (HT_IS_PACKED(Z_ARRVAL_P(arrays[i]))) {</span></a>
<a name="5752"><span class="lineNum">    5752 </span><span class="lineCov">        108 :                         zval *zv = Z_ARRVAL_P(arrays[i])-&gt;arPacked;</span></a>
<a name="5753"><span class="lineNum">    5753 </span><span class="lineCov">       1140 :                         for (idx = 0; idx &lt; Z_ARRVAL_P(arrays[i])-&gt;nNumUsed; idx++, zv++) {</span></a>
<a name="5754"><span class="lineNum">    5754 </span><span class="lineCov">       1032 :                                 if (Z_TYPE_P(zv) == IS_UNDEF) continue;</span></a>
<a name="5755"><span class="lineNum">    5755 </span><span class="lineCov">       1029 :                                 ZVAL_COPY_VALUE(&amp;indirect[k][i].val, zv);</span></a>
<a name="5756"><span class="lineNum">    5756 </span><span class="lineCov">       1029 :                                 indirect[k][i].h = idx;</span></a>
<a name="5757"><span class="lineNum">    5757 </span><span class="lineCov">       1029 :                                 indirect[k][i].key = NULL;</span></a>
<a name="5758"><span class="lineNum">    5758 </span><span class="lineCov">       1029 :                                 k++;</span></a>
<a name="5759"><span class="lineNum">    5759 </span>            :                         }</a>
<a name="5760"><span class="lineNum">    5760 </span>            :                 } else {</a>
<a name="5761"><span class="lineNum">    5761 </span><span class="lineCov">         36 :                         Bucket *p = Z_ARRVAL_P(arrays[i])-&gt;arData;</span></a>
<a name="5762"><span class="lineNum">    5762 </span><span class="lineCov">        198 :                         for (idx = 0; idx &lt; Z_ARRVAL_P(arrays[i])-&gt;nNumUsed; idx++, p++) {</span></a>
<a name="5763"><span class="lineNum">    5763 </span><span class="lineCov">        324 :                                 if (Z_TYPE(p-&gt;val) == IS_UNDEF) continue;</span></a>
<a name="5764"><span class="lineNum">    5764 </span><span class="lineCov">        162 :                                 indirect[k][i] = *p;</span></a>
<a name="5765"><span class="lineNum">    5765 </span><span class="lineCov">        162 :                                 k++;</span></a>
<a name="5766"><span class="lineNum">    5766 </span>            :                         }</a>
<a name="5767"><span class="lineNum">    5767 </span>            :                 }</a>
<a name="5768"><span class="lineNum">    5768 </span>            :         }</a>
<a name="5769"><span class="lineNum">    5769 </span><span class="lineCov">        819 :         for (k = 0; k &lt; array_size; k++) {</span></a>
<a name="5770"><span class="lineNum">    5770 </span><span class="lineCov">        714 :                 ZVAL_UNDEF(&amp;indirect[k][num_arrays].val);</span></a>
<a name="5771"><span class="lineNum">    5771 </span><span class="lineCov">        714 :                 Z_EXTRA_P(&amp;indirect[k][num_arrays].val) = k;</span></a>
<a name="5772"><span class="lineNum">    5772 </span>            :         }</a>
<a name="5773"><span class="lineNum">    5773 </span>            : </a>
<a name="5774"><span class="lineNum">    5774 </span>            :         /* Do the actual sort magic - bada-bim, bada-boom. */</a>
<a name="5775"><span class="lineNum">    5775 </span><span class="lineCov">        105 :         zend_sort(indirect, array_size, sizeof(Bucket *), php_multisort_compare, (swap_func_t)array_bucket_p_sawp);</span></a>
<a name="5776"><span class="lineNum">    5776 </span>            : </a>
<a name="5777"><span class="lineNum">    5777 </span>            :         /* Restructure the arrays based on sorted indirect - this is mostly taken from zend_hash_sort() function. */</a>
<a name="5778"><span class="lineNum">    5778 </span><span class="lineCov">        249 :         for (i = 0; i &lt; num_arrays; i++) {</span></a>
<a name="5779"><span class="lineNum">    5779 </span><span class="lineCov">        144 :                 hash = Z_ARRVAL_P(arrays[i]);</span></a>
<a name="5780"><span class="lineNum">    5780 </span><span class="lineCov">        144 :                 hash-&gt;nNumUsed = array_size;</span></a>
<a name="5781"><span class="lineNum">    5781 </span><span class="lineCov">        144 :                 hash-&gt;nNextFreeElement = array_size;</span></a>
<a name="5782"><span class="lineNum">    5782 </span><span class="lineCov">        144 :                 hash-&gt;nInternalPointer = 0;</span></a>
<a name="5783"><span class="lineNum">    5783 </span><span class="lineCov">        144 :                 if (HT_IS_PACKED(hash)) {</span></a>
<a name="5784"><span class="lineNum">    5784 </span><span class="lineCov">       1137 :                         for (k = 0; k &lt; array_size; k++) {</span></a>
<a name="5785"><span class="lineNum">    5785 </span><span class="lineCov">       1029 :                                 ZVAL_COPY_VALUE(&amp;hash-&gt;arPacked[k], &amp;indirect[k][i].val);</span></a>
<a name="5786"><span class="lineNum">    5786 </span>            :                         }</a>
<a name="5787"><span class="lineNum">    5787 </span>            :                 } else {</a>
<a name="5788"><span class="lineNum">    5788 </span><span class="lineCov">         36 :                         int repack = 1;</span></a>
<a name="5789"><span class="lineNum">    5789 </span>            : </a>
<a name="5790"><span class="lineNum">    5790 </span><span class="lineCov">        198 :                         for (n = 0, k = 0; k &lt; array_size; k++) {</span></a>
<a name="5791"><span class="lineNum">    5791 </span><span class="lineCov">        162 :                                 hash-&gt;arData[k] = indirect[k][i];</span></a>
<a name="5792"><span class="lineNum">    5792 </span><span class="lineCov">        162 :                                 if (hash-&gt;arData[k].key == NULL) {</span></a>
<a name="5793"><span class="lineNum">    5793 </span><span class="lineCov">         15 :                                         hash-&gt;arData[k].h = n++;</span></a>
<a name="5794"><span class="lineNum">    5794 </span>            :                                 } else {</a>
<a name="5795"><span class="lineNum">    5795 </span><span class="lineCov">        147 :                                         repack = 0;</span></a>
<a name="5796"><span class="lineNum">    5796 </span>            :                                 }</a>
<a name="5797"><span class="lineNum">    5797 </span>            :                         }</a>
<a name="5798"><span class="lineNum">    5798 </span><span class="lineCov">         36 :                         if (repack) {</span></a>
<a name="5799"><span class="lineNum">    5799 </span><span class="lineNoCov">          0 :                                 zend_hash_to_packed(hash);</span></a>
<a name="5800"><span class="lineNum">    5800 </span>            :                         }</a>
<a name="5801"><span class="lineNum">    5801 </span>            :                 }</a>
<a name="5802"><span class="lineNum">    5802 </span>            :         }</a>
<a name="5803"><span class="lineNum">    5803 </span>            : </a>
<a name="5804"><span class="lineNum">    5804 </span>            :         /* Clean up. */</a>
<a name="5805"><span class="lineNum">    5805 </span><span class="lineCov">        819 :         for (i = 0; i &lt; array_size; i++) {</span></a>
<a name="5806"><span class="lineNum">    5806 </span><span class="lineCov">        714 :                 efree(indirect[i]);</span></a>
<a name="5807"><span class="lineNum">    5807 </span>            :         }</a>
<a name="5808"><span class="lineNum">    5808 </span><span class="lineCov">        105 :         efree(indirect);</span></a>
<a name="5809"><span class="lineNum">    5809 </span><span class="lineCov">        105 :         efree(func);</span></a>
<a name="5810"><span class="lineNum">    5810 </span><span class="lineCov">        105 :         efree(arrays);</span></a>
<a name="5811"><span class="lineNum">    5811 </span><span class="lineCov">        105 :         RETURN_TRUE;</span></a>
<a name="5812"><span class="lineNum">    5812 </span>            : }</a>
<a name="5813"><span class="lineNum">    5813 </span>            : /* }}} */</a>
<a name="5814"><span class="lineNum">    5814 </span>            : </a>
<a name="5815"><span class="lineNum">    5815 </span>            : /* {{{ Return key/keys for random entry/entries in the array */</a>
<a name="5816"><span class="lineNum">    5816 </span><span class="lineCov">       1020 : PHP_FUNCTION(array_rand)</span></a>
<a name="5817"><span class="lineNum">    5817 </span>            : {</a>
<a name="5818"><span class="lineNum">    5818 </span>            :         zval *input;</a>
<a name="5819"><span class="lineNum">    5819 </span><span class="lineCov">       1020 :         zend_long num_req = 1;</span></a>
<a name="5820"><span class="lineNum">    5820 </span>            :         zend_string *string_key;</a>
<a name="5821"><span class="lineNum">    5821 </span>            :         zend_ulong num_key;</a>
<a name="5822"><span class="lineNum">    5822 </span>            :         int i;</a>
<a name="5823"><span class="lineNum">    5823 </span>            :         int num_avail;</a>
<a name="5824"><span class="lineNum">    5824 </span>            :         zend_bitset bitset;</a>
<a name="5825"><span class="lineNum">    5825 </span><span class="lineCov">       1020 :         int negative_bitset = 0;</span></a>
<a name="5826"><span class="lineNum">    5826 </span>            :         uint32_t bitset_len;</a>
<a name="5827"><span class="lineNum">    5827 </span>            :         ALLOCA_FLAG(use_heap)</a>
<a name="5828"><span class="lineNum">    5828 </span>            : </a>
<a name="5829"><span class="lineNum">    5829 </span><span class="lineCov">       1020 :         ZEND_PARSE_PARAMETERS_START(1, 2)</span></a>
<a name="5830"><span class="lineNum">    5830 </span><span class="lineCov">       1956 :                 Z_PARAM_ARRAY(input)</span></a>
<a name="5831"><span class="lineNum">    5831 </span><span class="lineCov">        966 :                 Z_PARAM_OPTIONAL</span></a>
<a name="5832"><span class="lineNum">    5832 </span><span class="lineCov">       1875 :                 Z_PARAM_LONG(num_req)</span></a>
<a name="5833"><span class="lineNum">    5833 </span><span class="lineCov">       1020 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="5834"><span class="lineNum">    5834 </span>            : </a>
<a name="5835"><span class="lineNum">    5835 </span><span class="lineCov">        966 :         num_avail = zend_hash_num_elements(Z_ARRVAL_P(input));</span></a>
<a name="5836"><span class="lineNum">    5836 </span>            : </a>
<a name="5837"><span class="lineNum">    5837 </span><span class="lineCov">        966 :         if (num_avail == 0) {</span></a>
<a name="5838"><span class="lineNum">    5838 </span><span class="lineCov">          6 :                 zend_argument_value_error(1, &quot;cannot be empty&quot;);</span></a>
<a name="5839"><span class="lineNum">    5839 </span><span class="lineCov">          6 :                 RETURN_THROWS();</span></a>
<a name="5840"><span class="lineNum">    5840 </span>            :         }</a>
<a name="5841"><span class="lineNum">    5841 </span>            : </a>
<a name="5842"><span class="lineNum">    5842 </span><span class="lineCov">        960 :         if (num_req == 1) {</span></a>
<a name="5843"><span class="lineNum">    5843 </span><span class="lineCov">        867 :                 HashTable *ht = Z_ARRVAL_P(input);</span></a>
<a name="5844"><span class="lineNum">    5844 </span>            : </a>
<a name="5845"><span class="lineNum">    5845 </span><span class="lineCov">        867 :                 if ((uint32_t)num_avail &lt; ht-&gt;nNumUsed - (ht-&gt;nNumUsed&gt;&gt;1)) {</span></a>
<a name="5846"><span class="lineNum">    5846 </span>            :                         /* If less than 1/2 of elements are used, don't sample. Instead search for a</a>
<a name="5847"><span class="lineNum">    5847 </span>            :                          * specific offset using linear scan. */</a>
<a name="5848"><span class="lineNum">    5848 </span><span class="lineCov">         24 :                         zend_long i = 0, randval = php_mt_rand_range(0, num_avail - 1);</span></a>
<a name="5849"><span class="lineNum">    5849 </span><span class="lineCov">        371 :                         ZEND_HASH_FOREACH_KEY(Z_ARRVAL_P(input), num_key, string_key) {</span></a>
<a name="5850"><span class="lineNum">    5850 </span><span class="lineCov">         85 :                                 if (i == randval) {</span></a>
<a name="5851"><span class="lineNum">    5851 </span><span class="lineCov">         24 :                                         if (string_key) {</span></a>
<a name="5852"><span class="lineNum">    5852 </span><span class="lineNoCov">          0 :                                                 RETURN_STR_COPY(string_key);</span></a>
<a name="5853"><span class="lineNum">    5853 </span>            :                                         } else {</a>
<a name="5854"><span class="lineNum">    5854 </span><span class="lineCov">         24 :                                                 RETURN_LONG(num_key);</span></a>
<a name="5855"><span class="lineNum">    5855 </span>            :                                         }</a>
<a name="5856"><span class="lineNum">    5856 </span>            :                                 }</a>
<a name="5857"><span class="lineNum">    5857 </span><span class="lineCov">         61 :                                 i++;</span></a>
<a name="5858"><span class="lineNum">    5858 </span>            :                         } ZEND_HASH_FOREACH_END();</a>
<a name="5859"><span class="lineNum">    5859 </span>            :                 }</a>
<a name="5860"><span class="lineNum">    5860 </span>            : </a>
<a name="5861"><span class="lineNum">    5861 </span>            :                 /* Sample random buckets until we hit one that is not empty.</a>
<a name="5862"><span class="lineNum">    5862 </span>            :                  * The worst case probability of hitting an empty element is 1-1/2. The worst case</a>
<a name="5863"><span class="lineNum">    5863 </span>            :                  * probability of hitting N empty elements in a row is (1-1/2)**N.</a>
<a name="5864"><span class="lineNum">    5864 </span>            :                  * For N=10 this becomes smaller than 0.1%. */</a>
<a name="5865"><span class="lineNum">    5865 </span><span class="lineCov">        843 :                 if (HT_IS_PACKED(ht)) {</span></a>
<a name="5866"><span class="lineNum">    5866 </span><span class="lineNoCov">          0 :                         do {</span></a>
<a name="5867"><span class="lineNum">    5867 </span><span class="lineCov">        792 :                                 zend_long randval = php_mt_rand_range(0, ht-&gt;nNumUsed - 1);</span></a>
<a name="5868"><span class="lineNum">    5868 </span><span class="lineCov">        792 :                                 zval *zv = &amp;ht-&gt;arPacked[randval];</span></a>
<a name="5869"><span class="lineNum">    5869 </span><span class="lineCov">        792 :                                 if (!Z_ISUNDEF_P(zv)) {</span></a>
<a name="5870"><span class="lineNum">    5870 </span><span class="lineCov">        792 :                                         RETURN_LONG(randval);</span></a>
<a name="5871"><span class="lineNum">    5871 </span>            :                                 }</a>
<a name="5872"><span class="lineNum">    5872 </span>            :                         } while (1);</a>
<a name="5873"><span class="lineNum">    5873 </span>            :                 } else {</a>
<a name="5874"><span class="lineNum">    5874 </span><span class="lineNoCov">          0 :                         do {</span></a>
<a name="5875"><span class="lineNum">    5875 </span><span class="lineCov">         51 :                                 zend_long randval = php_mt_rand_range(0, ht-&gt;nNumUsed - 1);</span></a>
<a name="5876"><span class="lineNum">    5876 </span><span class="lineCov">         51 :                                 Bucket *bucket = &amp;ht-&gt;arData[randval];</span></a>
<a name="5877"><span class="lineNum">    5877 </span><span class="lineCov">        102 :                                 if (!Z_ISUNDEF(bucket-&gt;val)) {</span></a>
<a name="5878"><span class="lineNum">    5878 </span><span class="lineCov">         51 :                                         if (bucket-&gt;key) {</span></a>
<a name="5879"><span class="lineNum">    5879 </span><span class="lineCov">         52 :                                                 RETURN_STR_COPY(bucket-&gt;key);</span></a>
<a name="5880"><span class="lineNum">    5880 </span>            :                                         } else {</a>
<a name="5881"><span class="lineNum">    5881 </span><span class="lineCov">         30 :                                                 RETURN_LONG(bucket-&gt;h);</span></a>
<a name="5882"><span class="lineNum">    5882 </span>            :                                         }</a>
<a name="5883"><span class="lineNum">    5883 </span>            :                                 }</a>
<a name="5884"><span class="lineNum">    5884 </span>            :                         } while (1);</a>
<a name="5885"><span class="lineNum">    5885 </span>            :                 }</a>
<a name="5886"><span class="lineNum">    5886 </span>            :         }</a>
<a name="5887"><span class="lineNum">    5887 </span>            : </a>
<a name="5888"><span class="lineNum">    5888 </span><span class="lineCov">         93 :         if (num_req &lt;= 0 || num_req &gt; num_avail) {</span></a>
<a name="5889"><span class="lineNum">    5889 </span><span class="lineCov">         21 :                 zend_argument_value_error(2, &quot;must be between 1 and the number of elements in argument #1 ($array)&quot;);</span></a>
<a name="5890"><span class="lineNum">    5890 </span><span class="lineCov">         21 :                 RETURN_THROWS();</span></a>
<a name="5891"><span class="lineNum">    5891 </span>            :         }</a>
<a name="5892"><span class="lineNum">    5892 </span>            : </a>
<a name="5893"><span class="lineNum">    5893 </span>            :         /* Make the return value an array only if we need to pass back more than one result. */</a>
<a name="5894"><span class="lineNum">    5894 </span><span class="lineCov">         72 :         array_init_size(return_value, (uint32_t)num_req);</span></a>
<a name="5895"><span class="lineNum">    5895 </span><span class="lineCov">         72 :         if (num_req &gt; (num_avail &gt;&gt; 1)) {</span></a>
<a name="5896"><span class="lineNum">    5896 </span><span class="lineCov">         42 :                 negative_bitset = 1;</span></a>
<a name="5897"><span class="lineNum">    5897 </span><span class="lineCov">         42 :                 num_req = num_avail - num_req;</span></a>
<a name="5898"><span class="lineNum">    5898 </span>            :         }</a>
<a name="5899"><span class="lineNum">    5899 </span>            : </a>
<a name="5900"><span class="lineNum">    5900 </span><span class="lineCov">         72 :         bitset_len = zend_bitset_len(num_avail);</span></a>
<a name="5901"><span class="lineNum">    5901 </span><span class="lineCov">         72 :         bitset = ZEND_BITSET_ALLOCA(bitset_len, use_heap);</span></a>
<a name="5902"><span class="lineNum">    5902 </span><span class="lineCov">         72 :         zend_bitset_clear(bitset, bitset_len);</span></a>
<a name="5903"><span class="lineNum">    5903 </span>            : </a>
<a name="5904"><span class="lineNum">    5904 </span><span class="lineCov">         72 :         i = num_req;</span></a>
<a name="5905"><span class="lineNum">    5905 </span><span class="lineCov">        202 :         while (i) {</span></a>
<a name="5906"><span class="lineNum">    5906 </span><span class="lineCov">        130 :                 zend_long randval = php_mt_rand_range(0, num_avail - 1);</span></a>
<a name="5907"><span class="lineNum">    5907 </span><span class="lineCov">        130 :                 if (!zend_bitset_in(bitset, randval)) {</span></a>
<a name="5908"><span class="lineNum">    5908 </span><span class="lineCov">        114 :                         zend_bitset_incl(bitset, randval);</span></a>
<a name="5909"><span class="lineNum">    5909 </span><span class="lineCov">        114 :                         i--;</span></a>
<a name="5910"><span class="lineNum">    5910 </span>            :                 }</a>
<a name="5911"><span class="lineNum">    5911 </span>            :         }</a>
<a name="5912"><span class="lineNum">    5912 </span>            :         /* i = 0; */</a>
<a name="5913"><span class="lineNum">    5913 </span>            : </a>
<a name="5914"><span class="lineNum">    5914 </span><span class="lineCov">         72 :         zend_hash_real_init_packed(Z_ARRVAL_P(return_value));</span></a>
<a name="5915"><span class="lineNum">    5915 </span><span class="lineCov">         72 :         ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {</span></a>
<a name="5916"><span class="lineNum">    5916 </span>            :                 /* We can't use zend_hash_index_find()</a>
<a name="5917"><span class="lineNum">    5917 </span>            :                  * because the array may have string keys or gaps. */</a>
<a name="5918"><span class="lineNum">    5918 </span><span class="lineCov">       3168 :                 ZEND_HASH_FOREACH_KEY(Z_ARRVAL_P(input), num_key, string_key) {</span></a>
<a name="5919"><span class="lineNum">    5919 </span><span class="lineCov">       1548 :                         if (zend_bitset_in(bitset, i) ^ negative_bitset) {</span></a>
<a name="5920"><span class="lineNum">    5920 </span><span class="lineCov">       1398 :                                 if (string_key) {</span></a>
<a name="5921"><span class="lineNum">    5921 </span><span class="lineCov">        141 :                                         ZEND_HASH_FILL_SET_STR_COPY(string_key);</span></a>
<a name="5922"><span class="lineNum">    5922 </span>            :                                 } else {</a>
<a name="5923"><span class="lineNum">    5923 </span><span class="lineCov">       1341 :                                         ZEND_HASH_FILL_SET_LONG(num_key);</span></a>
<a name="5924"><span class="lineNum">    5924 </span>            :                                 }</a>
<a name="5925"><span class="lineNum">    5925 </span><span class="lineCov">       1398 :                                 ZEND_HASH_FILL_NEXT();</span></a>
<a name="5926"><span class="lineNum">    5926 </span>            :                         }</a>
<a name="5927"><span class="lineNum">    5927 </span><span class="lineCov">       1548 :                         i++;</span></a>
<a name="5928"><span class="lineNum">    5928 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="5929"><span class="lineNum">    5929 </span><span class="lineCov">         72 :         } ZEND_HASH_FILL_END();</span></a>
<a name="5930"><span class="lineNum">    5930 </span>            : </a>
<a name="5931"><span class="lineNum">    5931 </span><span class="lineCov">         72 :         free_alloca(bitset, use_heap);</span></a>
<a name="5932"><span class="lineNum">    5932 </span>            : }</a>
<a name="5933"><span class="lineNum">    5933 </span>            : /* }}} */</a>
<a name="5934"><span class="lineNum">    5934 </span>            : </a>
<a name="5935"><span class="lineNum">    5935 </span>            : /* {{{ Returns the sum of the array entries */</a>
<a name="5936"><span class="lineNum">    5936 </span><span class="lineCov">        168 : PHP_FUNCTION(array_sum)</span></a>
<a name="5937"><span class="lineNum">    5937 </span>            : {</a>
<a name="5938"><span class="lineNum">    5938 </span>            :         zval *input,</a>
<a name="5939"><span class="lineNum">    5939 </span>            :                  *entry,</a>
<a name="5940"><span class="lineNum">    5940 </span>            :                  entry_n;</a>
<a name="5941"><span class="lineNum">    5941 </span>            : </a>
<a name="5942"><span class="lineNum">    5942 </span><span class="lineCov">        168 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="5943"><span class="lineNum">    5943 </span><span class="lineCov">        240 :                 Z_PARAM_ARRAY(input)</span></a>
<a name="5944"><span class="lineNum">    5944 </span><span class="lineCov">        168 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="5945"><span class="lineNum">    5945 </span>            : </a>
<a name="5946"><span class="lineNum">    5946 </span><span class="lineCov">        114 :         ZVAL_LONG(return_value, 0);</span></a>
<a name="5947"><span class="lineNum">    5947 </span>            : </a>
<a name="5948"><span class="lineNum">    5948 </span><span class="lineCov">    1213040 :         ZEND_HASH_FOREACH_VAL(Z_ARRVAL_P(input), entry) {</span></a>
<a name="5949"><span class="lineNum">    5949 </span><span class="lineCov">    1212920 :                 if (Z_TYPE_P(entry) == IS_ARRAY || Z_TYPE_P(entry) == IS_OBJECT) {</span></a>
<a name="5950"><span class="lineNum">    5950 </span><span class="lineCov">         24 :                         continue;</span></a>
<a name="5951"><span class="lineNum">    5951 </span>            :                 }</a>
<a name="5952"><span class="lineNum">    5952 </span><span class="lineCov">     606441 :                 ZVAL_COPY(&amp;entry_n, entry);</span></a>
<a name="5953"><span class="lineNum">    5953 </span><span class="lineCov">     606441 :                 convert_scalar_to_number(&amp;entry_n);</span></a>
<a name="5954"><span class="lineNum">    5954 </span>            :                 fast_add_function(return_value, return_value, &amp;entry_n);</a>
<a name="5955"><span class="lineNum">    5955 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="5956"><span class="lineNum">    5956 </span>            : }</a>
<a name="5957"><span class="lineNum">    5957 </span>            : /* }}} */</a>
<a name="5958"><span class="lineNum">    5958 </span>            : </a>
<a name="5959"><span class="lineNum">    5959 </span>            : /* {{{ Returns the product of the array entries */</a>
<a name="5960"><span class="lineNum">    5960 </span><span class="lineCov">        126 : PHP_FUNCTION(array_product)</span></a>
<a name="5961"><span class="lineNum">    5961 </span>            : {</a>
<a name="5962"><span class="lineNum">    5962 </span>            :         zval *input,</a>
<a name="5963"><span class="lineNum">    5963 </span>            :                  *entry,</a>
<a name="5964"><span class="lineNum">    5964 </span>            :                  entry_n;</a>
<a name="5965"><span class="lineNum">    5965 </span>            :         double dval;</a>
<a name="5966"><span class="lineNum">    5966 </span>            : </a>
<a name="5967"><span class="lineNum">    5967 </span><span class="lineCov">        126 :         ZEND_PARSE_PARAMETERS_START(1, 1)</span></a>
<a name="5968"><span class="lineNum">    5968 </span><span class="lineCov">        156 :                 Z_PARAM_ARRAY(input)</span></a>
<a name="5969"><span class="lineNum">    5969 </span><span class="lineCov">        132 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="5970"><span class="lineNum">    5970 </span>            : </a>
<a name="5971"><span class="lineNum">    5971 </span><span class="lineCov">         72 :         ZVAL_LONG(return_value, 1);</span></a>
<a name="5972"><span class="lineNum">    5972 </span><span class="lineCov">         72 :         if (!zend_hash_num_elements(Z_ARRVAL_P(input))) {</span></a>
<a name="5973"><span class="lineNum">    5973 </span><span class="lineCov">          6 :                 return;</span></a>
<a name="5974"><span class="lineNum">    5974 </span>            :         }</a>
<a name="5975"><span class="lineNum">    5975 </span>            : </a>
<a name="5976"><span class="lineNum">    5976 </span><span class="lineCov">       6258 :         ZEND_HASH_FOREACH_VAL(Z_ARRVAL_P(input), entry) {</span></a>
<a name="5977"><span class="lineNum">    5977 </span><span class="lineCov">       6189 :                 if (Z_TYPE_P(entry) == IS_ARRAY || Z_TYPE_P(entry) == IS_OBJECT) {</span></a>
<a name="5978"><span class="lineNum">    5978 </span><span class="lineCov">          6 :                         continue;</span></a>
<a name="5979"><span class="lineNum">    5979 </span>            :                 }</a>
<a name="5980"><span class="lineNum">    5980 </span><span class="lineCov">       3090 :                 ZVAL_COPY(&amp;entry_n, entry);</span></a>
<a name="5981"><span class="lineNum">    5981 </span><span class="lineCov">       3090 :                 convert_scalar_to_number(&amp;entry_n);</span></a>
<a name="5982"><span class="lineNum">    5982 </span>            : </a>
<a name="5983"><span class="lineNum">    5983 </span><span class="lineCov">       6159 :                 if (Z_TYPE(entry_n) == IS_LONG &amp;&amp; Z_TYPE_P(return_value) == IS_LONG) {</span></a>
<a name="5984"><span class="lineNum">    5984 </span><span class="lineCov">         84 :                         dval = (double)Z_LVAL_P(return_value) * (double)Z_LVAL(entry_n);</span></a>
<a name="5985"><span class="lineNum">    5985 </span><span class="lineCov">         84 :                         if ( (double)ZEND_LONG_MIN &lt;= dval &amp;&amp; dval &lt;= (double)ZEND_LONG_MAX ) {</span></a>
<a name="5986"><span class="lineNum">    5986 </span><span class="lineCov">         81 :                                 Z_LVAL_P(return_value) *= Z_LVAL(entry_n);</span></a>
<a name="5987"><span class="lineNum">    5987 </span><span class="lineCov">         81 :                                 continue;</span></a>
<a name="5988"><span class="lineNum">    5988 </span>            :                         }</a>
<a name="5989"><span class="lineNum">    5989 </span>            :                 }</a>
<a name="5990"><span class="lineNum">    5990 </span><span class="lineCov">       3009 :                 convert_to_double(return_value);</span></a>
<a name="5991"><span class="lineNum">    5991 </span><span class="lineCov">       3009 :                 convert_to_double(&amp;entry_n);</span></a>
<a name="5992"><span class="lineNum">    5992 </span><span class="lineCov">       3009 :                 Z_DVAL_P(return_value) *= Z_DVAL(entry_n);</span></a>
<a name="5993"><span class="lineNum">    5993 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="5994"><span class="lineNum">    5994 </span>            : }</a>
<a name="5995"><span class="lineNum">    5995 </span>            : /* }}} */</a>
<a name="5996"><span class="lineNum">    5996 </span>            : </a>
<a name="5997"><span class="lineNum">    5997 </span>            : /* {{{ Iteratively reduce the array to a single value via the callback. */</a>
<a name="5998"><span class="lineNum">    5998 </span><span class="lineCov">        237 : PHP_FUNCTION(array_reduce)</span></a>
<a name="5999"><span class="lineNum">    5999 </span>            : {</a>
<a name="6000"><span class="lineNum">    6000 </span>            :         zval *input;</a>
<a name="6001"><span class="lineNum">    6001 </span>            :         zval args[2];</a>
<a name="6002"><span class="lineNum">    6002 </span>            :         zval *operand;</a>
<a name="6003"><span class="lineNum">    6003 </span>            :         zval retval;</a>
<a name="6004"><span class="lineNum">    6004 </span>            :         zend_fcall_info fci;</a>
<a name="6005"><span class="lineNum">    6005 </span><span class="lineCov">        237 :         zend_fcall_info_cache fci_cache = empty_fcall_info_cache;</span></a>
<a name="6006"><span class="lineNum">    6006 </span><span class="lineCov">        237 :         zval *initial = NULL;</span></a>
<a name="6007"><span class="lineNum">    6007 </span>            :         HashTable *htbl;</a>
<a name="6008"><span class="lineNum">    6008 </span>            : </a>
<a name="6009"><span class="lineNum">    6009 </span><span class="lineCov">        237 :         ZEND_PARSE_PARAMETERS_START(2, 3)</span></a>
<a name="6010"><span class="lineNum">    6010 </span><span class="lineCov">        390 :                 Z_PARAM_ARRAY(input)</span></a>
<a name="6011"><span class="lineNum">    6011 </span><span class="lineCov">        366 :                 Z_PARAM_FUNC(fci, fci_cache)</span></a>
<a name="6012"><span class="lineNum">    6012 </span><span class="lineCov">        183 :                 Z_PARAM_OPTIONAL</span></a>
<a name="6013"><span class="lineNum">    6013 </span><span class="lineCov">        183 :                 Z_PARAM_ZVAL(initial)</span></a>
<a name="6014"><span class="lineNum">    6014 </span><span class="lineCov">        237 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="6015"><span class="lineNum">    6015 </span>            : </a>
<a name="6016"><span class="lineNum">    6016 </span>            : </a>
<a name="6017"><span class="lineNum">    6017 </span><span class="lineCov">        183 :         if (ZEND_NUM_ARGS() &gt; 2) {</span></a>
<a name="6018"><span class="lineNum">    6018 </span><span class="lineCov">         54 :                 ZVAL_COPY(return_value, initial);</span></a>
<a name="6019"><span class="lineNum">    6019 </span>            :         } else {</a>
<a name="6020"><span class="lineNum">    6020 </span><span class="lineCov">        129 :                 ZVAL_NULL(return_value);</span></a>
<a name="6021"><span class="lineNum">    6021 </span>            :         }</a>
<a name="6022"><span class="lineNum">    6022 </span>            : </a>
<a name="6023"><span class="lineNum">    6023 </span>            :         /* (zval **)input points to an element of argument stack</a>
<a name="6024"><span class="lineNum">    6024 </span>            :          * the base pointer of which is subject to change.</a>
<a name="6025"><span class="lineNum">    6025 </span>            :          * thus we need to keep the pointer to the hashtable for safety */</a>
<a name="6026"><span class="lineNum">    6026 </span><span class="lineCov">        183 :         htbl = Z_ARRVAL_P(input);</span></a>
<a name="6027"><span class="lineNum">    6027 </span>            : </a>
<a name="6028"><span class="lineNum">    6028 </span><span class="lineCov">        183 :         if (zend_hash_num_elements(htbl) == 0) {</span></a>
<a name="6029"><span class="lineNum">    6029 </span><span class="lineCov">          6 :                 return;</span></a>
<a name="6030"><span class="lineNum">    6030 </span>            :         }</a>
<a name="6031"><span class="lineNum">    6031 </span>            : </a>
<a name="6032"><span class="lineNum">    6032 </span><span class="lineCov">        177 :         fci.retval = &amp;retval;</span></a>
<a name="6033"><span class="lineNum">    6033 </span><span class="lineCov">        177 :         fci.param_count = 2;</span></a>
<a name="6034"><span class="lineNum">    6034 </span>            : </a>
<a name="6035"><span class="lineNum">    6035 </span><span class="lineCov">     100413 :         ZEND_HASH_FOREACH_VAL(htbl, operand) {</span></a>
<a name="6036"><span class="lineNum">    6036 </span><span class="lineCov">      50121 :                 ZVAL_COPY_VALUE(&amp;args[0], return_value);</span></a>
<a name="6037"><span class="lineNum">    6037 </span><span class="lineCov">      50121 :                 ZVAL_COPY(&amp;args[1], operand);</span></a>
<a name="6038"><span class="lineNum">    6038 </span><span class="lineCov">      50121 :                 fci.params = args;</span></a>
<a name="6039"><span class="lineNum">    6039 </span>            : </a>
<a name="6040"><span class="lineNum">    6040 </span><span class="lineCov">     100242 :                 if (zend_call_function(&amp;fci, &amp;fci_cache) == SUCCESS &amp;&amp; Z_TYPE(retval) != IS_UNDEF) {</span></a>
<a name="6041"><span class="lineNum">    6041 </span><span class="lineCov">      50115 :                         zval_ptr_dtor(&amp;args[1]);</span></a>
<a name="6042"><span class="lineNum">    6042 </span><span class="lineCov">      50115 :                         zval_ptr_dtor(&amp;args[0]);</span></a>
<a name="6043"><span class="lineNum">    6043 </span><span class="lineCov">      50115 :                         ZVAL_COPY_VALUE(return_value, &amp;retval);</span></a>
<a name="6044"><span class="lineNum">    6044 </span><span class="lineCov">      50115 :                         if (UNEXPECTED(Z_ISREF_P(return_value))) {</span></a>
<a name="6045"><span class="lineNum">    6045 </span>            :                                 zend_unwrap_reference(return_value);</a>
<a name="6046"><span class="lineNum">    6046 </span>            :                         }</a>
<a name="6047"><span class="lineNum">    6047 </span>            :                 } else {</a>
<a name="6048"><span class="lineNum">    6048 </span><span class="lineCov">          6 :                         zval_ptr_dtor(&amp;args[1]);</span></a>
<a name="6049"><span class="lineNum">    6049 </span><span class="lineCov">          6 :                         zval_ptr_dtor(&amp;args[0]);</span></a>
<a name="6050"><span class="lineNum">    6050 </span><span class="lineCov">          6 :                         RETURN_NULL();</span></a>
<a name="6051"><span class="lineNum">    6051 </span>            :                 }</a>
<a name="6052"><span class="lineNum">    6052 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="6053"><span class="lineNum">    6053 </span>            : }</a>
<a name="6054"><span class="lineNum">    6054 </span>            : /* }}} */</a>
<a name="6055"><span class="lineNum">    6055 </span>            : </a>
<a name="6056"><span class="lineNum">    6056 </span>            : /* {{{ Filters elements from the array via the callback. */</a>
<a name="6057"><span class="lineNum">    6057 </span><span class="lineCov">        258 : PHP_FUNCTION(array_filter)</span></a>
<a name="6058"><span class="lineNum">    6058 </span>            : {</a>
<a name="6059"><span class="lineNum">    6059 </span>            :         zval *array;</a>
<a name="6060"><span class="lineNum">    6060 </span>            :         zval *operand;</a>
<a name="6061"><span class="lineNum">    6061 </span>            :         zval *key;</a>
<a name="6062"><span class="lineNum">    6062 </span>            :         zval args[2];</a>
<a name="6063"><span class="lineNum">    6063 </span>            :         zval retval;</a>
<a name="6064"><span class="lineNum">    6064 </span><span class="lineCov">        258 :         bool have_callback = 0;</span></a>
<a name="6065"><span class="lineNum">    6065 </span><span class="lineCov">        258 :         zend_long use_type = 0;</span></a>
<a name="6066"><span class="lineNum">    6066 </span>            :         zend_string *string_key;</a>
<a name="6067"><span class="lineNum">    6067 </span><span class="lineCov">        258 :         zend_fcall_info fci = empty_fcall_info;</span></a>
<a name="6068"><span class="lineNum">    6068 </span><span class="lineCov">        258 :         zend_fcall_info_cache fci_cache = empty_fcall_info_cache;</span></a>
<a name="6069"><span class="lineNum">    6069 </span>            :         zend_ulong num_key;</a>
<a name="6070"><span class="lineNum">    6070 </span>            : </a>
<a name="6071"><span class="lineNum">    6071 </span><span class="lineCov">        258 :         ZEND_PARSE_PARAMETERS_START(1, 3)</span></a>
<a name="6072"><span class="lineNum">    6072 </span><span class="lineCov">        444 :                 Z_PARAM_ARRAY(array)</span></a>
<a name="6073"><span class="lineNum">    6073 </span><span class="lineCov">        204 :                 Z_PARAM_OPTIONAL</span></a>
<a name="6074"><span class="lineNum">    6074 </span><span class="lineCov">        369 :                 Z_PARAM_FUNC_OR_NULL(fci, fci_cache)</span></a>
<a name="6075"><span class="lineNum">    6075 </span><span class="lineCov">        180 :                 Z_PARAM_LONG(use_type)</span></a>
<a name="6076"><span class="lineNum">    6076 </span><span class="lineCov">        258 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="6077"><span class="lineNum">    6077 </span>            : </a>
<a name="6078"><span class="lineNum">    6078 </span><span class="lineCov">        198 :         if (zend_hash_num_elements(Z_ARRVAL_P(array)) == 0) {</span></a>
<a name="6079"><span class="lineNum">    6079 </span><span class="lineCov">          6 :                 RETVAL_EMPTY_ARRAY();</span></a>
<a name="6080"><span class="lineNum">    6080 </span><span class="lineCov">          6 :                 return;</span></a>
<a name="6081"><span class="lineNum">    6081 </span>            :         }</a>
<a name="6082"><span class="lineNum">    6082 </span><span class="lineCov">        192 :         array_init(return_value);</span></a>
<a name="6083"><span class="lineNum">    6083 </span>            : </a>
<a name="6084"><span class="lineNum">    6084 </span><span class="lineCov">        192 :         if (ZEND_FCI_INITIALIZED(fci)) {</span></a>
<a name="6085"><span class="lineNum">    6085 </span><span class="lineCov">        153 :                 have_callback = 1;</span></a>
<a name="6086"><span class="lineNum">    6086 </span><span class="lineCov">        153 :                 fci.retval = &amp;retval;</span></a>
<a name="6087"><span class="lineNum">    6087 </span><span class="lineCov">        153 :                 if (use_type == ARRAY_FILTER_USE_BOTH) {</span></a>
<a name="6088"><span class="lineNum">    6088 </span><span class="lineCov">         12 :                         fci.param_count = 2;</span></a>
<a name="6089"><span class="lineNum">    6089 </span><span class="lineCov">         12 :                         key = &amp;args[1];</span></a>
<a name="6090"><span class="lineNum">    6090 </span>            :                 } else {</a>
<a name="6091"><span class="lineNum">    6091 </span><span class="lineCov">        141 :                         fci.param_count = 1;</span></a>
<a name="6092"><span class="lineNum">    6092 </span><span class="lineCov">        141 :                         key = &amp;args[0];</span></a>
<a name="6093"><span class="lineNum">    6093 </span>            :                 }</a>
<a name="6094"><span class="lineNum">    6094 </span>            :         }</a>
<a name="6095"><span class="lineNum">    6095 </span>            : </a>
<a name="6096"><span class="lineNum">    6096 </span><span class="lineCov">       2358 :         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(array), num_key, string_key, operand) {</span></a>
<a name="6097"><span class="lineNum">    6097 </span><span class="lineCov">       1083 :                 if (have_callback) {</span></a>
<a name="6098"><span class="lineNum">    6098 </span><span class="lineCov">        885 :                         if (use_type) {</span></a>
<a name="6099"><span class="lineNum">    6099 </span>            :                                 /* Set up the key */</a>
<a name="6100"><span class="lineNum">    6100 </span><span class="lineCov">         78 :                                 if (!string_key) {</span></a>
<a name="6101"><span class="lineNum">    6101 </span><span class="lineCov">         60 :                                         ZVAL_LONG(key, num_key);</span></a>
<a name="6102"><span class="lineNum">    6102 </span>            :                                 } else {</a>
<a name="6103"><span class="lineNum">    6103 </span><span class="lineCov">         42 :                                         ZVAL_STR_COPY(key, string_key);</span></a>
<a name="6104"><span class="lineNum">    6104 </span>            :                                 }</a>
<a name="6105"><span class="lineNum">    6105 </span>            :                         }</a>
<a name="6106"><span class="lineNum">    6106 </span><span class="lineCov">        885 :                         if (use_type != ARRAY_FILTER_USE_KEY) {</span></a>
<a name="6107"><span class="lineNum">    6107 </span><span class="lineCov">        873 :                                 ZVAL_COPY(&amp;args[0], operand);</span></a>
<a name="6108"><span class="lineNum">    6108 </span>            :                         }</a>
<a name="6109"><span class="lineNum">    6109 </span><span class="lineCov">        885 :                         fci.params = args;</span></a>
<a name="6110"><span class="lineNum">    6110 </span>            : </a>
<a name="6111"><span class="lineNum">    6111 </span><span class="lineCov">        885 :                         if (zend_call_function(&amp;fci, &amp;fci_cache) == SUCCESS) {</span></a>
<a name="6112"><span class="lineNum">    6112 </span>            :                                 int retval_true;</a>
<a name="6113"><span class="lineNum">    6113 </span>            : </a>
<a name="6114"><span class="lineNum">    6114 </span><span class="lineCov">        885 :                                 zval_ptr_dtor(&amp;args[0]);</span></a>
<a name="6115"><span class="lineNum">    6115 </span><span class="lineCov">        885 :                                 if (use_type == ARRAY_FILTER_USE_BOTH) {</span></a>
<a name="6116"><span class="lineNum">    6116 </span><span class="lineCov">         66 :                                         zval_ptr_dtor(&amp;args[1]);</span></a>
<a name="6117"><span class="lineNum">    6117 </span>            :                                 }</a>
<a name="6118"><span class="lineNum">    6118 </span><span class="lineCov">        885 :                                 retval_true = zend_is_true(&amp;retval);</span></a>
<a name="6119"><span class="lineNum">    6119 </span><span class="lineCov">        885 :                                 zval_ptr_dtor(&amp;retval);</span></a>
<a name="6120"><span class="lineNum">    6120 </span><span class="lineCov">        885 :                                 if (!retval_true) {</span></a>
<a name="6121"><span class="lineNum">    6121 </span><span class="lineCov">        405 :                                         continue;</span></a>
<a name="6122"><span class="lineNum">    6122 </span>            :                                 }</a>
<a name="6123"><span class="lineNum">    6123 </span>            :                         } else {</a>
<a name="6124"><span class="lineNum">    6124 </span><span class="lineNoCov">          0 :                                 zval_ptr_dtor(&amp;args[0]);</span></a>
<a name="6125"><span class="lineNum">    6125 </span><span class="lineNoCov">          0 :                                 if (use_type == ARRAY_FILTER_USE_BOTH) {</span></a>
<a name="6126"><span class="lineNum">    6126 </span><span class="lineNoCov">          0 :                                         zval_ptr_dtor(&amp;args[1]);</span></a>
<a name="6127"><span class="lineNum">    6127 </span>            :                                 }</a>
<a name="6128"><span class="lineNum">    6128 </span><span class="lineNoCov">          0 :                                 return;</span></a>
<a name="6129"><span class="lineNum">    6129 </span>            :                         }</a>
<a name="6130"><span class="lineNum">    6130 </span><span class="lineCov">        198 :                 } else if (!zend_is_true(operand)) {</span></a>
<a name="6131"><span class="lineNum">    6131 </span><span class="lineCov">         81 :                         continue;</span></a>
<a name="6132"><span class="lineNum">    6132 </span>            :                 }</a>
<a name="6133"><span class="lineNum">    6133 </span>            : </a>
<a name="6134"><span class="lineNum">    6134 </span><span class="lineCov">        597 :                 if (string_key) {</span></a>
<a name="6135"><span class="lineNum">    6135 </span><span class="lineCov">         51 :                         operand = zend_hash_add_new(Z_ARRVAL_P(return_value), string_key, operand);</span></a>
<a name="6136"><span class="lineNum">    6136 </span>            :                 } else {</a>
<a name="6137"><span class="lineNum">    6137 </span><span class="lineCov">        546 :                         operand = zend_hash_index_add_new(Z_ARRVAL_P(return_value), num_key, operand);</span></a>
<a name="6138"><span class="lineNum">    6138 </span>            :                 }</a>
<a name="6139"><span class="lineNum">    6139 </span><span class="lineCov">        597 :                 zval_add_ref(operand);</span></a>
<a name="6140"><span class="lineNum">    6140 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="6141"><span class="lineNum">    6141 </span>            : }</a>
<a name="6142"><span class="lineNum">    6142 </span>            : /* }}} */</a>
<a name="6143"><span class="lineNum">    6143 </span>            : </a>
<a name="6144"><span class="lineNum">    6144 </span>            : /* {{{ Applies the callback to the elements in given arrays. */</a>
<a name="6145"><span class="lineNum">    6145 </span><span class="lineCov">        972 : PHP_FUNCTION(array_map)</span></a>
<a name="6146"><span class="lineNum">    6146 </span>            : {</a>
<a name="6147"><span class="lineNum">    6147 </span><span class="lineCov">        972 :         zval *arrays = NULL;</span></a>
<a name="6148"><span class="lineNum">    6148 </span><span class="lineCov">        972 :         int n_arrays = 0;</span></a>
<a name="6149"><span class="lineNum">    6149 </span>            :         zval result;</a>
<a name="6150"><span class="lineNum">    6150 </span><span class="lineCov">        972 :         zend_fcall_info fci = empty_fcall_info;</span></a>
<a name="6151"><span class="lineNum">    6151 </span><span class="lineCov">        972 :         zend_fcall_info_cache fci_cache = empty_fcall_info_cache;</span></a>
<a name="6152"><span class="lineNum">    6152 </span>            :         int i;</a>
<a name="6153"><span class="lineNum">    6153 </span><span class="lineCov">        972 :         uint32_t k, maxlen = 0;</span></a>
<a name="6154"><span class="lineNum">    6154 </span>            : </a>
<a name="6155"><span class="lineNum">    6155 </span><span class="lineCov">        972 :         ZEND_PARSE_PARAMETERS_START(2, -1)</span></a>
<a name="6156"><span class="lineNum">    6156 </span><span class="lineCov">       1914 :                 Z_PARAM_FUNC_OR_NULL(fci, fci_cache)</span></a>
<a name="6157"><span class="lineNum">    6157 </span><span class="lineCov">        816 :                 Z_PARAM_VARIADIC('+', arrays, n_arrays)</span></a>
<a name="6158"><span class="lineNum">    6158 </span><span class="lineCov">        972 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="6159"><span class="lineNum">    6159 </span>            : </a>
<a name="6160"><span class="lineNum">    6160 </span><span class="lineCov">        816 :         if (n_arrays == 1) {</span></a>
<a name="6161"><span class="lineNum">    6161 </span>            :                 zend_ulong num_key;</a>
<a name="6162"><span class="lineNum">    6162 </span>            :                 zend_string *str_key;</a>
<a name="6163"><span class="lineNum">    6163 </span>            :                 zval *zv, arg;</a>
<a name="6164"><span class="lineNum">    6164 </span>            :                 int ret;</a>
<a name="6165"><span class="lineNum">    6165 </span>            : </a>
<a name="6166"><span class="lineNum">    6166 </span><span class="lineCov">        696 :                 if (Z_TYPE(arrays[0]) != IS_ARRAY) {</span></a>
<a name="6167"><span class="lineNum">    6167 </span><span class="lineCov">         12 :                         zend_argument_type_error(2, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;arrays[0]));</span></a>
<a name="6168"><span class="lineNum">    6168 </span><span class="lineCov">        141 :                         RETURN_THROWS();</span></a>
<a name="6169"><span class="lineNum">    6169 </span>            :                 }</a>
<a name="6170"><span class="lineNum">    6170 </span><span class="lineCov">        684 :                 maxlen = zend_hash_num_elements(Z_ARRVAL(arrays[0]));</span></a>
<a name="6171"><span class="lineNum">    6171 </span>            : </a>
<a name="6172"><span class="lineNum">    6172 </span>            :                 /* Short-circuit: if no callback and only one array, just return it. */</a>
<a name="6173"><span class="lineNum">    6173 </span><span class="lineCov">        684 :                 if (!ZEND_FCI_INITIALIZED(fci) || !maxlen) {</span></a>
<a name="6174"><span class="lineNum">    6174 </span><span class="lineCov">        105 :                         ZVAL_COPY(return_value, &amp;arrays[0]);</span></a>
<a name="6175"><span class="lineNum">    6175 </span><span class="lineCov">        105 :                         return;</span></a>
<a name="6176"><span class="lineNum">    6176 </span>            :                 }</a>
<a name="6177"><span class="lineNum">    6177 </span>            : </a>
<a name="6178"><span class="lineNum">    6178 </span><span class="lineCov">        579 :                 array_init_size(return_value, maxlen);</span></a>
<a name="6179"><span class="lineNum">    6179 </span><span class="lineCov">        579 :                 zend_hash_real_init(Z_ARRVAL_P(return_value), HT_IS_PACKED(Z_ARRVAL(arrays[0])));</span></a>
<a name="6180"><span class="lineNum">    6180 </span>            : </a>
<a name="6181"><span class="lineNum">    6181 </span><span class="lineCov">       5820 :                 ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL(arrays[0]), num_key, str_key, zv) {</span></a>
<a name="6182"><span class="lineNum">    6182 </span><span class="lineCov">       2625 :                         fci.retval = &amp;result;</span></a>
<a name="6183"><span class="lineNum">    6183 </span><span class="lineCov">       2625 :                         fci.param_count = 1;</span></a>
<a name="6184"><span class="lineNum">    6184 </span><span class="lineCov">       2625 :                         fci.params = &amp;arg;</span></a>
<a name="6185"><span class="lineNum">    6185 </span>            : </a>
<a name="6186"><span class="lineNum">    6186 </span><span class="lineCov">       2625 :                         ZVAL_COPY(&amp;arg, zv);</span></a>
<a name="6187"><span class="lineNum">    6187 </span><span class="lineCov">       2625 :                         ret = zend_call_function(&amp;fci, &amp;fci_cache);</span></a>
<a name="6188"><span class="lineNum">    6188 </span>            :                         i_zval_ptr_dtor(&amp;arg);</a>
<a name="6189"><span class="lineNum">    6189 </span><span class="lineCov">       5250 :                         if (ret != SUCCESS || Z_TYPE(result) == IS_UNDEF) {</span></a>
<a name="6190"><span class="lineNum">    6190 </span><span class="lineCov">         24 :                                 zend_array_destroy(Z_ARR_P(return_value));</span></a>
<a name="6191"><span class="lineNum">    6191 </span><span class="lineCov">         24 :                                 RETURN_NULL();</span></a>
<a name="6192"><span class="lineNum">    6192 </span>            :                         }</a>
<a name="6193"><span class="lineNum">    6193 </span><span class="lineCov">       2601 :                         if (str_key) {</span></a>
<a name="6194"><span class="lineNum">    6194 </span><span class="lineCov">        369 :                                 _zend_hash_append(Z_ARRVAL_P(return_value), str_key, &amp;result);</span></a>
<a name="6195"><span class="lineNum">    6195 </span>            :                         } else {</a>
<a name="6196"><span class="lineNum">    6196 </span><span class="lineCov">       2232 :                                 zend_hash_index_add_new(Z_ARRVAL_P(return_value), num_key, &amp;result);</span></a>
<a name="6197"><span class="lineNum">    6197 </span>            :                         }</a>
<a name="6198"><span class="lineNum">    6198 </span>            :                 } ZEND_HASH_FOREACH_END();</a>
<a name="6199"><span class="lineNum">    6199 </span>            :         } else {</a>
<a name="6200"><span class="lineNum">    6200 </span><span class="lineCov">        120 :                 uint32_t *array_pos = (HashPosition *)ecalloc(n_arrays, sizeof(HashPosition));</span></a>
<a name="6201"><span class="lineNum">    6201 </span>            : </a>
<a name="6202"><span class="lineNum">    6202 </span><span class="lineCov">        303 :                 for (i = 0; i &lt; n_arrays; i++) {</span></a>
<a name="6203"><span class="lineNum">    6203 </span><span class="lineCov">        462 :                         if (Z_TYPE(arrays[i]) != IS_ARRAY) {</span></a>
<a name="6204"><span class="lineNum">    6204 </span><span class="lineCov">         48 :                                 zend_argument_type_error(i + 2, &quot;must be of type array, %s given&quot;, zend_zval_type_name(&amp;arrays[i]));</span></a>
<a name="6205"><span class="lineNum">    6205 </span><span class="lineCov">         48 :                                 efree(array_pos);</span></a>
<a name="6206"><span class="lineNum">    6206 </span><span class="lineCov">         48 :                                 RETURN_THROWS();</span></a>
<a name="6207"><span class="lineNum">    6207 </span>            :                         }</a>
<a name="6208"><span class="lineNum">    6208 </span><span class="lineCov">        183 :                         if (zend_hash_num_elements(Z_ARRVAL(arrays[i])) &gt; maxlen) {</span></a>
<a name="6209"><span class="lineNum">    6209 </span><span class="lineCov">         69 :                                 maxlen = zend_hash_num_elements(Z_ARRVAL(arrays[i]));</span></a>
<a name="6210"><span class="lineNum">    6210 </span>            :                         }</a>
<a name="6211"><span class="lineNum">    6211 </span>            :                 }</a>
<a name="6212"><span class="lineNum">    6212 </span>            : </a>
<a name="6213"><span class="lineNum">    6213 </span><span class="lineCov">         72 :                 array_init_size(return_value, maxlen);</span></a>
<a name="6214"><span class="lineNum">    6214 </span>            : </a>
<a name="6215"><span class="lineNum">    6215 </span><span class="lineCov">         72 :                 if (!ZEND_FCI_INITIALIZED(fci)) {</span></a>
<a name="6216"><span class="lineNum">    6216 </span>            :                         zval zv;</a>
<a name="6217"><span class="lineNum">    6217 </span>            : </a>
<a name="6218"><span class="lineNum">    6218 </span>            :                         /* We iterate through all the arrays at once. */</a>
<a name="6219"><span class="lineNum">    6219 </span><span class="lineCov">         72 :                         for (k = 0; k &lt; maxlen; k++) {</span></a>
<a name="6220"><span class="lineNum">    6220 </span>            : </a>
<a name="6221"><span class="lineNum">    6221 </span>            :                                 /* If no callback, the result will be an array, consisting of current</a>
<a name="6222"><span class="lineNum">    6222 </span>            :                                  * entries from all arrays. */</a>
<a name="6223"><span class="lineNum">    6223 </span><span class="lineCov">         51 :                                 array_init_size(&amp;result, n_arrays);</span></a>
<a name="6224"><span class="lineNum">    6224 </span>            : </a>
<a name="6225"><span class="lineNum">    6225 </span><span class="lineCov">        189 :                                 for (i = 0; i &lt; n_arrays; i++) {</span></a>
<a name="6226"><span class="lineNum">    6226 </span>            :                                         /* If this array still has elements, add the current one to the</a>
<a name="6227"><span class="lineNum">    6227 </span>            :                                          * parameter list, otherwise use null value. */</a>
<a name="6228"><span class="lineNum">    6228 </span><span class="lineCov">        138 :                                         uint32_t pos = array_pos[i];</span></a>
<a name="6229"><span class="lineNum">    6229 </span><span class="lineCov">        138 :                                         if (HT_IS_PACKED(Z_ARRVAL(arrays[i]))) {</span></a>
<a name="6230"><span class="lineNum">    6230 </span>            :                                                 while (1) {</a>
<a name="6231"><span class="lineNum">    6231 </span><span class="lineCov">        108 :                                                         if (pos &gt;= Z_ARRVAL(arrays[i])-&gt;nNumUsed) {</span></a>
<a name="6232"><span class="lineNum">    6232 </span><span class="lineNoCov">          0 :                                                                 ZVAL_NULL(&amp;zv);</span></a>
<a name="6233"><span class="lineNum">    6233 </span><span class="lineNoCov">          0 :                                                                 break;</span></a>
<a name="6234"><span class="lineNum">    6234 </span><span class="lineCov">        216 :                                                         } else if (Z_TYPE(Z_ARRVAL(arrays[i])-&gt;arPacked[pos]) != IS_UNDEF) {</span></a>
<a name="6235"><span class="lineNum">    6235 </span><span class="lineCov">        108 :                                                                 ZVAL_COPY(&amp;zv, &amp;Z_ARRVAL(arrays[i])-&gt;arPacked[pos]);</span></a>
<a name="6236"><span class="lineNum">    6236 </span><span class="lineCov">        108 :                                                                 array_pos[i] = pos + 1;</span></a>
<a name="6237"><span class="lineNum">    6237 </span><span class="lineCov">        108 :                                                                 break;</span></a>
<a name="6238"><span class="lineNum">    6238 </span>            :                                                         }</a>
<a name="6239"><span class="lineNum">    6239 </span><span class="lineNoCov">          0 :                                                         pos++;</span></a>
<a name="6240"><span class="lineNum">    6240 </span>            :                                                 }</a>
<a name="6241"><span class="lineNum">    6241 </span>            :                                         } else {</a>
<a name="6242"><span class="lineNum">    6242 </span>            :                                                 while (1) {</a>
<a name="6243"><span class="lineNum">    6243 </span><span class="lineCov">         30 :                                                         if (pos &gt;= Z_ARRVAL(arrays[i])-&gt;nNumUsed) {</span></a>
<a name="6244"><span class="lineNum">    6244 </span><span class="lineNoCov">          0 :                                                                 ZVAL_NULL(&amp;zv);</span></a>
<a name="6245"><span class="lineNum">    6245 </span><span class="lineNoCov">          0 :                                                                 break;</span></a>
<a name="6246"><span class="lineNum">    6246 </span><span class="lineCov">         60 :                                                         } else if (Z_TYPE(Z_ARRVAL(arrays[i])-&gt;arData[pos].val) != IS_UNDEF) {</span></a>
<a name="6247"><span class="lineNum">    6247 </span><span class="lineCov">         30 :                                                                 ZVAL_COPY(&amp;zv, &amp;Z_ARRVAL(arrays[i])-&gt;arData[pos].val);</span></a>
<a name="6248"><span class="lineNum">    6248 </span><span class="lineCov">         30 :                                                                 array_pos[i] = pos + 1;</span></a>
<a name="6249"><span class="lineNum">    6249 </span><span class="lineCov">         30 :                                                                 break;</span></a>
<a name="6250"><span class="lineNum">    6250 </span>            :                                                         }</a>
<a name="6251"><span class="lineNum">    6251 </span><span class="lineNoCov">          0 :                                                         pos++;</span></a>
<a name="6252"><span class="lineNum">    6252 </span>            :                                                 }</a>
<a name="6253"><span class="lineNum">    6253 </span>            :                                         }</a>
<a name="6254"><span class="lineNum">    6254 </span><span class="lineCov">        138 :                                         zend_hash_next_index_insert_new(Z_ARRVAL(result), &amp;zv);</span></a>
<a name="6255"><span class="lineNum">    6255 </span>            :                                 }</a>
<a name="6256"><span class="lineNum">    6256 </span>            : </a>
<a name="6257"><span class="lineNum">    6257 </span><span class="lineCov">         51 :                                 zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), &amp;result);</span></a>
<a name="6258"><span class="lineNum">    6258 </span>            :                         }</a>
<a name="6259"><span class="lineNum">    6259 </span>            :                 } else {</a>
<a name="6260"><span class="lineNum">    6260 </span><span class="lineCov">         51 :                         zval *params = (zval *)safe_emalloc(n_arrays, sizeof(zval), 0);</span></a>
<a name="6261"><span class="lineNum">    6261 </span>            : </a>
<a name="6262"><span class="lineNum">    6262 </span>            :                         /* We iterate through all the arrays at once. */</a>
<a name="6263"><span class="lineNum">    6263 </span><span class="lineCov">        183 :                         for (k = 0; k &lt; maxlen; k++) {</span></a>
<a name="6264"><span class="lineNum">    6264 </span><span class="lineCov">        420 :                                 for (i = 0; i &lt; n_arrays; i++) {</span></a>
<a name="6265"><span class="lineNum">    6265 </span>            :                                         /* If this array still has elements, add the current one to the</a>
<a name="6266"><span class="lineNum">    6266 </span>            :                                          * parameter list, otherwise use null value. */</a>
<a name="6267"><span class="lineNum">    6267 </span><span class="lineCov">        285 :                                         uint32_t pos = array_pos[i];</span></a>
<a name="6268"><span class="lineNum">    6268 </span><span class="lineCov">        285 :                                         if (HT_IS_PACKED(Z_ARRVAL(arrays[i]))) {</span></a>
<a name="6269"><span class="lineNum">    6269 </span>            :                                                 while (1) {</a>
<a name="6270"><span class="lineNum">    6270 </span><span class="lineCov">        216 :                                                         if (pos &gt;= Z_ARRVAL(arrays[i])-&gt;nNumUsed) {</span></a>
<a name="6271"><span class="lineNum">    6271 </span><span class="lineCov">          9 :                                                                 ZVAL_NULL(&amp;params[i]);</span></a>
<a name="6272"><span class="lineNum">    6272 </span><span class="lineCov">          9 :                                                                 break;</span></a>
<a name="6273"><span class="lineNum">    6273 </span><span class="lineCov">        414 :                                                         } else if (Z_TYPE(Z_ARRVAL(arrays[i])-&gt;arPacked[pos]) != IS_UNDEF) {</span></a>
<a name="6274"><span class="lineNum">    6274 </span><span class="lineCov">        207 :                                                                 ZVAL_COPY(&amp;params[i], &amp;Z_ARRVAL(arrays[i])-&gt;arPacked[pos]);</span></a>
<a name="6275"><span class="lineNum">    6275 </span><span class="lineCov">        207 :                                                                 array_pos[i] = pos + 1;</span></a>
<a name="6276"><span class="lineNum">    6276 </span><span class="lineCov">        207 :                                                                 break;</span></a>
<a name="6277"><span class="lineNum">    6277 </span>            :                                                         }</a>
<a name="6278"><span class="lineNum">    6278 </span><span class="lineNoCov">          0 :                                                         pos++;</span></a>
<a name="6279"><span class="lineNum">    6279 </span>            :                                                 }</a>
<a name="6280"><span class="lineNum">    6280 </span>            :                                         } else {</a>
<a name="6281"><span class="lineNum">    6281 </span>            :                                                 while (1) {</a>
<a name="6282"><span class="lineNum">    6282 </span><span class="lineCov">         69 :                                                         if (pos &gt;= Z_ARRVAL(arrays[i])-&gt;nNumUsed) {</span></a>
<a name="6283"><span class="lineNum">    6283 </span><span class="lineCov">         27 :                                                                 ZVAL_NULL(&amp;params[i]);</span></a>
<a name="6284"><span class="lineNum">    6284 </span><span class="lineCov">         27 :                                                                 break;</span></a>
<a name="6285"><span class="lineNum">    6285 </span><span class="lineCov">         84 :                                                         } else if (Z_TYPE(Z_ARRVAL(arrays[i])-&gt;arData[pos].val) != IS_UNDEF) {</span></a>
<a name="6286"><span class="lineNum">    6286 </span><span class="lineCov">         42 :                                                                 ZVAL_COPY(&amp;params[i], &amp;Z_ARRVAL(arrays[i])-&gt;arData[pos].val);</span></a>
<a name="6287"><span class="lineNum">    6287 </span><span class="lineCov">         42 :                                                                 array_pos[i] = pos + 1;</span></a>
<a name="6288"><span class="lineNum">    6288 </span><span class="lineCov">         42 :                                                                 break;</span></a>
<a name="6289"><span class="lineNum">    6289 </span>            :                                                         }</a>
<a name="6290"><span class="lineNum">    6290 </span><span class="lineNoCov">          0 :                                                         pos++;</span></a>
<a name="6291"><span class="lineNum">    6291 </span>            :                                                 }</a>
<a name="6292"><span class="lineNum">    6292 </span>            :                                         }</a>
<a name="6293"><span class="lineNum">    6293 </span>            :                                 }</a>
<a name="6294"><span class="lineNum">    6294 </span>            : </a>
<a name="6295"><span class="lineNum">    6295 </span><span class="lineCov">        135 :                                 fci.retval = &amp;result;</span></a>
<a name="6296"><span class="lineNum">    6296 </span><span class="lineCov">        135 :                                 fci.param_count = n_arrays;</span></a>
<a name="6297"><span class="lineNum">    6297 </span><span class="lineCov">        135 :                                 fci.params = params;</span></a>
<a name="6298"><span class="lineNum">    6298 </span>            : </a>
<a name="6299"><span class="lineNum">    6299 </span><span class="lineCov">        270 :                                 if (zend_call_function(&amp;fci, &amp;fci_cache) != SUCCESS || Z_TYPE(result) == IS_UNDEF) {</span></a>
<a name="6300"><span class="lineNum">    6300 </span><span class="lineCov">          3 :                                         efree(array_pos);</span></a>
<a name="6301"><span class="lineNum">    6301 </span><span class="lineCov">          3 :                                         zend_array_destroy(Z_ARR_P(return_value));</span></a>
<a name="6302"><span class="lineNum">    6302 </span><span class="lineCov">          9 :                                         for (i = 0; i &lt; n_arrays; i++) {</span></a>
<a name="6303"><span class="lineNum">    6303 </span><span class="lineCov">          6 :                                                 zval_ptr_dtor(&amp;params[i]);</span></a>
<a name="6304"><span class="lineNum">    6304 </span>            :                                         }</a>
<a name="6305"><span class="lineNum">    6305 </span><span class="lineCov">          3 :                                         efree(params);</span></a>
<a name="6306"><span class="lineNum">    6306 </span><span class="lineCov">          3 :                                         RETURN_NULL();</span></a>
<a name="6307"><span class="lineNum">    6307 </span>            :                                 } else {</a>
<a name="6308"><span class="lineNum">    6308 </span><span class="lineCov">        411 :                                         for (i = 0; i &lt; n_arrays; i++) {</span></a>
<a name="6309"><span class="lineNum">    6309 </span><span class="lineCov">        279 :                                                 zval_ptr_dtor(&amp;params[i]);</span></a>
<a name="6310"><span class="lineNum">    6310 </span>            :                                         }</a>
<a name="6311"><span class="lineNum">    6311 </span>            :                                 }</a>
<a name="6312"><span class="lineNum">    6312 </span>            : </a>
<a name="6313"><span class="lineNum">    6313 </span><span class="lineCov">        132 :                                 zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), &amp;result);</span></a>
<a name="6314"><span class="lineNum">    6314 </span>            :                         }</a>
<a name="6315"><span class="lineNum">    6315 </span>            : </a>
<a name="6316"><span class="lineNum">    6316 </span><span class="lineCov">         48 :                         efree(params);</span></a>
<a name="6317"><span class="lineNum">    6317 </span>            :                 }</a>
<a name="6318"><span class="lineNum">    6318 </span><span class="lineCov">         69 :                 efree(array_pos);</span></a>
<a name="6319"><span class="lineNum">    6319 </span>            :         }</a>
<a name="6320"><span class="lineNum">    6320 </span>            : }</a>
<a name="6321"><span class="lineNum">    6321 </span>            : /* }}} */</a>
<a name="6322"><span class="lineNum">    6322 </span>            : </a>
<a name="6323"><span class="lineNum">    6323 </span>            : /* {{{ Checks if the given key or index exists in the array */</a>
<a name="6324"><span class="lineNum">    6324 </span><span class="lineCov">        171 : PHP_FUNCTION(array_key_exists)</span></a>
<a name="6325"><span class="lineNum">    6325 </span>            : {</a>
<a name="6326"><span class="lineNum">    6326 </span>            :         zval *key;</a>
<a name="6327"><span class="lineNum">    6327 </span>            :         HashTable *ht;</a>
<a name="6328"><span class="lineNum">    6328 </span>            : </a>
<a name="6329"><span class="lineNum">    6329 </span><span class="lineCov">        171 :         ZEND_PARSE_PARAMETERS_START(2, 2)</span></a>
<a name="6330"><span class="lineNum">    6330 </span><span class="lineCov">         75 :                 Z_PARAM_ZVAL(key)</span></a>
<a name="6331"><span class="lineNum">    6331 </span><span class="lineCov">        150 :                 Z_PARAM_ARRAY_HT(ht)</span></a>
<a name="6332"><span class="lineNum">    6332 </span><span class="lineCov">        171 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="6333"><span class="lineNum">    6333 </span>            : </a>
<a name="6334"><span class="lineNum">    6334 </span><span class="lineCov">        126 :         switch (Z_TYPE_P(key)) {</span></a>
<a name="6335"><span class="lineNum">    6335 </span><span class="lineCov">         12 :                 case IS_STRING:</span></a>
<a name="6336"><span class="lineNum">    6336 </span><span class="lineCov">         24 :                         RETVAL_BOOL(zend_symtable_exists(ht, Z_STR_P(key)));</span></a>
<a name="6337"><span class="lineNum">    6337 </span><span class="lineCov">         12 :                         break;</span></a>
<a name="6338"><span class="lineNum">    6338 </span><span class="lineCov">         51 :                 case IS_LONG:</span></a>
<a name="6339"><span class="lineNum">    6339 </span><span class="lineCov">        102 :                         RETVAL_BOOL(zend_hash_index_exists(ht, Z_LVAL_P(key)));</span></a>
<a name="6340"><span class="lineNum">    6340 </span><span class="lineCov">         51 :                         break;</span></a>
<a name="6341"><span class="lineNum">    6341 </span><span class="lineNoCov">          0 :                 case IS_NULL:</span></a>
<a name="6342"><span class="lineNum">    6342 </span><span class="lineNoCov">          0 :                         RETVAL_BOOL(zend_hash_exists(ht, ZSTR_EMPTY_ALLOC()));</span></a>
<a name="6343"><span class="lineNum">    6343 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="6344"><span class="lineNum">    6344 </span><span class="lineNoCov">          0 :                 case IS_DOUBLE:</span></a>
<a name="6345"><span class="lineNum">    6345 </span><span class="lineNoCov">          0 :                         RETVAL_BOOL(zend_hash_index_exists(ht, zend_dval_to_lval_safe(Z_DVAL_P(key))));</span></a>
<a name="6346"><span class="lineNum">    6346 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="6347"><span class="lineNum">    6347 </span><span class="lineNoCov">          0 :                 case IS_FALSE:</span></a>
<a name="6348"><span class="lineNum">    6348 </span><span class="lineNoCov">          0 :                         RETVAL_BOOL(zend_hash_index_exists(ht, 0));</span></a>
<a name="6349"><span class="lineNum">    6349 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="6350"><span class="lineNum">    6350 </span><span class="lineNoCov">          0 :                 case IS_TRUE:</span></a>
<a name="6351"><span class="lineNum">    6351 </span><span class="lineNoCov">          0 :                         RETVAL_BOOL(zend_hash_index_exists(ht, 1));</span></a>
<a name="6352"><span class="lineNum">    6352 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="6353"><span class="lineNum">    6353 </span><span class="lineNoCov">          0 :                 case IS_RESOURCE:</span></a>
<a name="6354"><span class="lineNum">    6354 </span><span class="lineNoCov">          0 :                         zend_use_resource_as_offset(key);</span></a>
<a name="6355"><span class="lineNum">    6355 </span><span class="lineNoCov">          0 :                         RETVAL_BOOL(zend_hash_index_exists(ht, Z_RES_HANDLE_P(key)));</span></a>
<a name="6356"><span class="lineNum">    6356 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="6357"><span class="lineNum">    6357 </span><span class="lineNoCov">          0 :                 default:</span></a>
<a name="6358"><span class="lineNum">    6358 </span><span class="lineNoCov">          0 :                         zend_argument_type_error(1, &quot;must be a valid array offset type&quot;);</span></a>
<a name="6359"><span class="lineNum">    6359 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="6360"><span class="lineNum">    6360 </span>            :         }</a>
<a name="6361"><span class="lineNum">    6361 </span>            : }</a>
<a name="6362"><span class="lineNum">    6362 </span>            : /* }}} */</a>
<a name="6363"><span class="lineNum">    6363 </span>            : </a>
<a name="6364"><span class="lineNum">    6364 </span>            : /* {{{ Split array into chunks */</a>
<a name="6365"><span class="lineNum">    6365 </span><span class="lineCov">        915 : PHP_FUNCTION(array_chunk)</span></a>
<a name="6366"><span class="lineNum">    6366 </span>            : {</a>
<a name="6367"><span class="lineNum">    6367 </span>            :         int num_in;</a>
<a name="6368"><span class="lineNum">    6368 </span><span class="lineCov">        915 :         zend_long size, current = 0;</span></a>
<a name="6369"><span class="lineNum">    6369 </span>            :         zend_string *str_key;</a>
<a name="6370"><span class="lineNum">    6370 </span>            :         zend_ulong num_key;</a>
<a name="6371"><span class="lineNum">    6371 </span><span class="lineCov">        915 :         bool preserve_keys = 0;</span></a>
<a name="6372"><span class="lineNum">    6372 </span><span class="lineCov">        915 :         zval *input = NULL;</span></a>
<a name="6373"><span class="lineNum">    6373 </span>            :         zval chunk;</a>
<a name="6374"><span class="lineNum">    6374 </span>            :         zval *entry;</a>
<a name="6375"><span class="lineNum">    6375 </span>            : </a>
<a name="6376"><span class="lineNum">    6376 </span><span class="lineCov">        915 :         ZEND_PARSE_PARAMETERS_START(2, 3)</span></a>
<a name="6377"><span class="lineNum">    6377 </span><span class="lineCov">       1746 :                 Z_PARAM_ARRAY(input)</span></a>
<a name="6378"><span class="lineNum">    6378 </span><span class="lineCov">       1722 :                 Z_PARAM_LONG(size)</span></a>
<a name="6379"><span class="lineNum">    6379 </span><span class="lineCov">        861 :                 Z_PARAM_OPTIONAL</span></a>
<a name="6380"><span class="lineNum">    6380 </span><span class="lineCov">       1431 :                 Z_PARAM_BOOL(preserve_keys)</span></a>
<a name="6381"><span class="lineNum">    6381 </span><span class="lineCov">        915 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="6382"><span class="lineNum">    6382 </span>            : </a>
<a name="6383"><span class="lineNum">    6383 </span>            :         /* Do bounds checking for size parameter. */</a>
<a name="6384"><span class="lineNum">    6384 </span><span class="lineCov">        861 :         if (size &lt; 1) {</span></a>
<a name="6385"><span class="lineNum">    6385 </span><span class="lineCov">         24 :                 zend_argument_value_error(2, &quot;must be greater than 0&quot;);</span></a>
<a name="6386"><span class="lineNum">    6386 </span><span class="lineCov">         24 :                 RETURN_THROWS();</span></a>
<a name="6387"><span class="lineNum">    6387 </span>            :         }</a>
<a name="6388"><span class="lineNum">    6388 </span>            : </a>
<a name="6389"><span class="lineNum">    6389 </span><span class="lineCov">        837 :         num_in = zend_hash_num_elements(Z_ARRVAL_P(input));</span></a>
<a name="6390"><span class="lineNum">    6390 </span>            : </a>
<a name="6391"><span class="lineNum">    6391 </span><span class="lineCov">        837 :         if (size &gt; num_in) {</span></a>
<a name="6392"><span class="lineNum">    6392 </span><span class="lineCov">         33 :                 if (num_in == 0) {</span></a>
<a name="6393"><span class="lineNum">    6393 </span><span class="lineCov">          9 :                         RETVAL_EMPTY_ARRAY();</span></a>
<a name="6394"><span class="lineNum">    6394 </span><span class="lineCov">          9 :                         return;</span></a>
<a name="6395"><span class="lineNum">    6395 </span>            :                 }</a>
<a name="6396"><span class="lineNum">    6396 </span><span class="lineCov">         24 :                 size = num_in;</span></a>
<a name="6397"><span class="lineNum">    6397 </span>            :         }</a>
<a name="6398"><span class="lineNum">    6398 </span>            : </a>
<a name="6399"><span class="lineNum">    6399 </span><span class="lineCov">        828 :         array_init_size(return_value, (uint32_t)(((num_in - 1) / size) + 1));</span></a>
<a name="6400"><span class="lineNum">    6400 </span>            : </a>
<a name="6401"><span class="lineNum">    6401 </span><span class="lineCov">        828 :         ZVAL_UNDEF(&amp;chunk);</span></a>
<a name="6402"><span class="lineNum">    6402 </span>            : </a>
<a name="6403"><span class="lineNum">    6403 </span><span class="lineCov">       9432 :         ZEND_HASH_FOREACH_KEY_VAL(Z_ARRVAL_P(input), num_key, str_key, entry) {</span></a>
<a name="6404"><span class="lineNum">    6404 </span>            :                 /* If new chunk, create and initialize it. */</a>
<a name="6405"><span class="lineNum">    6405 </span><span class="lineCov">       4230 :                 if (Z_TYPE(chunk) == IS_UNDEF) {</span></a>
<a name="6406"><span class="lineNum">    6406 </span><span class="lineCov">       1944 :                         array_init_size(&amp;chunk, (uint32_t)size);</span></a>
<a name="6407"><span class="lineNum">    6407 </span>            :                 }</a>
<a name="6408"><span class="lineNum">    6408 </span>            : </a>
<a name="6409"><span class="lineNum">    6409 </span>            :                 /* Add entry to the chunk, preserving keys if necessary. */</a>
<a name="6410"><span class="lineNum">    6410 </span><span class="lineCov">       4230 :                 if (preserve_keys) {</span></a>
<a name="6411"><span class="lineNum">    6411 </span><span class="lineCov">       1425 :                         if (str_key) {</span></a>
<a name="6412"><span class="lineNum">    6412 </span><span class="lineCov">        279 :                                 entry = zend_hash_add_new(Z_ARRVAL(chunk), str_key, entry);</span></a>
<a name="6413"><span class="lineNum">    6413 </span>            :                         } else {</a>
<a name="6414"><span class="lineNum">    6414 </span><span class="lineCov">       1146 :                                 entry = zend_hash_index_add_new(Z_ARRVAL(chunk), num_key, entry);</span></a>
<a name="6415"><span class="lineNum">    6415 </span>            :                         }</a>
<a name="6416"><span class="lineNum">    6416 </span>            :                 } else {</a>
<a name="6417"><span class="lineNum">    6417 </span><span class="lineCov">       2805 :                         entry = zend_hash_next_index_insert(Z_ARRVAL(chunk), entry);</span></a>
<a name="6418"><span class="lineNum">    6418 </span>            :                 }</a>
<a name="6419"><span class="lineNum">    6419 </span><span class="lineCov">       4230 :                 zval_add_ref(entry);</span></a>
<a name="6420"><span class="lineNum">    6420 </span>            : </a>
<a name="6421"><span class="lineNum">    6421 </span>            :                 /* If reached the chunk size, add it to the result array, and reset the</a>
<a name="6422"><span class="lineNum">    6422 </span>            :                  * pointer. */</a>
<a name="6423"><span class="lineNum">    6423 </span><span class="lineCov">       4230 :                 if (!(++current % size)) {</span></a>
<a name="6424"><span class="lineNum">    6424 </span>            :                         add_next_index_zval(return_value, &amp;chunk);</a>
<a name="6425"><span class="lineNum">    6425 </span><span class="lineCov">       1623 :                         ZVAL_UNDEF(&amp;chunk);</span></a>
<a name="6426"><span class="lineNum">    6426 </span>            :                 }</a>
<a name="6427"><span class="lineNum">    6427 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="6428"><span class="lineNum">    6428 </span>            : </a>
<a name="6429"><span class="lineNum">    6429 </span>            :         /* Add the final chunk if there is one. */</a>
<a name="6430"><span class="lineNum">    6430 </span><span class="lineCov">        828 :         if (Z_TYPE(chunk) != IS_UNDEF) {</span></a>
<a name="6431"><span class="lineNum">    6431 </span>            :                 add_next_index_zval(return_value, &amp;chunk);</a>
<a name="6432"><span class="lineNum">    6432 </span>            :         }</a>
<a name="6433"><span class="lineNum">    6433 </span>            : }</a>
<a name="6434"><span class="lineNum">    6434 </span>            : /* }}} */</a>
<a name="6435"><span class="lineNum">    6435 </span>            : </a>
<a name="6436"><span class="lineNum">    6436 </span>            : /* {{{ Creates an array by using the elements of the first parameter as keys and the elements of the second as the corresponding values */</a>
<a name="6437"><span class="lineNum">    6437 </span><span class="lineCov">        270 : PHP_FUNCTION(array_combine)</span></a>
<a name="6438"><span class="lineNum">    6438 </span>            : {</a>
<a name="6439"><span class="lineNum">    6439 </span>            :         HashTable *values, *keys;</a>
<a name="6440"><span class="lineNum">    6440 </span><span class="lineCov">        270 :         uint32_t pos_values = 0;</span></a>
<a name="6441"><span class="lineNum">    6441 </span>            :         zval *entry_keys, *entry_values;</a>
<a name="6442"><span class="lineNum">    6442 </span>            :         int num_keys, num_values;</a>
<a name="6443"><span class="lineNum">    6443 </span>            : </a>
<a name="6444"><span class="lineNum">    6444 </span><span class="lineCov">        270 :         ZEND_PARSE_PARAMETERS_START(2, 2)</span></a>
<a name="6445"><span class="lineNum">    6445 </span><span class="lineCov">        444 :                 Z_PARAM_ARRAY_HT(keys)</span></a>
<a name="6446"><span class="lineNum">    6446 </span><span class="lineCov">        432 :                 Z_PARAM_ARRAY_HT(values)</span></a>
<a name="6447"><span class="lineNum">    6447 </span><span class="lineCov">        291 :         ZEND_PARSE_PARAMETERS_END();</span></a>
<a name="6448"><span class="lineNum">    6448 </span>            : </a>
<a name="6449"><span class="lineNum">    6449 </span><span class="lineCov">        216 :         num_keys = zend_hash_num_elements(keys);</span></a>
<a name="6450"><span class="lineNum">    6450 </span><span class="lineCov">        216 :         num_values = zend_hash_num_elements(values);</span></a>
<a name="6451"><span class="lineNum">    6451 </span>            : </a>
<a name="6452"><span class="lineNum">    6452 </span><span class="lineCov">        216 :         if (num_keys != num_values) {</span></a>
<a name="6453"><span class="lineNum">    6453 </span><span class="lineCov">          9 :                 zend_argument_value_error(1, &quot;and argument #2 ($values) must have the same number of elements&quot;);</span></a>
<a name="6454"><span class="lineNum">    6454 </span><span class="lineCov">          9 :                 RETURN_THROWS();</span></a>
<a name="6455"><span class="lineNum">    6455 </span>            :         }</a>
<a name="6456"><span class="lineNum">    6456 </span>            : </a>
<a name="6457"><span class="lineNum">    6457 </span><span class="lineCov">        207 :         if (!num_keys) {</span></a>
<a name="6458"><span class="lineNum">    6458 </span><span class="lineCov">         12 :                 RETURN_EMPTY_ARRAY();</span></a>
<a name="6459"><span class="lineNum">    6459 </span>            :         }</a>
<a name="6460"><span class="lineNum">    6460 </span>            : </a>
<a name="6461"><span class="lineNum">    6461 </span><span class="lineCov">        195 :         array_init_size(return_value, num_keys);</span></a>
<a name="6462"><span class="lineNum">    6462 </span><span class="lineCov">       2844 :         ZEND_HASH_FOREACH_VAL(keys, entry_keys) {</span></a>
<a name="6463"><span class="lineNum">    6463 </span>            :                 while (1) {</a>
<a name="6464"><span class="lineNum">    6464 </span><span class="lineCov">       1347 :                         if (pos_values &gt;= values-&gt;nNumUsed) {</span></a>
<a name="6465"><span class="lineNum">    6465 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="6466"><span class="lineNum">    6466 </span>            :                         }</a>
<a name="6467"><span class="lineNum">    6467 </span><span class="lineCov">       1347 :                         entry_values = ZEND_HASH_ELEMENT(values, pos_values);</span></a>
<a name="6468"><span class="lineNum">    6468 </span><span class="lineCov">       1347 :                         if (Z_TYPE_P(entry_values) != IS_UNDEF) {</span></a>
<a name="6469"><span class="lineNum">    6469 </span><span class="lineCov">       1314 :                                 if (Z_TYPE_P(entry_keys) == IS_LONG) {</span></a>
<a name="6470"><span class="lineNum">    6470 </span><span class="lineCov">        912 :                                         entry_values = zend_hash_index_update(Z_ARRVAL_P(return_value),</span></a>
<a name="6471"><span class="lineNum">    6471 </span><span class="lineCov">        912 :                                                 Z_LVAL_P(entry_keys), entry_values);</span></a>
<a name="6472"><span class="lineNum">    6472 </span>            :                                 } else {</a>
<a name="6473"><span class="lineNum">    6473 </span>            :                                         zend_string *tmp_key;</a>
<a name="6474"><span class="lineNum">    6474 </span><span class="lineCov">        402 :                                         zend_string *key = zval_get_tmp_string(entry_keys, &amp;tmp_key);</span></a>
<a name="6475"><span class="lineNum">    6475 </span><span class="lineCov">        402 :                                         entry_values = zend_symtable_update(Z_ARRVAL_P(return_value),</span></a>
<a name="6476"><span class="lineNum">    6476 </span>            :                                                 key, entry_values);</a>
<a name="6477"><span class="lineNum">    6477 </span><span class="lineCov">        402 :                                         zend_tmp_string_release(tmp_key);</span></a>
<a name="6478"><span class="lineNum">    6478 </span>            :                                 }</a>
<a name="6479"><span class="lineNum">    6479 </span><span class="lineCov">       1314 :                                 zval_add_ref(entry_values);</span></a>
<a name="6480"><span class="lineNum">    6480 </span><span class="lineCov">       1314 :                                 pos_values++;</span></a>
<a name="6481"><span class="lineNum">    6481 </span><span class="lineCov">       1314 :                                 break;</span></a>
<a name="6482"><span class="lineNum">    6482 </span>            :                         }</a>
<a name="6483"><span class="lineNum">    6483 </span><span class="lineCov">         33 :                         pos_values++;</span></a>
<a name="6484"><span class="lineNum">    6484 </span>            :                 }</a>
<a name="6485"><span class="lineNum">    6485 </span>            :         } ZEND_HASH_FOREACH_END();</a>
<a name="6486"><span class="lineNum">    6486 </span>            : }</a>
<a name="6487"><span class="lineNum">    6487 </span>            : /* }}} */</a>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.14</a></td></tr>
  </table>
  <br>

</body>
</html>
